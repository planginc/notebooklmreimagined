{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","type":"user","message":{"role":"user","content":"Redesign the notebook page at `/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/app/notebooks/[id]/page.tsx` to look like Google's NotebookLM - clean, modern, and professional.\n\nKey design requirements:\n1. Clean three-panel layout with proper spacing\n2. Left panel: Minimal source list with subtle selection states\n3. Center panel: Clean chat interface with proper message bubbles\n4. Right panel (Studio): Collapsible accordion sections instead of cramped cards, clean tabs\n\nDesign principles:\n- Use subtle borders and shadows instead of heavy outlines\n- Proper whitespace and breathing room\n- Clean typography hierarchy\n- Smooth hover states and transitions\n- Study materials should appear in a modal/dialog or slide-over panel, not cramped in the sidebar\n- Use a cohesive color palette (neutral grays with accent colors)\n- Modern, minimal aesthetic\n\nThe file already has all the functionality working (flashcards, quiz, study guide, FAQ, chat, sources, notes, audio/video generation) - just needs visual polish. Keep all the existing state and handlers but redesign the JSX/Tailwind styles.\n\nThis is a NotebookLM clone and should look as polished as the original Google product. Make it beautiful!"},"uuid":"9beaa3e9-95e7-4622-b3ae-02b9ed462f0b","timestamp":"2025-12-28T12:50:43.039Z"}
{"parentUuid":"9beaa3e9-95e7-4622-b3ae-02b9ed462f0b","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_011WcsMSmGjk16UjDf89eiSZ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SCpKKAWEvh9hVTugv3WLZp","name":"Read","input":{"file_path":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/app/notebooks/[id]/page.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":6051,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":6051,"ephemeral_1h_input_tokens":0},"output_tokens":90,"service_tier":"standard"}},"requestId":"req_011CWZ7bGz5vo6KazwLbh3oD","type":"assistant","uuid":"0f582fb2-9df2-4897-9063-dbaa8cc34f88","timestamp":"2025-12-28T12:50:48.025Z"}
{"parentUuid":"0f582fb2-9df2-4897-9063-dbaa8cc34f88","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SCpKKAWEvh9hVTugv3WLZp","type":"tool_result","content":"     1→'use client'\n     2→\n     3→import { useEffect, useState, useRef, useCallback } from 'react'\n     4→import { useParams, useRouter } from 'next/navigation'\n     5→import { createClient, Notebook, Source, ChatMessage } from '@/lib/supabase'\n     6→import { chatApi, Note } from '@/lib/api'\n     7→import { Button } from '@/components/ui/button'\n     8→import { Input } from '@/components/ui/input'\n     9→import { Textarea } from '@/components/ui/textarea'\n    10→import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\n    11→import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'\n    12→import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\n    13→import { Badge } from '@/components/ui/badge'\n    14→import { Separator } from '@/components/ui/separator'\n    15→import { Progress } from '@/components/ui/progress'\n    16→import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\n    17→import {\n    18→  ArrowLeft, Plus, Upload, FileText, Youtube, Link as LinkIcon,\n    19→  Type, Send, Loader2, CheckCircle, XCircle, Clock, Trash2,\n    20→  Mic, Video, Search, BookOpen, StickyNote, Sparkles, Pin,\n    21→  Edit2, Save, X, AlertCircle, ChevronDown\n    22→} from 'lucide-react'\n    23→import { toast } from 'sonner'\n    24→import { User } from '@supabase/supabase-js'\n    25→\n    26→interface LocalNote {\n    27→  id: string\n    28→  notebook_id: string\n    29→  type: 'written' | 'saved_response'\n    30→  title: string | null\n    31→  content: string | null\n    32→  tags: string[]\n    33→  is_pinned: boolean\n    34→  created_at: string\n    35→  updated_at: string\n    36→}\n    37→\n    38→export default function NotebookPage() {\n    39→  const params = useParams()\n    40→  const router = useRouter()\n    41→  const notebookId = params.id as string\n    42→  const supabase = createClient()\n    43→\n    44→  // Core state\n    45→  const [user, setUser] = useState<User | null>(null)\n    46→  const [notebook, setNotebook] = useState<Notebook | null>(null)\n    47→  const [sources, setSources] = useState<Source[]>([])\n    48→  const [messages, setMessages] = useState<ChatMessage[]>([])\n    49→  const [notes, setNotes] = useState<LocalNote[]>([])\n    50→  const [loading, setLoading] = useState(true)\n    51→\n    52→  // Chat state\n    53→  const [sending, setSending] = useState(false)\n    54→  const [message, setMessage] = useState('')\n    55→  const [selectedSources, setSelectedSources] = useState<Set<string>>(new Set())\n    56→  const [sessionId, setSessionId] = useState<string | null>(null)\n    57→\n    58→  // Source modal state\n    59→  const [addSourceOpen, setAddSourceOpen] = useState(false)\n    60→  const [sourceType, setSourceType] = useState<'file' | 'youtube' | 'url' | 'text'>('file')\n    61→  const [sourceInput, setSourceInput] = useState('')\n    62→  const [sourceName, setSourceName] = useState('')\n    63→  const [uploading, setUploading] = useState(false)\n    64→\n    65→  // Notes state\n    66→  const [addNoteOpen, setAddNoteOpen] = useState(false)\n    67→  const [noteTitle, setNoteTitle] = useState('')\n    68→  const [noteContent, setNoteContent] = useState('')\n    69→  const [editingNote, setEditingNote] = useState<string | null>(null)\n    70→  const [savingNote, setSavingNote] = useState(false)\n    71→\n    72→  // Audio state\n    73→  const [audioFormat, setAudioFormat] = useState('deep_dive')\n    74→  const [audioInstructions, setAudioInstructions] = useState('')\n    75→  const [generatingAudio, setGeneratingAudio] = useState(false)\n    76→\n    77→  // Video state\n    78→  const [videoStyle, setVideoStyle] = useState('explainer')\n    79→  const [generatingVideo, setGeneratingVideo] = useState(false)\n    80→\n    81→  // Research state\n    82→  const [researchQuery, setResearchQuery] = useState('')\n    83→  const [researchMode, setResearchMode] = useState('fast')\n    84→  const [researching, setResearching] = useState(false)\n    85→\n    86→  // Study loading states\n    87→  const [generatingFlashcards, setGeneratingFlashcards] = useState(false)\n    88→  const [generatingQuiz, setGeneratingQuiz] = useState(false)\n    89→  const [generatingStudyGuide, setGeneratingStudyGuide] = useState(false)\n    90→  const [generatingFaq, setGeneratingFaq] = useState(false)\n    91→\n    92→  // Study results\n    93→  const [flashcards, setFlashcards] = useState<Array<{id: string, front: string, back: string}>>([])\n    94→  const [quizQuestions, setQuizQuestions] = useState<Array<{id: string, question: string, options: string[], correct_index: number, explanation: string}>>([])\n    95→  const [studyGuide, setStudyGuide] = useState<{title: string, sections: Array<{heading: string, content: string}>} | null>(null)\n    96→  const [faqItems, setFaqItems] = useState<Array<{question: string, answer: string}>>([])\n    97→  const [currentFlashcard, setCurrentFlashcard] = useState(0)\n    98→  const [showFlashcardBack, setShowFlashcardBack] = useState(false)\n    99→  const [currentQuizQuestion, setCurrentQuizQuestion] = useState(0)\n   100→  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null)\n   101→  const [showQuizAnswer, setShowQuizAnswer] = useState(false)\n   102→\n   103→  // Studio tab state\n   104→  const [studioTab, setStudioTab] = useState('audio')\n   105→\n   106→  // Source preview state\n   107→  const [viewingSource, setViewingSource] = useState<Source | null>(null)\n   108→\n   109→  // Refs\n   110→  const fileInputRef = useRef<HTMLInputElement>(null)\n   111→  const messagesEndRef = useRef<HTMLDivElement>(null)\n   112→\n   113→  // Initialize\n   114→  useEffect(() => {\n   115→    const init = async () => {\n   116→      const { data: { user } } = await supabase.auth.getUser()\n   117→      if (!user) {\n   118→        router.push('/auth/login')\n   119→        return\n   120→      }\n   121→      setUser(user)\n   122→      await Promise.all([fetchNotebook(), fetchSources(), fetchNotes()])\n   123→      setLoading(false)\n   124→    }\n   125→    init()\n   126→  }, [notebookId])\n   127→\n   128→  // Auto-scroll messages\n   129→  useEffect(() => {\n   130→    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n   131→  }, [messages])\n   132→\n   133→  const fetchNotebook = async () => {\n   134→    const { data, error } = await supabase\n   135→      .from('notebooks')\n   136→      .select('*')\n   137→      .eq('id', notebookId)\n   138→      .single()\n   139→\n   140→    if (error || !data) {\n   141→      toast.error('Notebook not found')\n   142→      router.push('/')\n   143→      return\n   144→    }\n   145→    setNotebook(data)\n   146→  }\n   147→\n   148→  const fetchSources = async () => {\n   149→    const { data } = await supabase\n   150→      .from('sources')\n   151→      .select('*')\n   152→      .eq('notebook_id', notebookId)\n   153→      .order('created_at', { ascending: false })\n   154→\n   155→    setSources(data || [])\n   156→  }\n   157→\n   158→  const fetchNotes = async () => {\n   159→    const { data } = await supabase\n   160→      .from('notes')\n   161→      .select('*')\n   162→      .eq('notebook_id', notebookId)\n   163→      .order('is_pinned', { ascending: false })\n   164→      .order('created_at', { ascending: false })\n   165→\n   166→    setNotes(data || [])\n   167→  }\n   168→\n   169→  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n   170→    const file = e.target.files?.[0]\n   171→    if (!file) return\n   172→\n   173→    setUploading(true)\n   174→    const fileExt = file.name.split('.').pop()?.toLowerCase()\n   175→    const filePath = `${user?.id}/${notebookId}/${Date.now()}.${fileExt}`\n   176→\n   177→    const { error: uploadError } = await supabase.storage\n   178→      .from('sources')\n   179→      .upload(filePath, file)\n   180→\n   181→    if (uploadError) {\n   182→      toast.error('Failed to upload file')\n   183→      setUploading(false)\n   184→      return\n   185→    }\n   186→\n   187→    const { data, error } = await supabase\n   188→      .from('sources')\n   189→      .insert({\n   190→        notebook_id: notebookId,\n   191→        type: fileExt === 'pdf' ? 'pdf' : fileExt === 'docx' ? 'docx' : 'txt',\n   192→        name: file.name,\n   193→        status: 'ready',\n   194→        file_path: filePath,\n   195→        original_filename: file.name,\n   196→        mime_type: file.type,\n   197→        file_size_bytes: file.size,\n   198→      })\n   199→      .select()\n   200→      .single()\n   201→\n   202→    if (error) {\n   203→      toast.error('Failed to create source')\n   204→    } else {\n   205→      toast.success('File uploaded!')\n   206→      setSources([data, ...sources])\n   207→      setAddSourceOpen(false)\n   208→    }\n   209→    setUploading(false)\n   210→  }\n   211→\n   212→  const addSource = async () => {\n   213→    if (!sourceInput.trim()) return\n   214→\n   215→    setUploading(true)\n   216→    let sourceData: Partial<Source> = {\n   217→      notebook_id: notebookId,\n   218→      status: 'ready',\n   219→    }\n   220→\n   221→    if (sourceType === 'youtube') {\n   222→      sourceData = {\n   223→        ...sourceData,\n   224→        type: 'youtube',\n   225→        name: sourceName || `YouTube: ${sourceInput}`,\n   226→        metadata: { url: sourceInput },\n   227→      }\n   228→    } else if (sourceType === 'url') {\n   229→      sourceData = {\n   230→        ...sourceData,\n   231→        type: 'url',\n   232→        name: sourceName || sourceInput,\n   233→        metadata: { url: sourceInput },\n   234→      }\n   235→    } else if (sourceType === 'text') {\n   236→      sourceData = {\n   237→        ...sourceData,\n   238→        type: 'text',\n   239→        name: sourceName || 'Pasted Text',\n   240→        metadata: { content: sourceInput },\n   241→      }\n   242→    }\n   243→\n   244→    const { data, error } = await supabase\n   245→      .from('sources')\n   246→      .insert(sourceData)\n   247→      .select()\n   248→      .single()\n   249→\n   250→    if (error) {\n   251→      toast.error('Failed to add source')\n   252→    } else {\n   253→      toast.success('Source added!')\n   254→      setSources([data, ...sources])\n   255→      setSourceInput('')\n   256→      setSourceName('')\n   257→      setAddSourceOpen(false)\n   258→    }\n   259→    setUploading(false)\n   260→  }\n   261→\n   262→  const deleteSource = async (sourceId: string) => {\n   263→    const { error } = await supabase\n   264→      .from('sources')\n   265→      .delete()\n   266→      .eq('id', sourceId)\n   267→\n   268→    if (error) {\n   269→      toast.error('Failed to delete source')\n   270→    } else {\n   271→      setSources(sources.filter(s => s.id !== sourceId))\n   272→      selectedSources.delete(sourceId)\n   273→      setSelectedSources(new Set(selectedSources))\n   274→      toast.success('Source deleted')\n   275→    }\n   276→  }\n   277→\n   278→  const toggleSource = (sourceId: string) => {\n   279→    const newSelected = new Set(selectedSources)\n   280→    if (newSelected.has(sourceId)) {\n   281→      newSelected.delete(sourceId)\n   282→    } else {\n   283→      newSelected.add(sourceId)\n   284→    }\n   285→    setSelectedSources(newSelected)\n   286→  }\n   287→\n   288→  const selectAllSources = () => {\n   289→    if (selectedSources.size === sources.length) {\n   290→      setSelectedSources(new Set())\n   291→    } else {\n   292→      setSelectedSources(new Set(sources.map(s => s.id)))\n   293→    }\n   294→  }\n   295→\n   296→  const sendMessage = async () => {\n   297→    if (!message.trim() || sending) return\n   298→\n   299→    setSending(true)\n   300→    const userMessage: ChatMessage = {\n   301→      id: crypto.randomUUID(),\n   302→      session_id: sessionId || '',\n   303→      role: 'user',\n   304→      content: message,\n   305→      citations: [],\n   306→      source_ids_used: Array.from(selectedSources),\n   307→      model_used: null,\n   308→      input_tokens: null,\n   309→      output_tokens: null,\n   310→      cost_usd: null,\n   311→      created_at: new Date().toISOString(),\n   312→    }\n   313→    setMessages(prev => [...prev, userMessage])\n   314→    setMessage('')\n   315→\n   316→    try {\n   317→      const response = await chatApi.sendMessage(notebookId, {\n   318→        message: userMessage.content,\n   319→        source_ids: Array.from(selectedSources),\n   320→        session_id: sessionId || undefined,\n   321→      })\n   322→\n   323→      if (response.data.session_id) {\n   324→        setSessionId(response.data.session_id)\n   325→      }\n   326→\n   327→      const aiMessage: ChatMessage = {\n   328→        id: response.data.message_id,\n   329→        session_id: response.data.session_id,\n   330→        role: 'assistant',\n   331→        content: response.data.content,\n   332→        citations: response.data.citations,\n   333→        source_ids_used: Array.from(selectedSources),\n   334→        model_used: response.usage?.model_used || 'gemini-2.0-flash',\n   335→        input_tokens: response.usage?.input_tokens || 0,\n   336→        output_tokens: response.usage?.output_tokens || 0,\n   337→        cost_usd: response.usage?.cost_usd || 0,\n   338→        created_at: new Date().toISOString(),\n   339→      }\n   340→      setMessages(prev => [...prev, aiMessage])\n   341→    } catch (error) {\n   342→      toast.error('Failed to send message')\n   343→      // Remove the user message on error\n   344→      setMessages(prev => prev.filter(m => m.id !== userMessage.id))\n   345→    }\n   346→    setSending(false)\n   347→  }\n   348→\n   349→  // Notes functions\n   350→  const createNote = async () => {\n   351→    if (!noteTitle.trim() && !noteContent.trim()) return\n   352→\n   353→    setSavingNote(true)\n   354→    const { data, error } = await supabase\n   355→      .from('notes')\n   356→      .insert({\n   357→        notebook_id: notebookId,\n   358→        type: 'written',\n   359→        title: noteTitle || 'Untitled Note',\n   360→        content: noteContent,\n   361→        tags: [],\n   362→      })\n   363→      .select()\n   364→      .single()\n   365→\n   366→    if (error) {\n   367→      toast.error('Failed to create note')\n   368→    } else {\n   369→      toast.success('Note created!')\n   370→      setNotes([data, ...notes])\n   371→      setNoteTitle('')\n   372→      setNoteContent('')\n   373→      setAddNoteOpen(false)\n   374→    }\n   375→    setSavingNote(false)\n   376→  }\n   377→\n   378→  const updateNote = async (noteId: string, updates: Partial<LocalNote>) => {\n   379→    const { data, error } = await supabase\n   380→      .from('notes')\n   381→      .update({ ...updates, updated_at: new Date().toISOString() })\n   382→      .eq('id', noteId)\n   383→      .select()\n   384→      .single()\n   385→\n   386→    if (error) {\n   387→      toast.error('Failed to update note')\n   388→    } else {\n   389→      setNotes(notes.map(n => n.id === noteId ? data : n))\n   390→      setEditingNote(null)\n   391→    }\n   392→  }\n   393→\n   394→  const deleteNote = async (noteId: string) => {\n   395→    const { error } = await supabase\n   396→      .from('notes')\n   397→      .delete()\n   398→      .eq('id', noteId)\n   399→\n   400→    if (error) {\n   401→      toast.error('Failed to delete note')\n   402→    } else {\n   403→      setNotes(notes.filter(n => n.id !== noteId))\n   404→      toast.success('Note deleted')\n   405→    }\n   406→  }\n   407→\n   408→  const togglePinNote = async (note: LocalNote) => {\n   409→    await updateNote(note.id, { is_pinned: !note.is_pinned })\n   410→  }\n   411→\n   412→  const saveResponseAsNote = async (msg: ChatMessage) => {\n   413→    const { data, error } = await supabase\n   414→      .from('notes')\n   415→      .insert({\n   416→        notebook_id: notebookId,\n   417→        type: 'saved_response',\n   418→        title: `Saved Response - ${new Date().toLocaleDateString()}`,\n   419→        content: msg.content,\n   420→        tags: [],\n   421→      })\n   422→      .select()\n   423→      .single()\n   424→\n   425→    if (error) {\n   426→      toast.error('Failed to save response')\n   427→    } else {\n   428→      toast.success('Response saved as note!')\n   429→      setNotes([data, ...notes])\n   430→    }\n   431→  }\n   432→\n   433→  // Audio generation\n   434→  const generateAudio = async () => {\n   435→    if (selectedSources.size === 0) {\n   436→      toast.error('Please select at least one source')\n   437→      return\n   438→    }\n   439→\n   440→    setGeneratingAudio(true)\n   441→    try {\n   442→      const { data: { session } } = await supabase.auth.getSession()\n   443→      const response = await fetch(`/api/notebooks/${notebookId}/audio`, {\n   444→        method: 'POST',\n   445→        headers: {\n   446→          'Content-Type': 'application/json',\n   447→          'Authorization': `Bearer ${session?.access_token}`,\n   448→        },\n   449→        body: JSON.stringify({\n   450→          format: audioFormat,\n   451→          source_ids: Array.from(selectedSources),\n   452→          custom_instructions: audioInstructions || undefined,\n   453→        }),\n   454→      })\n   455→      const result = await response.json()\n   456→      if (result.error) {\n   457→        toast.error(result.error)\n   458→      } else {\n   459→        toast.success('Audio script generated! (Demo mode - no actual audio file)')\n   460→      }\n   461→    } catch {\n   462→      toast.error('Failed to generate audio')\n   463→    }\n   464→    setGeneratingAudio(false)\n   465→  }\n   466→\n   467→  // Video generation\n   468→  const generateVideo = async () => {\n   469→    if (selectedSources.size === 0) {\n   470→      toast.error('Please select at least one source')\n   471→      return\n   472→    }\n   473→\n   474→    setGeneratingVideo(true)\n   475→    try {\n   476→      const { data: { session } } = await supabase.auth.getSession()\n   477→      const response = await fetch(`/api/notebooks/${notebookId}/video`, {\n   478→        method: 'POST',\n   479→        headers: {\n   480→          'Content-Type': 'application/json',\n   481→          'Authorization': `Bearer ${session?.access_token}`,\n   482→        },\n   483→        body: JSON.stringify({\n   484→          style: videoStyle,\n   485→          source_ids: Array.from(selectedSources),\n   486→        }),\n   487→      })\n   488→      const result = await response.json()\n   489→      if (result.error) {\n   490→        toast.error(result.error)\n   491→      } else {\n   492→        toast.success('Video script generated! (Demo mode - no actual video file)')\n   493→      }\n   494→    } catch {\n   495→      toast.error('Failed to generate video')\n   496→    }\n   497→    setGeneratingVideo(false)\n   498→  }\n   499→\n   500→  // Research generation\n   501→  const runResearch = async () => {\n   502→    if (!researchQuery.trim()) {\n   503→      toast.error('Please enter a research query')\n   504→      return\n   505→    }\n   506→\n   507→    setResearching(true)\n   508→    try {\n   509→      const { data: { session } } = await supabase.auth.getSession()\n   510→      const response = await fetch(`/api/notebooks/${notebookId}/research`, {\n   511→        method: 'POST',\n   512→        headers: {\n   513→          'Content-Type': 'application/json',\n   514→          'Authorization': `Bearer ${session?.access_token}`,\n   515→        },\n   516→        body: JSON.stringify({\n   517→          query: researchQuery,\n   518→          mode: researchMode,\n   519→        }),\n   520→      })\n   521→      const result = await response.json()\n   522→      if (result.error) {\n   523→        toast.error(result.error)\n   524→      } else {\n   525→        toast.success('Research report generated!')\n   526→        setResearchQuery('')\n   527→      }\n   528→    } catch {\n   529→      toast.error('Failed to run research')\n   530→    }\n   531→    setResearching(false)\n   532→  }\n   533→\n   534→  const getStatusIcon = (status: string) => {\n   535→    switch (status) {\n   536→      case 'ready':\n   537→        return <CheckCircle className=\"h-4 w-4 text-green-500\" />\n   538→      case 'processing':\n   539→        return <Clock className=\"h-4 w-4 text-yellow-500 animate-spin\" />\n   540→      case 'failed':\n   541→        return <XCircle className=\"h-4 w-4 text-red-500\" />\n   542→      default:\n   543→        return <Clock className=\"h-4 w-4 text-muted-foreground\" />\n   544→    }\n   545→  }\n   546→\n   547→  const getSourceIcon = (type: string) => {\n   548→    switch (type) {\n   549→      case 'pdf':\n   550→      case 'docx':\n   551→      case 'txt':\n   552→        return <FileText className=\"h-4 w-4\" />\n   553→      case 'youtube':\n   554→        return <Youtube className=\"h-4 w-4\" />\n   555→      case 'url':\n   556→        return <LinkIcon className=\"h-4 w-4\" />\n   557→      case 'text':\n   558→        return <Type className=\"h-4 w-4\" />\n   559→      default:\n   560→        return <FileText className=\"h-4 w-4\" />\n   561→    }\n   562→  }\n   563→\n   564→  if (loading) {\n   565→    return (\n   566→      <div className=\"min-h-screen flex items-center justify-center\">\n   567→        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n   568→      </div>\n   569→    )\n   570→  }\n   571→\n   572→  return (\n   573→    <div className=\"h-screen flex flex-col overflow-hidden\">\n   574→      {/* Header */}\n   575→      <header className=\"border-b px-4 py-3 flex items-center gap-4 shrink-0\">\n   576→        <Button variant=\"ghost\" size=\"sm\" onClick={() => router.push('/')}>\n   577→          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n   578→          Back\n   579→        </Button>\n   580→        <Separator orientation=\"vertical\" className=\"h-6\" />\n   581→        <div className=\"flex items-center gap-2\">\n   582→          <span className=\"text-xl\">{notebook?.emoji}</span>\n   583→          <h1 className=\"font-semibold\">{notebook?.name}</h1>\n   584→        </div>\n   585→        <Badge variant=\"secondary\">{sources.length} sources</Badge>\n   586→        <div className=\"ml-auto flex items-center gap-2\">\n   587→          <Badge variant=\"outline\" className=\"text-xs\">\n   588→            {selectedSources.size} selected\n   589→          </Badge>\n   590→        </div>\n   591→      </header>\n   592→\n   593→      {/* Three Panel Layout */}\n   594→      <div className=\"flex-1 grid grid-cols-[256px_1fr_320px] overflow-hidden\">\n   595→        {/* Left Panel - Sources */}\n   596→        <div className=\"border-r flex flex-col bg-background h-full min-h-0\">\n   597→          <div className=\"p-4 border-b shrink-0\">\n   598→            <div className=\"flex items-center justify-between mb-2\">\n   599→              <h2 className=\"font-semibold\">Sources</h2>\n   600→              <Dialog open={addSourceOpen} onOpenChange={setAddSourceOpen}>\n   601→                <DialogTrigger asChild>\n   602→                  <Button size=\"sm\" variant=\"outline\">\n   603→                    <Plus className=\"h-4 w-4\" />\n   604→                  </Button>\n   605→                </DialogTrigger>\n   606→                <DialogContent>\n   607→                  <DialogHeader>\n   608→                    <DialogTitle>Add Source</DialogTitle>\n   609→                    <DialogDescription>\n   610→                      Add documents, URLs, or text to your notebook\n   611→                    </DialogDescription>\n   612→                  </DialogHeader>\n   613→                  <Tabs value={sourceType} onValueChange={(v) => setSourceType(v as typeof sourceType)}>\n   614→                    <TabsList className=\"grid grid-cols-4 w-full\">\n   615→                      <TabsTrigger value=\"file\"><Upload className=\"h-4 w-4\" /></TabsTrigger>\n   616→                      <TabsTrigger value=\"youtube\"><Youtube className=\"h-4 w-4\" /></TabsTrigger>\n   617→                      <TabsTrigger value=\"url\"><LinkIcon className=\"h-4 w-4\" /></TabsTrigger>\n   618→                      <TabsTrigger value=\"text\"><Type className=\"h-4 w-4\" /></TabsTrigger>\n   619→                    </TabsList>\n   620→                    <TabsContent value=\"file\" className=\"space-y-4\">\n   621→                      <input\n   622→                        ref={fileInputRef}\n   623→                        type=\"file\"\n   624→                        accept=\".pdf,.docx,.txt,.md\"\n   625→                        onChange={handleFileUpload}\n   626→                        className=\"hidden\"\n   627→                      />\n   628→                      <Button\n   629→                        variant=\"outline\"\n   630→                        className=\"w-full h-24\"\n   631→                        onClick={() => fileInputRef.current?.click()}\n   632→                        disabled={uploading}\n   633→                      >\n   634→                        {uploading ? (\n   635→                          <Loader2 className=\"h-6 w-6 animate-spin\" />\n   636→                        ) : (\n   637→                          <div className=\"text-center\">\n   638→                            <Upload className=\"h-6 w-6 mx-auto mb-2\" />\n   639→                            <p className=\"text-sm\">Click to upload</p>\n   640→                            <p className=\"text-xs text-muted-foreground\">PDF, DOCX, TXT</p>\n   641→                          </div>\n   642→                        )}\n   643→                      </Button>\n   644→                    </TabsContent>\n   645→                    <TabsContent value=\"youtube\" className=\"space-y-4\">\n   646→                      <Input\n   647→                        placeholder=\"YouTube URL\"\n   648→                        value={sourceInput}\n   649→                        onChange={(e) => setSourceInput(e.target.value)}\n   650→                      />\n   651→                      <Input\n   652→                        placeholder=\"Name (optional)\"\n   653→                        value={sourceName}\n   654→                        onChange={(e) => setSourceName(e.target.value)}\n   655→                      />\n   656→                    </TabsContent>\n   657→                    <TabsContent value=\"url\" className=\"space-y-4\">\n   658→                      <Input\n   659→                        placeholder=\"Website URL\"\n   660→                        value={sourceInput}\n   661→                        onChange={(e) => setSourceInput(e.target.value)}\n   662→                      />\n   663→                      <Input\n   664→                        placeholder=\"Name (optional)\"\n   665→                        value={sourceName}\n   666→                        onChange={(e) => setSourceName(e.target.value)}\n   667→                      />\n   668→                    </TabsContent>\n   669→                    <TabsContent value=\"text\" className=\"space-y-4\">\n   670→                      <Input\n   671→                        placeholder=\"Name\"\n   672→                        value={sourceName}\n   673→                        onChange={(e) => setSourceName(e.target.value)}\n   674→                      />\n   675→                      <Textarea\n   676→                        placeholder=\"Paste your text here...\"\n   677→                        value={sourceInput}\n   678→                        onChange={(e) => setSourceInput(e.target.value)}\n   679→                        rows={6}\n   680→                      />\n   681→                    </TabsContent>\n   682→                  </Tabs>\n   683→                  {sourceType !== 'file' && (\n   684→                    <DialogFooter>\n   685→                      <Button onClick={addSource} disabled={uploading || !sourceInput.trim()}>\n   686→                        {uploading && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n   687→                        Add Source\n   688→                      </Button>\n   689→                    </DialogFooter>\n   690→                  )}\n   691→                </DialogContent>\n   692→              </Dialog>\n   693→            </div>\n   694→            {sources.length > 0 && (\n   695→              <Button\n   696→                variant=\"ghost\"\n   697→                size=\"sm\"\n   698→                className=\"w-full justify-start text-xs\"\n   699→                onClick={selectAllSources}\n   700→              >\n   701→                {selectedSources.size === sources.length ? 'Deselect All' : 'Select All'}\n   702→              </Button>\n   703→            )}\n   704→          </div>\n   705→          <div className=\"flex-1 min-h-0 overflow-y-auto\">\n   706→            <div className=\"p-2 space-y-1\">\n   707→              {sources.length === 0 ? (\n   708→                <div className=\"text-center py-8 text-muted-foreground\">\n   709→                  <FileText className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n   710→                  <p className=\"text-sm\">No sources yet</p>\n   711→                  <p className=\"text-xs\">Add documents to get started</p>\n   712→                </div>\n   713→              ) : (\n   714→                sources.map((source) => (\n   715→                  <div\n   716→                    key={source.id}\n   717→                    className={`p-2 rounded-lg flex items-center gap-2 group ${\n   718→                      selectedSources.has(source.id) ? 'bg-primary/10' : 'hover:bg-muted'\n   719→                    } ${viewingSource?.id === source.id ? 'ring-2 ring-primary' : ''}`}\n   720→                  >\n   721→                    <input\n   722→                      type=\"checkbox\"\n   723→                      checked={selectedSources.has(source.id)}\n   724→                      onChange={() => toggleSource(source.id)}\n   725→                      className=\"rounded cursor-pointer\"\n   726→                    />\n   727→                    {getSourceIcon(source.type)}\n   728→                    <span\n   729→                      className=\"flex-1 text-sm truncate cursor-pointer hover:underline select-text\"\n   730→                      onClick={() => setViewingSource(source)}\n   731→                    >\n   732→                      {source.name}\n   733→                    </span>\n   734→                    {getStatusIcon(source.status)}\n   735→                    <Button\n   736→                      variant=\"ghost\"\n   737→                      size=\"sm\"\n   738→                      className=\"opacity-0 group-hover:opacity-100 h-6 w-6 p-0\"\n   739→                      onClick={() => deleteSource(source.id)}\n   740→                    >\n   741→                      <Trash2 className=\"h-3 w-3\" />\n   742→                    </Button>\n   743→                  </div>\n   744→                ))\n   745→              )}\n   746→            </div>\n   747→          </div>\n   748→        </div>\n   749→\n   750→        {/* Center Panel - Chat or Source Preview */}\n   751→        <div className=\"flex flex-col h-full min-h-0\">\n   752→          {/* Source Preview */}\n   753→          {viewingSource && (\n   754→            <div className=\"border-b bg-muted/30 shrink-0\">\n   755→              <div className=\"max-w-3xl mx-auto p-4\">\n   756→                <div className=\"flex items-center justify-between mb-3\">\n   757→                  <div className=\"flex items-center gap-2\">\n   758→                    {getSourceIcon(viewingSource.type)}\n   759→                    <h3 className=\"font-medium\">{viewingSource.name}</h3>\n   760→                    <Badge variant=\"outline\" className=\"text-xs\">{viewingSource.type}</Badge>\n   761→                  </div>\n   762→                  <Button variant=\"ghost\" size=\"sm\" onClick={() => setViewingSource(null)}>\n   763→                    <X className=\"h-4 w-4\" />\n   764→                  </Button>\n   765→                </div>\n   766→                <div className=\"bg-background rounded-lg border p-4 max-h-48 overflow-y-auto\">\n   767→                  {viewingSource.type === 'text' && viewingSource.metadata?.content ? (\n   768→                    <p className=\"text-sm whitespace-pre-wrap select-text\">{viewingSource.metadata.content}</p>\n   769→                  ) : viewingSource.type === 'youtube' && viewingSource.metadata?.url ? (\n   770→                    <div className=\"space-y-2\">\n   771→                      <p className=\"text-sm text-muted-foreground\">YouTube URL:</p>\n   772→                      <a href={viewingSource.metadata.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-sm text-primary hover:underline break-all select-text\">\n   773→                        {viewingSource.metadata.url}\n   774→                      </a>\n   775→                    </div>\n   776→                  ) : viewingSource.type === 'url' && viewingSource.metadata?.url ? (\n   777→                    <div className=\"space-y-2\">\n   778→                      <p className=\"text-sm text-muted-foreground\">Website URL:</p>\n   779→                      <a href={viewingSource.metadata.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-sm text-primary hover:underline break-all select-text\">\n   780→                        {viewingSource.metadata.url}\n   781→                      </a>\n   782→                    </div>\n   783→                  ) : viewingSource.file_path ? (\n   784→                    <div className=\"space-y-2\">\n   785→                      <p className=\"text-sm text-muted-foreground\">File: {viewingSource.original_filename || viewingSource.name}</p>\n   786→                      <p className=\"text-xs text-muted-foreground\">Size: {viewingSource.file_size_bytes ? `${(viewingSource.file_size_bytes / 1024).toFixed(1)} KB` : 'Unknown'}</p>\n   787→                    </div>\n   788→                  ) : (\n   789→                    <p className=\"text-sm text-muted-foreground\">No preview available</p>\n   790→                  )}\n   791→                </div>\n   792→              </div>\n   793→            </div>\n   794→          )}\n   795→\n   796→          <div className=\"flex-1 min-h-0 overflow-y-auto p-4\">\n   797→            <div className=\"max-w-3xl mx-auto space-y-4\">\n   798→              {messages.length === 0 ? (\n   799→                <div className=\"text-center py-16\">\n   800→                  <Sparkles className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n   801→                  <h3 className=\"text-lg font-medium mb-2\">Start a Conversation</h3>\n   802→                  <p className=\"text-muted-foreground mb-4\">\n   803→                    Ask questions about your sources\n   804→                  </p>\n   805→                  <div className=\"flex flex-wrap justify-center gap-2\">\n   806→                    {['Summarize the main points', 'What are the key takeaways?', 'Explain the methodology'].map((q) => (\n   807→                      <Button\n   808→                        key={q}\n   809→                        variant=\"outline\"\n   810→                        size=\"sm\"\n   811→                        onClick={() => setMessage(q)}\n   812→                      >\n   813→                        {q}\n   814→                      </Button>\n   815→                    ))}\n   816→                  </div>\n   817→                </div>\n   818→              ) : (\n   819→                messages.map((msg) => (\n   820→                  <div\n   821→                    key={msg.id}\n   822→                    className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}\n   823→                  >\n   824→                    <div\n   825→                      className={`max-w-[80%] rounded-2xl px-4 py-3 ${\n   826→                        msg.role === 'user'\n   827→                          ? 'bg-primary text-primary-foreground'\n   828→                          : 'bg-muted'\n   829→                      }`}\n   830→                    >\n   831→                      <p className=\"whitespace-pre-wrap text-sm select-text\">{msg.content}</p>\n   832→                      {msg.role === 'assistant' && (\n   833→                        <div className=\"flex items-center gap-2 mt-2 pt-2 border-t border-border/50\">\n   834→                          {msg.cost_usd !== null && msg.cost_usd > 0 && (\n   835→                            <span className=\"text-xs opacity-70\">\n   836→                              Cost: ${msg.cost_usd.toFixed(4)}\n   837→                            </span>\n   838→                          )}\n   839→                          <Button\n   840→                            variant=\"ghost\"\n   841→                            size=\"sm\"\n   842→                            className=\"h-6 text-xs ml-auto\"\n   843→                            onClick={() => saveResponseAsNote(msg)}\n   844→                          >\n   845→                            <StickyNote className=\"h-3 w-3 mr-1\" />\n   846→                            Save\n   847→                          </Button>\n   848→                        </div>\n   849→                      )}\n   850→                    </div>\n   851→                  </div>\n   852→                ))\n   853→              )}\n   854→              {sending && (\n   855→                <div className=\"flex justify-start\">\n   856→                  <div className=\"bg-muted rounded-2xl px-4 py-3\">\n   857→                    <Loader2 className=\"h-5 w-5 animate-spin\" />\n   858→                  </div>\n   859→                </div>\n   860→              )}\n   861→              <div ref={messagesEndRef} />\n   862→            </div>\n   863→          </div>\n   864→          <div className=\"p-4 border-t shrink-0\">\n   865→            <div className=\"max-w-3xl mx-auto\">\n   866→              {selectedSources.size === 0 && sources.length > 0 && (\n   867→                <div className=\"flex items-center gap-2 mb-2 text-xs text-amber-600 bg-amber-50 dark:bg-amber-900/20 p-2 rounded-lg\">\n   868→                  <AlertCircle className=\"h-4 w-4\" />\n   869→                  Select sources from the left panel for contextual answers\n   870→                </div>\n   871→              )}\n   872→              <div className=\"flex gap-2\">\n   873→                <Input\n   874→                  placeholder=\"Ask a question about your sources...\"\n   875→                  value={message}\n   876→                  onChange={(e) => setMessage(e.target.value)}\n   877→                  onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && sendMessage()}\n   878→                  disabled={sending}\n   879→                />\n   880→                <Button onClick={sendMessage} disabled={sending || !message.trim()}>\n   881→                  <Send className=\"h-4 w-4\" />\n   882→                </Button>\n   883→              </div>\n   884→            </div>\n   885→          </div>\n   886→        </div>\n   887→\n   888→        {/* Right Panel - Studio */}\n   889→        <div className=\"border-l flex flex-col bg-background h-full min-h-0\">\n   890→          <Tabs value={studioTab} onValueChange={setStudioTab} className=\"flex flex-col h-full min-h-0\">\n   891→            <div className=\"p-4 border-b shrink-0\">\n   892→              <h2 className=\"font-semibold mb-2\">Studio</h2>\n   893→              <TabsList className=\"grid grid-cols-3 w-full\">\n   894→                <TabsTrigger value=\"audio\" className=\"text-xs\">\n   895→                  <Mic className=\"h-3 w-3 mr-1\" />\n   896→                  Audio\n   897→                </TabsTrigger>\n   898→                <TabsTrigger value=\"study\" className=\"text-xs\">\n   899→                  <BookOpen className=\"h-3 w-3 mr-1\" />\n   900→                  Study\n   901→                </TabsTrigger>\n   902→                <TabsTrigger value=\"notes\" className=\"text-xs\">\n   903→                  <StickyNote className=\"h-3 w-3 mr-1\" />\n   904→                  Notes\n   905→                </TabsTrigger>\n   906→              </TabsList>\n   907→            </div>\n   908→\n   909→            <div className=\"flex-1 min-h-0 overflow-y-auto p-4\">\n   910→              <TabsContent value=\"audio\" className=\"mt-0 space-y-4\">\n   911→                <Card>\n   912→                  <CardHeader className=\"pb-2\">\n   913→                    <CardTitle className=\"text-sm flex items-center gap-2\">\n   914→                      <Mic className=\"h-4 w-4\" />\n   915→                      Audio Overview\n   916→                    </CardTitle>\n   917→                    <CardDescription className=\"text-xs\">\n   918→                      Generate a podcast-style discussion\n   919→                    </CardDescription>\n   920→                  </CardHeader>\n   921→                  <CardContent className=\"space-y-3\">\n   922→                    <div>\n   923→                      <label className=\"text-xs font-medium mb-1 block\">Format</label>\n   924→                      <Select value={audioFormat} onValueChange={setAudioFormat}>\n   925→                        <SelectTrigger className=\"h-8 text-xs\">\n   926→                          <SelectValue />\n   927→                        </SelectTrigger>\n   928→                        <SelectContent>\n   929→                          <SelectItem value=\"deep_dive\">Deep Dive (10-15 min)</SelectItem>\n   930→                          <SelectItem value=\"brief\">Brief Summary (2-3 min)</SelectItem>\n   931→                          <SelectItem value=\"critique\">Analytical Discussion (5-10 min)</SelectItem>\n   932→                          <SelectItem value=\"debate\">Debate Format (8-15 min)</SelectItem>\n   933→                        </SelectContent>\n   934→                      </Select>\n   935→                    </div>\n   936→                    <div>\n   937→                      <label className=\"text-xs font-medium mb-1 block\">Custom Instructions</label>\n   938→                      <Textarea\n   939→                        placeholder=\"Optional instructions for the hosts...\"\n   940→                        value={audioInstructions}\n   941→                        onChange={(e) => setAudioInstructions(e.target.value)}\n   942→                        rows={2}\n   943→                        className=\"text-xs\"\n   944→                      />\n   945→                    </div>\n   946→                    <Button\n   947→                      className=\"w-full\"\n   948→                      size=\"sm\"\n   949→                      onClick={generateAudio}\n   950→                      disabled={generatingAudio || selectedSources.size === 0}\n   951→                    >\n   952→                      {generatingAudio ? (\n   953→                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n   954→                      ) : (\n   955→                        <Mic className=\"h-4 w-4 mr-2\" />\n   956→                      )}\n   957→                      Generate Audio\n   958→                    </Button>\n   959→                    {selectedSources.size === 0 && (\n   960→                      <p className=\"text-xs text-muted-foreground text-center\">\n   961→                        Select sources to generate audio\n   962→                      </p>\n   963→                    )}\n   964→                  </CardContent>\n   965→                </Card>\n   966→\n   967→                <Card>\n   968→                  <CardHeader className=\"pb-2\">\n   969→                    <CardTitle className=\"text-sm flex items-center gap-2\">\n   970→                      <Video className=\"h-4 w-4\" />\n   971→                      Video Overview\n   972→                    </CardTitle>\n   973→                    <CardDescription className=\"text-xs\">\n   974→                      Create a visual explainer video\n   975→                    </CardDescription>\n   976→                  </CardHeader>\n   977→                  <CardContent className=\"space-y-3\">\n   978→                    <div>\n   979→                      <label className=\"text-xs font-medium mb-1 block\">Style</label>\n   980→                      <Select value={videoStyle} onValueChange={setVideoStyle}>\n   981→                        <SelectTrigger className=\"h-8 text-xs\">\n   982→                          <SelectValue />\n   983→                        </SelectTrigger>\n   984→                        <SelectContent>\n   985→                          <SelectItem value=\"explainer\">Explainer</SelectItem>\n   986→                          <SelectItem value=\"documentary\">Documentary</SelectItem>\n   987→                          <SelectItem value=\"presentation\">Presentation</SelectItem>\n   988→                        </SelectContent>\n   989→                      </Select>\n   990→                    </div>\n   991→                    <Button\n   992→                      className=\"w-full\"\n   993→                      size=\"sm\"\n   994→                      onClick={generateVideo}\n   995→                      disabled={generatingVideo || selectedSources.size === 0}\n   996→                    >\n   997→                      {generatingVideo ? (\n   998→                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n   999→                      ) : (\n  1000→                        <Video className=\"h-4 w-4 mr-2\" />\n  1001→                      )}\n  1002→                      Generate Video Script\n  1003→                    </Button>\n  1004→                    {selectedSources.size === 0 && (\n  1005→                      <p className=\"text-xs text-muted-foreground text-center\">\n  1006→                        Select sources to generate video\n  1007→                      </p>\n  1008→                    )}\n  1009→                  </CardContent>\n  1010→                </Card>\n  1011→\n  1012→                <Card>\n  1013→                  <CardHeader className=\"pb-2\">\n  1014→                    <CardTitle className=\"text-sm flex items-center gap-2\">\n  1015→                      <Search className=\"h-4 w-4\" />\n  1016→                      Deep Research\n  1017→                    </CardTitle>\n  1018→                    <CardDescription className=\"text-xs\">\n  1019→                      Autonomous web research agent\n  1020→                    </CardDescription>\n  1021→                  </CardHeader>\n  1022→                  <CardContent className=\"space-y-3\">\n  1023→                    <div>\n  1024→                      <label className=\"text-xs font-medium mb-1 block\">Research Query</label>\n  1025→                      <Input\n  1026→                        placeholder=\"What would you like to research?\"\n  1027→                        value={researchQuery}\n  1028→                        onChange={(e) => setResearchQuery(e.target.value)}\n  1029→                        className=\"h-8 text-xs\"\n  1030→                      />\n  1031→                    </div>\n  1032→                    <div>\n  1033→                      <label className=\"text-xs font-medium mb-1 block\">Mode</label>\n  1034→                      <Select value={researchMode} onValueChange={setResearchMode}>\n  1035→                        <SelectTrigger className=\"h-8 text-xs\">\n  1036→                          <SelectValue />\n  1037→                        </SelectTrigger>\n  1038→                        <SelectContent>\n  1039→                          <SelectItem value=\"fast\">Fast (3-5 min)</SelectItem>\n  1040→                          <SelectItem value=\"deep\">Deep (10-15 min)</SelectItem>\n  1041→                        </SelectContent>\n  1042→                      </Select>\n  1043→                    </div>\n  1044→                    <Button\n  1045→                      className=\"w-full\"\n  1046→                      size=\"sm\"\n  1047→                      onClick={runResearch}\n  1048→                      disabled={researching || !researchQuery.trim()}\n  1049→                    >\n  1050→                      {researching ? (\n  1051→                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n  1052→                      ) : (\n  1053→                        <Search className=\"h-4 w-4 mr-2\" />\n  1054→                      )}\n  1055→                      Start Research\n  1056→                    </Button>\n  1057→                  </CardContent>\n  1058→                </Card>\n  1059→              </TabsContent>\n  1060→\n  1061→              <TabsContent value=\"study\" className=\"mt-0 space-y-4\">\n  1062→                <Card>\n  1063→                  <CardHeader className=\"pb-2\">\n  1064→                    <CardTitle className=\"text-sm\">Study Materials</CardTitle>\n  1065→                    <CardDescription className=\"text-xs\">\n  1066→                      Generate study aids from your sources\n  1067→                    </CardDescription>\n  1068→                  </CardHeader>\n  1069→                  <CardContent className=\"space-y-2\">\n  1070→                    <Button\n  1071→                      variant=\"outline\"\n  1072→                      size=\"sm\"\n  1073→                      className=\"w-full justify-start\"\n  1074→                      disabled={selectedSources.size === 0 || generatingFlashcards}\n  1075→                      onClick={async () => {\n  1076→                        setGeneratingFlashcards(true)\n  1077→                        try {\n  1078→                          const { data: { session } } = await supabase.auth.getSession()\n  1079→                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n  1080→                            method: 'POST',\n  1081→                            headers: {\n  1082→                              'Content-Type': 'application/json',\n  1083→                              'Authorization': `Bearer ${session?.access_token}`,\n  1084→                            },\n  1085→                            body: JSON.stringify({\n  1086→                              type: 'flashcards',\n  1087→                              source_ids: Array.from(selectedSources),\n  1088→                              count: 5,\n  1089→                            }),\n  1090→                          })\n  1091→                          const result = await response.json()\n  1092→                          if (result.error) {\n  1093→                            toast.error(result.error)\n  1094→                          } else if (result.data?.flashcards) {\n  1095→                            setFlashcards(result.data.flashcards)\n  1096→                            setCurrentFlashcard(0)\n  1097→                            setShowFlashcardBack(false)\n  1098→                            toast.success(`Generated ${result.data.flashcards.length} flashcards!`)\n  1099→                          } else {\n  1100→                            toast.error('Unexpected response')\n  1101→                          }\n  1102→                        } catch (err) {\n  1103→                          console.error('Flashcards error:', err)\n  1104→                          toast.error('Failed to generate flashcards')\n  1105→                        } finally {\n  1106→                          setGeneratingFlashcards(false)\n  1107→                        }\n  1108→                      }}\n  1109→                    >\n  1110→                      {generatingFlashcards ? (\n  1111→                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n  1112→                      ) : (\n  1113→                        <BookOpen className=\"h-4 w-4 mr-2\" />\n  1114→                      )}\n  1115→                      {generatingFlashcards ? 'Generating...' : 'Generate Flashcards'}\n  1116→                    </Button>\n  1117→                    <Button\n  1118→                      variant=\"outline\"\n  1119→                      size=\"sm\"\n  1120→                      className=\"w-full justify-start\"\n  1121→                      disabled={selectedSources.size === 0 || generatingQuiz}\n  1122→                      onClick={async () => {\n  1123→                        setGeneratingQuiz(true)\n  1124→                        try {\n  1125→                          const { data: { session } } = await supabase.auth.getSession()\n  1126→                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n  1127→                            method: 'POST',\n  1128→                            headers: {\n  1129→                              'Content-Type': 'application/json',\n  1130→                              'Authorization': `Bearer ${session?.access_token}`,\n  1131→                            },\n  1132→                            body: JSON.stringify({\n  1133→                              type: 'quiz',\n  1134→                              source_ids: Array.from(selectedSources),\n  1135→                              count: 5,\n  1136→                            }),\n  1137→                          })\n  1138→                          const result = await response.json()\n  1139→                          if (result.error) {\n  1140→                            toast.error(result.error)\n  1141→                          } else if (result.data?.questions) {\n  1142→                            setQuizQuestions(result.data.questions)\n  1143→                            setCurrentQuizQuestion(0)\n  1144→                            setSelectedAnswer(null)\n  1145→                            setShowQuizAnswer(false)\n  1146→                            toast.success(`Generated ${result.data.questions.length} quiz questions!`)\n  1147→                          } else {\n  1148→                            toast.error('Unexpected response')\n  1149→                          }\n  1150→                        } catch (err) {\n  1151→                          console.error('Quiz error:', err)\n  1152→                          toast.error('Failed to generate quiz')\n  1153→                        } finally {\n  1154→                          setGeneratingQuiz(false)\n  1155→                        }\n  1156→                      }}\n  1157→                    >\n  1158→                      {generatingQuiz ? (\n  1159→                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n  1160→                      ) : (\n  1161→                        <CheckCircle className=\"h-4 w-4 mr-2\" />\n  1162→                      )}\n  1163→                      {generatingQuiz ? 'Generating...' : 'Generate Quiz'}\n  1164→                    </Button>\n  1165→                    <Button\n  1166→                      variant=\"outline\"\n  1167→                      size=\"sm\"\n  1168→                      className=\"w-full justify-start\"\n  1169→                      disabled={selectedSources.size === 0 || generatingStudyGuide}\n  1170→                      onClick={async () => {\n  1171→                        setGeneratingStudyGuide(true)\n  1172→                        try {\n  1173→                          const { data: { session } } = await supabase.auth.getSession()\n  1174→                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n  1175→                            method: 'POST',\n  1176→                            headers: {\n  1177→                              'Content-Type': 'application/json',\n  1178→                              'Authorization': `Bearer ${session?.access_token}`,\n  1179→                            },\n  1180→                            body: JSON.stringify({\n  1181→                              type: 'study-guide',\n  1182→                              source_ids: Array.from(selectedSources),\n  1183→                            }),\n  1184→                          })\n  1185→                          const result = await response.json()\n  1186→                          if (result.error) {\n  1187→                            toast.error(result.error)\n  1188→                          } else if (result.data?.sections) {\n  1189→                            setStudyGuide(result.data)\n  1190→                            toast.success('Study guide generated!')\n  1191→                          } else {\n  1192→                            toast.error('Unexpected response')\n  1193→                          }\n  1194→                        } catch (err) {\n  1195→                          console.error('Study guide error:', err)\n  1196→                          toast.error('Failed to generate study guide')\n  1197→                        } finally {\n  1198→                          setGeneratingStudyGuide(false)\n  1199→                        }\n  1200→                      }}\n  1201→                    >\n  1202→                      {generatingStudyGuide ? (\n  1203→                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n  1204→                      ) : (\n  1205→                        <FileText className=\"h-4 w-4 mr-2\" />\n  1206→                      )}\n  1207→                      {generatingStudyGuide ? 'Generating...' : 'Generate Study Guide'}\n  1208→                    </Button>\n  1209→                    <Button\n  1210→                      variant=\"outline\"\n  1211→                      size=\"sm\"\n  1212→                      className=\"w-full justify-start\"\n  1213→                      disabled={selectedSources.size === 0 || generatingFaq}\n  1214→                      onClick={async () => {\n  1215→                        setGeneratingFaq(true)\n  1216→                        try {\n  1217→                          const { data: { session } } = await supabase.auth.getSession()\n  1218→                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n  1219→                            method: 'POST',\n  1220→                            headers: {\n  1221→                              'Content-Type': 'application/json',\n  1222→                              'Authorization': `Bearer ${session?.access_token}`,\n  1223→                            },\n  1224→                            body: JSON.stringify({\n  1225→                              type: 'faq',\n  1226→                              source_ids: Array.from(selectedSources),\n  1227→                            }),\n  1228→                          })\n  1229→                          const result = await response.json()\n  1230→                          if (result.error) {\n  1231→                            toast.error(result.error)\n  1232→                          } else if (result.data?.faq) {\n  1233→                            setFaqItems(result.data.faq)\n  1234→                            toast.success(`Generated ${result.data.faq.length} FAQ items!`)\n  1235→                          } else {\n  1236→                            toast.error('Unexpected response')\n  1237→                          }\n  1238→                        } catch (err) {\n  1239→                          console.error('FAQ error:', err)\n  1240→                          toast.error('Failed to generate FAQ')\n  1241→                        } finally {\n  1242→                          setGeneratingFaq(false)\n  1243→                        }\n  1244→                      }}\n  1245→                    >\n  1246→                      {generatingFaq ? (\n  1247→                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n  1248→                      ) : (\n  1249→                        <AlertCircle className=\"h-4 w-4 mr-2\" />\n  1250→                      )}\n  1251→                      {generatingFaq ? 'Generating...' : 'Generate FAQ'}\n  1252→                    </Button>\n  1253→                  </CardContent>\n  1254→                </Card>\n  1255→\n  1256→                {/* Flashcards Display */}\n  1257→                {flashcards.length > 0 && (\n  1258→                  <Card>\n  1259→                    <CardHeader className=\"pb-2\">\n  1260→                      <div className=\"flex items-center justify-between\">\n  1261→                        <CardTitle className=\"text-sm\">Flashcards</CardTitle>\n  1262→                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setFlashcards([])}>\n  1263→                          <X className=\"h-3 w-3\" />\n  1264→                        </Button>\n  1265→                      </div>\n  1266→                      <CardDescription className=\"text-xs\">\n  1267→                        {currentFlashcard + 1} of {flashcards.length}\n  1268→                      </CardDescription>\n  1269→                    </CardHeader>\n  1270→                    <CardContent>\n  1271→                      <div\n  1272→                        className=\"bg-muted rounded-lg p-4 min-h-[120px] cursor-pointer select-text\"\n  1273→                        onClick={() => setShowFlashcardBack(!showFlashcardBack)}\n  1274→                      >\n  1275→                        <p className=\"text-xs text-muted-foreground mb-1\">\n  1276→                          {showFlashcardBack ? 'Answer' : 'Question'} (click to flip)\n  1277→                        </p>\n  1278→                        <p className=\"text-sm\">\n  1279→                          {showFlashcardBack ? flashcards[currentFlashcard]?.back : flashcards[currentFlashcard]?.front}\n  1280→                        </p>\n  1281→                      </div>\n  1282→                      <div className=\"flex gap-2 mt-3\">\n  1283→                        <Button\n  1284→                          variant=\"outline\"\n  1285→                          size=\"sm\"\n  1286→                          className=\"flex-1\"\n  1287→                          disabled={currentFlashcard === 0}\n  1288→                          onClick={() => { setCurrentFlashcard(c => c - 1); setShowFlashcardBack(false) }}\n  1289→                        >\n  1290→                          Previous\n  1291→                        </Button>\n  1292→                        <Button\n  1293→                          variant=\"outline\"\n  1294→                          size=\"sm\"\n  1295→                          className=\"flex-1\"\n  1296→                          disabled={currentFlashcard === flashcards.length - 1}\n  1297→                          onClick={() => { setCurrentFlashcard(c => c + 1); setShowFlashcardBack(false) }}\n  1298→                        >\n  1299→                          Next\n  1300→                        </Button>\n  1301→                      </div>\n  1302→                    </CardContent>\n  1303→                  </Card>\n  1304→                )}\n  1305→\n  1306→                {/* Quiz Display */}\n  1307→                {quizQuestions.length > 0 && (\n  1308→                  <Card>\n  1309→                    <CardHeader className=\"pb-2\">\n  1310→                      <div className=\"flex items-center justify-between\">\n  1311→                        <CardTitle className=\"text-sm\">Quiz</CardTitle>\n  1312→                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setQuizQuestions([])}>\n  1313→                          <X className=\"h-3 w-3\" />\n  1314→                        </Button>\n  1315→                      </div>\n  1316→                      <CardDescription className=\"text-xs\">\n  1317→                        Question {currentQuizQuestion + 1} of {quizQuestions.length}\n  1318→                      </CardDescription>\n  1319→                    </CardHeader>\n  1320→                    <CardContent>\n  1321→                      <p className=\"text-sm font-medium mb-3\">{quizQuestions[currentQuizQuestion]?.question}</p>\n  1322→                      <div className=\"space-y-2\">\n  1323→                        {quizQuestions[currentQuizQuestion]?.options.map((option, i) => (\n  1324→                          <button\n  1325→                            key={i}\n  1326→                            className={`w-full text-left p-2 rounded text-xs border transition-colors ${\n  1327→                              showQuizAnswer\n  1328→                                ? i === quizQuestions[currentQuizQuestion]?.correct_index\n  1329→                                  ? 'bg-green-100 border-green-500 dark:bg-green-900/30'\n  1330→                                  : selectedAnswer === i\n  1331→                                  ? 'bg-red-100 border-red-500 dark:bg-red-900/30'\n  1332→                                  : 'bg-muted'\n  1333→                                : selectedAnswer === i\n  1334→                                ? 'bg-primary/10 border-primary'\n  1335→                                : 'bg-muted hover:bg-muted/80'\n  1336→                            }`}\n  1337→                            onClick={() => !showQuizAnswer && setSelectedAnswer(i)}\n  1338→                            disabled={showQuizAnswer}\n  1339→                          >\n  1340→                            {option}\n  1341→                          </button>\n  1342→                        ))}\n  1343→                      </div>\n  1344→                      {selectedAnswer !== null && !showQuizAnswer && (\n  1345→                        <Button\n  1346→                          size=\"sm\"\n  1347→                          className=\"w-full mt-3\"\n  1348→                          onClick={() => setShowQuizAnswer(true)}\n  1349→                        >\n  1350→                          Check Answer\n  1351→                        </Button>\n  1352→                      )}\n  1353→                      {showQuizAnswer && (\n  1354→                        <>\n  1355→                          <p className=\"text-xs text-muted-foreground mt-3 p-2 bg-muted rounded\">\n  1356→                            {quizQuestions[currentQuizQuestion]?.explanation}\n  1357→                          </p>\n  1358→                          <Button\n  1359→                            size=\"sm\"\n  1360→                            className=\"w-full mt-2\"\n  1361→                            disabled={currentQuizQuestion === quizQuestions.length - 1}\n  1362→                            onClick={() => {\n  1363→                              setCurrentQuizQuestion(c => c + 1)\n  1364→                              setSelectedAnswer(null)\n  1365→                              setShowQuizAnswer(false)\n  1366→                            }}\n  1367→                          >\n  1368→                            Next Question\n  1369→                          </Button>\n  1370→                        </>\n  1371→                      )}\n  1372→                    </CardContent>\n  1373→                  </Card>\n  1374→                )}\n  1375→\n  1376→                {/* Study Guide Display */}\n  1377→                {studyGuide && (\n  1378→                  <Card>\n  1379→                    <CardHeader className=\"pb-2\">\n  1380→                      <div className=\"flex items-center justify-between\">\n  1381→                        <CardTitle className=\"text-sm\">{studyGuide.title}</CardTitle>\n  1382→                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setStudyGuide(null)}>\n  1383→                          <X className=\"h-3 w-3\" />\n  1384→                        </Button>\n  1385→                      </div>\n  1386→                    </CardHeader>\n  1387→                    <CardContent className=\"space-y-3\">\n  1388→                      {studyGuide.sections.map((section, i) => (\n  1389→                        <div key={i}>\n  1390→                          <h4 className=\"text-xs font-semibold mb-1\">{section.heading}</h4>\n  1391→                          <p className=\"text-xs text-muted-foreground whitespace-pre-wrap select-text\">\n  1392→                            {section.content}\n  1393→                          </p>\n  1394→                        </div>\n  1395→                      ))}\n  1396→                    </CardContent>\n  1397→                  </Card>\n  1398→                )}\n  1399→\n  1400→                {/* FAQ Display */}\n  1401→                {faqItems.length > 0 && (\n  1402→                  <Card>\n  1403→                    <CardHeader className=\"pb-2\">\n  1404→                      <div className=\"flex items-center justify-between\">\n  1405→                        <CardTitle className=\"text-sm\">FAQ</CardTitle>\n  1406→                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setFaqItems([])}>\n  1407→                          <X className=\"h-3 w-3\" />\n  1408→                        </Button>\n  1409→                      </div>\n  1410→                    </CardHeader>\n  1411→                    <CardContent className=\"space-y-3\">\n  1412→                      {faqItems.map((item, i) => (\n  1413→                        <div key={i} className=\"border-b pb-2 last:border-0\">\n  1414→                          <p className=\"text-xs font-semibold mb-1\">Q: {item.question}</p>\n  1415→                          <p className=\"text-xs text-muted-foreground select-text\">A: {item.answer}</p>\n  1416→                        </div>\n  1417→                      ))}\n  1418→                    </CardContent>\n  1419→                  </Card>\n  1420→                )}\n  1421→\n  1422→                {selectedSources.size === 0 && (\n  1423→                  <p className=\"text-xs text-muted-foreground text-center\">\n  1424→                    Select sources to generate study materials\n  1425→                  </p>\n  1426→                )}\n  1427→              </TabsContent>\n  1428→\n  1429→              <TabsContent value=\"notes\" className=\"mt-0 space-y-4\">\n  1430→                <div className=\"flex items-center justify-between\">\n  1431→                  <h3 className=\"text-sm font-medium\">Your Notes</h3>\n  1432→                  <Dialog open={addNoteOpen} onOpenChange={setAddNoteOpen}>\n  1433→                    <DialogTrigger asChild>\n  1434→                      <Button size=\"sm\" variant=\"outline\">\n  1435→                        <Plus className=\"h-4 w-4\" />\n  1436→                      </Button>\n  1437→                    </DialogTrigger>\n  1438→                    <DialogContent>\n  1439→                      <DialogHeader>\n  1440→                        <DialogTitle>Create Note</DialogTitle>\n  1441→                      </DialogHeader>\n  1442→                      <div className=\"space-y-4\">\n  1443→                        <div>\n  1444→                          <label className=\"text-sm font-medium\">Title</label>\n  1445→                          <Input\n  1446→                            placeholder=\"Note title...\"\n  1447→                            value={noteTitle}\n  1448→                            onChange={(e) => setNoteTitle(e.target.value)}\n  1449→                          />\n  1450→                        </div>\n  1451→                        <div>\n  1452→                          <label className=\"text-sm font-medium\">Content</label>\n  1453→                          <Textarea\n  1454→                            placeholder=\"Write your note...\"\n  1455→                            value={noteContent}\n  1456→                            onChange={(e) => setNoteContent(e.target.value)}\n  1457→                            rows={6}\n  1458→                          />\n  1459→                        </div>\n  1460→                      </div>\n  1461→                      <DialogFooter>\n  1462→                        <Button onClick={createNote} disabled={savingNote}>\n  1463→                          {savingNote && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n  1464→                          Create Note\n  1465→                        </Button>\n  1466→                      </DialogFooter>\n  1467→                    </DialogContent>\n  1468→                  </Dialog>\n  1469→                </div>\n  1470→\n  1471→                {notes.length === 0 ? (\n  1472→                  <div className=\"text-center py-8 text-muted-foreground\">\n  1473→                    <StickyNote className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n  1474→                    <p className=\"text-sm\">No notes yet</p>\n  1475→                    <p className=\"text-xs\">Create notes or save chat responses</p>\n  1476→                  </div>\n  1477→                ) : (\n  1478→                  <div className=\"space-y-2\">\n  1479→                    {notes.map((note) => (\n  1480→                      <Card key={note.id} className=\"relative\">\n  1481→                        <CardHeader className=\"pb-2\">\n  1482→                          <div className=\"flex items-start justify-between\">\n  1483→                            <div className=\"flex items-center gap-2\">\n  1484→                              {note.is_pinned && <Pin className=\"h-3 w-3 text-primary\" />}\n  1485→                              <CardTitle className=\"text-sm\">\n  1486→                                {note.title || 'Untitled'}\n  1487→                              </CardTitle>\n  1488→                            </div>\n  1489→                            <div className=\"flex items-center gap-1\">\n  1490→                              <Button\n  1491→                                variant=\"ghost\"\n  1492→                                size=\"sm\"\n  1493→                                className=\"h-6 w-6 p-0\"\n  1494→                                onClick={() => togglePinNote(note)}\n  1495→                              >\n  1496→                                <Pin className={`h-3 w-3 ${note.is_pinned ? 'text-primary' : ''}`} />\n  1497→                              </Button>\n  1498→                              <Button\n  1499→                                variant=\"ghost\"\n  1500→                                size=\"sm\"\n  1501→                                className=\"h-6 w-6 p-0\"\n  1502→                                onClick={() => deleteNote(note.id)}\n  1503→                              >\n  1504→                                <Trash2 className=\"h-3 w-3\" />\n  1505→                              </Button>\n  1506→                            </div>\n  1507→                          </div>\n  1508→                          <CardDescription className=\"text-xs\">\n  1509→                            {note.type === 'saved_response' ? 'Saved from chat' : 'Note'}\n  1510→                            {' · '}\n  1511→                            {new Date(note.created_at).toLocaleDateString()}\n  1512→                          </CardDescription>\n  1513→                        </CardHeader>\n  1514→                        <CardContent>\n  1515→                          <p className=\"text-xs text-muted-foreground line-clamp-3\">\n  1516→                            {note.content || 'No content'}\n  1517→                          </p>\n  1518→                        </CardContent>\n  1519→                      </Card>\n  1520→                    ))}\n  1521→                  </div>\n  1522→                )}\n  1523→              </TabsContent>\n  1524→            </div>\n  1525→          </Tabs>\n  1526→        </div>\n  1527→      </div>\n  1528→    </div>\n  1529→  )\n  1530→}\n  1531→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"06165388-fd86-4ad3-8609-a5856174356e","timestamp":"2025-12-28T12:50:49.500Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/app/notebooks/[id]/page.tsx","content":"'use client'\n\nimport { useEffect, useState, useRef, useCallback } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { createClient, Notebook, Source, ChatMessage } from '@/lib/supabase'\nimport { chatApi, Note } from '@/lib/api'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Badge } from '@/components/ui/badge'\nimport { Separator } from '@/components/ui/separator'\nimport { Progress } from '@/components/ui/progress'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport {\n  ArrowLeft, Plus, Upload, FileText, Youtube, Link as LinkIcon,\n  Type, Send, Loader2, CheckCircle, XCircle, Clock, Trash2,\n  Mic, Video, Search, BookOpen, StickyNote, Sparkles, Pin,\n  Edit2, Save, X, AlertCircle, ChevronDown\n} from 'lucide-react'\nimport { toast } from 'sonner'\nimport { User } from '@supabase/supabase-js'\n\ninterface LocalNote {\n  id: string\n  notebook_id: string\n  type: 'written' | 'saved_response'\n  title: string | null\n  content: string | null\n  tags: string[]\n  is_pinned: boolean\n  created_at: string\n  updated_at: string\n}\n\nexport default function NotebookPage() {\n  const params = useParams()\n  const router = useRouter()\n  const notebookId = params.id as string\n  const supabase = createClient()\n\n  // Core state\n  const [user, setUser] = useState<User | null>(null)\n  const [notebook, setNotebook] = useState<Notebook | null>(null)\n  const [sources, setSources] = useState<Source[]>([])\n  const [messages, setMessages] = useState<ChatMessage[]>([])\n  const [notes, setNotes] = useState<LocalNote[]>([])\n  const [loading, setLoading] = useState(true)\n\n  // Chat state\n  const [sending, setSending] = useState(false)\n  const [message, setMessage] = useState('')\n  const [selectedSources, setSelectedSources] = useState<Set<string>>(new Set())\n  const [sessionId, setSessionId] = useState<string | null>(null)\n\n  // Source modal state\n  const [addSourceOpen, setAddSourceOpen] = useState(false)\n  const [sourceType, setSourceType] = useState<'file' | 'youtube' | 'url' | 'text'>('file')\n  const [sourceInput, setSourceInput] = useState('')\n  const [sourceName, setSourceName] = useState('')\n  const [uploading, setUploading] = useState(false)\n\n  // Notes state\n  const [addNoteOpen, setAddNoteOpen] = useState(false)\n  const [noteTitle, setNoteTitle] = useState('')\n  const [noteContent, setNoteContent] = useState('')\n  const [editingNote, setEditingNote] = useState<string | null>(null)\n  const [savingNote, setSavingNote] = useState(false)\n\n  // Audio state\n  const [audioFormat, setAudioFormat] = useState('deep_dive')\n  const [audioInstructions, setAudioInstructions] = useState('')\n  const [generatingAudio, setGeneratingAudio] = useState(false)\n\n  // Video state\n  const [videoStyle, setVideoStyle] = useState('explainer')\n  const [generatingVideo, setGeneratingVideo] = useState(false)\n\n  // Research state\n  const [researchQuery, setResearchQuery] = useState('')\n  const [researchMode, setResearchMode] = useState('fast')\n  const [researching, setResearching] = useState(false)\n\n  // Study loading states\n  const [generatingFlashcards, setGeneratingFlashcards] = useState(false)\n  const [generatingQuiz, setGeneratingQuiz] = useState(false)\n  const [generatingStudyGuide, setGeneratingStudyGuide] = useState(false)\n  const [generatingFaq, setGeneratingFaq] = useState(false)\n\n  // Study results\n  const [flashcards, setFlashcards] = useState<Array<{id: string, front: string, back: string}>>([])\n  const [quizQuestions, setQuizQuestions] = useState<Array<{id: string, question: string, options: string[], correct_index: number, explanation: string}>>([])\n  const [studyGuide, setStudyGuide] = useState<{title: string, sections: Array<{heading: string, content: string}>} | null>(null)\n  const [faqItems, setFaqItems] = useState<Array<{question: string, answer: string}>>([])\n  const [currentFlashcard, setCurrentFlashcard] = useState(0)\n  const [showFlashcardBack, setShowFlashcardBack] = useState(false)\n  const [currentQuizQuestion, setCurrentQuizQuestion] = useState(0)\n  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null)\n  const [showQuizAnswer, setShowQuizAnswer] = useState(false)\n\n  // Studio tab state\n  const [studioTab, setStudioTab] = useState('audio')\n\n  // Source preview state\n  const [viewingSource, setViewingSource] = useState<Source | null>(null)\n\n  // Refs\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n\n  // Initialize\n  useEffect(() => {\n    const init = async () => {\n      const { data: { user } } = await supabase.auth.getUser()\n      if (!user) {\n        router.push('/auth/login')\n        return\n      }\n      setUser(user)\n      await Promise.all([fetchNotebook(), fetchSources(), fetchNotes()])\n      setLoading(false)\n    }\n    init()\n  }, [notebookId])\n\n  // Auto-scroll messages\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }, [messages])\n\n  const fetchNotebook = async () => {\n    const { data, error } = await supabase\n      .from('notebooks')\n      .select('*')\n      .eq('id', notebookId)\n      .single()\n\n    if (error || !data) {\n      toast.error('Notebook not found')\n      router.push('/')\n      return\n    }\n    setNotebook(data)\n  }\n\n  const fetchSources = async () => {\n    const { data } = await supabase\n      .from('sources')\n      .select('*')\n      .eq('notebook_id', notebookId)\n      .order('created_at', { ascending: false })\n\n    setSources(data || [])\n  }\n\n  const fetchNotes = async () => {\n    const { data } = await supabase\n      .from('notes')\n      .select('*')\n      .eq('notebook_id', notebookId)\n      .order('is_pinned', { ascending: false })\n      .order('created_at', { ascending: false })\n\n    setNotes(data || [])\n  }\n\n  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n\n    setUploading(true)\n    const fileExt = file.name.split('.').pop()?.toLowerCase()\n    const filePath = `${user?.id}/${notebookId}/${Date.now()}.${fileExt}`\n\n    const { error: uploadError } = await supabase.storage\n      .from('sources')\n      .upload(filePath, file)\n\n    if (uploadError) {\n      toast.error('Failed to upload file')\n      setUploading(false)\n      return\n    }\n\n    const { data, error } = await supabase\n      .from('sources')\n      .insert({\n        notebook_id: notebookId,\n        type: fileExt === 'pdf' ? 'pdf' : fileExt === 'docx' ? 'docx' : 'txt',\n        name: file.name,\n        status: 'ready',\n        file_path: filePath,\n        original_filename: file.name,\n        mime_type: file.type,\n        file_size_bytes: file.size,\n      })\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to create source')\n    } else {\n      toast.success('File uploaded!')\n      setSources([data, ...sources])\n      setAddSourceOpen(false)\n    }\n    setUploading(false)\n  }\n\n  const addSource = async () => {\n    if (!sourceInput.trim()) return\n\n    setUploading(true)\n    let sourceData: Partial<Source> = {\n      notebook_id: notebookId,\n      status: 'ready',\n    }\n\n    if (sourceType === 'youtube') {\n      sourceData = {\n        ...sourceData,\n        type: 'youtube',\n        name: sourceName || `YouTube: ${sourceInput}`,\n        metadata: { url: sourceInput },\n      }\n    } else if (sourceType === 'url') {\n      sourceData = {\n        ...sourceData,\n        type: 'url',\n        name: sourceName || sourceInput,\n        metadata: { url: sourceInput },\n      }\n    } else if (sourceType === 'text') {\n      sourceData = {\n        ...sourceData,\n        type: 'text',\n        name: sourceName || 'Pasted Text',\n        metadata: { content: sourceInput },\n      }\n    }\n\n    const { data, error } = await supabase\n      .from('sources')\n      .insert(sourceData)\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to add source')\n    } else {\n      toast.success('Source added!')\n      setSources([data, ...sources])\n      setSourceInput('')\n      setSourceName('')\n      setAddSourceOpen(false)\n    }\n    setUploading(false)\n  }\n\n  const deleteSource = async (sourceId: string) => {\n    const { error } = await supabase\n      .from('sources')\n      .delete()\n      .eq('id', sourceId)\n\n    if (error) {\n      toast.error('Failed to delete source')\n    } else {\n      setSources(sources.filter(s => s.id !== sourceId))\n      selectedSources.delete(sourceId)\n      setSelectedSources(new Set(selectedSources))\n      toast.success('Source deleted')\n    }\n  }\n\n  const toggleSource = (sourceId: string) => {\n    const newSelected = new Set(selectedSources)\n    if (newSelected.has(sourceId)) {\n      newSelected.delete(sourceId)\n    } else {\n      newSelected.add(sourceId)\n    }\n    setSelectedSources(newSelected)\n  }\n\n  const selectAllSources = () => {\n    if (selectedSources.size === sources.length) {\n      setSelectedSources(new Set())\n    } else {\n      setSelectedSources(new Set(sources.map(s => s.id)))\n    }\n  }\n\n  const sendMessage = async () => {\n    if (!message.trim() || sending) return\n\n    setSending(true)\n    const userMessage: ChatMessage = {\n      id: crypto.randomUUID(),\n      session_id: sessionId || '',\n      role: 'user',\n      content: message,\n      citations: [],\n      source_ids_used: Array.from(selectedSources),\n      model_used: null,\n      input_tokens: null,\n      output_tokens: null,\n      cost_usd: null,\n      created_at: new Date().toISOString(),\n    }\n    setMessages(prev => [...prev, userMessage])\n    setMessage('')\n\n    try {\n      const response = await chatApi.sendMessage(notebookId, {\n        message: userMessage.content,\n        source_ids: Array.from(selectedSources),\n        session_id: sessionId || undefined,\n      })\n\n      if (response.data.session_id) {\n        setSessionId(response.data.session_id)\n      }\n\n      const aiMessage: ChatMessage = {\n        id: response.data.message_id,\n        session_id: response.data.session_id,\n        role: 'assistant',\n        content: response.data.content,\n        citations: response.data.citations,\n        source_ids_used: Array.from(selectedSources),\n        model_used: response.usage?.model_used || 'gemini-2.0-flash',\n        input_tokens: response.usage?.input_tokens || 0,\n        output_tokens: response.usage?.output_tokens || 0,\n        cost_usd: response.usage?.cost_usd || 0,\n        created_at: new Date().toISOString(),\n      }\n      setMessages(prev => [...prev, aiMessage])\n    } catch (error) {\n      toast.error('Failed to send message')\n      // Remove the user message on error\n      setMessages(prev => prev.filter(m => m.id !== userMessage.id))\n    }\n    setSending(false)\n  }\n\n  // Notes functions\n  const createNote = async () => {\n    if (!noteTitle.trim() && !noteContent.trim()) return\n\n    setSavingNote(true)\n    const { data, error } = await supabase\n      .from('notes')\n      .insert({\n        notebook_id: notebookId,\n        type: 'written',\n        title: noteTitle || 'Untitled Note',\n        content: noteContent,\n        tags: [],\n      })\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to create note')\n    } else {\n      toast.success('Note created!')\n      setNotes([data, ...notes])\n      setNoteTitle('')\n      setNoteContent('')\n      setAddNoteOpen(false)\n    }\n    setSavingNote(false)\n  }\n\n  const updateNote = async (noteId: string, updates: Partial<LocalNote>) => {\n    const { data, error } = await supabase\n      .from('notes')\n      .update({ ...updates, updated_at: new Date().toISOString() })\n      .eq('id', noteId)\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to update note')\n    } else {\n      setNotes(notes.map(n => n.id === noteId ? data : n))\n      setEditingNote(null)\n    }\n  }\n\n  const deleteNote = async (noteId: string) => {\n    const { error } = await supabase\n      .from('notes')\n      .delete()\n      .eq('id', noteId)\n\n    if (error) {\n      toast.error('Failed to delete note')\n    } else {\n      setNotes(notes.filter(n => n.id !== noteId))\n      toast.success('Note deleted')\n    }\n  }\n\n  const togglePinNote = async (note: LocalNote) => {\n    await updateNote(note.id, { is_pinned: !note.is_pinned })\n  }\n\n  const saveResponseAsNote = async (msg: ChatMessage) => {\n    const { data, error } = await supabase\n      .from('notes')\n      .insert({\n        notebook_id: notebookId,\n        type: 'saved_response',\n        title: `Saved Response - ${new Date().toLocaleDateString()}`,\n        content: msg.content,\n        tags: [],\n      })\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to save response')\n    } else {\n      toast.success('Response saved as note!')\n      setNotes([data, ...notes])\n    }\n  }\n\n  // Audio generation\n  const generateAudio = async () => {\n    if (selectedSources.size === 0) {\n      toast.error('Please select at least one source')\n      return\n    }\n\n    setGeneratingAudio(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/audio`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          format: audioFormat,\n          source_ids: Array.from(selectedSources),\n          custom_instructions: audioInstructions || undefined,\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else {\n        toast.success('Audio script generated! (Demo mode - no actual audio file)')\n      }\n    } catch {\n      toast.error('Failed to generate audio')\n    }\n    setGeneratingAudio(false)\n  }\n\n  // Video generation\n  const generateVideo = async () => {\n    if (selectedSources.size === 0) {\n      toast.error('Please select at least one source')\n      return\n    }\n\n    setGeneratingVideo(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/video`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          style: videoStyle,\n          source_ids: Array.from(selectedSources),\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else {\n        toast.success('Video script generated! (Demo mode - no actual video file)')\n      }\n    } catch {\n      toast.error('Failed to generate video')\n    }\n    setGeneratingVideo(false)\n  }\n\n  // Research generation\n  const runResearch = async () => {\n    if (!researchQuery.trim()) {\n      toast.error('Please enter a research query')\n      return\n    }\n\n    setResearching(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/research`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          query: researchQuery,\n          mode: researchMode,\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else {\n        toast.success('Research report generated!')\n        setResearchQuery('')\n      }\n    } catch {\n      toast.error('Failed to run research')\n    }\n    setResearching(false)\n  }\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'ready':\n        return <CheckCircle className=\"h-4 w-4 text-green-500\" />\n      case 'processing':\n        return <Clock className=\"h-4 w-4 text-yellow-500 animate-spin\" />\n      case 'failed':\n        return <XCircle className=\"h-4 w-4 text-red-500\" />\n      default:\n        return <Clock className=\"h-4 w-4 text-muted-foreground\" />\n    }\n  }\n\n  const getSourceIcon = (type: string) => {\n    switch (type) {\n      case 'pdf':\n      case 'docx':\n      case 'txt':\n        return <FileText className=\"h-4 w-4\" />\n      case 'youtube':\n        return <Youtube className=\"h-4 w-4\" />\n      case 'url':\n        return <LinkIcon className=\"h-4 w-4\" />\n      case 'text':\n        return <Type className=\"h-4 w-4\" />\n      default:\n        return <FileText className=\"h-4 w-4\" />\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"h-screen flex flex-col overflow-hidden\">\n      {/* Header */}\n      <header className=\"border-b px-4 py-3 flex items-center gap-4 shrink-0\">\n        <Button variant=\"ghost\" size=\"sm\" onClick={() => router.push('/')}>\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back\n        </Button>\n        <Separator orientation=\"vertical\" className=\"h-6\" />\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-xl\">{notebook?.emoji}</span>\n          <h1 className=\"font-semibold\">{notebook?.name}</h1>\n        </div>\n        <Badge variant=\"secondary\">{sources.length} sources</Badge>\n        <div className=\"ml-auto flex items-center gap-2\">\n          <Badge variant=\"outline\" className=\"text-xs\">\n            {selectedSources.size} selected\n          </Badge>\n        </div>\n      </header>\n\n      {/* Three Panel Layout */}\n      <div className=\"flex-1 grid grid-cols-[256px_1fr_320px] overflow-hidden\">\n        {/* Left Panel - Sources */}\n        <div className=\"border-r flex flex-col bg-background h-full min-h-0\">\n          <div className=\"p-4 border-b shrink-0\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <h2 className=\"font-semibold\">Sources</h2>\n              <Dialog open={addSourceOpen} onOpenChange={setAddSourceOpen}>\n                <DialogTrigger asChild>\n                  <Button size=\"sm\" variant=\"outline\">\n                    <Plus className=\"h-4 w-4\" />\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>Add Source</DialogTitle>\n                    <DialogDescription>\n                      Add documents, URLs, or text to your notebook\n                    </DialogDescription>\n                  </DialogHeader>\n                  <Tabs value={sourceType} onValueChange={(v) => setSourceType(v as typeof sourceType)}>\n                    <TabsList className=\"grid grid-cols-4 w-full\">\n                      <TabsTrigger value=\"file\"><Upload className=\"h-4 w-4\" /></TabsTrigger>\n                      <TabsTrigger value=\"youtube\"><Youtube className=\"h-4 w-4\" /></TabsTrigger>\n                      <TabsTrigger value=\"url\"><LinkIcon className=\"h-4 w-4\" /></TabsTrigger>\n                      <TabsTrigger value=\"text\"><Type className=\"h-4 w-4\" /></TabsTrigger>\n                    </TabsList>\n                    <TabsContent value=\"file\" className=\"space-y-4\">\n                      <input\n                        ref={fileInputRef}\n                        type=\"file\"\n                        accept=\".pdf,.docx,.txt,.md\"\n                        onChange={handleFileUpload}\n                        className=\"hidden\"\n                      />\n                      <Button\n                        variant=\"outline\"\n                        className=\"w-full h-24\"\n                        onClick={() => fileInputRef.current?.click()}\n                        disabled={uploading}\n                      >\n                        {uploading ? (\n                          <Loader2 className=\"h-6 w-6 animate-spin\" />\n                        ) : (\n                          <div className=\"text-center\">\n                            <Upload className=\"h-6 w-6 mx-auto mb-2\" />\n                            <p className=\"text-sm\">Click to upload</p>\n                            <p className=\"text-xs text-muted-foreground\">PDF, DOCX, TXT</p>\n                          </div>\n                        )}\n                      </Button>\n                    </TabsContent>\n                    <TabsContent value=\"youtube\" className=\"space-y-4\">\n                      <Input\n                        placeholder=\"YouTube URL\"\n                        value={sourceInput}\n                        onChange={(e) => setSourceInput(e.target.value)}\n                      />\n                      <Input\n                        placeholder=\"Name (optional)\"\n                        value={sourceName}\n                        onChange={(e) => setSourceName(e.target.value)}\n                      />\n                    </TabsContent>\n                    <TabsContent value=\"url\" className=\"space-y-4\">\n                      <Input\n                        placeholder=\"Website URL\"\n                        value={sourceInput}\n                        onChange={(e) => setSourceInput(e.target.value)}\n                      />\n                      <Input\n                        placeholder=\"Name (optional)\"\n                        value={sourceName}\n                        onChange={(e) => setSourceName(e.target.value)}\n                      />\n                    </TabsContent>\n                    <TabsContent value=\"text\" className=\"space-y-4\">\n                      <Input\n                        placeholder=\"Name\"\n                        value={sourceName}\n                        onChange={(e) => setSourceName(e.target.value)}\n                      />\n                      <Textarea\n                        placeholder=\"Paste your text here...\"\n                        value={sourceInput}\n                        onChange={(e) => setSourceInput(e.target.value)}\n                        rows={6}\n                      />\n                    </TabsContent>\n                  </Tabs>\n                  {sourceType !== 'file' && (\n                    <DialogFooter>\n                      <Button onClick={addSource} disabled={uploading || !sourceInput.trim()}>\n                        {uploading && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                        Add Source\n                      </Button>\n                    </DialogFooter>\n                  )}\n                </DialogContent>\n              </Dialog>\n            </div>\n            {sources.length > 0 && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"w-full justify-start text-xs\"\n                onClick={selectAllSources}\n              >\n                {selectedSources.size === sources.length ? 'Deselect All' : 'Select All'}\n              </Button>\n            )}\n          </div>\n          <div className=\"flex-1 min-h-0 overflow-y-auto\">\n            <div className=\"p-2 space-y-1\">\n              {sources.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <FileText className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                  <p className=\"text-sm\">No sources yet</p>\n                  <p className=\"text-xs\">Add documents to get started</p>\n                </div>\n              ) : (\n                sources.map((source) => (\n                  <div\n                    key={source.id}\n                    className={`p-2 rounded-lg flex items-center gap-2 group ${\n                      selectedSources.has(source.id) ? 'bg-primary/10' : 'hover:bg-muted'\n                    } ${viewingSource?.id === source.id ? 'ring-2 ring-primary' : ''}`}\n                  >\n                    <input\n                      type=\"checkbox\"\n                      checked={selectedSources.has(source.id)}\n                      onChange={() => toggleSource(source.id)}\n                      className=\"rounded cursor-pointer\"\n                    />\n                    {getSourceIcon(source.type)}\n                    <span\n                      className=\"flex-1 text-sm truncate cursor-pointer hover:underline select-text\"\n                      onClick={() => setViewingSource(source)}\n                    >\n                      {source.name}\n                    </span>\n                    {getStatusIcon(source.status)}\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"opacity-0 group-hover:opacity-100 h-6 w-6 p-0\"\n                      onClick={() => deleteSource(source.id)}\n                    >\n                      <Trash2 className=\"h-3 w-3\" />\n                    </Button>\n                  </div>\n                ))\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Center Panel - Chat or Source Preview */}\n        <div className=\"flex flex-col h-full min-h-0\">\n          {/* Source Preview */}\n          {viewingSource && (\n            <div className=\"border-b bg-muted/30 shrink-0\">\n              <div className=\"max-w-3xl mx-auto p-4\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <div className=\"flex items-center gap-2\">\n                    {getSourceIcon(viewingSource.type)}\n                    <h3 className=\"font-medium\">{viewingSource.name}</h3>\n                    <Badge variant=\"outline\" className=\"text-xs\">{viewingSource.type}</Badge>\n                  </div>\n                  <Button variant=\"ghost\" size=\"sm\" onClick={() => setViewingSource(null)}>\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n                <div className=\"bg-background rounded-lg border p-4 max-h-48 overflow-y-auto\">\n                  {viewingSource.type === 'text' && viewingSource.metadata?.content ? (\n                    <p className=\"text-sm whitespace-pre-wrap select-text\">{viewingSource.metadata.content}</p>\n                  ) : viewingSource.type === 'youtube' && viewingSource.metadata?.url ? (\n                    <div className=\"space-y-2\">\n                      <p className=\"text-sm text-muted-foreground\">YouTube URL:</p>\n                      <a href={viewingSource.metadata.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-sm text-primary hover:underline break-all select-text\">\n                        {viewingSource.metadata.url}\n                      </a>\n                    </div>\n                  ) : viewingSource.type === 'url' && viewingSource.metadata?.url ? (\n                    <div className=\"space-y-2\">\n                      <p className=\"text-sm text-muted-foreground\">Website URL:</p>\n                      <a href={viewingSource.metadata.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-sm text-primary hover:underline break-all select-text\">\n                        {viewingSource.metadata.url}\n                      </a>\n                    </div>\n                  ) : viewingSource.file_path ? (\n                    <div className=\"space-y-2\">\n                      <p className=\"text-sm text-muted-foreground\">File: {viewingSource.original_filename || viewingSource.name}</p>\n                      <p className=\"text-xs text-muted-foreground\">Size: {viewingSource.file_size_bytes ? `${(viewingSource.file_size_bytes / 1024).toFixed(1)} KB` : 'Unknown'}</p>\n                    </div>\n                  ) : (\n                    <p className=\"text-sm text-muted-foreground\">No preview available</p>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex-1 min-h-0 overflow-y-auto p-4\">\n            <div className=\"max-w-3xl mx-auto space-y-4\">\n              {messages.length === 0 ? (\n                <div className=\"text-center py-16\">\n                  <Sparkles className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n                  <h3 className=\"text-lg font-medium mb-2\">Start a Conversation</h3>\n                  <p className=\"text-muted-foreground mb-4\">\n                    Ask questions about your sources\n                  </p>\n                  <div className=\"flex flex-wrap justify-center gap-2\">\n                    {['Summarize the main points', 'What are the key takeaways?', 'Explain the methodology'].map((q) => (\n                      <Button\n                        key={q}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => setMessage(q)}\n                      >\n                        {q}\n                      </Button>\n                    ))}\n                  </div>\n                </div>\n              ) : (\n                messages.map((msg) => (\n                  <div\n                    key={msg.id}\n                    className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}\n                  >\n                    <div\n                      className={`max-w-[80%] rounded-2xl px-4 py-3 ${\n                        msg.role === 'user'\n                          ? 'bg-primary text-primary-foreground'\n                          : 'bg-muted'\n                      }`}\n                    >\n                      <p className=\"whitespace-pre-wrap text-sm select-text\">{msg.content}</p>\n                      {msg.role === 'assistant' && (\n                        <div className=\"flex items-center gap-2 mt-2 pt-2 border-t border-border/50\">\n                          {msg.cost_usd !== null && msg.cost_usd > 0 && (\n                            <span className=\"text-xs opacity-70\">\n                              Cost: ${msg.cost_usd.toFixed(4)}\n                            </span>\n                          )}\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-6 text-xs ml-auto\"\n                            onClick={() => saveResponseAsNote(msg)}\n                          >\n                            <StickyNote className=\"h-3 w-3 mr-1\" />\n                            Save\n                          </Button>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                ))\n              )}\n              {sending && (\n                <div className=\"flex justify-start\">\n                  <div className=\"bg-muted rounded-2xl px-4 py-3\">\n                    <Loader2 className=\"h-5 w-5 animate-spin\" />\n                  </div>\n                </div>\n              )}\n              <div ref={messagesEndRef} />\n            </div>\n          </div>\n          <div className=\"p-4 border-t shrink-0\">\n            <div className=\"max-w-3xl mx-auto\">\n              {selectedSources.size === 0 && sources.length > 0 && (\n                <div className=\"flex items-center gap-2 mb-2 text-xs text-amber-600 bg-amber-50 dark:bg-amber-900/20 p-2 rounded-lg\">\n                  <AlertCircle className=\"h-4 w-4\" />\n                  Select sources from the left panel for contextual answers\n                </div>\n              )}\n              <div className=\"flex gap-2\">\n                <Input\n                  placeholder=\"Ask a question about your sources...\"\n                  value={message}\n                  onChange={(e) => setMessage(e.target.value)}\n                  onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && sendMessage()}\n                  disabled={sending}\n                />\n                <Button onClick={sendMessage} disabled={sending || !message.trim()}>\n                  <Send className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Right Panel - Studio */}\n        <div className=\"border-l flex flex-col bg-background h-full min-h-0\">\n          <Tabs value={studioTab} onValueChange={setStudioTab} className=\"flex flex-col h-full min-h-0\">\n            <div className=\"p-4 border-b shrink-0\">\n              <h2 className=\"font-semibold mb-2\">Studio</h2>\n              <TabsList className=\"grid grid-cols-3 w-full\">\n                <TabsTrigger value=\"audio\" className=\"text-xs\">\n                  <Mic className=\"h-3 w-3 mr-1\" />\n                  Audio\n                </TabsTrigger>\n                <TabsTrigger value=\"study\" className=\"text-xs\">\n                  <BookOpen className=\"h-3 w-3 mr-1\" />\n                  Study\n                </TabsTrigger>\n                <TabsTrigger value=\"notes\" className=\"text-xs\">\n                  <StickyNote className=\"h-3 w-3 mr-1\" />\n                  Notes\n                </TabsTrigger>\n              </TabsList>\n            </div>\n\n            <div className=\"flex-1 min-h-0 overflow-y-auto p-4\">\n              <TabsContent value=\"audio\" className=\"mt-0 space-y-4\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm flex items-center gap-2\">\n                      <Mic className=\"h-4 w-4\" />\n                      Audio Overview\n                    </CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      Generate a podcast-style discussion\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div>\n                      <label className=\"text-xs font-medium mb-1 block\">Format</label>\n                      <Select value={audioFormat} onValueChange={setAudioFormat}>\n                        <SelectTrigger className=\"h-8 text-xs\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"deep_dive\">Deep Dive (10-15 min)</SelectItem>\n                          <SelectItem value=\"brief\">Brief Summary (2-3 min)</SelectItem>\n                          <SelectItem value=\"critique\">Analytical Discussion (5-10 min)</SelectItem>\n                          <SelectItem value=\"debate\">Debate Format (8-15 min)</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <label className=\"text-xs font-medium mb-1 block\">Custom Instructions</label>\n                      <Textarea\n                        placeholder=\"Optional instructions for the hosts...\"\n                        value={audioInstructions}\n                        onChange={(e) => setAudioInstructions(e.target.value)}\n                        rows={2}\n                        className=\"text-xs\"\n                      />\n                    </div>\n                    <Button\n                      className=\"w-full\"\n                      size=\"sm\"\n                      onClick={generateAudio}\n                      disabled={generatingAudio || selectedSources.size === 0}\n                    >\n                      {generatingAudio ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <Mic className=\"h-4 w-4 mr-2\" />\n                      )}\n                      Generate Audio\n                    </Button>\n                    {selectedSources.size === 0 && (\n                      <p className=\"text-xs text-muted-foreground text-center\">\n                        Select sources to generate audio\n                      </p>\n                    )}\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm flex items-center gap-2\">\n                      <Video className=\"h-4 w-4\" />\n                      Video Overview\n                    </CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      Create a visual explainer video\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div>\n                      <label className=\"text-xs font-medium mb-1 block\">Style</label>\n                      <Select value={videoStyle} onValueChange={setVideoStyle}>\n                        <SelectTrigger className=\"h-8 text-xs\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"explainer\">Explainer</SelectItem>\n                          <SelectItem value=\"documentary\">Documentary</SelectItem>\n                          <SelectItem value=\"presentation\">Presentation</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <Button\n                      className=\"w-full\"\n                      size=\"sm\"\n                      onClick={generateVideo}\n                      disabled={generatingVideo || selectedSources.size === 0}\n                    >\n                      {generatingVideo ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <Video className=\"h-4 w-4 mr-2\" />\n                      )}\n                      Generate Video Script\n                    </Button>\n                    {selectedSources.size === 0 && (\n                      <p className=\"text-xs text-muted-foreground text-center\">\n                        Select sources to generate video\n                      </p>\n                    )}\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm flex items-center gap-2\">\n                      <Search className=\"h-4 w-4\" />\n                      Deep Research\n                    </CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      Autonomous web research agent\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div>\n                      <label className=\"text-xs font-medium mb-1 block\">Research Query</label>\n                      <Input\n                        placeholder=\"What would you like to research?\"\n                        value={researchQuery}\n                        onChange={(e) => setResearchQuery(e.target.value)}\n                        className=\"h-8 text-xs\"\n                      />\n                    </div>\n                    <div>\n                      <label className=\"text-xs font-medium mb-1 block\">Mode</label>\n                      <Select value={researchMode} onValueChange={setResearchMode}>\n                        <SelectTrigger className=\"h-8 text-xs\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"fast\">Fast (3-5 min)</SelectItem>\n                          <SelectItem value=\"deep\">Deep (10-15 min)</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <Button\n                      className=\"w-full\"\n                      size=\"sm\"\n                      onClick={runResearch}\n                      disabled={researching || !researchQuery.trim()}\n                    >\n                      {researching ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <Search className=\"h-4 w-4 mr-2\" />\n                      )}\n                      Start Research\n                    </Button>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"study\" className=\"mt-0 space-y-4\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm\">Study Materials</CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      Generate study aids from your sources\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"w-full justify-start\"\n                      disabled={selectedSources.size === 0 || generatingFlashcards}\n                      onClick={async () => {\n                        setGeneratingFlashcards(true)\n                        try {\n                          const { data: { session } } = await supabase.auth.getSession()\n                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n                            method: 'POST',\n                            headers: {\n                              'Content-Type': 'application/json',\n                              'Authorization': `Bearer ${session?.access_token}`,\n                            },\n                            body: JSON.stringify({\n                              type: 'flashcards',\n                              source_ids: Array.from(selectedSources),\n                              count: 5,\n                            }),\n                          })\n                          const result = await response.json()\n                          if (result.error) {\n                            toast.error(result.error)\n                          } else if (result.data?.flashcards) {\n                            setFlashcards(result.data.flashcards)\n                            setCurrentFlashcard(0)\n                            setShowFlashcardBack(false)\n                            toast.success(`Generated ${result.data.flashcards.length} flashcards!`)\n                          } else {\n                            toast.error('Unexpected response')\n                          }\n                        } catch (err) {\n                          console.error('Flashcards error:', err)\n                          toast.error('Failed to generate flashcards')\n                        } finally {\n                          setGeneratingFlashcards(false)\n                        }\n                      }}\n                    >\n                      {generatingFlashcards ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <BookOpen className=\"h-4 w-4 mr-2\" />\n                      )}\n                      {generatingFlashcards ? 'Generating...' : 'Generate Flashcards'}\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"w-full justify-start\"\n                      disabled={selectedSources.size === 0 || generatingQuiz}\n                      onClick={async () => {\n                        setGeneratingQuiz(true)\n                        try {\n                          const { data: { session } } = await supabase.auth.getSession()\n                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n                            method: 'POST',\n                            headers: {\n                              'Content-Type': 'application/json',\n                              'Authorization': `Bearer ${session?.access_token}`,\n                            },\n                            body: JSON.stringify({\n                              type: 'quiz',\n                              source_ids: Array.from(selectedSources),\n                              count: 5,\n                            }),\n                          })\n                          const result = await response.json()\n                          if (result.error) {\n                            toast.error(result.error)\n                          } else if (result.data?.questions) {\n                            setQuizQuestions(result.data.questions)\n                            setCurrentQuizQuestion(0)\n                            setSelectedAnswer(null)\n                            setShowQuizAnswer(false)\n                            toast.success(`Generated ${result.data.questions.length} quiz questions!`)\n                          } else {\n                            toast.error('Unexpected response')\n                          }\n                        } catch (err) {\n                          console.error('Quiz error:', err)\n                          toast.error('Failed to generate quiz')\n                        } finally {\n                          setGeneratingQuiz(false)\n                        }\n                      }}\n                    >\n                      {generatingQuiz ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <CheckCircle className=\"h-4 w-4 mr-2\" />\n                      )}\n                      {generatingQuiz ? 'Generating...' : 'Generate Quiz'}\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"w-full justify-start\"\n                      disabled={selectedSources.size === 0 || generatingStudyGuide}\n                      onClick={async () => {\n                        setGeneratingStudyGuide(true)\n                        try {\n                          const { data: { session } } = await supabase.auth.getSession()\n                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n                            method: 'POST',\n                            headers: {\n                              'Content-Type': 'application/json',\n                              'Authorization': `Bearer ${session?.access_token}`,\n                            },\n                            body: JSON.stringify({\n                              type: 'study-guide',\n                              source_ids: Array.from(selectedSources),\n                            }),\n                          })\n                          const result = await response.json()\n                          if (result.error) {\n                            toast.error(result.error)\n                          } else if (result.data?.sections) {\n                            setStudyGuide(result.data)\n                            toast.success('Study guide generated!')\n                          } else {\n                            toast.error('Unexpected response')\n                          }\n                        } catch (err) {\n                          console.error('Study guide error:', err)\n                          toast.error('Failed to generate study guide')\n                        } finally {\n                          setGeneratingStudyGuide(false)\n                        }\n                      }}\n                    >\n                      {generatingStudyGuide ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <FileText className=\"h-4 w-4 mr-2\" />\n                      )}\n                      {generatingStudyGuide ? 'Generating...' : 'Generate Study Guide'}\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"w-full justify-start\"\n                      disabled={selectedSources.size === 0 || generatingFaq}\n                      onClick={async () => {\n                        setGeneratingFaq(true)\n                        try {\n                          const { data: { session } } = await supabase.auth.getSession()\n                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n                            method: 'POST',\n                            headers: {\n                              'Content-Type': 'application/json',\n                              'Authorization': `Bearer ${session?.access_token}`,\n                            },\n                            body: JSON.stringify({\n                              type: 'faq',\n                              source_ids: Array.from(selectedSources),\n                            }),\n                          })\n                          const result = await response.json()\n                          if (result.error) {\n                            toast.error(result.error)\n                          } else if (result.data?.faq) {\n                            setFaqItems(result.data.faq)\n                            toast.success(`Generated ${result.data.faq.length} FAQ items!`)\n                          } else {\n                            toast.error('Unexpected response')\n                          }\n                        } catch (err) {\n                          console.error('FAQ error:', err)\n                          toast.error('Failed to generate FAQ')\n                        } finally {\n                          setGeneratingFaq(false)\n                        }\n                      }}\n                    >\n                      {generatingFaq ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <AlertCircle className=\"h-4 w-4 mr-2\" />\n                      )}\n                      {generatingFaq ? 'Generating...' : 'Generate FAQ'}\n                    </Button>\n                  </CardContent>\n                </Card>\n\n                {/* Flashcards Display */}\n                {flashcards.length > 0 && (\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-sm\">Flashcards</CardTitle>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setFlashcards([])}>\n                          <X className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                      <CardDescription className=\"text-xs\">\n                        {currentFlashcard + 1} of {flashcards.length}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <div\n                        className=\"bg-muted rounded-lg p-4 min-h-[120px] cursor-pointer select-text\"\n                        onClick={() => setShowFlashcardBack(!showFlashcardBack)}\n                      >\n                        <p className=\"text-xs text-muted-foreground mb-1\">\n                          {showFlashcardBack ? 'Answer' : 'Question'} (click to flip)\n                        </p>\n                        <p className=\"text-sm\">\n                          {showFlashcardBack ? flashcards[currentFlashcard]?.back : flashcards[currentFlashcard]?.front}\n                        </p>\n                      </div>\n                      <div className=\"flex gap-2 mt-3\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"flex-1\"\n                          disabled={currentFlashcard === 0}\n                          onClick={() => { setCurrentFlashcard(c => c - 1); setShowFlashcardBack(false) }}\n                        >\n                          Previous\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"flex-1\"\n                          disabled={currentFlashcard === flashcards.length - 1}\n                          onClick={() => { setCurrentFlashcard(c => c + 1); setShowFlashcardBack(false) }}\n                        >\n                          Next\n                        </Button>\n                      </div>\n                    </CardContent>\n                  </Card>\n                )}\n\n                {/* Quiz Display */}\n                {quizQuestions.length > 0 && (\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-sm\">Quiz</CardTitle>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setQuizQuestions([])}>\n                          <X className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                      <CardDescription className=\"text-xs\">\n                        Question {currentQuizQuestion + 1} of {quizQuestions.length}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-sm font-medium mb-3\">{quizQuestions[currentQuizQuestion]?.question}</p>\n                      <div className=\"space-y-2\">\n                        {quizQuestions[currentQuizQuestion]?.options.map((option, i) => (\n                          <button\n                            key={i}\n                            className={`w-full text-left p-2 rounded text-xs border transition-colors ${\n                              showQuizAnswer\n                                ? i === quizQuestions[currentQuizQuestion]?.correct_index\n                                  ? 'bg-green-100 border-green-500 dark:bg-green-900/30'\n                                  : selectedAnswer === i\n                                  ? 'bg-red-100 border-red-500 dark:bg-red-900/30'\n                                  : 'bg-muted'\n                                : selectedAnswer === i\n                                ? 'bg-primary/10 border-primary'\n                                : 'bg-muted hover:bg-muted/80'\n                            }`}\n                            onClick={() => !showQuizAnswer && setSelectedAnswer(i)}\n                            disabled={showQuizAnswer}\n                          >\n                            {option}\n                          </button>\n                        ))}\n                      </div>\n                      {selectedAnswer !== null && !showQuizAnswer && (\n                        <Button\n                          size=\"sm\"\n                          className=\"w-full mt-3\"\n                          onClick={() => setShowQuizAnswer(true)}\n                        >\n                          Check Answer\n                        </Button>\n                      )}\n                      {showQuizAnswer && (\n                        <>\n                          <p className=\"text-xs text-muted-foreground mt-3 p-2 bg-muted rounded\">\n                            {quizQuestions[currentQuizQuestion]?.explanation}\n                          </p>\n                          <Button\n                            size=\"sm\"\n                            className=\"w-full mt-2\"\n                            disabled={currentQuizQuestion === quizQuestions.length - 1}\n                            onClick={() => {\n                              setCurrentQuizQuestion(c => c + 1)\n                              setSelectedAnswer(null)\n                              setShowQuizAnswer(false)\n                            }}\n                          >\n                            Next Question\n                          </Button>\n                        </>\n                      )}\n                    </CardContent>\n                  </Card>\n                )}\n\n                {/* Study Guide Display */}\n                {studyGuide && (\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-sm\">{studyGuide.title}</CardTitle>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setStudyGuide(null)}>\n                          <X className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      {studyGuide.sections.map((section, i) => (\n                        <div key={i}>\n                          <h4 className=\"text-xs font-semibold mb-1\">{section.heading}</h4>\n                          <p className=\"text-xs text-muted-foreground whitespace-pre-wrap select-text\">\n                            {section.content}\n                          </p>\n                        </div>\n                      ))}\n                    </CardContent>\n                  </Card>\n                )}\n\n                {/* FAQ Display */}\n                {faqItems.length > 0 && (\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-sm\">FAQ</CardTitle>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setFaqItems([])}>\n                          <X className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      {faqItems.map((item, i) => (\n                        <div key={i} className=\"border-b pb-2 last:border-0\">\n                          <p className=\"text-xs font-semibold mb-1\">Q: {item.question}</p>\n                          <p className=\"text-xs text-muted-foreground select-text\">A: {item.answer}</p>\n                        </div>\n                      ))}\n                    </CardContent>\n                  </Card>\n                )}\n\n                {selectedSources.size === 0 && (\n                  <p className=\"text-xs text-muted-foreground text-center\">\n                    Select sources to generate study materials\n                  </p>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"notes\" className=\"mt-0 space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <h3 className=\"text-sm font-medium\">Your Notes</h3>\n                  <Dialog open={addNoteOpen} onOpenChange={setAddNoteOpen}>\n                    <DialogTrigger asChild>\n                      <Button size=\"sm\" variant=\"outline\">\n                        <Plus className=\"h-4 w-4\" />\n                      </Button>\n                    </DialogTrigger>\n                    <DialogContent>\n                      <DialogHeader>\n                        <DialogTitle>Create Note</DialogTitle>\n                      </DialogHeader>\n                      <div className=\"space-y-4\">\n                        <div>\n                          <label className=\"text-sm font-medium\">Title</label>\n                          <Input\n                            placeholder=\"Note title...\"\n                            value={noteTitle}\n                            onChange={(e) => setNoteTitle(e.target.value)}\n                          />\n                        </div>\n                        <div>\n                          <label className=\"text-sm font-medium\">Content</label>\n                          <Textarea\n                            placeholder=\"Write your note...\"\n                            value={noteContent}\n                            onChange={(e) => setNoteContent(e.target.value)}\n                            rows={6}\n                          />\n                        </div>\n                      </div>\n                      <DialogFooter>\n                        <Button onClick={createNote} disabled={savingNote}>\n                          {savingNote && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                          Create Note\n                        </Button>\n                      </DialogFooter>\n                    </DialogContent>\n                  </Dialog>\n                </div>\n\n                {notes.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    <StickyNote className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                    <p className=\"text-sm\">No notes yet</p>\n                    <p className=\"text-xs\">Create notes or save chat responses</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-2\">\n                    {notes.map((note) => (\n                      <Card key={note.id} className=\"relative\">\n                        <CardHeader className=\"pb-2\">\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex items-center gap-2\">\n                              {note.is_pinned && <Pin className=\"h-3 w-3 text-primary\" />}\n                              <CardTitle className=\"text-sm\">\n                                {note.title || 'Untitled'}\n                              </CardTitle>\n                            </div>\n                            <div className=\"flex items-center gap-1\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                className=\"h-6 w-6 p-0\"\n                                onClick={() => togglePinNote(note)}\n                              >\n                                <Pin className={`h-3 w-3 ${note.is_pinned ? 'text-primary' : ''}`} />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                className=\"h-6 w-6 p-0\"\n                                onClick={() => deleteNote(note.id)}\n                              >\n                                <Trash2 className=\"h-3 w-3\" />\n                              </Button>\n                            </div>\n                          </div>\n                          <CardDescription className=\"text-xs\">\n                            {note.type === 'saved_response' ? 'Saved from chat' : 'Note'}\n                            {' · '}\n                            {new Date(note.created_at).toLocaleDateString()}\n                          </CardDescription>\n                        </CardHeader>\n                        <CardContent>\n                          <p className=\"text-xs text-muted-foreground line-clamp-3\">\n                            {note.content || 'No content'}\n                          </p>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n            </div>\n          </Tabs>\n        </div>\n      </div>\n    </div>\n  )\n}\n","numLines":1531,"startLine":1,"totalLines":1531}}}
{"parentUuid":"06165388-fd86-4ad3-8609-a5856174356e","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SSFtRPkqjQmrUHWSjDc56g","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me check what UI components are available in the project to ensure I use consistent styling:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":21648,"cache_read_input_tokens":6051,"cache_creation":{"ephemeral_5m_input_tokens":21648,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWZ7bmDiN3DCWj4qSSD3p","type":"assistant","uuid":"8488dfab-46c3-48f4-b39f-6e21406ffa89","timestamp":"2025-12-28T12:50:54.378Z"}
{"parentUuid":"8488dfab-46c3-48f4-b39f-6e21406ffa89","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SSFtRPkqjQmrUHWSjDc56g","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018H3u4tiGbE1NuUX474JdFg","name":"Read","input":{"file_path":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/components/ui/accordion.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":21648,"cache_read_input_tokens":6051,"cache_creation":{"ephemeral_5m_input_tokens":21648,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWZ7bmDiN3DCWj4qSSD3p","type":"assistant","uuid":"fd225fa3-5751-4bdd-b232-5be296a9626e","timestamp":"2025-12-28T12:50:55.887Z"}
{"parentUuid":"fd225fa3-5751-4bdd-b232-5be296a9626e","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SSFtRPkqjQmrUHWSjDc56g","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Qbk5WgAcuG7H1qXfTgcJJv","name":"Read","input":{"file_path":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/components/ui/sheet.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":21648,"cache_read_input_tokens":6051,"cache_creation":{"ephemeral_5m_input_tokens":21648,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWZ7bmDiN3DCWj4qSSD3p","type":"assistant","uuid":"63556862-6598-4643-b48e-71cdfd8e91b0","timestamp":"2025-12-28T12:50:56.595Z"}
{"parentUuid":"63556862-6598-4643-b48e-71cdfd8e91b0","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SSFtRPkqjQmrUHWSjDc56g","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019eaGJuQPiozFNZmRrsDk2R","name":"Read","input":{"file_path":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/tailwind.config.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":21648,"cache_read_input_tokens":6051,"cache_creation":{"ephemeral_5m_input_tokens":21648,"ephemeral_1h_input_tokens":0},"output_tokens":244,"service_tier":"standard"}},"requestId":"req_011CWZ7bmDiN3DCWj4qSSD3p","type":"assistant","uuid":"63331130-97b1-44d8-b868-1f0fd6e37a14","timestamp":"2025-12-28T12:50:57.278Z"}
{"parentUuid":"63331130-97b1-44d8-b868-1f0fd6e37a14","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File does not exist. Current working directory: /Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend</tool_use_error>","is_error":true,"tool_use_id":"toolu_018H3u4tiGbE1NuUX474JdFg"}]},"uuid":"605941f9-9ef7-4895-a356-56b724238f82","timestamp":"2025-12-28T12:50:57.317Z","toolUseResult":"Error: File does not exist. Current working directory: /Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend"}
{"parentUuid":"605941f9-9ef7-4895-a356-56b724238f82","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File does not exist. Current working directory: /Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend</tool_use_error>","is_error":true,"tool_use_id":"toolu_019eaGJuQPiozFNZmRrsDk2R"}]},"uuid":"25e807cb-9188-4382-bf26-2cc01f94b839","timestamp":"2025-12-28T12:50:57.317Z","toolUseResult":"Error: File does not exist. Current working directory: /Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend"}
{"parentUuid":"25e807cb-9188-4382-bf26-2cc01f94b839","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Qbk5WgAcuG7H1qXfTgcJJv","type":"tool_result","content":"     1→\"use client\"\n     2→\n     3→import * as React from \"react\"\n     4→import * as SheetPrimitive from \"@radix-ui/react-dialog\"\n     5→import { XIcon } from \"lucide-react\"\n     6→\n     7→import { cn } from \"@/lib/utils\"\n     8→\n     9→function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {\n    10→  return <SheetPrimitive.Root data-slot=\"sheet\" {...props} />\n    11→}\n    12→\n    13→function SheetTrigger({\n    14→  ...props\n    15→}: React.ComponentProps<typeof SheetPrimitive.Trigger>) {\n    16→  return <SheetPrimitive.Trigger data-slot=\"sheet-trigger\" {...props} />\n    17→}\n    18→\n    19→function SheetClose({\n    20→  ...props\n    21→}: React.ComponentProps<typeof SheetPrimitive.Close>) {\n    22→  return <SheetPrimitive.Close data-slot=\"sheet-close\" {...props} />\n    23→}\n    24→\n    25→function SheetPortal({\n    26→  ...props\n    27→}: React.ComponentProps<typeof SheetPrimitive.Portal>) {\n    28→  return <SheetPrimitive.Portal data-slot=\"sheet-portal\" {...props} />\n    29→}\n    30→\n    31→function SheetOverlay({\n    32→  className,\n    33→  ...props\n    34→}: React.ComponentProps<typeof SheetPrimitive.Overlay>) {\n    35→  return (\n    36→    <SheetPrimitive.Overlay\n    37→      data-slot=\"sheet-overlay\"\n    38→      className={cn(\n    39→        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50\",\n    40→        className\n    41→      )}\n    42→      {...props}\n    43→    />\n    44→  )\n    45→}\n    46→\n    47→function SheetContent({\n    48→  className,\n    49→  children,\n    50→  side = \"right\",\n    51→  ...props\n    52→}: React.ComponentProps<typeof SheetPrimitive.Content> & {\n    53→  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n    54→}) {\n    55→  return (\n    56→    <SheetPortal>\n    57→      <SheetOverlay />\n    58→      <SheetPrimitive.Content\n    59→        data-slot=\"sheet-content\"\n    60→        className={cn(\n    61→          \"bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n    62→          side === \"right\" &&\n    63→            \"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm\",\n    64→          side === \"left\" &&\n    65→            \"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm\",\n    66→          side === \"top\" &&\n    67→            \"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b\",\n    68→          side === \"bottom\" &&\n    69→            \"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t\",\n    70→          className\n    71→        )}\n    72→        {...props}\n    73→      >\n    74→        {children}\n    75→        <SheetPrimitive.Close className=\"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none\">\n    76→          <XIcon className=\"size-4\" />\n    77→          <span className=\"sr-only\">Close</span>\n    78→        </SheetPrimitive.Close>\n    79→      </SheetPrimitive.Content>\n    80→    </SheetPortal>\n    81→  )\n    82→}\n    83→\n    84→function SheetHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n    85→  return (\n    86→    <div\n    87→      data-slot=\"sheet-header\"\n    88→      className={cn(\"flex flex-col gap-1.5 p-4\", className)}\n    89→      {...props}\n    90→    />\n    91→  )\n    92→}\n    93→\n    94→function SheetFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n    95→  return (\n    96→    <div\n    97→      data-slot=\"sheet-footer\"\n    98→      className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    99→      {...props}\n   100→    />\n   101→  )\n   102→}\n   103→\n   104→function SheetTitle({\n   105→  className,\n   106→  ...props\n   107→}: React.ComponentProps<typeof SheetPrimitive.Title>) {\n   108→  return (\n   109→    <SheetPrimitive.Title\n   110→      data-slot=\"sheet-title\"\n   111→      className={cn(\"text-foreground font-semibold\", className)}\n   112→      {...props}\n   113→    />\n   114→  )\n   115→}\n   116→\n   117→function SheetDescription({\n   118→  className,\n   119→  ...props\n   120→}: React.ComponentProps<typeof SheetPrimitive.Description>) {\n   121→  return (\n   122→    <SheetPrimitive.Description\n   123→      data-slot=\"sheet-description\"\n   124→      className={cn(\"text-muted-foreground text-sm\", className)}\n   125→      {...props}\n   126→    />\n   127→  )\n   128→}\n   129→\n   130→export {\n   131→  Sheet,\n   132→  SheetTrigger,\n   133→  SheetClose,\n   134→  SheetContent,\n   135→  SheetHeader,\n   136→  SheetFooter,\n   137→  SheetTitle,\n   138→  SheetDescription,\n   139→}\n   140→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"7534920b-afc9-43c7-898f-f643d4c7fad6","timestamp":"2025-12-28T12:50:57.360Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/components/ui/sheet.tsx","content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { XIcon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {\n  return <SheetPrimitive.Root data-slot=\"sheet\" {...props} />\n}\n\nfunction SheetTrigger({\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Trigger>) {\n  return <SheetPrimitive.Trigger data-slot=\"sheet-trigger\" {...props} />\n}\n\nfunction SheetClose({\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Close>) {\n  return <SheetPrimitive.Close data-slot=\"sheet-close\" {...props} />\n}\n\nfunction SheetPortal({\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Portal>) {\n  return <SheetPrimitive.Portal data-slot=\"sheet-portal\" {...props} />\n}\n\nfunction SheetOverlay({\n  className,\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Overlay>) {\n  return (\n    <SheetPrimitive.Overlay\n      data-slot=\"sheet-overlay\"\n      className={cn(\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SheetContent({\n  className,\n  children,\n  side = \"right\",\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Content> & {\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n}) {\n  return (\n    <SheetPortal>\n      <SheetOverlay />\n      <SheetPrimitive.Content\n        data-slot=\"sheet-content\"\n        className={cn(\n          \"bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n          side === \"right\" &&\n            \"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm\",\n          side === \"left\" &&\n            \"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm\",\n          side === \"top\" &&\n            \"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b\",\n          side === \"bottom\" &&\n            \"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n        <SheetPrimitive.Close className=\"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none\">\n          <XIcon className=\"size-4\" />\n          <span className=\"sr-only\">Close</span>\n        </SheetPrimitive.Close>\n      </SheetPrimitive.Content>\n    </SheetPortal>\n  )\n}\n\nfunction SheetHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sheet-header\"\n      className={cn(\"flex flex-col gap-1.5 p-4\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SheetFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sheet-footer\"\n      className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SheetTitle({\n  className,\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Title>) {\n  return (\n    <SheetPrimitive.Title\n      data-slot=\"sheet-title\"\n      className={cn(\"text-foreground font-semibold\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SheetDescription({\n  className,\n  ...props\n}: React.ComponentProps<typeof SheetPrimitive.Description>) {\n  return (\n    <SheetPrimitive.Description\n      data-slot=\"sheet-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sheet,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","numLines":140,"startLine":1,"totalLines":140}}}
{"parentUuid":"7534920b-afc9-43c7-898f-f643d4c7fad6","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TGta8zH5mzU9fDJmb4j1z9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019v9ij4ej6r1ayBrKTADApp","name":"Read","input":{"file_path":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/components/ui/collapsible.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":75,"cache_creation_input_tokens":2248,"cache_read_input_tokens":27699,"cache_creation":{"ephemeral_5m_input_tokens":2248,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CWZ7cMg9SdfQeyyxczPk9","type":"assistant","uuid":"0cdcb688-5426-49cb-af0d-d8d3974fd560","timestamp":"2025-12-28T12:51:01.960Z"}
{"parentUuid":"0cdcb688-5426-49cb-af0d-d8d3974fd560","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TGta8zH5mzU9fDJmb4j1z9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Y6wtGmSZp1uzE9BBn6Pp9P","name":"Read","input":{"file_path":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/components/ui/scroll-area.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":75,"cache_creation_input_tokens":2248,"cache_read_input_tokens":27699,"cache_creation":{"ephemeral_5m_input_tokens":2248,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CWZ7cMg9SdfQeyyxczPk9","type":"assistant","uuid":"32c4159f-8179-41d9-9d8f-0b3a09a39af0","timestamp":"2025-12-28T12:51:02.753Z"}
{"parentUuid":"32c4159f-8179-41d9-9d8f-0b3a09a39af0","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TGta8zH5mzU9fDJmb4j1z9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01F655Z8osCJxQhGbBbQdMNq","name":"Read","input":{"file_path":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/app/globals.css"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":75,"cache_creation_input_tokens":2248,"cache_read_input_tokens":27699,"cache_creation":{"ephemeral_5m_input_tokens":2248,"ephemeral_1h_input_tokens":0},"output_tokens":229,"service_tier":"standard"}},"requestId":"req_011CWZ7cMg9SdfQeyyxczPk9","type":"assistant","uuid":"29de1660-693d-41e7-88bf-143d46673d92","timestamp":"2025-12-28T12:51:03.530Z"}
{"parentUuid":"29de1660-693d-41e7-88bf-143d46673d92","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File does not exist. Current working directory: /Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend</tool_use_error>","is_error":true,"tool_use_id":"toolu_019v9ij4ej6r1ayBrKTADApp"}]},"uuid":"84620c32-c5f2-47a0-ac3c-e5e304ddfe45","timestamp":"2025-12-28T12:51:03.568Z","toolUseResult":"Error: File does not exist. Current working directory: /Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend"}
{"parentUuid":"84620c32-c5f2-47a0-ac3c-e5e304ddfe45","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Y6wtGmSZp1uzE9BBn6Pp9P","type":"tool_result","content":"     1→\"use client\"\n     2→\n     3→import * as React from \"react\"\n     4→import * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n     5→\n     6→import { cn } from \"@/lib/utils\"\n     7→\n     8→function ScrollArea({\n     9→  className,\n    10→  children,\n    11→  ...props\n    12→}: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {\n    13→  return (\n    14→    <ScrollAreaPrimitive.Root\n    15→      data-slot=\"scroll-area\"\n    16→      className={cn(\"relative\", className)}\n    17→      {...props}\n    18→    >\n    19→      <ScrollAreaPrimitive.Viewport\n    20→        data-slot=\"scroll-area-viewport\"\n    21→        className=\"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1\"\n    22→      >\n    23→        {children}\n    24→      </ScrollAreaPrimitive.Viewport>\n    25→      <ScrollBar />\n    26→      <ScrollAreaPrimitive.Corner />\n    27→    </ScrollAreaPrimitive.Root>\n    28→  )\n    29→}\n    30→\n    31→function ScrollBar({\n    32→  className,\n    33→  orientation = \"vertical\",\n    34→  ...props\n    35→}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {\n    36→  return (\n    37→    <ScrollAreaPrimitive.ScrollAreaScrollbar\n    38→      data-slot=\"scroll-area-scrollbar\"\n    39→      orientation={orientation}\n    40→      className={cn(\n    41→        \"flex touch-none p-px transition-colors select-none\",\n    42→        orientation === \"vertical\" &&\n    43→          \"h-full w-2.5 border-l border-l-transparent\",\n    44→        orientation === \"horizontal\" &&\n    45→          \"h-2.5 flex-col border-t border-t-transparent\",\n    46→        className\n    47→      )}\n    48→      {...props}\n    49→    >\n    50→      <ScrollAreaPrimitive.ScrollAreaThumb\n    51→        data-slot=\"scroll-area-thumb\"\n    52→        className=\"bg-border relative flex-1 rounded-full\"\n    53→      />\n    54→    </ScrollAreaPrimitive.ScrollAreaScrollbar>\n    55→  )\n    56→}\n    57→\n    58→export { ScrollArea, ScrollBar }\n    59→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"05513f1d-8ae2-463e-9d05-6c9749f98c91","timestamp":"2025-12-28T12:51:03.610Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/components/ui/scroll-area.tsx","content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction ScrollArea({\n  className,\n  children,\n  ...props\n}: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {\n  return (\n    <ScrollAreaPrimitive.Root\n      data-slot=\"scroll-area\"\n      className={cn(\"relative\", className)}\n      {...props}\n    >\n      <ScrollAreaPrimitive.Viewport\n        data-slot=\"scroll-area-viewport\"\n        className=\"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1\"\n      >\n        {children}\n      </ScrollAreaPrimitive.Viewport>\n      <ScrollBar />\n      <ScrollAreaPrimitive.Corner />\n    </ScrollAreaPrimitive.Root>\n  )\n}\n\nfunction ScrollBar({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {\n  return (\n    <ScrollAreaPrimitive.ScrollAreaScrollbar\n      data-slot=\"scroll-area-scrollbar\"\n      orientation={orientation}\n      className={cn(\n        \"flex touch-none p-px transition-colors select-none\",\n        orientation === \"vertical\" &&\n          \"h-full w-2.5 border-l border-l-transparent\",\n        orientation === \"horizontal\" &&\n          \"h-2.5 flex-col border-t border-t-transparent\",\n        className\n      )}\n      {...props}\n    >\n      <ScrollAreaPrimitive.ScrollAreaThumb\n        data-slot=\"scroll-area-thumb\"\n        className=\"bg-border relative flex-1 rounded-full\"\n      />\n    </ScrollAreaPrimitive.ScrollAreaScrollbar>\n  )\n}\n\nexport { ScrollArea, ScrollBar }\n","numLines":59,"startLine":1,"totalLines":59}}}
{"parentUuid":"05513f1d-8ae2-463e-9d05-6c9749f98c91","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01F655Z8osCJxQhGbBbQdMNq","type":"tool_result","content":"     1→@import \"tailwindcss\";\n     2→@import \"tw-animate-css\";\n     3→\n     4→@custom-variant dark (&:is(.dark *));\n     5→\n     6→@theme inline {\n     7→  --color-background: var(--background);\n     8→  --color-foreground: var(--foreground);\n     9→  --font-sans: var(--font-geist-sans);\n    10→  --font-mono: var(--font-geist-mono);\n    11→  --color-sidebar-ring: var(--sidebar-ring);\n    12→  --color-sidebar-border: var(--sidebar-border);\n    13→  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);\n    14→  --color-sidebar-accent: var(--sidebar-accent);\n    15→  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);\n    16→  --color-sidebar-primary: var(--sidebar-primary);\n    17→  --color-sidebar-foreground: var(--sidebar-foreground);\n    18→  --color-sidebar: var(--sidebar);\n    19→  --color-chart-5: var(--chart-5);\n    20→  --color-chart-4: var(--chart-4);\n    21→  --color-chart-3: var(--chart-3);\n    22→  --color-chart-2: var(--chart-2);\n    23→  --color-chart-1: var(--chart-1);\n    24→  --color-ring: var(--ring);\n    25→  --color-input: var(--input);\n    26→  --color-border: var(--border);\n    27→  --color-destructive: var(--destructive);\n    28→  --color-accent-foreground: var(--accent-foreground);\n    29→  --color-accent: var(--accent);\n    30→  --color-muted-foreground: var(--muted-foreground);\n    31→  --color-muted: var(--muted);\n    32→  --color-secondary-foreground: var(--secondary-foreground);\n    33→  --color-secondary: var(--secondary);\n    34→  --color-primary-foreground: var(--primary-foreground);\n    35→  --color-primary: var(--primary);\n    36→  --color-popover-foreground: var(--popover-foreground);\n    37→  --color-popover: var(--popover);\n    38→  --color-card-foreground: var(--card-foreground);\n    39→  --color-card: var(--card);\n    40→  --radius-sm: calc(var(--radius) - 4px);\n    41→  --radius-md: calc(var(--radius) - 2px);\n    42→  --radius-lg: var(--radius);\n    43→  --radius-xl: calc(var(--radius) + 4px);\n    44→  --radius-2xl: calc(var(--radius) + 8px);\n    45→  --radius-3xl: calc(var(--radius) + 12px);\n    46→  --radius-4xl: calc(var(--radius) + 16px);\n    47→}\n    48→\n    49→:root {\n    50→  --radius: 0.625rem;\n    51→  --background: oklch(1 0 0);\n    52→  --foreground: oklch(0.145 0 0);\n    53→  --card: oklch(1 0 0);\n    54→  --card-foreground: oklch(0.145 0 0);\n    55→  --popover: oklch(1 0 0);\n    56→  --popover-foreground: oklch(0.145 0 0);\n    57→  --primary: oklch(0.205 0 0);\n    58→  --primary-foreground: oklch(0.985 0 0);\n    59→  --secondary: oklch(0.97 0 0);\n    60→  --secondary-foreground: oklch(0.205 0 0);\n    61→  --muted: oklch(0.97 0 0);\n    62→  --muted-foreground: oklch(0.556 0 0);\n    63→  --accent: oklch(0.97 0 0);\n    64→  --accent-foreground: oklch(0.205 0 0);\n    65→  --destructive: oklch(0.577 0.245 27.325);\n    66→  --border: oklch(0.922 0 0);\n    67→  --input: oklch(0.922 0 0);\n    68→  --ring: oklch(0.708 0 0);\n    69→  --chart-1: oklch(0.646 0.222 41.116);\n    70→  --chart-2: oklch(0.6 0.118 184.704);\n    71→  --chart-3: oklch(0.398 0.07 227.392);\n    72→  --chart-4: oklch(0.828 0.189 84.429);\n    73→  --chart-5: oklch(0.769 0.188 70.08);\n    74→  --sidebar: oklch(0.985 0 0);\n    75→  --sidebar-foreground: oklch(0.145 0 0);\n    76→  --sidebar-primary: oklch(0.205 0 0);\n    77→  --sidebar-primary-foreground: oklch(0.985 0 0);\n    78→  --sidebar-accent: oklch(0.97 0 0);\n    79→  --sidebar-accent-foreground: oklch(0.205 0 0);\n    80→  --sidebar-border: oklch(0.922 0 0);\n    81→  --sidebar-ring: oklch(0.708 0 0);\n    82→}\n    83→\n    84→.dark {\n    85→  --background: oklch(0.145 0 0);\n    86→  --foreground: oklch(0.985 0 0);\n    87→  --card: oklch(0.205 0 0);\n    88→  --card-foreground: oklch(0.985 0 0);\n    89→  --popover: oklch(0.205 0 0);\n    90→  --popover-foreground: oklch(0.985 0 0);\n    91→  --primary: oklch(0.922 0 0);\n    92→  --primary-foreground: oklch(0.205 0 0);\n    93→  --secondary: oklch(0.269 0 0);\n    94→  --secondary-foreground: oklch(0.985 0 0);\n    95→  --muted: oklch(0.269 0 0);\n    96→  --muted-foreground: oklch(0.708 0 0);\n    97→  --accent: oklch(0.269 0 0);\n    98→  --accent-foreground: oklch(0.985 0 0);\n    99→  --destructive: oklch(0.704 0.191 22.216);\n   100→  --border: oklch(1 0 0 / 10%);\n   101→  --input: oklch(1 0 0 / 15%);\n   102→  --ring: oklch(0.556 0 0);\n   103→  --chart-1: oklch(0.488 0.243 264.376);\n   104→  --chart-2: oklch(0.696 0.17 162.48);\n   105→  --chart-3: oklch(0.769 0.188 70.08);\n   106→  --chart-4: oklch(0.627 0.265 303.9);\n   107→  --chart-5: oklch(0.645 0.246 16.439);\n   108→  --sidebar: oklch(0.205 0 0);\n   109→  --sidebar-foreground: oklch(0.985 0 0);\n   110→  --sidebar-primary: oklch(0.488 0.243 264.376);\n   111→  --sidebar-primary-foreground: oklch(0.985 0 0);\n   112→  --sidebar-accent: oklch(0.269 0 0);\n   113→  --sidebar-accent-foreground: oklch(0.985 0 0);\n   114→  --sidebar-border: oklch(1 0 0 / 10%);\n   115→  --sidebar-ring: oklch(0.556 0 0);\n   116→}\n   117→\n   118→@layer base {\n   119→  * {\n   120→    @apply border-border outline-ring/50;\n   121→  }\n   122→  body {\n   123→    @apply bg-background text-foreground;\n   124→  }\n   125→}\n   126→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1489afa6-a0aa-429d-9ba6-05b33aaf5fce","timestamp":"2025-12-28T12:51:03.610Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/app/globals.css","content":"@import \"tailwindcss\";\n@import \"tw-animate-css\";\n\n@custom-variant dark (&:is(.dark *));\n\n@theme inline {\n  --color-background: var(--background);\n  --color-foreground: var(--foreground);\n  --font-sans: var(--font-geist-sans);\n  --font-mono: var(--font-geist-mono);\n  --color-sidebar-ring: var(--sidebar-ring);\n  --color-sidebar-border: var(--sidebar-border);\n  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);\n  --color-sidebar-accent: var(--sidebar-accent);\n  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);\n  --color-sidebar-primary: var(--sidebar-primary);\n  --color-sidebar-foreground: var(--sidebar-foreground);\n  --color-sidebar: var(--sidebar);\n  --color-chart-5: var(--chart-5);\n  --color-chart-4: var(--chart-4);\n  --color-chart-3: var(--chart-3);\n  --color-chart-2: var(--chart-2);\n  --color-chart-1: var(--chart-1);\n  --color-ring: var(--ring);\n  --color-input: var(--input);\n  --color-border: var(--border);\n  --color-destructive: var(--destructive);\n  --color-accent-foreground: var(--accent-foreground);\n  --color-accent: var(--accent);\n  --color-muted-foreground: var(--muted-foreground);\n  --color-muted: var(--muted);\n  --color-secondary-foreground: var(--secondary-foreground);\n  --color-secondary: var(--secondary);\n  --color-primary-foreground: var(--primary-foreground);\n  --color-primary: var(--primary);\n  --color-popover-foreground: var(--popover-foreground);\n  --color-popover: var(--popover);\n  --color-card-foreground: var(--card-foreground);\n  --color-card: var(--card);\n  --radius-sm: calc(var(--radius) - 4px);\n  --radius-md: calc(var(--radius) - 2px);\n  --radius-lg: var(--radius);\n  --radius-xl: calc(var(--radius) + 4px);\n  --radius-2xl: calc(var(--radius) + 8px);\n  --radius-3xl: calc(var(--radius) + 12px);\n  --radius-4xl: calc(var(--radius) + 16px);\n}\n\n:root {\n  --radius: 0.625rem;\n  --background: oklch(1 0 0);\n  --foreground: oklch(0.145 0 0);\n  --card: oklch(1 0 0);\n  --card-foreground: oklch(0.145 0 0);\n  --popover: oklch(1 0 0);\n  --popover-foreground: oklch(0.145 0 0);\n  --primary: oklch(0.205 0 0);\n  --primary-foreground: oklch(0.985 0 0);\n  --secondary: oklch(0.97 0 0);\n  --secondary-foreground: oklch(0.205 0 0);\n  --muted: oklch(0.97 0 0);\n  --muted-foreground: oklch(0.556 0 0);\n  --accent: oklch(0.97 0 0);\n  --accent-foreground: oklch(0.205 0 0);\n  --destructive: oklch(0.577 0.245 27.325);\n  --border: oklch(0.922 0 0);\n  --input: oklch(0.922 0 0);\n  --ring: oklch(0.708 0 0);\n  --chart-1: oklch(0.646 0.222 41.116);\n  --chart-2: oklch(0.6 0.118 184.704);\n  --chart-3: oklch(0.398 0.07 227.392);\n  --chart-4: oklch(0.828 0.189 84.429);\n  --chart-5: oklch(0.769 0.188 70.08);\n  --sidebar: oklch(0.985 0 0);\n  --sidebar-foreground: oklch(0.145 0 0);\n  --sidebar-primary: oklch(0.205 0 0);\n  --sidebar-primary-foreground: oklch(0.985 0 0);\n  --sidebar-accent: oklch(0.97 0 0);\n  --sidebar-accent-foreground: oklch(0.205 0 0);\n  --sidebar-border: oklch(0.922 0 0);\n  --sidebar-ring: oklch(0.708 0 0);\n}\n\n.dark {\n  --background: oklch(0.145 0 0);\n  --foreground: oklch(0.985 0 0);\n  --card: oklch(0.205 0 0);\n  --card-foreground: oklch(0.985 0 0);\n  --popover: oklch(0.205 0 0);\n  --popover-foreground: oklch(0.985 0 0);\n  --primary: oklch(0.922 0 0);\n  --primary-foreground: oklch(0.205 0 0);\n  --secondary: oklch(0.269 0 0);\n  --secondary-foreground: oklch(0.985 0 0);\n  --muted: oklch(0.269 0 0);\n  --muted-foreground: oklch(0.708 0 0);\n  --accent: oklch(0.269 0 0);\n  --accent-foreground: oklch(0.985 0 0);\n  --destructive: oklch(0.704 0.191 22.216);\n  --border: oklch(1 0 0 / 10%);\n  --input: oklch(1 0 0 / 15%);\n  --ring: oklch(0.556 0 0);\n  --chart-1: oklch(0.488 0.243 264.376);\n  --chart-2: oklch(0.696 0.17 162.48);\n  --chart-3: oklch(0.769 0.188 70.08);\n  --chart-4: oklch(0.627 0.265 303.9);\n  --chart-5: oklch(0.645 0.246 16.439);\n  --sidebar: oklch(0.205 0 0);\n  --sidebar-foreground: oklch(0.985 0 0);\n  --sidebar-primary: oklch(0.488 0.243 264.376);\n  --sidebar-primary-foreground: oklch(0.985 0 0);\n  --sidebar-accent: oklch(0.269 0 0);\n  --sidebar-accent-foreground: oklch(0.985 0 0);\n  --sidebar-border: oklch(1 0 0 / 10%);\n  --sidebar-ring: oklch(0.556 0 0);\n}\n\n@layer base {\n  * {\n    @apply border-border outline-ring/50;\n  }\n  body {\n    @apply bg-background text-foreground;\n  }\n}\n","numLines":126,"startLine":1,"totalLines":126}}}
{"parentUuid":"1489afa6-a0aa-429d-9ba6-05b33aaf5fce","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_01HpbBLZGJDn5HS7KUwrFzqX","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me check what other UI components exist:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":3664,"cache_read_input_tokens":29947,"cache_creation":{"ephemeral_5m_input_tokens":3664,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWZ7crt4QQqTYQgEsLpyK","type":"assistant","uuid":"a9437406-63e5-4452-8d3b-e7430cb3d893","timestamp":"2025-12-28T12:51:07.392Z"}
{"parentUuid":"a9437406-63e5-4452-8d3b-e7430cb3d893","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_01HpbBLZGJDn5HS7KUwrFzqX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CpU5xq1jdN6JJgUzb9QFrW","name":"Read","input":{"file_path":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/components/ui/tooltip.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":3664,"cache_read_input_tokens":29947,"cache_creation":{"ephemeral_5m_input_tokens":3664,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWZ7crt4QQqTYQgEsLpyK","type":"assistant","uuid":"931dd7ae-4a95-4894-ba9e-1d62e18abbb6","timestamp":"2025-12-28T12:51:08.885Z"}
{"parentUuid":"931dd7ae-4a95-4894-ba9e-1d62e18abbb6","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_01HpbBLZGJDn5HS7KUwrFzqX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MwGHy4DJWzNGskGA88BXtp","name":"Read","input":{"file_path":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/components/ui/checkbox.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":3664,"cache_read_input_tokens":29947,"cache_creation":{"ephemeral_5m_input_tokens":3664,"ephemeral_1h_input_tokens":0},"output_tokens":168,"service_tier":"standard"}},"requestId":"req_011CWZ7crt4QQqTYQgEsLpyK","type":"assistant","uuid":"3d4c0d10-66a9-488b-ac19-c15f0a91f635","timestamp":"2025-12-28T12:51:09.597Z"}
{"parentUuid":"3d4c0d10-66a9-488b-ac19-c15f0a91f635","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File does not exist. Current working directory: /Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend</tool_use_error>","is_error":true,"tool_use_id":"toolu_01MwGHy4DJWzNGskGA88BXtp"}]},"uuid":"54bc7a6b-f4b0-430c-9341-ce41da86dc56","timestamp":"2025-12-28T12:51:09.643Z","toolUseResult":"Error: File does not exist. Current working directory: /Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend"}
{"parentUuid":"54bc7a6b-f4b0-430c-9341-ce41da86dc56","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CpU5xq1jdN6JJgUzb9QFrW","type":"tool_result","content":"     1→\"use client\"\n     2→\n     3→import * as React from \"react\"\n     4→import * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n     5→\n     6→import { cn } from \"@/lib/utils\"\n     7→\n     8→function TooltipProvider({\n     9→  delayDuration = 0,\n    10→  ...props\n    11→}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {\n    12→  return (\n    13→    <TooltipPrimitive.Provider\n    14→      data-slot=\"tooltip-provider\"\n    15→      delayDuration={delayDuration}\n    16→      {...props}\n    17→    />\n    18→  )\n    19→}\n    20→\n    21→function Tooltip({\n    22→  ...props\n    23→}: React.ComponentProps<typeof TooltipPrimitive.Root>) {\n    24→  return (\n    25→    <TooltipProvider>\n    26→      <TooltipPrimitive.Root data-slot=\"tooltip\" {...props} />\n    27→    </TooltipProvider>\n    28→  )\n    29→}\n    30→\n    31→function TooltipTrigger({\n    32→  ...props\n    33→}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {\n    34→  return <TooltipPrimitive.Trigger data-slot=\"tooltip-trigger\" {...props} />\n    35→}\n    36→\n    37→function TooltipContent({\n    38→  className,\n    39→  sideOffset = 0,\n    40→  children,\n    41→  ...props\n    42→}: React.ComponentProps<typeof TooltipPrimitive.Content>) {\n    43→  return (\n    44→    <TooltipPrimitive.Portal>\n    45→      <TooltipPrimitive.Content\n    46→        data-slot=\"tooltip-content\"\n    47→        sideOffset={sideOffset}\n    48→        className={cn(\n    49→          \"bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance\",\n    50→          className\n    51→        )}\n    52→        {...props}\n    53→      >\n    54→        {children}\n    55→        <TooltipPrimitive.Arrow className=\"bg-foreground fill-foreground z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]\" />\n    56→      </TooltipPrimitive.Content>\n    57→    </TooltipPrimitive.Portal>\n    58→  )\n    59→}\n    60→\n    61→export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n    62→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a403b805-add7-433f-bcdd-b14d8fa670d1","timestamp":"2025-12-28T12:51:09.685Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/components/ui/tooltip.tsx","content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction TooltipProvider({\n  delayDuration = 0,\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {\n  return (\n    <TooltipPrimitive.Provider\n      data-slot=\"tooltip-provider\"\n      delayDuration={delayDuration}\n      {...props}\n    />\n  )\n}\n\nfunction Tooltip({\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Root>) {\n  return (\n    <TooltipProvider>\n      <TooltipPrimitive.Root data-slot=\"tooltip\" {...props} />\n    </TooltipProvider>\n  )\n}\n\nfunction TooltipTrigger({\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {\n  return <TooltipPrimitive.Trigger data-slot=\"tooltip-trigger\" {...props} />\n}\n\nfunction TooltipContent({\n  className,\n  sideOffset = 0,\n  children,\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Content>) {\n  return (\n    <TooltipPrimitive.Portal>\n      <TooltipPrimitive.Content\n        data-slot=\"tooltip-content\"\n        sideOffset={sideOffset}\n        className={cn(\n          \"bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n        <TooltipPrimitive.Arrow className=\"bg-foreground fill-foreground z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]\" />\n      </TooltipPrimitive.Content>\n    </TooltipPrimitive.Portal>\n  )\n}\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","numLines":62,"startLine":1,"totalLines":62}}}
{"parentUuid":"a403b805-add7-433f-bcdd-b14d8fa670d1","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TZrWLcBPUiE854dYpffcYy","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a good understanding of the current implementation and available components. Let me create a beautifully redesigned notebook page that looks like Google's NotebookLM - clean, modern, and professional. I will:\n\n1. Create a clean three-panel layout with proper spacing\n2. Use subtle borders and shadows instead of heavy outlines\n3. Implement collapsible accordion sections for the Studio panel\n4. Use a Sheet/slide-over for study materials\n5. Apply proper typography hierarchy and whitespace\n6. Add smooth hover states and transitions"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":75,"cache_creation_input_tokens":1238,"cache_read_input_tokens":33611,"cache_creation":{"ephemeral_5m_input_tokens":1238,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWZ7dM3UKwcxHNgX9FaxH","type":"assistant","uuid":"acf72a3d-e630-486f-a1b8-7b5afacab683","timestamp":"2025-12-28T12:51:17.447Z"}
{"parentUuid":"acf72a3d-e630-486f-a1b8-7b5afacab683","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TZrWLcBPUiE854dYpffcYy","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015AWVirxmWe8F7JrN9aXX8d","name":"Write","input":{"file_path":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/app/notebooks/[id]/page.tsx","content":"'use client'\n\nimport { useEffect, useState, useRef, useCallback } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { createClient, Notebook, Source, ChatMessage } from '@/lib/supabase'\nimport { chatApi, Note } from '@/lib/api'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Badge } from '@/components/ui/badge'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle, SheetTrigger } from '@/components/ui/sheet'\nimport { ScrollArea } from '@/components/ui/scroll-area'\nimport { Tooltip, TooltipContent, TooltipTrigger } from '@/components/ui/tooltip'\nimport {\n  ArrowLeft, Plus, Upload, FileText, Youtube, Link as LinkIcon,\n  Type, Send, Loader2, CheckCircle, XCircle, Clock, Trash2,\n  Mic, Video, Search, BookOpen, StickyNote, Sparkles, Pin,\n  Edit2, Save, X, AlertCircle, ChevronDown, ChevronRight,\n  MoreHorizontal, Copy, GraduationCap, HelpCircle, ListChecks,\n  Play, Pause, RotateCcw\n} from 'lucide-react'\nimport { toast } from 'sonner'\nimport { User } from '@supabase/supabase-js'\n\ninterface LocalNote {\n  id: string\n  notebook_id: string\n  type: 'written' | 'saved_response'\n  title: string | null\n  content: string | null\n  tags: string[]\n  is_pinned: boolean\n  created_at: string\n  updated_at: string\n}\n\nexport default function NotebookPage() {\n  const params = useParams()\n  const router = useRouter()\n  const notebookId = params.id as string\n  const supabase = createClient()\n\n  // Core state\n  const [user, setUser] = useState<User | null>(null)\n  const [notebook, setNotebook] = useState<Notebook | null>(null)\n  const [sources, setSources] = useState<Source[]>([])\n  const [messages, setMessages] = useState<ChatMessage[]>([])\n  const [notes, setNotes] = useState<LocalNote[]>([])\n  const [loading, setLoading] = useState(true)\n\n  // Chat state\n  const [sending, setSending] = useState(false)\n  const [message, setMessage] = useState('')\n  const [selectedSources, setSelectedSources] = useState<Set<string>>(new Set())\n  const [sessionId, setSessionId] = useState<string | null>(null)\n\n  // Source modal state\n  const [addSourceOpen, setAddSourceOpen] = useState(false)\n  const [sourceType, setSourceType] = useState<'file' | 'youtube' | 'url' | 'text'>('file')\n  const [sourceInput, setSourceInput] = useState('')\n  const [sourceName, setSourceName] = useState('')\n  const [uploading, setUploading] = useState(false)\n\n  // Notes state\n  const [addNoteOpen, setAddNoteOpen] = useState(false)\n  const [noteTitle, setNoteTitle] = useState('')\n  const [noteContent, setNoteContent] = useState('')\n  const [editingNote, setEditingNote] = useState<string | null>(null)\n  const [savingNote, setSavingNote] = useState(false)\n\n  // Audio state\n  const [audioFormat, setAudioFormat] = useState('deep_dive')\n  const [audioInstructions, setAudioInstructions] = useState('')\n  const [generatingAudio, setGeneratingAudio] = useState(false)\n\n  // Video state\n  const [videoStyle, setVideoStyle] = useState('explainer')\n  const [generatingVideo, setGeneratingVideo] = useState(false)\n\n  // Research state\n  const [researchQuery, setResearchQuery] = useState('')\n  const [researchMode, setResearchMode] = useState('fast')\n  const [researching, setResearching] = useState(false)\n\n  // Study loading states\n  const [generatingFlashcards, setGeneratingFlashcards] = useState(false)\n  const [generatingQuiz, setGeneratingQuiz] = useState(false)\n  const [generatingStudyGuide, setGeneratingStudyGuide] = useState(false)\n  const [generatingFaq, setGeneratingFaq] = useState(false)\n\n  // Study results\n  const [flashcards, setFlashcards] = useState<Array<{id: string, front: string, back: string}>>([])\n  const [quizQuestions, setQuizQuestions] = useState<Array<{id: string, question: string, options: string[], correct_index: number, explanation: string}>>([])\n  const [studyGuide, setStudyGuide] = useState<{title: string, sections: Array<{heading: string, content: string}>} | null>(null)\n  const [faqItems, setFaqItems] = useState<Array<{question: string, answer: string}>>([])\n  const [currentFlashcard, setCurrentFlashcard] = useState(0)\n  const [showFlashcardBack, setShowFlashcardBack] = useState(false)\n  const [currentQuizQuestion, setCurrentQuizQuestion] = useState(0)\n  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null)\n  const [showQuizAnswer, setShowQuizAnswer] = useState(false)\n\n  // Studio accordion state\n  const [expandedSection, setExpandedSection] = useState<string | null>('audio')\n\n  // Study materials sheet\n  const [studySheetOpen, setStudySheetOpen] = useState(false)\n  const [activeStudyType, setActiveStudyType] = useState<'flashcards' | 'quiz' | 'guide' | 'faq' | null>(null)\n\n  // Source preview state\n  const [viewingSource, setViewingSource] = useState<Source | null>(null)\n\n  // Refs\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n\n  // Initialize\n  useEffect(() => {\n    const init = async () => {\n      const { data: { user } } = await supabase.auth.getUser()\n      if (!user) {\n        router.push('/auth/login')\n        return\n      }\n      setUser(user)\n      await Promise.all([fetchNotebook(), fetchSources(), fetchNotes()])\n      setLoading(false)\n    }\n    init()\n  }, [notebookId])\n\n  // Auto-scroll messages\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }, [messages])\n\n  const fetchNotebook = async () => {\n    const { data, error } = await supabase\n      .from('notebooks')\n      .select('*')\n      .eq('id', notebookId)\n      .single()\n\n    if (error || !data) {\n      toast.error('Notebook not found')\n      router.push('/')\n      return\n    }\n    setNotebook(data)\n  }\n\n  const fetchSources = async () => {\n    const { data } = await supabase\n      .from('sources')\n      .select('*')\n      .eq('notebook_id', notebookId)\n      .order('created_at', { ascending: false })\n\n    setSources(data || [])\n  }\n\n  const fetchNotes = async () => {\n    const { data } = await supabase\n      .from('notes')\n      .select('*')\n      .eq('notebook_id', notebookId)\n      .order('is_pinned', { ascending: false })\n      .order('created_at', { ascending: false })\n\n    setNotes(data || [])\n  }\n\n  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n\n    setUploading(true)\n    const fileExt = file.name.split('.').pop()?.toLowerCase()\n    const filePath = `${user?.id}/${notebookId}/${Date.now()}.${fileExt}`\n\n    const { error: uploadError } = await supabase.storage\n      .from('sources')\n      .upload(filePath, file)\n\n    if (uploadError) {\n      toast.error('Failed to upload file')\n      setUploading(false)\n      return\n    }\n\n    const { data, error } = await supabase\n      .from('sources')\n      .insert({\n        notebook_id: notebookId,\n        type: fileExt === 'pdf' ? 'pdf' : fileExt === 'docx' ? 'docx' : 'txt',\n        name: file.name,\n        status: 'ready',\n        file_path: filePath,\n        original_filename: file.name,\n        mime_type: file.type,\n        file_size_bytes: file.size,\n      })\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to create source')\n    } else {\n      toast.success('File uploaded!')\n      setSources([data, ...sources])\n      setAddSourceOpen(false)\n    }\n    setUploading(false)\n  }\n\n  const addSource = async () => {\n    if (!sourceInput.trim()) return\n\n    setUploading(true)\n    let sourceData: Partial<Source> = {\n      notebook_id: notebookId,\n      status: 'ready',\n    }\n\n    if (sourceType === 'youtube') {\n      sourceData = {\n        ...sourceData,\n        type: 'youtube',\n        name: sourceName || `YouTube: ${sourceInput}`,\n        metadata: { url: sourceInput },\n      }\n    } else if (sourceType === 'url') {\n      sourceData = {\n        ...sourceData,\n        type: 'url',\n        name: sourceName || sourceInput,\n        metadata: { url: sourceInput },\n      }\n    } else if (sourceType === 'text') {\n      sourceData = {\n        ...sourceData,\n        type: 'text',\n        name: sourceName || 'Pasted Text',\n        metadata: { content: sourceInput },\n      }\n    }\n\n    const { data, error } = await supabase\n      .from('sources')\n      .insert(sourceData)\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to add source')\n    } else {\n      toast.success('Source added!')\n      setSources([data, ...sources])\n      setSourceInput('')\n      setSourceName('')\n      setAddSourceOpen(false)\n    }\n    setUploading(false)\n  }\n\n  const deleteSource = async (sourceId: string) => {\n    const { error } = await supabase\n      .from('sources')\n      .delete()\n      .eq('id', sourceId)\n\n    if (error) {\n      toast.error('Failed to delete source')\n    } else {\n      setSources(sources.filter(s => s.id !== sourceId))\n      selectedSources.delete(sourceId)\n      setSelectedSources(new Set(selectedSources))\n      toast.success('Source deleted')\n    }\n  }\n\n  const toggleSource = (sourceId: string) => {\n    const newSelected = new Set(selectedSources)\n    if (newSelected.has(sourceId)) {\n      newSelected.delete(sourceId)\n    } else {\n      newSelected.add(sourceId)\n    }\n    setSelectedSources(newSelected)\n  }\n\n  const selectAllSources = () => {\n    if (selectedSources.size === sources.length) {\n      setSelectedSources(new Set())\n    } else {\n      setSelectedSources(new Set(sources.map(s => s.id)))\n    }\n  }\n\n  const sendMessage = async () => {\n    if (!message.trim() || sending) return\n\n    setSending(true)\n    const userMessage: ChatMessage = {\n      id: crypto.randomUUID(),\n      session_id: sessionId || '',\n      role: 'user',\n      content: message,\n      citations: [],\n      source_ids_used: Array.from(selectedSources),\n      model_used: null,\n      input_tokens: null,\n      output_tokens: null,\n      cost_usd: null,\n      created_at: new Date().toISOString(),\n    }\n    setMessages(prev => [...prev, userMessage])\n    setMessage('')\n\n    try {\n      const response = await chatApi.sendMessage(notebookId, {\n        message: userMessage.content,\n        source_ids: Array.from(selectedSources),\n        session_id: sessionId || undefined,\n      })\n\n      if (response.data.session_id) {\n        setSessionId(response.data.session_id)\n      }\n\n      const aiMessage: ChatMessage = {\n        id: response.data.message_id,\n        session_id: response.data.session_id,\n        role: 'assistant',\n        content: response.data.content,\n        citations: response.data.citations,\n        source_ids_used: Array.from(selectedSources),\n        model_used: response.usage?.model_used || 'gemini-2.0-flash',\n        input_tokens: response.usage?.input_tokens || 0,\n        output_tokens: response.usage?.output_tokens || 0,\n        cost_usd: response.usage?.cost_usd || 0,\n        created_at: new Date().toISOString(),\n      }\n      setMessages(prev => [...prev, aiMessage])\n    } catch (error) {\n      toast.error('Failed to send message')\n      // Remove the user message on error\n      setMessages(prev => prev.filter(m => m.id !== userMessage.id))\n    }\n    setSending(false)\n  }\n\n  // Notes functions\n  const createNote = async () => {\n    if (!noteTitle.trim() && !noteContent.trim()) return\n\n    setSavingNote(true)\n    const { data, error } = await supabase\n      .from('notes')\n      .insert({\n        notebook_id: notebookId,\n        type: 'written',\n        title: noteTitle || 'Untitled Note',\n        content: noteContent,\n        tags: [],\n      })\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to create note')\n    } else {\n      toast.success('Note created!')\n      setNotes([data, ...notes])\n      setNoteTitle('')\n      setNoteContent('')\n      setAddNoteOpen(false)\n    }\n    setSavingNote(false)\n  }\n\n  const updateNote = async (noteId: string, updates: Partial<LocalNote>) => {\n    const { data, error } = await supabase\n      .from('notes')\n      .update({ ...updates, updated_at: new Date().toISOString() })\n      .eq('id', noteId)\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to update note')\n    } else {\n      setNotes(notes.map(n => n.id === noteId ? data : n))\n      setEditingNote(null)\n    }\n  }\n\n  const deleteNote = async (noteId: string) => {\n    const { error } = await supabase\n      .from('notes')\n      .delete()\n      .eq('id', noteId)\n\n    if (error) {\n      toast.error('Failed to delete note')\n    } else {\n      setNotes(notes.filter(n => n.id !== noteId))\n      toast.success('Note deleted')\n    }\n  }\n\n  const togglePinNote = async (note: LocalNote) => {\n    await updateNote(note.id, { is_pinned: !note.is_pinned })\n  }\n\n  const saveResponseAsNote = async (msg: ChatMessage) => {\n    const { data, error } = await supabase\n      .from('notes')\n      .insert({\n        notebook_id: notebookId,\n        type: 'saved_response',\n        title: `Saved Response - ${new Date().toLocaleDateString()}`,\n        content: msg.content,\n        tags: [],\n      })\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to save response')\n    } else {\n      toast.success('Response saved as note!')\n      setNotes([data, ...notes])\n    }\n  }\n\n  // Audio generation\n  const generateAudio = async () => {\n    if (selectedSources.size === 0) {\n      toast.error('Please select at least one source')\n      return\n    }\n\n    setGeneratingAudio(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/audio`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          format: audioFormat,\n          source_ids: Array.from(selectedSources),\n          custom_instructions: audioInstructions || undefined,\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else {\n        toast.success('Audio script generated! (Demo mode - no actual audio file)')\n      }\n    } catch {\n      toast.error('Failed to generate audio')\n    }\n    setGeneratingAudio(false)\n  }\n\n  // Video generation\n  const generateVideo = async () => {\n    if (selectedSources.size === 0) {\n      toast.error('Please select at least one source')\n      return\n    }\n\n    setGeneratingVideo(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/video`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          style: videoStyle,\n          source_ids: Array.from(selectedSources),\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else {\n        toast.success('Video script generated! (Demo mode - no actual video file)')\n      }\n    } catch {\n      toast.error('Failed to generate video')\n    }\n    setGeneratingVideo(false)\n  }\n\n  // Research generation\n  const runResearch = async () => {\n    if (!researchQuery.trim()) {\n      toast.error('Please enter a research query')\n      return\n    }\n\n    setResearching(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/research`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          query: researchQuery,\n          mode: researchMode,\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else {\n        toast.success('Research report generated!')\n        setResearchQuery('')\n      }\n    } catch {\n      toast.error('Failed to run research')\n    }\n    setResearching(false)\n  }\n\n  // Study material generation handlers\n  const handleGenerateFlashcards = async () => {\n    setGeneratingFlashcards(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          type: 'flashcards',\n          source_ids: Array.from(selectedSources),\n          count: 5,\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else if (result.data?.flashcards) {\n        setFlashcards(result.data.flashcards)\n        setCurrentFlashcard(0)\n        setShowFlashcardBack(false)\n        setActiveStudyType('flashcards')\n        setStudySheetOpen(true)\n        toast.success(`Generated ${result.data.flashcards.length} flashcards!`)\n      } else {\n        toast.error('Unexpected response')\n      }\n    } catch (err) {\n      console.error('Flashcards error:', err)\n      toast.error('Failed to generate flashcards')\n    } finally {\n      setGeneratingFlashcards(false)\n    }\n  }\n\n  const handleGenerateQuiz = async () => {\n    setGeneratingQuiz(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          type: 'quiz',\n          source_ids: Array.from(selectedSources),\n          count: 5,\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else if (result.data?.questions) {\n        setQuizQuestions(result.data.questions)\n        setCurrentQuizQuestion(0)\n        setSelectedAnswer(null)\n        setShowQuizAnswer(false)\n        setActiveStudyType('quiz')\n        setStudySheetOpen(true)\n        toast.success(`Generated ${result.data.questions.length} quiz questions!`)\n      } else {\n        toast.error('Unexpected response')\n      }\n    } catch (err) {\n      console.error('Quiz error:', err)\n      toast.error('Failed to generate quiz')\n    } finally {\n      setGeneratingQuiz(false)\n    }\n  }\n\n  const handleGenerateStudyGuide = async () => {\n    setGeneratingStudyGuide(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          type: 'study-guide',\n          source_ids: Array.from(selectedSources),\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else if (result.data?.sections) {\n        setStudyGuide(result.data)\n        setActiveStudyType('guide')\n        setStudySheetOpen(true)\n        toast.success('Study guide generated!')\n      } else {\n        toast.error('Unexpected response')\n      }\n    } catch (err) {\n      console.error('Study guide error:', err)\n      toast.error('Failed to generate study guide')\n    } finally {\n      setGeneratingStudyGuide(false)\n    }\n  }\n\n  const handleGenerateFaq = async () => {\n    setGeneratingFaq(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          type: 'faq',\n          source_ids: Array.from(selectedSources),\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else if (result.data?.faq) {\n        setFaqItems(result.data.faq)\n        setActiveStudyType('faq')\n        setStudySheetOpen(true)\n        toast.success(`Generated ${result.data.faq.length} FAQ items!`)\n      } else {\n        toast.error('Unexpected response')\n      }\n    } catch (err) {\n      console.error('FAQ error:', err)\n      toast.error('Failed to generate FAQ')\n    } finally {\n      setGeneratingFaq(false)\n    }\n  }\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'ready':\n        return <CheckCircle className=\"h-3.5 w-3.5 text-emerald-500\" />\n      case 'processing':\n        return <Clock className=\"h-3.5 w-3.5 text-amber-500 animate-spin\" />\n      case 'failed':\n        return <XCircle className=\"h-3.5 w-3.5 text-red-500\" />\n      default:\n        return <Clock className=\"h-3.5 w-3.5 text-muted-foreground\" />\n    }\n  }\n\n  const getSourceIcon = (type: string) => {\n    switch (type) {\n      case 'pdf':\n      case 'docx':\n      case 'txt':\n        return <FileText className=\"h-4 w-4 text-blue-500\" />\n      case 'youtube':\n        return <Youtube className=\"h-4 w-4 text-red-500\" />\n      case 'url':\n        return <LinkIcon className=\"h-4 w-4 text-violet-500\" />\n      case 'text':\n        return <Type className=\"h-4 w-4 text-slate-500\" />\n      default:\n        return <FileText className=\"h-4 w-4 text-slate-500\" />\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <div className=\"flex flex-col items-center gap-3\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          <p className=\"text-sm text-muted-foreground\">Loading notebook...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"h-screen flex flex-col bg-background\">\n      {/* Clean Header */}\n      <header className=\"h-14 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 px-4 flex items-center gap-4 shrink-0 sticky top-0 z-50\">\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => router.push('/')}\n          className=\"text-muted-foreground hover:text-foreground -ml-2\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n        </Button>\n\n        <div className=\"flex items-center gap-3\">\n          <span className=\"text-xl\">{notebook?.emoji}</span>\n          <h1 className=\"font-semibold text-lg tracking-tight\">{notebook?.name}</h1>\n        </div>\n\n        <div className=\"flex items-center gap-2 ml-auto\">\n          <Badge variant=\"secondary\" className=\"font-normal text-xs px-2.5 py-0.5\">\n            {sources.length} {sources.length === 1 ? 'source' : 'sources'}\n          </Badge>\n          {selectedSources.size > 0 && (\n            <Badge className=\"bg-primary/10 text-primary border-0 font-normal text-xs px-2.5 py-0.5\">\n              {selectedSources.size} selected\n            </Badge>\n          )}\n        </div>\n      </header>\n\n      {/* Three Panel Layout */}\n      <div className=\"flex-1 grid grid-cols-[280px_1fr_340px] overflow-hidden\">\n\n        {/* Left Panel - Sources */}\n        <div className=\"border-r bg-muted/30 flex flex-col h-full\">\n          <div className=\"p-4 border-b bg-background\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h2 className=\"font-semibold text-sm text-foreground\">Sources</h2>\n              <Dialog open={addSourceOpen} onOpenChange={setAddSourceOpen}>\n                <DialogTrigger asChild>\n                  <Button size=\"sm\" variant=\"outline\" className=\"h-7 w-7 p-0\">\n                    <Plus className=\"h-3.5 w-3.5\" />\n                  </Button>\n                </DialogTrigger>\n                <DialogContent className=\"sm:max-w-md\">\n                  <DialogHeader>\n                    <DialogTitle>Add Source</DialogTitle>\n                    <DialogDescription>\n                      Add documents, URLs, or text to your notebook for AI analysis.\n                    </DialogDescription>\n                  </DialogHeader>\n                  <Tabs value={sourceType} onValueChange={(v) => setSourceType(v as typeof sourceType)} className=\"mt-2\">\n                    <TabsList className=\"grid grid-cols-4 w-full\">\n                      <TabsTrigger value=\"file\" className=\"text-xs\">\n                        <Upload className=\"h-3.5 w-3.5 mr-1.5\" />\n                        File\n                      </TabsTrigger>\n                      <TabsTrigger value=\"youtube\" className=\"text-xs\">\n                        <Youtube className=\"h-3.5 w-3.5 mr-1.5\" />\n                        YouTube\n                      </TabsTrigger>\n                      <TabsTrigger value=\"url\" className=\"text-xs\">\n                        <LinkIcon className=\"h-3.5 w-3.5 mr-1.5\" />\n                        URL\n                      </TabsTrigger>\n                      <TabsTrigger value=\"text\" className=\"text-xs\">\n                        <Type className=\"h-3.5 w-3.5 mr-1.5\" />\n                        Text\n                      </TabsTrigger>\n                    </TabsList>\n                    <TabsContent value=\"file\" className=\"space-y-4 mt-4\">\n                      <input\n                        ref={fileInputRef}\n                        type=\"file\"\n                        accept=\".pdf,.docx,.txt,.md\"\n                        onChange={handleFileUpload}\n                        className=\"hidden\"\n                      />\n                      <button\n                        onClick={() => fileInputRef.current?.click()}\n                        disabled={uploading}\n                        className=\"w-full h-32 border-2 border-dashed rounded-lg flex flex-col items-center justify-center gap-2 hover:border-primary/50 hover:bg-muted/50 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {uploading ? (\n                          <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                        ) : (\n                          <>\n                            <Upload className=\"h-8 w-8 text-muted-foreground\" />\n                            <div className=\"text-center\">\n                              <p className=\"text-sm font-medium\">Click to upload</p>\n                              <p className=\"text-xs text-muted-foreground mt-0.5\">PDF, DOCX, TXT, or MD</p>\n                            </div>\n                          </>\n                        )}\n                      </button>\n                    </TabsContent>\n                    <TabsContent value=\"youtube\" className=\"space-y-3 mt-4\">\n                      <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium\">YouTube URL</label>\n                        <Input\n                          placeholder=\"https://youtube.com/watch?v=...\"\n                          value={sourceInput}\n                          onChange={(e) => setSourceInput(e.target.value)}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium\">Name (optional)</label>\n                        <Input\n                          placeholder=\"My video\"\n                          value={sourceName}\n                          onChange={(e) => setSourceName(e.target.value)}\n                        />\n                      </div>\n                    </TabsContent>\n                    <TabsContent value=\"url\" className=\"space-y-3 mt-4\">\n                      <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium\">Website URL</label>\n                        <Input\n                          placeholder=\"https://example.com/article\"\n                          value={sourceInput}\n                          onChange={(e) => setSourceInput(e.target.value)}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium\">Name (optional)</label>\n                        <Input\n                          placeholder=\"Article name\"\n                          value={sourceName}\n                          onChange={(e) => setSourceName(e.target.value)}\n                        />\n                      </div>\n                    </TabsContent>\n                    <TabsContent value=\"text\" className=\"space-y-3 mt-4\">\n                      <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium\">Name</label>\n                        <Input\n                          placeholder=\"My notes\"\n                          value={sourceName}\n                          onChange={(e) => setSourceName(e.target.value)}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium\">Content</label>\n                        <Textarea\n                          placeholder=\"Paste your text here...\"\n                          value={sourceInput}\n                          onChange={(e) => setSourceInput(e.target.value)}\n                          rows={6}\n                        />\n                      </div>\n                    </TabsContent>\n                  </Tabs>\n                  {sourceType !== 'file' && (\n                    <DialogFooter className=\"mt-4\">\n                      <Button\n                        onClick={addSource}\n                        disabled={uploading || !sourceInput.trim()}\n                        className=\"w-full sm:w-auto\"\n                      >\n                        {uploading && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                        Add Source\n                      </Button>\n                    </DialogFooter>\n                  )}\n                </DialogContent>\n              </Dialog>\n            </div>\n\n            {sources.length > 0 && (\n              <button\n                onClick={selectAllSources}\n                className=\"text-xs text-muted-foreground hover:text-foreground transition-colors\"\n              >\n                {selectedSources.size === sources.length ? 'Deselect all' : 'Select all'}\n              </button>\n            )}\n          </div>\n\n          <ScrollArea className=\"flex-1\">\n            <div className=\"p-2\">\n              {sources.length === 0 ? (\n                <div className=\"text-center py-12 px-4\">\n                  <div className=\"w-12 h-12 rounded-full bg-muted flex items-center justify-center mx-auto mb-3\">\n                    <FileText className=\"h-5 w-5 text-muted-foreground\" />\n                  </div>\n                  <p className=\"text-sm font-medium text-foreground mb-1\">No sources yet</p>\n                  <p className=\"text-xs text-muted-foreground\">Add documents to start analyzing</p>\n                </div>\n              ) : (\n                <div className=\"space-y-1\">\n                  {sources.map((source) => (\n                    <div\n                      key={source.id}\n                      className={`\n                        group relative flex items-center gap-2.5 px-3 py-2.5 rounded-lg cursor-pointer\n                        transition-all duration-150\n                        ${selectedSources.has(source.id)\n                          ? 'bg-primary/10 ring-1 ring-primary/20'\n                          : 'hover:bg-muted'\n                        }\n                        ${viewingSource?.id === source.id ? 'ring-2 ring-primary' : ''}\n                      `}\n                      onClick={() => toggleSource(source.id)}\n                    >\n                      <div className={`\n                        w-4 h-4 rounded border-2 flex items-center justify-center shrink-0\n                        transition-colors duration-150\n                        ${selectedSources.has(source.id)\n                          ? 'bg-primary border-primary'\n                          : 'border-muted-foreground/30 group-hover:border-muted-foreground/50'\n                        }\n                      `}>\n                        {selectedSources.has(source.id) && (\n                          <CheckCircle className=\"h-3 w-3 text-primary-foreground\" />\n                        )}\n                      </div>\n\n                      {getSourceIcon(source.type)}\n\n                      <span\n                        className=\"flex-1 text-sm truncate\"\n                        onClick={(e) => {\n                          e.stopPropagation()\n                          setViewingSource(source)\n                        }}\n                      >\n                        {source.name}\n                      </span>\n\n                      {getStatusIcon(source.status)}\n\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"opacity-0 group-hover:opacity-100 h-6 w-6 p-0 transition-opacity\"\n                        onClick={(e) => {\n                          e.stopPropagation()\n                          deleteSource(source.id)\n                        }}\n                      >\n                        <Trash2 className=\"h-3 w-3 text-muted-foreground hover:text-destructive\" />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n        </div>\n\n        {/* Center Panel - Chat */}\n        <div className=\"flex flex-col h-full bg-background\">\n          {/* Source Preview Banner */}\n          {viewingSource && (\n            <div className=\"border-b bg-muted/50 px-6 py-4\">\n              <div className=\"max-w-3xl mx-auto\">\n                <div className=\"flex items-start justify-between gap-4\">\n                  <div className=\"flex items-start gap-3 min-w-0\">\n                    <div className=\"p-2 rounded-lg bg-background border shrink-0\">\n                      {getSourceIcon(viewingSource.type)}\n                    </div>\n                    <div className=\"min-w-0\">\n                      <h3 className=\"font-medium text-sm truncate\">{viewingSource.name}</h3>\n                      <div className=\"flex items-center gap-2 mt-1\">\n                        <Badge variant=\"outline\" className=\"text-xs font-normal capitalize\">\n                          {viewingSource.type}\n                        </Badge>\n                        {viewingSource.file_size_bytes && (\n                          <span className=\"text-xs text-muted-foreground\">\n                            {(viewingSource.file_size_bytes / 1024).toFixed(1)} KB\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => setViewingSource(null)}\n                    className=\"shrink-0 h-8 w-8 p-0\"\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n\n                {(viewingSource.type === 'text' && viewingSource.metadata?.content) ||\n                 (viewingSource.type === 'youtube' && viewingSource.metadata?.url) ||\n                 (viewingSource.type === 'url' && viewingSource.metadata?.url) ? (\n                  <div className=\"mt-3 p-3 rounded-lg bg-background border text-sm max-h-32 overflow-y-auto\">\n                    {viewingSource.type === 'text' ? (\n                      <p className=\"whitespace-pre-wrap text-muted-foreground\">{viewingSource.metadata.content}</p>\n                    ) : (\n                      <a\n                        href={viewingSource.metadata.url}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"text-primary hover:underline break-all\"\n                      >\n                        {viewingSource.metadata.url}\n                      </a>\n                    )}\n                  </div>\n                ) : null}\n              </div>\n            </div>\n          )}\n\n          {/* Messages */}\n          <ScrollArea className=\"flex-1\">\n            <div className=\"max-w-3xl mx-auto px-6 py-6\">\n              {messages.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center min-h-[400px] text-center\">\n                  <div className=\"w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center mb-6\">\n                    <Sparkles className=\"h-7 w-7 text-primary\" />\n                  </div>\n                  <h3 className=\"text-xl font-semibold mb-2\">Start a conversation</h3>\n                  <p className=\"text-muted-foreground mb-8 max-w-sm\">\n                    Ask questions about your sources and get AI-powered insights with citations.\n                  </p>\n                  <div className=\"flex flex-wrap justify-center gap-2 max-w-lg\">\n                    {['Summarize the key points', 'What are the main takeaways?', 'Explain the methodology'].map((q) => (\n                      <button\n                        key={q}\n                        onClick={() => setMessage(q)}\n                        className=\"px-4 py-2 text-sm rounded-full border bg-background hover:bg-muted transition-colors\"\n                      >\n                        {q}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              ) : (\n                <div className=\"space-y-6\">\n                  {messages.map((msg) => (\n                    <div\n                      key={msg.id}\n                      className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}\n                    >\n                      <div\n                        className={`\n                          max-w-[85%] rounded-2xl px-4 py-3\n                          ${msg.role === 'user'\n                            ? 'bg-primary text-primary-foreground rounded-br-md'\n                            : 'bg-muted rounded-bl-md'\n                          }\n                        `}\n                      >\n                        <p className=\"whitespace-pre-wrap text-[15px] leading-relaxed\">{msg.content}</p>\n                        {msg.role === 'assistant' && (\n                          <div className=\"flex items-center gap-3 mt-3 pt-3 border-t border-border/50\">\n                            {msg.cost_usd !== null && msg.cost_usd > 0 && (\n                              <span className=\"text-xs text-muted-foreground\">\n                                ${msg.cost_usd.toFixed(4)}\n                              </span>\n                            )}\n                            <div className=\"flex items-center gap-1 ml-auto\">\n                              <Tooltip>\n                                <TooltipTrigger asChild>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"h-7 w-7 p-0\"\n                                    onClick={() => navigator.clipboard.writeText(msg.content)}\n                                  >\n                                    <Copy className=\"h-3.5 w-3.5\" />\n                                  </Button>\n                                </TooltipTrigger>\n                                <TooltipContent>Copy</TooltipContent>\n                              </Tooltip>\n                              <Tooltip>\n                                <TooltipTrigger asChild>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"h-7 w-7 p-0\"\n                                    onClick={() => saveResponseAsNote(msg)}\n                                  >\n                                    <StickyNote className=\"h-3.5 w-3.5\" />\n                                  </Button>\n                                </TooltipTrigger>\n                                <TooltipContent>Save as note</TooltipContent>\n                              </Tooltip>\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  ))}\n                  {sending && (\n                    <div className=\"flex justify-start\">\n                      <div className=\"bg-muted rounded-2xl rounded-bl-md px-4 py-3\">\n                        <div className=\"flex items-center gap-2\">\n                          <Loader2 className=\"h-4 w-4 animate-spin\" />\n                          <span className=\"text-sm text-muted-foreground\">Thinking...</span>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                  <div ref={messagesEndRef} />\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n\n          {/* Chat Input */}\n          <div className=\"border-t bg-background p-4\">\n            <div className=\"max-w-3xl mx-auto\">\n              {selectedSources.size === 0 && sources.length > 0 && (\n                <div className=\"flex items-center gap-2 mb-3 px-3 py-2 text-sm text-amber-700 dark:text-amber-400 bg-amber-50 dark:bg-amber-950/30 rounded-lg border border-amber-200 dark:border-amber-800/50\">\n                  <AlertCircle className=\"h-4 w-4 shrink-0\" />\n                  <span>Select sources from the left panel for contextual answers</span>\n                </div>\n              )}\n              <div className=\"flex items-center gap-3\">\n                <div className=\"flex-1 relative\">\n                  <Input\n                    placeholder=\"Ask a question about your sources...\"\n                    value={message}\n                    onChange={(e) => setMessage(e.target.value)}\n                    onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && sendMessage()}\n                    disabled={sending}\n                    className=\"pr-12 h-12 text-[15px] rounded-xl border-muted-foreground/20 focus:border-primary\"\n                  />\n                </div>\n                <Button\n                  onClick={sendMessage}\n                  disabled={sending || !message.trim()}\n                  size=\"lg\"\n                  className=\"h-12 w-12 rounded-xl shrink-0\"\n                >\n                  <Send className=\"h-5 w-5\" />\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Right Panel - Studio */}\n        <div className=\"border-l bg-muted/30 flex flex-col h-full\">\n          <div className=\"p-4 border-b bg-background\">\n            <h2 className=\"font-semibold text-sm\">Studio</h2>\n            <p className=\"text-xs text-muted-foreground mt-0.5\">Create content from your sources</p>\n          </div>\n\n          <ScrollArea className=\"flex-1\">\n            <div className=\"p-3 space-y-2\">\n\n              {/* Audio Overview Section */}\n              <div className=\"rounded-xl border bg-background overflow-hidden\">\n                <button\n                  onClick={() => setExpandedSection(expandedSection === 'audio' ? null : 'audio')}\n                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-orange-500/20 to-red-500/20 flex items-center justify-center\">\n                      <Mic className=\"h-4 w-4 text-orange-600\" />\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium text-sm\">Audio Overview</p>\n                      <p className=\"text-xs text-muted-foreground\">Podcast-style discussion</p>\n                    </div>\n                  </div>\n                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'audio' ? 'rotate-180' : ''}`} />\n                </button>\n\n                {expandedSection === 'audio' && (\n                  <div className=\"px-4 pb-4 space-y-4 border-t bg-muted/20\">\n                    <div className=\"pt-4 space-y-3\">\n                      <div className=\"space-y-1.5\">\n                        <label className=\"text-xs font-medium\">Format</label>\n                        <Select value={audioFormat} onValueChange={setAudioFormat}>\n                          <SelectTrigger className=\"h-9 text-sm\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"deep_dive\">Deep Dive (10-15 min)</SelectItem>\n                            <SelectItem value=\"brief\">Brief Summary (2-3 min)</SelectItem>\n                            <SelectItem value=\"critique\">Analytical (5-10 min)</SelectItem>\n                            <SelectItem value=\"debate\">Debate (8-15 min)</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"space-y-1.5\">\n                        <label className=\"text-xs font-medium\">Custom Instructions</label>\n                        <Textarea\n                          placeholder=\"Optional instructions for hosts...\"\n                          value={audioInstructions}\n                          onChange={(e) => setAudioInstructions(e.target.value)}\n                          rows={2}\n                          className=\"text-sm resize-none\"\n                        />\n                      </div>\n                      <Button\n                        className=\"w-full\"\n                        onClick={generateAudio}\n                        disabled={generatingAudio || selectedSources.size === 0}\n                      >\n                        {generatingAudio ? (\n                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        ) : (\n                          <Play className=\"h-4 w-4 mr-2\" />\n                        )}\n                        Generate Audio\n                      </Button>\n                      {selectedSources.size === 0 && (\n                        <p className=\"text-xs text-muted-foreground text-center\">\n                          Select sources to generate\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Video Overview Section */}\n              <div className=\"rounded-xl border bg-background overflow-hidden\">\n                <button\n                  onClick={() => setExpandedSection(expandedSection === 'video' ? null : 'video')}\n                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center\">\n                      <Video className=\"h-4 w-4 text-purple-600\" />\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium text-sm\">Video Overview</p>\n                      <p className=\"text-xs text-muted-foreground\">Visual explainer video</p>\n                    </div>\n                  </div>\n                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'video' ? 'rotate-180' : ''}`} />\n                </button>\n\n                {expandedSection === 'video' && (\n                  <div className=\"px-4 pb-4 space-y-4 border-t bg-muted/20\">\n                    <div className=\"pt-4 space-y-3\">\n                      <div className=\"space-y-1.5\">\n                        <label className=\"text-xs font-medium\">Style</label>\n                        <Select value={videoStyle} onValueChange={setVideoStyle}>\n                          <SelectTrigger className=\"h-9 text-sm\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"explainer\">Explainer</SelectItem>\n                            <SelectItem value=\"documentary\">Documentary</SelectItem>\n                            <SelectItem value=\"presentation\">Presentation</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <Button\n                        className=\"w-full\"\n                        onClick={generateVideo}\n                        disabled={generatingVideo || selectedSources.size === 0}\n                      >\n                        {generatingVideo ? (\n                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        ) : (\n                          <Video className=\"h-4 w-4 mr-2\" />\n                        )}\n                        Generate Video\n                      </Button>\n                      {selectedSources.size === 0 && (\n                        <p className=\"text-xs text-muted-foreground text-center\">\n                          Select sources to generate\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Deep Research Section */}\n              <div className=\"rounded-xl border bg-background overflow-hidden\">\n                <button\n                  onClick={() => setExpandedSection(expandedSection === 'research' ? null : 'research')}\n                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-blue-500/20 to-cyan-500/20 flex items-center justify-center\">\n                      <Search className=\"h-4 w-4 text-blue-600\" />\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium text-sm\">Deep Research</p>\n                      <p className=\"text-xs text-muted-foreground\">Autonomous web research</p>\n                    </div>\n                  </div>\n                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'research' ? 'rotate-180' : ''}`} />\n                </button>\n\n                {expandedSection === 'research' && (\n                  <div className=\"px-4 pb-4 space-y-4 border-t bg-muted/20\">\n                    <div className=\"pt-4 space-y-3\">\n                      <div className=\"space-y-1.5\">\n                        <label className=\"text-xs font-medium\">Research Query</label>\n                        <Input\n                          placeholder=\"What would you like to research?\"\n                          value={researchQuery}\n                          onChange={(e) => setResearchQuery(e.target.value)}\n                          className=\"h-9 text-sm\"\n                        />\n                      </div>\n                      <div className=\"space-y-1.5\">\n                        <label className=\"text-xs font-medium\">Mode</label>\n                        <Select value={researchMode} onValueChange={setResearchMode}>\n                          <SelectTrigger className=\"h-9 text-sm\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"fast\">Fast (3-5 min)</SelectItem>\n                            <SelectItem value=\"deep\">Deep (10-15 min)</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <Button\n                        className=\"w-full\"\n                        onClick={runResearch}\n                        disabled={researching || !researchQuery.trim()}\n                      >\n                        {researching ? (\n                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        ) : (\n                          <Search className=\"h-4 w-4 mr-2\" />\n                        )}\n                        Start Research\n                      </Button>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Study Materials Section */}\n              <div className=\"rounded-xl border bg-background overflow-hidden\">\n                <button\n                  onClick={() => setExpandedSection(expandedSection === 'study' ? null : 'study')}\n                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-emerald-500/20 to-teal-500/20 flex items-center justify-center\">\n                      <GraduationCap className=\"h-4 w-4 text-emerald-600\" />\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium text-sm\">Study Materials</p>\n                      <p className=\"text-xs text-muted-foreground\">Flashcards, quizzes, and more</p>\n                    </div>\n                  </div>\n                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'study' ? 'rotate-180' : ''}`} />\n                </button>\n\n                {expandedSection === 'study' && (\n                  <div className=\"px-4 pb-4 border-t bg-muted/20\">\n                    <div className=\"pt-4 grid grid-cols-2 gap-2\">\n                      <button\n                        onClick={handleGenerateFlashcards}\n                        disabled={selectedSources.size === 0 || generatingFlashcards}\n                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {generatingFlashcards ? (\n                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n                        ) : (\n                          <BookOpen className=\"h-5 w-5 text-blue-500\" />\n                        )}\n                        <span className=\"text-xs font-medium\">Flashcards</span>\n                      </button>\n\n                      <button\n                        onClick={handleGenerateQuiz}\n                        disabled={selectedSources.size === 0 || generatingQuiz}\n                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {generatingQuiz ? (\n                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n                        ) : (\n                          <ListChecks className=\"h-5 w-5 text-purple-500\" />\n                        )}\n                        <span className=\"text-xs font-medium\">Quiz</span>\n                      </button>\n\n                      <button\n                        onClick={handleGenerateStudyGuide}\n                        disabled={selectedSources.size === 0 || generatingStudyGuide}\n                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {generatingStudyGuide ? (\n                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n                        ) : (\n                          <FileText className=\"h-5 w-5 text-orange-500\" />\n                        )}\n                        <span className=\"text-xs font-medium\">Study Guide</span>\n                      </button>\n\n                      <button\n                        onClick={handleGenerateFaq}\n                        disabled={selectedSources.size === 0 || generatingFaq}\n                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {generatingFaq ? (\n                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n                        ) : (\n                          <HelpCircle className=\"h-5 w-5 text-teal-500\" />\n                        )}\n                        <span className=\"text-xs font-medium\">FAQ</span>\n                      </button>\n                    </div>\n\n                    {selectedSources.size === 0 && (\n                      <p className=\"text-xs text-muted-foreground text-center mt-3\">\n                        Select sources to generate study materials\n                      </p>\n                    )}\n\n                    {/* Quick access to generated materials */}\n                    {(flashcards.length > 0 || quizQuestions.length > 0 || studyGuide || faqItems.length > 0) && (\n                      <div className=\"mt-4 pt-3 border-t\">\n                        <p className=\"text-xs font-medium text-muted-foreground mb-2\">Generated Materials</p>\n                        <div className=\"space-y-1\">\n                          {flashcards.length > 0 && (\n                            <button\n                              onClick={() => { setActiveStudyType('flashcards'); setStudySheetOpen(true) }}\n                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"\n                            >\n                              <BookOpen className=\"h-4 w-4 text-blue-500\" />\n                              <span>{flashcards.length} Flashcards</span>\n                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />\n                            </button>\n                          )}\n                          {quizQuestions.length > 0 && (\n                            <button\n                              onClick={() => { setActiveStudyType('quiz'); setStudySheetOpen(true) }}\n                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"\n                            >\n                              <ListChecks className=\"h-4 w-4 text-purple-500\" />\n                              <span>{quizQuestions.length} Quiz Questions</span>\n                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />\n                            </button>\n                          )}\n                          {studyGuide && (\n                            <button\n                              onClick={() => { setActiveStudyType('guide'); setStudySheetOpen(true) }}\n                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"\n                            >\n                              <FileText className=\"h-4 w-4 text-orange-500\" />\n                              <span>Study Guide</span>\n                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />\n                            </button>\n                          )}\n                          {faqItems.length > 0 && (\n                            <button\n                              onClick={() => { setActiveStudyType('faq'); setStudySheetOpen(true) }}\n                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"\n                            >\n                              <HelpCircle className=\"h-4 w-4 text-teal-500\" />\n                              <span>{faqItems.length} FAQ Items</span>\n                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />\n                            </button>\n                          )}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n\n              {/* Notes Section */}\n              <div className=\"rounded-xl border bg-background overflow-hidden\">\n                <button\n                  onClick={() => setExpandedSection(expandedSection === 'notes' ? null : 'notes')}\n                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-amber-500/20 to-yellow-500/20 flex items-center justify-center\">\n                      <StickyNote className=\"h-4 w-4 text-amber-600\" />\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium text-sm\">Notes</p>\n                      <p className=\"text-xs text-muted-foreground\">{notes.length} saved</p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Dialog open={addNoteOpen} onOpenChange={setAddNoteOpen}>\n                      <DialogTrigger asChild>\n                        <Button\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          className=\"h-7 w-7 p-0\"\n                          onClick={(e) => e.stopPropagation()}\n                        >\n                          <Plus className=\"h-3.5 w-3.5\" />\n                        </Button>\n                      </DialogTrigger>\n                      <DialogContent>\n                        <DialogHeader>\n                          <DialogTitle>Create Note</DialogTitle>\n                          <DialogDescription>\n                            Write a new note to save your thoughts.\n                          </DialogDescription>\n                        </DialogHeader>\n                        <div className=\"space-y-4 mt-2\">\n                          <div className=\"space-y-2\">\n                            <label className=\"text-sm font-medium\">Title</label>\n                            <Input\n                              placeholder=\"Note title...\"\n                              value={noteTitle}\n                              onChange={(e) => setNoteTitle(e.target.value)}\n                            />\n                          </div>\n                          <div className=\"space-y-2\">\n                            <label className=\"text-sm font-medium\">Content</label>\n                            <Textarea\n                              placeholder=\"Write your note...\"\n                              value={noteContent}\n                              onChange={(e) => setNoteContent(e.target.value)}\n                              rows={6}\n                            />\n                          </div>\n                        </div>\n                        <DialogFooter className=\"mt-4\">\n                          <Button onClick={createNote} disabled={savingNote}>\n                            {savingNote && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                            Create Note\n                          </Button>\n                        </DialogFooter>\n                      </DialogContent>\n                    </Dialog>\n                    <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'notes' ? 'rotate-180' : ''}`} />\n                  </div>\n                </button>\n\n                {expandedSection === 'notes' && (\n                  <div className=\"px-4 pb-4 border-t bg-muted/20\">\n                    <div className=\"pt-4\">\n                      {notes.length === 0 ? (\n                        <div className=\"text-center py-6\">\n                          <StickyNote className=\"h-8 w-8 mx-auto mb-2 text-muted-foreground/50\" />\n                          <p className=\"text-sm text-muted-foreground\">No notes yet</p>\n                          <p className=\"text-xs text-muted-foreground mt-1\">Create notes or save chat responses</p>\n                        </div>\n                      ) : (\n                        <div className=\"space-y-2\">\n                          {notes.map((note) => (\n                            <div\n                              key={note.id}\n                              className=\"p-3 rounded-lg border bg-background group\"\n                            >\n                              <div className=\"flex items-start justify-between gap-2\">\n                                <div className=\"flex items-center gap-2 min-w-0\">\n                                  {note.is_pinned && <Pin className=\"h-3 w-3 text-amber-500 shrink-0\" />}\n                                  <span className=\"font-medium text-sm truncate\">\n                                    {note.title || 'Untitled'}\n                                  </span>\n                                </div>\n                                <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"h-6 w-6 p-0\"\n                                    onClick={() => togglePinNote(note)}\n                                  >\n                                    <Pin className={`h-3 w-3 ${note.is_pinned ? 'text-amber-500' : 'text-muted-foreground'}`} />\n                                  </Button>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"h-6 w-6 p-0\"\n                                    onClick={() => deleteNote(note.id)}\n                                  >\n                                    <Trash2 className=\"h-3 w-3 text-muted-foreground hover:text-destructive\" />\n                                  </Button>\n                                </div>\n                              </div>\n                              <p className=\"text-xs text-muted-foreground mt-1.5 line-clamp-2\">\n                                {note.content || 'No content'}\n                              </p>\n                              <div className=\"flex items-center gap-2 mt-2\">\n                                <Badge variant=\"outline\" className=\"text-[10px] font-normal px-1.5 py-0\">\n                                  {note.type === 'saved_response' ? 'Chat' : 'Note'}\n                                </Badge>\n                                <span className=\"text-[10px] text-muted-foreground\">\n                                  {new Date(note.created_at).toLocaleDateString()}\n                                </span>\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n\n            </div>\n          </ScrollArea>\n        </div>\n      </div>\n\n      {/* Study Materials Sheet */}\n      <Sheet open={studySheetOpen} onOpenChange={setStudySheetOpen}>\n        <SheetContent className=\"w-full sm:max-w-lg overflow-y-auto\">\n          <SheetHeader>\n            <SheetTitle className=\"flex items-center gap-2\">\n              {activeStudyType === 'flashcards' && <><BookOpen className=\"h-5 w-5 text-blue-500\" /> Flashcards</>}\n              {activeStudyType === 'quiz' && <><ListChecks className=\"h-5 w-5 text-purple-500\" /> Quiz</>}\n              {activeStudyType === 'guide' && <><FileText className=\"h-5 w-5 text-orange-500\" /> Study Guide</>}\n              {activeStudyType === 'faq' && <><HelpCircle className=\"h-5 w-5 text-teal-500\" /> FAQ</>}\n            </SheetTitle>\n            <SheetDescription>\n              {activeStudyType === 'flashcards' && `${flashcards.length} cards generated from your sources`}\n              {activeStudyType === 'quiz' && `${quizQuestions.length} questions to test your knowledge`}\n              {activeStudyType === 'guide' && 'Comprehensive study guide from your sources'}\n              {activeStudyType === 'faq' && `${faqItems.length} frequently asked questions`}\n            </SheetDescription>\n          </SheetHeader>\n\n          <div className=\"mt-6\">\n            {/* Flashcards View */}\n            {activeStudyType === 'flashcards' && flashcards.length > 0 && (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n                  <span>Card {currentFlashcard + 1} of {flashcards.length}</span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setCurrentFlashcard(0)\n                      setShowFlashcardBack(false)\n                    }}\n                  >\n                    <RotateCcw className=\"h-4 w-4 mr-1\" />\n                    Reset\n                  </Button>\n                </div>\n\n                <div\n                  onClick={() => setShowFlashcardBack(!showFlashcardBack)}\n                  className=\"min-h-[200px] p-6 rounded-xl border-2 bg-gradient-to-br from-background to-muted/30 cursor-pointer hover:shadow-lg transition-all flex flex-col justify-center\"\n                >\n                  <p className=\"text-xs font-medium text-muted-foreground mb-3 uppercase tracking-wide\">\n                    {showFlashcardBack ? 'Answer' : 'Question'}\n                  </p>\n                  <p className=\"text-lg leading-relaxed\">\n                    {showFlashcardBack ? flashcards[currentFlashcard]?.back : flashcards[currentFlashcard]?.front}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground mt-4\">Click to flip</p>\n                </div>\n\n                <div className=\"flex gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    className=\"flex-1\"\n                    disabled={currentFlashcard === 0}\n                    onClick={() => { setCurrentFlashcard(c => c - 1); setShowFlashcardBack(false) }}\n                  >\n                    Previous\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    className=\"flex-1\"\n                    disabled={currentFlashcard === flashcards.length - 1}\n                    onClick={() => { setCurrentFlashcard(c => c + 1); setShowFlashcardBack(false) }}\n                  >\n                    Next\n                  </Button>\n                </div>\n              </div>\n            )}\n\n            {/* Quiz View */}\n            {activeStudyType === 'quiz' && quizQuestions.length > 0 && (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n                  <span>Question {currentQuizQuestion + 1} of {quizQuestions.length}</span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setCurrentQuizQuestion(0)\n                      setSelectedAnswer(null)\n                      setShowQuizAnswer(false)\n                    }}\n                  >\n                    <RotateCcw className=\"h-4 w-4 mr-1\" />\n                    Reset\n                  </Button>\n                </div>\n\n                <div className=\"p-6 rounded-xl border bg-muted/30\">\n                  <p className=\"font-medium text-lg mb-4\">{quizQuestions[currentQuizQuestion]?.question}</p>\n\n                  <div className=\"space-y-2\">\n                    {quizQuestions[currentQuizQuestion]?.options.map((option, i) => (\n                      <button\n                        key={i}\n                        className={`\n                          w-full text-left p-4 rounded-lg border transition-all\n                          ${showQuizAnswer\n                            ? i === quizQuestions[currentQuizQuestion]?.correct_index\n                              ? 'bg-emerald-100 dark:bg-emerald-900/30 border-emerald-500'\n                              : selectedAnswer === i\n                              ? 'bg-red-100 dark:bg-red-900/30 border-red-500'\n                              : 'bg-muted/50'\n                            : selectedAnswer === i\n                            ? 'bg-primary/10 border-primary'\n                            : 'bg-background hover:bg-muted/50'\n                          }\n                        `}\n                        onClick={() => !showQuizAnswer && setSelectedAnswer(i)}\n                        disabled={showQuizAnswer}\n                      >\n                        {option}\n                      </button>\n                    ))}\n                  </div>\n\n                  {selectedAnswer !== null && !showQuizAnswer && (\n                    <Button\n                      className=\"w-full mt-4\"\n                      onClick={() => setShowQuizAnswer(true)}\n                    >\n                      Check Answer\n                    </Button>\n                  )}\n\n                  {showQuizAnswer && (\n                    <div className=\"mt-4 space-y-3\">\n                      <div className=\"p-4 rounded-lg bg-muted\">\n                        <p className=\"text-sm\">{quizQuestions[currentQuizQuestion]?.explanation}</p>\n                      </div>\n                      <Button\n                        className=\"w-full\"\n                        disabled={currentQuizQuestion === quizQuestions.length - 1}\n                        onClick={() => {\n                          setCurrentQuizQuestion(c => c + 1)\n                          setSelectedAnswer(null)\n                          setShowQuizAnswer(false)\n                        }}\n                      >\n                        Next Question\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Study Guide View */}\n            {activeStudyType === 'guide' && studyGuide && (\n              <div className=\"space-y-6\">\n                <h3 className=\"text-xl font-semibold\">{studyGuide.title}</h3>\n                {studyGuide.sections.map((section, i) => (\n                  <div key={i} className=\"space-y-2\">\n                    <h4 className=\"font-medium text-primary\">{section.heading}</h4>\n                    <p className=\"text-sm text-muted-foreground leading-relaxed whitespace-pre-wrap\">\n                      {section.content}\n                    </p>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {/* FAQ View */}\n            {activeStudyType === 'faq' && faqItems.length > 0 && (\n              <div className=\"space-y-4\">\n                {faqItems.map((item, i) => (\n                  <div key={i} className=\"p-4 rounded-xl border bg-muted/30\">\n                    <p className=\"font-medium mb-2\">Q: {item.question}</p>\n                    <p className=\"text-sm text-muted-foreground\">A: {item.answer}</p>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </SheetContent>\n      </Sheet>\n    </div>\n  )\n}\n"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":75,"cache_creation_input_tokens":1238,"cache_read_input_tokens":33611,"cache_creation":{"ephemeral_5m_input_tokens":1238,"ephemeral_1h_input_tokens":0},"output_tokens":20884,"service_tier":"standard"}},"requestId":"req_011CWZ7dM3UKwcxHNgX9FaxH","type":"assistant","uuid":"27e9602e-57b6-4a4c-a60c-4894ec950f1b","timestamp":"2025-12-28T12:56:39.905Z"}
{"parentUuid":"8048c706-c9c2-4298-8b45-b3ef56700097","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015AWVirxmWe8F7JrN9aXX8d","type":"tool_result","content":"The file /Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/app/notebooks/[id]/page.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n     1→'use client'\n     2→\n     3→import { useEffect, useState, useRef, useCallback } from 'react'\n     4→import { useParams, useRouter } from 'next/navigation'\n     5→import { createClient, Notebook, Source, ChatMessage } from '@/lib/supabase'\n     6→import { chatApi, Note } from '@/lib/api'\n     7→import { Button } from '@/components/ui/button'\n     8→import { Input } from '@/components/ui/input'\n     9→import { Textarea } from '@/components/ui/textarea'\n    10→import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'\n    11→import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\n    12→import { Badge } from '@/components/ui/badge'\n    13→import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\n    14→import { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle, SheetTrigger } from '@/components/ui/sheet'\n    15→import { ScrollArea } from '@/components/ui/scroll-area'\n    16→import { Tooltip, TooltipContent, TooltipTrigger } from '@/components/ui/tooltip'\n    17→import {\n    18→  ArrowLeft, Plus, Upload, FileText, Youtube, Link as LinkIcon,\n    19→  Type, Send, Loader2, CheckCircle, XCircle, Clock, Trash2,\n    20→  Mic, Video, Search, BookOpen, StickyNote, Sparkles, Pin,\n    21→  Edit2, Save, X, AlertCircle, ChevronDown, ChevronRight,\n    22→  MoreHorizontal, Copy, GraduationCap, HelpCircle, ListChecks,\n    23→  Play, Pause, RotateCcw\n    24→} from 'lucide-react'\n    25→import { toast } from 'sonner'\n    26→import { User } from '@supabase/supabase-js'\n    27→\n    28→interface LocalNote {\n    29→  id: string\n    30→  notebook_id: string\n    31→  type: 'written' | 'saved_response'\n    32→  title: string | null\n    33→  content: string | null\n    34→  tags: string[]\n    35→  is_pinned: boolean\n    36→  created_at: string\n    37→  updated_at: string\n    38→}\n    39→\n    40→export default function NotebookPage() {\n    41→  const params = useParams()\n    42→  const router = useRouter()\n    43→  const notebookId = params.id as string\n    44→  const supabase = createClient()\n    45→\n    46→  // Core state\n    47→  const [user, setUser] = useState<User | null>(null)\n    48→  const [notebook, setNotebook] = useState<Notebook | null>(null)\n    49→  const [sources, setSources] = useState<Source[]>([])\n    50→  const [messages, setMessages] = useState<ChatMessage[]>([])\n    51→  const [notes, setNotes] = useState<LocalNote[]>([])\n    52→  const [loading, setLoading] = useState(true)\n    53→\n    54→  // Chat state\n    55→  const [sending, setSending] = useState(false)\n    56→  const [message, setMessage] = useState('')\n    57→  const [selectedSources, setSelectedSources] = useState<Set<string>>(new Set())\n    58→  const [sessionId, setSessionId] = useState<string | null>(null)\n    59→\n    60→  // Source modal state\n    61→  const [addSourceOpen, setAddSourceOpen] = useState(false)\n    62→  const [sourceType, setSourceType] = useState<'file' | 'youtube' | 'url' | 'text'>('file')\n    63→  const [sourceInput, setSourceInput] = useState('')\n    64→  const [sourceName, setSourceName] = useState('')\n    65→  const [uploading, setUploading] = useState(false)\n    66→\n    67→  // Notes state\n    68→  const [addNoteOpen, setAddNoteOpen] = useState(false)\n    69→  const [noteTitle, setNoteTitle] = useState('')\n    70→  const [noteContent, setNoteContent] = useState('')\n    71→  const [editingNote, setEditingNote] = useState<string | null>(null)\n    72→  const [savingNote, setSavingNote] = useState(false)\n    73→\n    74→  // Audio state\n    75→  const [audioFormat, setAudioFormat] = useState('deep_dive')\n    76→  const [audioInstructions, setAudioInstructions] = useState('')\n    77→  const [generatingAudio, setGeneratingAudio] = useState(false)\n    78→\n    79→  // Video state\n    80→  const [videoStyle, setVideoStyle] = useState('explainer')\n    81→  const [generatingVideo, setGeneratingVideo] = useState(false)\n    82→\n    83→  // Research state\n    84→  const [researchQuery, setResearchQuery] = useState('')\n    85→  const [researchMode, setResearchMode] = useState('fast')\n    86→  const [researching, setResearching] = useState(false)\n    87→\n    88→  // Study loading states\n    89→  const [generatingFlashcards, setGeneratingFlashcards] = useState(false)\n    90→  const [generatingQuiz, setGeneratingQuiz] = useState(false)\n    91→  const [generatingStudyGuide, setGeneratingStudyGuide] = useState(false)\n    92→  const [generatingFaq, setGeneratingFaq] = useState(false)\n    93→\n    94→  // Study results\n    95→  const [flashcards, setFlashcards] = useState<Array<{id: string, front: string, back: string}>>([])\n    96→  const [quizQuestions, setQuizQuestions] = useState<Array<{id: string, question: string, options: string[], correct_index: number, explanation: string}>>([])\n    97→  const [studyGuide, setStudyGuide] = useState<{title: string, sections: Array<{heading: string, content: string}>} | null>(null)\n    98→  const [faqItems, setFaqItems] = useState<Array<{question: string, answer: string}>>([])\n    99→  const [currentFlashcard, setCurrentFlashcard] = useState(0)\n   100→  const [showFlashcardBack, setShowFlashcardBack] = useState(false)\n   101→  const [currentQuizQuestion, setCurrentQuizQuestion] = useState(0)\n   102→  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null)\n   103→  const [showQuizAnswer, setShowQuizAnswer] = useState(false)\n   104→\n   105→  // Studio accordion state\n   106→  const [expandedSection, setExpandedSection] = useState<string | null>('audio')\n   107→\n   108→  // Study materials sheet\n   109→  const [studySheetOpen, setStudySheetOpen] = useState(false)\n   110→  const [activeStudyType, setActiveStudyType] = useState<'flashcards' | 'quiz' | 'guide' | 'faq' | null>(null)\n   111→\n   112→  // Source preview state\n   113→  const [viewingSource, setViewingSource] = useState<Source | null>(null)\n   114→\n   115→  // Refs\n   116→  const fileInputRef = useRef<HTMLInputElement>(null)\n   117→  const messagesEndRef = useRef<HTMLDivElement>(null)\n   118→\n   119→  // Initialize\n   120→  useEffect(() => {\n   121→    const init = async () => {\n   122→      const { data: { user } } = await supabase.auth.getUser()\n   123→      if (!user) {\n   124→        router.push('/auth/login')\n   125→        return\n   126→      }\n   127→      setUser(user)\n   128→      await Promise.all([fetchNotebook(), fetchSources(), fetchNotes()])\n   129→      setLoading(false)\n   130→    }\n   131→    init()\n   132→  }, [notebookId])\n   133→\n   134→  // Auto-scroll messages\n   135→  useEffect(() => {\n   136→    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n   137→  }, [messages])\n   138→\n   139→  const fetchNotebook = async () => {\n   140→    const { data, error } = await supabase\n   141→      .from('notebooks')\n   142→      .select('*')\n   143→      .eq('id', notebookId)\n   144→      .single()\n   145→\n   146→    if (error || !data) {\n   147→      toast.error('Notebook not found')\n   148→      router.push('/')\n   149→      return\n   150→    }\n   151→    setNotebook(data)\n   152→  }\n   153→\n   154→  const fetchSources = async () => {\n   155→    const { data } = await supabase\n   156→      .from('sources')\n   157→      .select('*')\n   158→      .eq('notebook_id', notebookId)\n   159→      .order('created_at', { ascending: false })\n   160→\n   161→    setSources(data || [])\n   162→  }\n   163→\n   164→  const fetchNotes = async () => {\n   165→    const { data } = await supabase\n   166→      .from('notes')\n   167→      .select('*')\n   168→      .eq('notebook_id', notebookId)\n   169→      .order('is_pinned', { ascending: false })\n   170→      .order('created_at', { ascending: false })\n   171→\n   172→    setNotes(data || [])\n   173→  }\n   174→\n   175→  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n   176→    const file = e.target.files?.[0]\n   177→    if (!file) return\n   178→\n   179→    setUploading(true)\n   180→    const fileExt = file.name.split('.').pop()?.toLowerCase()\n   181→    const filePath = `${user?.id}/${notebookId}/${Date.now()}.${fileExt}`\n   182→\n   183→    const { error: uploadError } = await supabase.storage\n   184→      .from('sources')\n   185→      .upload(filePath, file)\n   186→\n   187→    if (uploadError) {\n   188→      toast.error('Failed to upload file')\n   189→      setUploading(false)\n   190→      return\n   191→    }\n   192→\n   193→    const { data, error } = await supabase\n   194→      .from('sources')\n   195→      .insert({\n   196→        notebook_id: notebookId,\n   197→        type: fileExt === 'pdf' ? 'pdf' : fileExt === 'docx' ? 'docx' : 'txt',\n   198→        name: file.name,\n   199→        status: 'ready',\n   200→        file_path: filePath,\n   201→        original_filename: file.name,\n   202→        mime_type: file.type,\n   203→        file_size_bytes: file.size,\n   204→      })\n   205→      .select()\n   206→      .single()\n   207→\n   208→    if (error) {\n   209→      toast.error('Failed to create source')\n   210→    } else {\n   211→      toast.success('File uploaded!')\n   212→      setSources([data, ...sources])\n   213→      setAddSourceOpen(false)\n   214→    }\n   215→    setUploading(false)\n   216→  }\n   217→\n   218→  const addSource = async () => {\n   219→    if (!sourceInput.trim()) return\n   220→\n   221→    setUploading(true)\n   222→    let sourceData: Partial<Source> = {\n   223→      notebook_id: notebookId,\n   224→      status: 'ready',\n   225→    }\n   226→\n   227→    if (sourceType === 'youtube') {\n   228→      sourceData = {\n   229→        ...sourceData,\n   230→        type: 'youtube',\n   231→        name: sourceName || `YouTube: ${sourceInput}`,\n   232→        metadata: { url: sourceInput },\n   233→      }\n   234→    } else if (sourceType === 'url') {\n   235→      sourceData = {\n   236→        ...sourceData,\n   237→        type: 'url',\n   238→        name: sourceName || sourceInput,\n   239→        metadata: { url: sourceInput },\n   240→      }\n   241→    } else if (sourceType === 'text') {\n   242→      sourceData = {\n   243→        ...sourceData,\n   244→        type: 'text',\n   245→        name: sourceName || 'Pasted Text',\n   246→        metadata: { content: sourceInput },\n   247→      }\n   248→    }\n   249→\n   250→    const { data, error } = await supabase\n   251→      .from('sources')\n   252→      .insert(sourceData)\n   253→      .select()\n   254→      .single()\n   255→\n   256→    if (error) {\n   257→      toast.error('Failed to add source')\n   258→    } else {\n   259→      toast.success('Source added!')\n   260→      setSources([data, ...sources])\n   261→      setSourceInput('')\n   262→      setSourceName('')\n   263→      setAddSourceOpen(false)\n   264→    }\n   265→    setUploading(false)\n   266→  }\n   267→\n   268→  const deleteSource = async (sourceId: string) => {\n   269→    const { error } = await supabase\n   270→      .from('sources')\n   271→      .delete()\n   272→      .eq('id', sourceId)\n   273→\n   274→    if (error) {\n   275→      toast.error('Failed to delete source')\n   276→    } else {\n   277→      setSources(sources.filter(s => s.id !== sourceId))\n   278→      selectedSources.delete(sourceId)\n   279→      setSelectedSources(new Set(selectedSources))\n   280→      toast.success('Source deleted')\n   281→    }\n   282→  }\n   283→\n   284→  const toggleSource = (sourceId: string) => {\n   285→    const newSelected = new Set(selectedSources)\n   286→    if (newSelected.has(sourceId)) {\n   287→      newSelected.delete(sourceId)\n   288→    } else {\n   289→      newSelected.add(sourceId)\n   290→    }\n   291→    setSelectedSources(newSelected)\n   292→  }\n   293→\n   294→  const selectAllSources = () => {\n   295→    if (selectedSources.size === sources.length) {\n   296→      setSelectedSources(new Set())\n   297→    } else {\n   298→      setSelectedSources(new Set(sources.map(s => s.id)))\n   299→    }\n   300→  }\n   301→\n   302→  const sendMessage = async () => {\n   303→    if (!message.trim() || sending) return\n   304→\n   305→    setSending(true)\n   306→    const userMessage: ChatMessage = {\n   307→      id: crypto.randomUUID(),\n   308→      session_id: sessionId || '',\n   309→      role: 'user',\n   310→      content: message,\n   311→      citations: [],\n   312→      source_ids_used: Array.from(selectedSources),\n   313→      model_used: null,\n   314→      input_tokens: null,\n   315→      output_tokens: null,\n   316→      cost_usd: null,\n   317→      created_at: new Date().toISOString(),\n   318→    }\n   319→    setMessages(prev => [...prev, userMessage])\n   320→    setMessage('')\n   321→\n   322→    try {\n   323→      const response = await chatApi.sendMessage(notebookId, {\n   324→        message: userMessage.content,\n   325→        source_ids: Array.from(selectedSources),\n   326→        session_id: sessionId || undefined,\n   327→      })\n   328→\n   329→      if (response.data.session_id) {\n   330→        setSessionId(response.data.session_id)\n   331→      }\n   332→\n   333→      const aiMessage: ChatMessage = {\n   334→        id: response.data.message_id,\n   335→        session_id: response.data.session_id,\n   336→        role: 'assistant',\n   337→        content: response.data.content,\n   338→        citations: response.data.citations,\n   339→        source_ids_used: Array.from(selectedSources),\n   340→        model_used: response.usage?.model_used || 'gemini-2.0-flash',\n   341→        input_tokens: response.usage?.input_tokens || 0,\n   342→        output_tokens: response.usage?.output_tokens || 0,\n   343→        cost_usd: response.usage?.cost_usd || 0,\n   344→        created_at: new Date().toISOString(),\n   345→      }\n   346→      setMessages(prev => [...prev, aiMessage])\n   347→    } catch (error) {\n   348→      toast.error('Failed to send message')\n   349→      // Remove the user message on error\n   350→      setMessages(prev => prev.filter(m => m.id !== userMessage.id))\n   351→    }\n   352→    setSending(false)\n   353→  }\n   354→\n   355→  // Notes functions\n   356→  const createNote = async () => {\n   357→    if (!noteTitle.trim() && !noteContent.trim()) return\n   358→\n   359→    setSavingNote(true)\n   360→    const { data, error } = await supabase\n   361→      .from('notes')\n   362→      .insert({\n   363→        notebook_id: notebookId,\n   364→        type: 'written',\n   365→        title: noteTitle || 'Untitled Note',\n   366→        content: noteContent,\n   367→        tags: [],\n   368→      })\n   369→      .select()\n   370→      .single()\n   371→\n   372→    if (error) {\n   373→      toast.error('Failed to create note')\n   374→    } else {\n   375→      toast.success('Note created!')\n   376→      setNotes([data, ...notes])\n   377→      setNoteTitle('')\n   378→      setNoteContent('')\n   379→      setAddNoteOpen(false)\n   380→    }\n   381→    setSavingNote(false)\n   382→  }\n   383→\n   384→  const updateNote = async (noteId: string, updates: Partial<LocalNote>) => {\n   385→    const { data, error } = await supabase\n   386→      .from('notes')\n   387→      .update({ ...updates, updated_at: new Date().toISOString() })\n   388→      .eq('id', noteId)\n   389→      .select()\n   390→      .single()\n   391→\n   392→    if (error) {\n   393→      toast.error('Failed to update note')\n   394→    } else {\n   395→      setNotes(notes.map(n => n.id === noteId ? data : n))\n   396→      setEditingNote(null)\n   397→    }\n   398→  }\n   399→\n   400→  const deleteNote = async (noteId: string) => {\n   401→    const { error } = await supabase\n   402→      .from('notes')\n   403→      .delete()\n   404→      .eq('id', noteId)\n   405→\n   406→    if (error) {\n   407→      toast.error('Failed to delete note')\n   408→    } else {\n   409→      setNotes(notes.filter(n => n.id !== noteId))\n   410→      toast.success('Note deleted')\n   411→    }\n   412→  }\n   413→\n   414→  const togglePinNote = async (note: LocalNote) => {\n   415→    await updateNote(note.id, { is_pinned: !note.is_pinned })\n   416→  }\n   417→\n   418→  const saveResponseAsNote = async (msg: ChatMessage) => {\n   419→    const { data, error } = await supabase\n   420→      .from('notes')\n   421→      .insert({\n   422→        notebook_id: notebookId,\n   423→        type: 'saved_response',\n   424→        title: `Saved Response - ${new Date().toLocaleDateString()}`,\n   425→        content: msg.content,\n   426→        tags: [],\n   427→      })\n   428→      .select()\n   429→      .single()\n   430→\n   431→    if (error) {\n   432→      toast.error('Failed to save response')\n   433→    } else {\n   434→      toast.success('Response saved as note!')\n   435→      setNotes([data, ...notes])\n   436→    }\n   437→  }\n   438→\n   439→  // Audio generation\n   440→  const generateAudio = async () => {\n   441→    if (selectedSources.size === 0) {\n   442→      toast.error('Please select at least one source')\n   443→      return\n   444→    }\n   445→\n   446→    setGeneratingAudio(true)\n   447→    try {\n   448→      const { data: { session } } = await supabase.auth.getSession()\n   449→      const response = await fetch(`/api/notebooks/${notebookId}/audio`, {\n   450→        method: 'POST',\n   451→        headers: {\n   452→          'Content-Type': 'application/json',\n   453→          'Authorization': `Bearer ${session?.access_token}`,\n   454→        },\n   455→        body: JSON.stringify({\n   456→          format: audioFormat,\n   457→          source_ids: Array.from(selectedSources),\n   458→          custom_instructions: audioInstructions || undefined,\n   459→        }),\n   460→      })\n   461→      const result = await response.json()\n   462→      if (result.error) {\n   463→        toast.error(result.error)\n   464→      } else {\n   465→        toast.success('Audio script generated! (Demo mode - no actual audio file)')\n   466→      }\n   467→    } catch {\n   468→      toast.error('Failed to generate audio')\n   469→    }\n   470→    setGeneratingAudio(false)\n   471→  }\n   472→\n   473→  // Video generation\n   474→  const generateVideo = async () => {\n   475→    if (selectedSources.size === 0) {\n   476→      toast.error('Please select at least one source')\n   477→      return\n   478→    }\n   479→\n   480→    setGeneratingVideo(true)\n   481→    try {\n   482→      const { data: { session } } = await supabase.auth.getSession()\n   483→      const response = await fetch(`/api/notebooks/${notebookId}/video`, {\n   484→        method: 'POST',\n   485→        headers: {\n   486→          'Content-Type': 'application/json',\n   487→          'Authorization': `Bearer ${session?.access_token}`,\n   488→        },\n   489→        body: JSON.stringify({\n   490→          style: videoStyle,\n   491→          source_ids: Array.from(selectedSources),\n   492→        }),\n   493→      })\n   494→      const result = await response.json()\n   495→      if (result.error) {\n   496→        toast.error(result.error)\n   497→      } else {\n   498→        toast.success('Video script generated! (Demo mode - no actual video file)')\n   499→      }\n   500→    } catch {\n   501→      toast.error('Failed to generate video')\n   502→    }\n   503→    setGeneratingVideo(false)\n   504→  }\n   505→\n   506→  // Research generation\n   507→  const runResearch = async () => {\n   508→    if (!researchQuery.trim()) {\n   509→      toast.error('Please enter a research query')\n   510→      return\n   511→    }\n   512→\n   513→    setResearching(true)\n   514→    try {\n   515→      const { data: { session } } = await supabase.auth.getSession()\n   516→      const response = await fetch(`/api/notebooks/${notebookId}/research`, {\n   517→        method: 'POST',\n   518→        headers: {\n   519→          'Content-Type': 'application/json',\n   520→          'Authorization': `Bearer ${session?.access_token}`,\n   521→        },\n   522→        body: JSON.stringify({\n   523→          query: researchQuery,\n   524→          mode: researchMode,\n   525→        }),\n   526→      })\n   527→      const result = await response.json()\n   528→      if (result.error) {\n   529→        toast.error(result.error)\n   530→      } else {\n   531→        toast.success('Research report generated!')\n   532→        setResearchQuery('')\n   533→      }\n   534→    } catch {\n   535→      toast.error('Failed to run research')\n   536→    }\n   537→    setResearching(false)\n   538→  }\n   539→\n   540→  // Study material generation handlers\n   541→  const handleGenerateFlashcards = async () => {\n   542→    setGeneratingFlashcards(true)\n   543→    try {\n   544→      const { data: { session } } = await supabase.auth.getSession()\n   545→      const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n   546→        method: 'POST',\n   547→        headers: {\n   548→          'Content-Type': 'application/json',\n   549→          'Authorization': `Bearer ${session?.access_token}`,\n   550→        },\n   551→        body: JSON.stringify({\n   552→          type: 'flashcards',\n   553→          source_ids: Array.from(selectedSources),\n   554→          count: 5,\n   555→        }),\n   556→      })\n   557→      const result = await response.json()\n   558→      if (result.error) {\n   559→        toast.error(result.error)\n   560→      } else if (result.data?.flashcards) {\n   561→        setFlashcards(result.data.flashcards)\n   562→        setCurrentFlashcard(0)\n   563→        setShowFlashcardBack(false)\n   564→        setActiveStudyType('flashcards')\n   565→        setStudySheetOpen(true)\n   566→        toast.success(`Generated ${result.data.flashcards.length} flashcards!`)\n   567→      } else {\n   568→        toast.error('Unexpected response')\n   569→      }\n   570→    } catch (err) {\n   571→      console.error('Flashcards error:', err)\n   572→      toast.error('Failed to generate flashcards')\n   573→    } finally {\n   574→      setGeneratingFlashcards(false)\n   575→    }\n   576→  }\n   577→\n   578→  const handleGenerateQuiz = async () => {\n   579→    setGeneratingQuiz(true)\n   580→    try {\n   581→      const { data: { session } } = await supabase.auth.getSession()\n   582→      const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n   583→        method: 'POST',\n   584→        headers: {\n   585→          'Content-Type': 'application/json',\n   586→          'Authorization': `Bearer ${session?.access_token}`,\n   587→        },\n   588→        body: JSON.stringify({\n   589→          type: 'quiz',\n   590→          source_ids: Array.from(selectedSources),\n   591→          count: 5,\n   592→        }),\n   593→      })\n   594→      const result = await response.json()\n   595→      if (result.error) {\n   596→        toast.error(result.error)\n   597→      } else if (result.data?.questions) {\n   598→        setQuizQuestions(result.data.questions)\n   599→        setCurrentQuizQuestion(0)\n   600→        setSelectedAnswer(null)\n   601→        setShowQuizAnswer(false)\n   602→        setActiveStudyType('quiz')\n   603→        setStudySheetOpen(true)\n   604→        toast.success(`Generated ${result.data.questions.length} quiz questions!`)\n   605→      } else {\n   606→        toast.error('Unexpected response')\n   607→      }\n   608→    } catch (err) {\n   609→      console.error('Quiz error:', err)\n   610→      toast.error('Failed to generate quiz')\n   611→    } finally {\n   612→      setGeneratingQuiz(false)\n   613→    }\n   614→  }\n   615→\n   616→  const handleGenerateStudyGuide = async () => {\n   617→    setGeneratingStudyGuide(true)\n   618→    try {\n   619→      const { data: { session } } = await supabase.auth.getSession()\n   620→      const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n   621→        method: 'POST',\n   622→        headers: {\n   623→          'Content-Type': 'application/json',\n   624→          'Authorization': `Bearer ${session?.access_token}`,\n   625→        },\n   626→        body: JSON.stringify({\n   627→          type: 'study-guide',\n   628→          source_ids: Array.from(selectedSources),\n   629→        }),\n   630→      })\n   631→      const result = await response.json()\n   632→      if (result.error) {\n   633→        toast.error(result.error)\n   634→      } else if (result.data?.sections) {\n   635→        setStudyGuide(result.data)\n   636→        setActiveStudyType('guide')\n   637→        setStudySheetOpen(true)\n   638→        toast.success('Study guide generated!')\n   639→      } else {\n   640→        toast.error('Unexpected response')\n   641→      }\n   642→    } catch (err) {\n   643→      console.error('Study guide error:', err)\n   644→      toast.error('Failed to generate study guide')\n   645→    } finally {\n   646→      setGeneratingStudyGuide(false)\n   647→    }\n   648→  }\n   649→\n   650→  const handleGenerateFaq = async () => {\n   651→    setGeneratingFaq(true)\n   652→    try {\n   653→      const { data: { session } } = await supabase.auth.getSession()\n   654→      const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n   655→        method: 'POST',\n   656→        headers: {\n   657→          'Content-Type': 'application/json',\n   658→          'Authorization': `Bearer ${session?.access_token}`,\n   659→        },\n   660→        body: JSON.stringify({\n   661→          type: 'faq',\n   662→          source_ids: Array.from(selectedSources),\n   663→        }),\n   664→      })\n   665→      const result = await response.json()\n   666→      if (result.error) {\n   667→        toast.error(result.error)\n   668→      } else if (result.data?.faq) {\n   669→        setFaqItems(result.data.faq)\n   670→        setActiveStudyType('faq')\n   671→        setStudySheetOpen(true)\n   672→        toast.success(`Generated ${result.data.faq.length} FAQ items!`)\n   673→      } else {\n   674→        toast.error('Unexpected response')\n   675→      }\n   676→    } catch (err) {\n   677→      console.error('FAQ error:', err)\n   678→      toast.error('Failed to generate FAQ')\n   679→    } finally {\n   680→      setGeneratingFaq(false)\n   681→    }\n   682→  }\n   683→\n   684→  const getStatusIcon = (status: string) => {\n   685→    switch (status) {\n   686→      case 'ready':\n   687→        return <CheckCircle className=\"h-3.5 w-3.5 text-emerald-500\" />\n   688→      case 'processing':\n   689→        return <Clock className=\"h-3.5 w-3.5 text-amber-500 animate-spin\" />\n   690→      case 'failed':\n   691→        return <XCircle className=\"h-3.5 w-3.5 text-red-500\" />\n   692→      default:\n   693→        return <Clock className=\"h-3.5 w-3.5 text-muted-foreground\" />\n   694→    }\n   695→  }\n   696→\n   697→  const getSourceIcon = (type: string) => {\n   698→    switch (type) {\n   699→      case 'pdf':\n   700→      case 'docx':\n   701→      case 'txt':\n   702→        return <FileText className=\"h-4 w-4 text-blue-500\" />\n   703→      case 'youtube':\n   704→        return <Youtube className=\"h-4 w-4 text-red-500\" />\n   705→      case 'url':\n   706→        return <LinkIcon className=\"h-4 w-4 text-violet-500\" />\n   707→      case 'text':\n   708→        return <Type className=\"h-4 w-4 text-slate-500\" />\n   709→      default:\n   710→        return <FileText className=\"h-4 w-4 text-slate-500\" />\n   711→    }\n   712→  }\n   713→\n   714→  if (loading) {\n   715→    return (\n   716→      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n   717→        <div className=\"flex flex-col items-center gap-3\">\n   718→          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n   719→          <p className=\"text-sm text-muted-foreground\">Loading notebook...</p>\n   720→        </div>\n   721→      </div>\n   722→    )\n   723→  }\n   724→\n   725→  return (\n   726→    <div className=\"h-screen flex flex-col bg-background\">\n   727→      {/* Clean Header */}\n   728→      <header className=\"h-14 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 px-4 flex items-center gap-4 shrink-0 sticky top-0 z-50\">\n   729→        <Button\n   730→          variant=\"ghost\"\n   731→          size=\"sm\"\n   732→          onClick={() => router.push('/')}\n   733→          className=\"text-muted-foreground hover:text-foreground -ml-2\"\n   734→        >\n   735→          <ArrowLeft className=\"h-4 w-4\" />\n   736→        </Button>\n   737→\n   738→        <div className=\"flex items-center gap-3\">\n   739→          <span className=\"text-xl\">{notebook?.emoji}</span>\n   740→          <h1 className=\"font-semibold text-lg tracking-tight\">{notebook?.name}</h1>\n   741→        </div>\n   742→\n   743→        <div className=\"flex items-center gap-2 ml-auto\">\n   744→          <Badge variant=\"secondary\" className=\"font-normal text-xs px-2.5 py-0.5\">\n   745→            {sources.length} {sources.length === 1 ? 'source' : 'sources'}\n   746→          </Badge>\n   747→          {selectedSources.size > 0 && (\n   748→            <Badge className=\"bg-primary/10 text-primary border-0 font-normal text-xs px-2.5 py-0.5\">\n   749→              {selectedSources.size} selected\n   750→            </Badge>\n   751→          )}\n   752→        </div>\n   753→      </header>\n   754→\n   755→      {/* Three Panel Layout */}\n   756→      <div className=\"flex-1 grid grid-cols-[280px_1fr_340px] overflow-hidden\">\n   757→\n   758→        {/* Left Panel - Sources */}\n   759→        <div className=\"border-r bg-muted/30 flex flex-col h-full\">\n   760→          <div className=\"p-4 border-b bg-background\">\n   761→            <div className=\"flex items-center justify-between mb-3\">\n   762→              <h2 className=\"font-semibold text-sm text-foreground\">Sources</h2>\n   763→              <Dialog open={addSourceOpen} onOpenChange={setAddSourceOpen}>\n   764→                <DialogTrigger asChild>\n   765→                  <Button size=\"sm\" variant=\"outline\" className=\"h-7 w-7 p-0\">\n   766→                    <Plus className=\"h-3.5 w-3.5\" />\n   767→                  </Button>\n   768→                </DialogTrigger>\n   769→                <DialogContent className=\"sm:max-w-md\">\n   770→                  <DialogHeader>\n   771→                    <DialogTitle>Add Source</DialogTitle>\n   772→                    <DialogDescription>\n   773→                      Add documents, URLs, or text to your notebook for AI analysis.\n   774→                    </DialogDescription>\n   775→                  </DialogHeader>\n   776→                  <Tabs value={sourceType} onValueChange={(v) => setSourceType(v as typeof sourceType)} className=\"mt-2\">\n   777→                    <TabsList className=\"grid grid-cols-4 w-full\">\n   778→                      <TabsTrigger value=\"file\" className=\"text-xs\">\n   779→                        <Upload className=\"h-3.5 w-3.5 mr-1.5\" />\n   780→                        File\n   781→                      </TabsTrigger>\n   782→                      <TabsTrigger value=\"youtube\" className=\"text-xs\">\n   783→                        <Youtube className=\"h-3.5 w-3.5 mr-1.5\" />\n   784→                        YouTube\n   785→                      </TabsTrigger>\n   786→                      <TabsTrigger value=\"url\" className=\"text-xs\">\n   787→                        <LinkIcon className=\"h-3.5 w-3.5 mr-1.5\" />\n   788→                        URL\n   789→                      </TabsTrigger>\n   790→                      <TabsTrigger value=\"text\" className=\"text-xs\">\n   791→                        <Type className=\"h-3.5 w-3.5 mr-1.5\" />\n   792→                        Text\n   793→                      </TabsTrigger>\n   794→                    </TabsList>\n   795→                    <TabsContent value=\"file\" className=\"space-y-4 mt-4\">\n   796→                      <input\n   797→                        ref={fileInputRef}\n   798→                        type=\"file\"\n   799→                        accept=\".pdf,.docx,.txt,.md\"\n   800→                        onChange={handleFileUpload}\n   801→                        className=\"hidden\"\n   802→                      />\n   803→                      <button\n   804→                        onClick={() => fileInputRef.current?.click()}\n   805→                        disabled={uploading}\n   806→                        className=\"w-full h-32 border-2 border-dashed rounded-lg flex flex-col items-center justify-center gap-2 hover:border-primary/50 hover:bg-muted/50 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\n   807→                      >\n   808→                        {uploading ? (\n   809→                          <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n   810→                        ) : (\n   811→                          <>\n   812→                            <Upload className=\"h-8 w-8 text-muted-foreground\" />\n   813→                            <div className=\"text-center\">\n   814→                              <p className=\"text-sm font-medium\">Click to upload</p>\n   815→                              <p className=\"text-xs text-muted-foreground mt-0.5\">PDF, DOCX, TXT, or MD</p>\n   816→                            </div>\n   817→                          </>\n   818→                        )}\n   819→                      </button>\n   820→                    </TabsContent>\n   821→                    <TabsContent value=\"youtube\" className=\"space-y-3 mt-4\">\n   822→                      <div className=\"space-y-2\">\n   823→                        <label className=\"text-sm font-medium\">YouTube URL</label>\n   824→                        <Input\n   825→                          placeholder=\"https://youtube.com/watch?v=...\"\n   826→                          value={sourceInput}\n   827→                          onChange={(e) => setSourceInput(e.target.value)}\n   828→                        />\n   829→                      </div>\n   830→                      <div className=\"space-y-2\">\n   831→                        <label className=\"text-sm font-medium\">Name (optional)</label>\n   832→                        <Input\n   833→                          placeholder=\"My video\"\n   834→                          value={sourceName}\n   835→                          onChange={(e) => setSourceName(e.target.value)}\n   836→                        />\n   837→                      </div>\n   838→                    </TabsContent>\n   839→                    <TabsContent value=\"url\" className=\"space-y-3 mt-4\">\n   840→                      <div className=\"space-y-2\">\n   841→                        <label className=\"text-sm font-medium\">Website URL</label>\n   842→                        <Input\n   843→                          placeholder=\"https://example.com/article\"\n   844→                          value={sourceInput}\n   845→                          onChange={(e) => setSourceInput(e.target.value)}\n   846→                        />\n   847→                      </div>\n   848→                      <div className=\"space-y-2\">\n   849→                        <label className=\"text-sm font-medium\">Name (optional)</label>\n   850→                        <Input\n   851→                          placeholder=\"Article name\"\n   852→                          value={sourceName}\n   853→                          onChange={(e) => setSourceName(e.target.value)}\n   854→                        />\n   855→                      </div>\n   856→                    </TabsContent>\n   857→                    <TabsContent value=\"text\" className=\"space-y-3 mt-4\">\n   858→                      <div className=\"space-y-2\">\n   859→                        <label className=\"text-sm font-medium\">Name</label>\n   860→                        <Input\n   861→                          placeholder=\"My notes\"\n   862→                          value={sourceName}\n   863→                          onChange={(e) => setSourceName(e.target.value)}\n   864→                        />\n   865→                      </div>\n   866→                      <div className=\"space-y-2\">\n   867→                        <label className=\"text-sm font-medium\">Content</label>\n   868→                        <Textarea\n   869→                          placeholder=\"Paste your text here...\"\n   870→                          value={sourceInput}\n   871→                          onChange={(e) => setSourceInput(e.target.value)}\n   872→                          rows={6}\n   873→                        />\n   874→                      </div>\n   875→                    </TabsContent>\n   876→                  </Tabs>\n   877→                  {sourceType !== 'file' && (\n   878→                    <DialogFooter className=\"mt-4\">\n   879→                      <Button\n   880→                        onClick={addSource}\n   881→                        disabled={uploading || !sourceInput.trim()}\n   882→                        className=\"w-full sm:w-auto\"\n   883→                      >\n   884→                        {uploading && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n   885→                        Add Source\n   886→                      </Button>\n   887→                    </DialogFooter>\n   888→                  )}\n   889→                </DialogContent>\n   890→              </Dialog>\n   891→            </div>\n   892→\n   893→            {sources.length > 0 && (\n   894→              <button\n   895→                onClick={selectAllSources}\n   896→                className=\"text-xs text-muted-foreground hover:text-foreground transition-colors\"\n   897→              >\n   898→                {selectedSources.size === sources.length ? 'Deselect all' : 'Select all'}\n   899→              </button>\n   900→            )}\n   901→          </div>\n   902→\n   903→          <ScrollArea className=\"flex-1\">\n   904→            <div className=\"p-2\">\n   905→              {sources.length === 0 ? (\n   906→                <div className=\"text-center py-12 px-4\">\n   907→                  <div className=\"w-12 h-12 rounded-full bg-muted flex items-center justify-center mx-auto mb-3\">\n   908→                    <FileText className=\"h-5 w-5 text-muted-foreground\" />\n   909→                  </div>\n   910→                  <p className=\"text-sm font-medium text-foreground mb-1\">No sources yet</p>\n   911→                  <p className=\"text-xs text-muted-foreground\">Add documents to start analyzing</p>\n   912→                </div>\n   913→              ) : (\n   914→                <div className=\"space-y-1\">\n   915→                  {sources.map((source) => (\n   916→                    <div\n   917→                      key={source.id}\n   918→                      className={`\n   919→                        group relative flex items-center gap-2.5 px-3 py-2.5 rounded-lg cursor-pointer\n   920→                        transition-all duration-150\n   921→                        ${selectedSources.has(source.id)\n   922→                          ? 'bg-primary/10 ring-1 ring-primary/20'\n   923→                          : 'hover:bg-muted'\n   924→                        }\n   925→                        ${viewingSource?.id === source.id ? 'ring-2 ring-primary' : ''}\n   926→                      `}\n   927→                      onClick={() => toggleSource(source.id)}\n   928→                    >\n   929→                      <div className={`\n   930→                        w-4 h-4 rounded border-2 flex items-center justify-center shrink-0\n   931→                        transition-colors duration-150\n   932→                        ${selectedSources.has(source.id)\n   933→                          ? 'bg-primary border-primary'\n   934→                          : 'border-muted-foreground/30 group-hover:border-muted-foreground/50'\n   935→                        }\n   936→                      `}>\n   937→                        {selectedSources.has(source.id) && (\n   938→                          <CheckCircle className=\"h-3 w-3 text-primary-foreground\" />\n   939→                        )}\n   940→                      </div>\n   941→\n   942→                      {getSourceIcon(source.type)}\n   943→\n   944→                      <span\n   945→                        className=\"flex-1 text-sm truncate\"\n   946→                        onClick={(e) => {\n   947→                          e.stopPropagation()\n   948→                          setViewingSource(source)\n   949→                        }}\n   950→                      >\n   951→                        {source.name}\n   952→                      </span>\n   953→\n   954→                      {getStatusIcon(source.status)}\n   955→\n   956→                      <Button\n   957→                        variant=\"ghost\"\n   958→                        size=\"sm\"\n   959→                        className=\"opacity-0 group-hover:opacity-100 h-6 w-6 p-0 transition-opacity\"\n   960→                        onClick={(e) => {\n   961→                          e.stopPropagation()\n   962→                          deleteSource(source.id)\n   963→                        }}\n   964→                      >\n   965→                        <Trash2 className=\"h-3 w-3 text-muted-foreground hover:text-destructive\" />\n   966→                      </Button>\n   967→                    </div>\n   968→                  ))}\n   969→                </div>\n   970→              )}\n   971→            </div>\n   972→          </ScrollArea>\n   973→        </div>\n   974→\n   975→        {/* Center Panel - Chat */}\n   976→        <div className=\"flex flex-col h-full bg-background\">\n   977→          {/* Source Preview Banner */}\n   978→          {viewingSource && (\n   979→            <div className=\"border-b bg-muted/50 px-6 py-4\">\n   980→              <div className=\"max-w-3xl mx-auto\">\n   981→                <div className=\"flex items-start justify-between gap-4\">\n   982→                  <div className=\"flex items-start gap-3 min-w-0\">\n   983→                    <div className=\"p-2 rounded-lg bg-background border shrink-0\">\n   984→                      {getSourceIcon(viewingSource.type)}\n   985→                    </div>\n   986→                    <div className=\"min-w-0\">\n   987→                      <h3 className=\"font-medium text-sm truncate\">{viewingSource.name}</h3>\n   988→                      <div className=\"flex items-center gap-2 mt-1\">\n   989→                        <Badge variant=\"outline\" className=\"text-xs font-normal capitalize\">\n   990→                          {viewingSource.type}\n   991→                        </Badge>\n   992→                        {viewingSource.file_size_bytes && (\n   993→                          <span className=\"text-xs text-muted-foreground\">\n   994→                            {(viewingSource.file_size_bytes / 1024).toFixed(1)} KB\n   995→                          </span>\n   996→                        )}\n   997→                      </div>\n   998→                    </div>\n   999→                  </div>\n  1000→                  <Button\n  1001→                    variant=\"ghost\"\n  1002→                    size=\"sm\"\n  1003→                    onClick={() => setViewingSource(null)}\n  1004→                    className=\"shrink-0 h-8 w-8 p-0\"\n  1005→                  >\n  1006→                    <X className=\"h-4 w-4\" />\n  1007→                  </Button>\n  1008→                </div>\n  1009→\n  1010→                {(viewingSource.type === 'text' && viewingSource.metadata?.content) ||\n  1011→                 (viewingSource.type === 'youtube' && viewingSource.metadata?.url) ||\n  1012→                 (viewingSource.type === 'url' && viewingSource.metadata?.url) ? (\n  1013→                  <div className=\"mt-3 p-3 rounded-lg bg-background border text-sm max-h-32 overflow-y-auto\">\n  1014→                    {viewingSource.type === 'text' ? (\n  1015→                      <p className=\"whitespace-pre-wrap text-muted-foreground\">{viewingSource.metadata.content}</p>\n  1016→                    ) : (\n  1017→                      <a\n  1018→                        href={viewingSource.metadata.url}\n  1019→                        target=\"_blank\"\n  1020→                        rel=\"noopener noreferrer\"\n  1021→                        className=\"text-primary hover:underline break-all\"\n  1022→                      >\n  1023→                        {viewingSource.metadata.url}\n  1024→                      </a>\n  1025→                    )}\n  1026→                  </div>\n  1027→                ) : null}\n  1028→              </div>\n  1029→            </div>\n  1030→          )}\n  1031→\n  1032→          {/* Messages */}\n  1033→          <ScrollArea className=\"flex-1\">\n  1034→            <div className=\"max-w-3xl mx-auto px-6 py-6\">\n  1035→              {messages.length === 0 ? (\n  1036→                <div className=\"flex flex-col items-center justify-center min-h-[400px] text-center\">\n  1037→                  <div className=\"w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center mb-6\">\n  1038→                    <Sparkles className=\"h-7 w-7 text-primary\" />\n  1039→                  </div>\n  1040→                  <h3 className=\"text-xl font-semibold mb-2\">Start a conversation</h3>\n  1041→                  <p className=\"text-muted-foreground mb-8 max-w-sm\">\n  1042→                    Ask questions about your sources and get AI-powered insights with citations.\n  1043→                  </p>\n  1044→                  <div className=\"flex flex-wrap justify-center gap-2 max-w-lg\">\n  1045→                    {['Summarize the key points', 'What are the main takeaways?', 'Explain the methodology'].map((q) => (\n  1046→                      <button\n  1047→                        key={q}\n  1048→                        onClick={() => setMessage(q)}\n  1049→                        className=\"px-4 py-2 text-sm rounded-full border bg-background hover:bg-muted transition-colors\"\n  1050→                      >\n  1051→                        {q}\n  1052→                      </button>\n  1053→                    ))}\n  1054→                  </div>\n  1055→                </div>\n  1056→              ) : (\n  1057→                <div className=\"space-y-6\">\n  1058→                  {messages.map((msg) => (\n  1059→                    <div\n  1060→                      key={msg.id}\n  1061→                      className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}\n  1062→                    >\n  1063→                      <div\n  1064→                        className={`\n  1065→                          max-w-[85%] rounded-2xl px-4 py-3\n  1066→                          ${msg.role === 'user'\n  1067→                            ? 'bg-primary text-primary-foreground rounded-br-md'\n  1068→                            : 'bg-muted rounded-bl-md'\n  1069→                          }\n  1070→                        `}\n  1071→                      >\n  1072→                        <p className=\"whitespace-pre-wrap text-[15px] leading-relaxed\">{msg.content}</p>\n  1073→                        {msg.role === 'assistant' && (\n  1074→                          <div className=\"flex items-center gap-3 mt-3 pt-3 border-t border-border/50\">\n  1075→                            {msg.cost_usd !== null && msg.cost_usd > 0 && (\n  1076→                              <span className=\"text-xs text-muted-foreground\">\n  1077→                                ${msg.cost_usd.toFixed(4)}\n  1078→                              </span>\n  1079→                            )}\n  1080→                            <div className=\"flex items-center gap-1 ml-auto\">\n  1081→                              <Tooltip>\n  1082→                                <TooltipTrigger asChild>\n  1083→                                  <Button\n  1084→                                    variant=\"ghost\"\n  1085→                                    size=\"sm\"\n  1086→                                    className=\"h-7 w-7 p-0\"\n  1087→                                    onClick={() => navigator.clipboard.writeText(msg.content)}\n  1088→                                  >\n  1089→                                    <Copy className=\"h-3.5 w-3.5\" />\n  1090→                                  </Button>\n  1091→                                </TooltipTrigger>\n  1092→                                <TooltipContent>Copy</TooltipContent>\n  1093→                              </Tooltip>\n  1094→                              <Tooltip>\n  1095→                                <TooltipTrigger asChild>\n  1096→                                  <Button\n  1097→                                    variant=\"ghost\"\n  1098→                                    size=\"sm\"\n  1099→                                    className=\"h-7 w-7 p-0\"\n  1100→                                    onClick={() => saveResponseAsNote(msg)}\n  1101→                                  >\n  1102→                                    <StickyNote className=\"h-3.5 w-3.5\" />\n  1103→                                  </Button>\n  1104→                                </TooltipTrigger>\n  1105→                                <TooltipContent>Save as note</TooltipContent>\n  1106→                              </Tooltip>\n  1107→                            </div>\n  1108→                          </div>\n  1109→                        )}\n  1110→                      </div>\n  1111→                    </div>\n  1112→                  ))}\n  1113→                  {sending && (\n  1114→                    <div className=\"flex justify-start\">\n  1115→                      <div className=\"bg-muted rounded-2xl rounded-bl-md px-4 py-3\">\n  1116→                        <div className=\"flex items-center gap-2\">\n  1117→                          <Loader2 className=\"h-4 w-4 animate-spin\" />\n  1118→                          <span className=\"text-sm text-muted-foreground\">Thinking...</span>\n  1119→                        </div>\n  1120→                      </div>\n  1121→                    </div>\n  1122→                  )}\n  1123→                  <div ref={messagesEndRef} />\n  1124→                </div>\n  1125→              )}\n  1126→            </div>\n  1127→          </ScrollArea>\n  1128→\n  1129→          {/* Chat Input */}\n  1130→          <div className=\"border-t bg-background p-4\">\n  1131→            <div className=\"max-w-3xl mx-auto\">\n  1132→              {selectedSources.size === 0 && sources.length > 0 && (\n  1133→                <div className=\"flex items-center gap-2 mb-3 px-3 py-2 text-sm text-amber-700 dark:text-amber-400 bg-amber-50 dark:bg-amber-950/30 rounded-lg border border-amber-200 dark:border-amber-800/50\">\n  1134→                  <AlertCircle className=\"h-4 w-4 shrink-0\" />\n  1135→                  <span>Select sources from the left panel for contextual answers</span>\n  1136→                </div>\n  1137→              )}\n  1138→              <div className=\"flex items-center gap-3\">\n  1139→                <div className=\"flex-1 relative\">\n  1140→                  <Input\n  1141→                    placeholder=\"Ask a question about your sources...\"\n  1142→                    value={message}\n  1143→                    onChange={(e) => setMessage(e.target.value)}\n  1144→                    onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && sendMessage()}\n  1145→                    disabled={sending}\n  1146→                    className=\"pr-12 h-12 text-[15px] rounded-xl border-muted-foreground/20 focus:border-primary\"\n  1147→                  />\n  1148→                </div>\n  1149→                <Button\n  1150→                  onClick={sendMessage}\n  1151→                  disabled={sending || !message.trim()}\n  1152→                  size=\"lg\"\n  1153→                  className=\"h-12 w-12 rounded-xl shrink-0\"\n  1154→                >\n  1155→                  <Send className=\"h-5 w-5\" />\n  1156→                </Button>\n  1157→              </div>\n  1158→            </div>\n  1159→          </div>\n  1160→        </div>\n  1161→\n  1162→        {/* Right Panel - Studio */}\n  1163→        <div className=\"border-l bg-muted/30 flex flex-col h-full\">\n  1164→          <div className=\"p-4 border-b bg-background\">\n  1165→            <h2 className=\"font-semibold text-sm\">Studio</h2>\n  1166→            <p className=\"text-xs text-muted-foreground mt-0.5\">Create content from your sources</p>\n  1167→          </div>\n  1168→\n  1169→          <ScrollArea className=\"flex-1\">\n  1170→            <div className=\"p-3 space-y-2\">\n  1171→\n  1172→              {/* Audio Overview Section */}\n  1173→              <div className=\"rounded-xl border bg-background overflow-hidden\">\n  1174→                <button\n  1175→                  onClick={() => setExpandedSection(expandedSection === 'audio' ? null : 'audio')}\n  1176→                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n  1177→                >\n  1178→                  <div className=\"flex items-center gap-3\">\n  1179→                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-orange-500/20 to-red-500/20 flex items-center justify-center\">\n  1180→                      <Mic className=\"h-4 w-4 text-orange-600\" />\n  1181→                    </div>\n  1182→                    <div className=\"text-left\">\n  1183→                      <p className=\"font-medium text-sm\">Audio Overview</p>\n  1184→                      <p className=\"text-xs text-muted-foreground\">Podcast-style discussion</p>\n  1185→                    </div>\n  1186→                  </div>\n  1187→                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'audio' ? 'rotate-180' : ''}`} />\n  1188→                </button>\n  1189→\n  1190→                {expandedSection === 'audio' && (\n  1191→                  <div className=\"px-4 pb-4 space-y-4 border-t bg-muted/20\">\n  1192→                    <div className=\"pt-4 space-y-3\">\n  1193→                      <div className=\"space-y-1.5\">\n  1194→                        <label className=\"text-xs font-medium\">Format</label>\n  1195→                        <Select value={audioFormat} onValueChange={setAudioFormat}>\n  1196→                          <SelectTrigger className=\"h-9 text-sm\">\n  1197→                            <SelectValue />\n  1198→                          </SelectTrigger>\n  1199→                          <SelectContent>\n  1200→                            <SelectItem value=\"deep_dive\">Deep Dive (10-15 min)</SelectItem>\n  1201→                            <SelectItem value=\"brief\">Brief Summary (2-3 min)</SelectItem>\n  1202→                            <SelectItem value=\"critique\">Analytical (5-10 min)</SelectItem>\n  1203→                            <SelectItem value=\"debate\">Debate (8-15 min)</SelectItem>\n  1204→                          </SelectContent>\n  1205→                        </Select>\n  1206→                      </div>\n  1207→                      <div className=\"space-y-1.5\">\n  1208→                        <label className=\"text-xs font-medium\">Custom Instructions</label>\n  1209→                        <Textarea\n  1210→                          placeholder=\"Optional instructions for hosts...\"\n  1211→                          value={audioInstructions}\n  1212→                          onChange={(e) => setAudioInstructions(e.target.value)}\n  1213→                          rows={2}\n  1214→                          className=\"text-sm resize-none\"\n  1215→                        />\n  1216→                      </div>\n  1217→                      <Button\n  1218→                        className=\"w-full\"\n  1219→                        onClick={generateAudio}\n  1220→                        disabled={generatingAudio || selectedSources.size === 0}\n  1221→                      >\n  1222→                        {generatingAudio ? (\n  1223→                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n  1224→                        ) : (\n  1225→                          <Play className=\"h-4 w-4 mr-2\" />\n  1226→                        )}\n  1227→                        Generate Audio\n  1228→                      </Button>\n  1229→                      {selectedSources.size === 0 && (\n  1230→                        <p className=\"text-xs text-muted-foreground text-center\">\n  1231→                          Select sources to generate\n  1232→                        </p>\n  1233→                      )}\n  1234→                    </div>\n  1235→                  </div>\n  1236→                )}\n  1237→              </div>\n  1238→\n  1239→              {/* Video Overview Section */}\n  1240→              <div className=\"rounded-xl border bg-background overflow-hidden\">\n  1241→                <button\n  1242→                  onClick={() => setExpandedSection(expandedSection === 'video' ? null : 'video')}\n  1243→                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n  1244→                >\n  1245→                  <div className=\"flex items-center gap-3\">\n  1246→                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center\">\n  1247→                      <Video className=\"h-4 w-4 text-purple-600\" />\n  1248→                    </div>\n  1249→                    <div className=\"text-left\">\n  1250→                      <p className=\"font-medium text-sm\">Video Overview</p>\n  1251→                      <p className=\"text-xs text-muted-foreground\">Visual explainer video</p>\n  1252→                    </div>\n  1253→                  </div>\n  1254→                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'video' ? 'rotate-180' : ''}`} />\n  1255→                </button>\n  1256→\n  1257→                {expandedSection === 'video' && (\n  1258→                  <div className=\"px-4 pb-4 space-y-4 border-t bg-muted/20\">\n  1259→                    <div className=\"pt-4 space-y-3\">\n  1260→                      <div className=\"space-y-1.5\">\n  1261→                        <label className=\"text-xs font-medium\">Style</label>\n  1262→                        <Select value={videoStyle} onValueChange={setVideoStyle}>\n  1263→                          <SelectTrigger className=\"h-9 text-sm\">\n  1264→                            <SelectValue />\n  1265→                          </SelectTrigger>\n  1266→                          <SelectContent>\n  1267→                            <SelectItem value=\"explainer\">Explainer</SelectItem>\n  1268→                            <SelectItem value=\"documentary\">Documentary</SelectItem>\n  1269→                            <SelectItem value=\"presentation\">Presentation</SelectItem>\n  1270→                          </SelectContent>\n  1271→                        </Select>\n  1272→                      </div>\n  1273→                      <Button\n  1274→                        className=\"w-full\"\n  1275→                        onClick={generateVideo}\n  1276→                        disabled={generatingVideo || selectedSources.size === 0}\n  1277→                      >\n  1278→                        {generatingVideo ? (\n  1279→                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n  1280→                        ) : (\n  1281→                          <Video className=\"h-4 w-4 mr-2\" />\n  1282→                        )}\n  1283→                        Generate Video\n  1284→                      </Button>\n  1285→                      {selectedSources.size === 0 && (\n  1286→                        <p className=\"text-xs text-muted-foreground text-center\">\n  1287→                          Select sources to generate\n  1288→                        </p>\n  1289→                      )}\n  1290→                    </div>\n  1291→                  </div>\n  1292→                )}\n  1293→              </div>\n  1294→\n  1295→              {/* Deep Research Section */}\n  1296→              <div className=\"rounded-xl border bg-background overflow-hidden\">\n  1297→                <button\n  1298→                  onClick={() => setExpandedSection(expandedSection === 'research' ? null : 'research')}\n  1299→                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n  1300→                >\n  1301→                  <div className=\"flex items-center gap-3\">\n  1302→                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-blue-500/20 to-cyan-500/20 flex items-center justify-center\">\n  1303→                      <Search className=\"h-4 w-4 text-blue-600\" />\n  1304→                    </div>\n  1305→                    <div className=\"text-left\">\n  1306→                      <p className=\"font-medium text-sm\">Deep Research</p>\n  1307→                      <p className=\"text-xs text-muted-foreground\">Autonomous web research</p>\n  1308→                    </div>\n  1309→                  </div>\n  1310→                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'research' ? 'rotate-180' : ''}`} />\n  1311→                </button>\n  1312→\n  1313→                {expandedSection === 'research' && (\n  1314→                  <div className=\"px-4 pb-4 space-y-4 border-t bg-muted/20\">\n  1315→                    <div className=\"pt-4 space-y-3\">\n  1316→                      <div className=\"space-y-1.5\">\n  1317→                        <label className=\"text-xs font-medium\">Research Query</label>\n  1318→                        <Input\n  1319→                          placeholder=\"What would you like to research?\"\n  1320→                          value={researchQuery}\n  1321→                          onChange={(e) => setResearchQuery(e.target.value)}\n  1322→                          className=\"h-9 text-sm\"\n  1323→                        />\n  1324→                      </div>\n  1325→                      <div className=\"space-y-1.5\">\n  1326→                        <label className=\"text-xs font-medium\">Mode</label>\n  1327→                        <Select value={researchMode} onValueChange={setResearchMode}>\n  1328→                          <SelectTrigger className=\"h-9 text-sm\">\n  1329→                            <SelectValue />\n  1330→                          </SelectTrigger>\n  1331→                          <SelectContent>\n  1332→                            <SelectItem value=\"fast\">Fast (3-5 min)</SelectItem>\n  1333→                            <SelectItem value=\"deep\">Deep (10-15 min)</SelectItem>\n  1334→                          </SelectContent>\n  1335→                        </Select>\n  1336→                      </div>\n  1337→                      <Button\n  1338→                        className=\"w-full\"\n  1339→                        onClick={runResearch}\n  1340→                        disabled={researching || !researchQuery.trim()}\n  1341→                      >\n  1342→                        {researching ? (\n  1343→                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n  1344→                        ) : (\n  1345→                          <Search className=\"h-4 w-4 mr-2\" />\n  1346→                        )}\n  1347→                        Start Research\n  1348→                      </Button>\n  1349→                    </div>\n  1350→                  </div>\n  1351→                )}\n  1352→              </div>\n  1353→\n  1354→              {/* Study Materials Section */}\n  1355→              <div className=\"rounded-xl border bg-background overflow-hidden\">\n  1356→                <button\n  1357→                  onClick={() => setExpandedSection(expandedSection === 'study' ? null : 'study')}\n  1358→                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n  1359→                >\n  1360→                  <div className=\"flex items-center gap-3\">\n  1361→                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-emerald-500/20 to-teal-500/20 flex items-center justify-center\">\n  1362→                      <GraduationCap className=\"h-4 w-4 text-emerald-600\" />\n  1363→                    </div>\n  1364→                    <div className=\"text-left\">\n  1365→                      <p className=\"font-medium text-sm\">Study Materials</p>\n  1366→                      <p className=\"text-xs text-muted-foreground\">Flashcards, quizzes, and more</p>\n  1367→                    </div>\n  1368→                  </div>\n  1369→                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'study' ? 'rotate-180' : ''}`} />\n  1370→                </button>\n  1371→\n  1372→                {expandedSection === 'study' && (\n  1373→                  <div className=\"px-4 pb-4 border-t bg-muted/20\">\n  1374→                    <div className=\"pt-4 grid grid-cols-2 gap-2\">\n  1375→                      <button\n  1376→                        onClick={handleGenerateFlashcards}\n  1377→                        disabled={selectedSources.size === 0 || generatingFlashcards}\n  1378→                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n  1379→                      >\n  1380→                        {generatingFlashcards ? (\n  1381→                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n  1382→                        ) : (\n  1383→                          <BookOpen className=\"h-5 w-5 text-blue-500\" />\n  1384→                        )}\n  1385→                        <span className=\"text-xs font-medium\">Flashcards</span>\n  1386→                      </button>\n  1387→\n  1388→                      <button\n  1389→                        onClick={handleGenerateQuiz}\n  1390→                        disabled={selectedSources.size === 0 || generatingQuiz}\n  1391→                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n  1392→                      >\n  1393→                        {generatingQuiz ? (\n  1394→                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n  1395→                        ) : (\n  1396→                          <ListChecks className=\"h-5 w-5 text-purple-500\" />\n  1397→                        )}\n  1398→                        <span className=\"text-xs font-medium\">Quiz</span>\n  1399→                      </button>\n  1400→\n  1401→                      <button\n  1402→                        onClick={handleGenerateStudyGuide}\n  1403→                        disabled={selectedSources.size === 0 || generatingStudyGuide}\n  1404→                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n  1405→                      >\n  1406→                        {generatingStudyGuide ? (\n  1407→                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n  1408→                        ) : (\n  1409→                          <FileText className=\"h-5 w-5 text-orange-500\" />\n  1410→                        )}\n  1411→                        <span className=\"text-xs font-medium\">Study Guide</span>\n  1412→                      </button>\n  1413→\n  1414→                      <button\n  1415→                        onClick={handleGenerateFaq}\n  1416→                        disabled={selectedSources.size === 0 || generatingFaq}\n  1417→                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n  1418→                      >\n  1419→                        {generatingFaq ? (\n  1420→                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n  1421→                        ) : (\n  1422→                          <HelpCircle className=\"h-5 w-5 text-teal-500\" />\n  1423→                        )}\n  1424→                        <span className=\"text-xs font-medium\">FAQ</span>\n  1425→                      </button>\n  1426→                    </div>\n  1427→\n  1428→                    {selectedSources.size === 0 && (\n  1429→                      <p className=\"text-xs text-muted-foreground text-center mt-3\">\n  1430→                        Select sources to generate study materials\n  1431→                      </p>\n  1432→                    )}\n  1433→\n  1434→                    {/* Quick access to generated materials */}\n  1435→                    {(flashcards.length > 0 || quizQuestions.length > 0 || studyGuide || faqItems.length > 0) && (\n  1436→                      <div className=\"mt-4 pt-3 border-t\">\n  1437→                        <p className=\"text-xs font-medium text-muted-foreground mb-2\">Generated Materials</p>\n  1438→                        <div className=\"space-y-1\">\n  1439→                          {flashcards.length > 0 && (\n  1440→                            <button\n  1441→                              onClick={() => { setActiveStudyType('flashcards'); setStudySheetOpen(true) }}\n  1442→                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"\n  1443→                            >\n  1444→                              <BookOpen className=\"h-4 w-4 text-blue-500\" />\n  1445→                              <span>{flashcards.length} Flashcards</span>\n  1446→                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />\n  1447→                            </button>\n  1448→                          )}\n  1449→                          {quizQuestions.length > 0 && (\n  1450→                            <button\n  1451→                              onClick={() => { setActiveStudyType('quiz'); setStudySheetOpen(true) }}\n  1452→                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"\n  1453→                            >\n  1454→                              <ListChecks className=\"h-4 w-4 text-purple-500\" />\n  1455→                              <span>{quizQuestions.length} Quiz Questions</span>\n  1456→                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />\n  1457→                            </button>\n  1458→                          )}\n  1459→                          {studyGuide && (\n  1460→                            <button\n  1461→                              onClick={() => { setActiveStudyType('guide'); setStudySheetOpen(true) }}\n  1462→                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"\n  1463→                            >\n  1464→                              <FileText className=\"h-4 w-4 text-orange-500\" />\n  1465→                              <span>Study Guide</span>\n  1466→                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />\n  1467→                            </button>\n  1468→                          )}\n  1469→                          {faqItems.length > 0 && (\n  1470→                            <button\n  1471→                              onClick={() => { setActiveStudyType('faq'); setStudySheetOpen(true) }}\n  1472→                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"\n  1473→                            >\n  1474→                              <HelpCircle className=\"h-4 w-4 text-teal-500\" />\n  1475→                              <span>{faqItems.length} FAQ Items</span>\n  1476→                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />\n  1477→                            </button>\n  1478→                          )}\n  1479→                        </div>\n  1480→                      </div>\n  1481→                    )}\n  1482→                  </div>\n  1483→                )}\n  1484→              </div>\n  1485→\n  1486→              {/* Notes Section */}\n  1487→              <div className=\"rounded-xl border bg-background overflow-hidden\">\n  1488→                <button\n  1489→                  onClick={() => setExpandedSection(expandedSection === 'notes' ? null : 'notes')}\n  1490→                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n  1491→                >\n  1492→                  <div className=\"flex items-center gap-3\">\n  1493→                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-amber-500/20 to-yellow-500/20 flex items-center justify-center\">\n  1494→                      <StickyNote className=\"h-4 w-4 text-amber-600\" />\n  1495→                    </div>\n  1496→                    <div className=\"text-left\">\n  1497→                      <p className=\"font-medium text-sm\">Notes</p>\n  1498→                      <p className=\"text-xs text-muted-foreground\">{notes.length} saved</p>\n  1499→                    </div>\n  1500→                  </div>\n  1501→                  <div className=\"flex items-center gap-2\">\n  1502→                    <Dialog open={addNoteOpen} onOpenChange={setAddNoteOpen}>\n  1503→                      <DialogTrigger asChild>\n  1504→                        <Button\n  1505→                          size=\"sm\"\n  1506→                          variant=\"ghost\"\n  1507→                          className=\"h-7 w-7 p-0\"\n  1508→                          onClick={(e) => e.stopPropagation()}\n  1509→                        >\n  1510→                          <Plus className=\"h-3.5 w-3.5\" />\n  1511→                        </Button>\n  1512→                      </DialogTrigger>\n  1513→                      <DialogContent>\n  1514→                        <DialogHeader>\n  1515→                          <DialogTitle>Create Note</DialogTitle>\n  1516→                          <DialogDescription>\n  1517→                            Write a new note to save your thoughts.\n  1518→                          </DialogDescription>\n  1519→                        </DialogHeader>\n  1520→                        <div className=\"space-y-4 mt-2\">\n  1521→                          <div className=\"space-y-2\">\n  1522→                            <label className=\"text-sm font-medium\">Title</label>\n  1523→                            <Input\n  1524→                              placeholder=\"Note title...\"\n  1525→                              value={noteTitle}\n  1526→                              onChange={(e) => setNoteTitle(e.target.value)}\n  1527→                            />\n  1528→                          </div>\n  1529→                          <div className=\"space-y-2\">\n  1530→                            <label className=\"text-sm font-medium\">Content</label>\n  1531→                            <Textarea\n  1532→                              placeholder=\"Write your note...\"\n  1533→                              value={noteContent}\n  1534→                              onChange={(e) => setNoteContent(e.target.value)}\n  1535→                              rows={6}\n  1536→                            />\n  1537→                          </div>\n  1538→                        </div>\n  1539→                        <DialogFooter className=\"mt-4\">\n  1540→                          <Button onClick={createNote} disabled={savingNote}>\n  1541→                            {savingNote && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n  1542→                            Create Note\n  1543→                          </Button>\n  1544→                        </DialogFooter>\n  1545→                      </DialogContent>\n  1546→                    </Dialog>\n  1547→                    <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'notes' ? 'rotate-180' : ''}`} />\n  1548→                  </div>\n  1549→                </button>\n  1550→\n  1551→                {expandedSection === 'notes' && (\n  1552→                  <div className=\"px-4 pb-4 border-t bg-muted/20\">\n  1553→                    <div className=\"pt-4\">\n  1554→                      {notes.length === 0 ? (\n  1555→                        <div className=\"text-center py-6\">\n  1556→                          <StickyNote className=\"h-8 w-8 mx-auto mb-2 text-muted-foreground/50\" />\n  1557→                          <p className=\"text-sm text-muted-foreground\">No notes yet</p>\n  1558→                          <p className=\"text-xs text-muted-foreground mt-1\">Create notes or save chat responses</p>\n  1559→                        </div>\n  1560→                      ) : (\n  1561→                        <div className=\"space-y-2\">\n  1562→                          {notes.map((note) => (\n  1563→                            <div\n  1564→                              key={note.id}\n  1565→                              className=\"p-3 rounded-lg border bg-background group\"\n  1566→                            >\n  1567→                              <div className=\"flex items-start justify-between gap-2\">\n  1568→                                <div className=\"flex items-center gap-2 min-w-0\">\n  1569→                                  {note.is_pinned && <Pin className=\"h-3 w-3 text-amber-500 shrink-0\" />}\n  1570→                                  <span className=\"font-medium text-sm truncate\">\n  1571→                                    {note.title || 'Untitled'}\n  1572→                                  </span>\n  1573→                                </div>\n  1574→                                <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n  1575→                                  <Button\n  1576→                                    variant=\"ghost\"\n  1577→                                    size=\"sm\"\n  1578→                                    className=\"h-6 w-6 p-0\"\n  1579→                                    onClick={() => togglePinNote(note)}\n  1580→                                  >\n  1581→                                    <Pin className={`h-3 w-3 ${note.is_pinned ? 'text-amber-500' : 'text-muted-foreground'}`} />\n  1582→                                  </Button>\n  1583→                                  <Button\n  1584→                                    variant=\"ghost\"\n  1585→                                    size=\"sm\"\n  1586→                                    className=\"h-6 w-6 p-0\"\n  1587→                                    onClick={() => deleteNote(note.id)}\n  1588→                                  >\n  1589→                                    <Trash2 className=\"h-3 w-3 text-muted-foreground hover:text-destructive\" />\n  1590→                                  </Button>\n  1591→                                </div>\n  1592→                              </div>\n  1593→                              <p className=\"text-xs text-muted-foreground mt-1.5 line-clamp-2\">\n  1594→                                {note.content || 'No content'}\n  1595→                              </p>\n  1596→                              <div className=\"flex items-center gap-2 mt-2\">\n  1597→                                <Badge variant=\"outline\" className=\"text-[10px] font-normal px-1.5 py-0\">\n  1598→                                  {note.type === 'saved_response' ? 'Chat' : 'Note'}\n  1599→                                </Badge>\n  1600→                                <span className=\"text-[10px] text-muted-foreground\">\n  1601→                                  {new Date(note.created_at).toLocaleDateString()}\n  1602→                                </span>\n  1603→                              </div>\n  1604→                            </div>\n  1605→                          ))}\n  1606→                        </div>\n  1607→                      )}\n  1608→                    </div>\n  1609→                  </div>\n  1610→                )}\n  1611→              </div>\n  1612→\n  1613→            </div>\n  1614→          </ScrollArea>\n  1615→        </div>\n  1616→      </div>\n  1617→\n  1618→      {/* Study Materials Sheet */}\n  1619→      <Sheet open={studySheetOpen} onOpenChange={setStudySheetOpen}>\n  1620→        <SheetContent className=\"w-full sm:max-w-lg overflow-y-auto\">\n  1621→          <SheetHeader>\n  1622→            <SheetTitle className=\"flex items-center gap-2\">\n  1623→              {activeStudyType === 'flashcards' && <><BookOpen className=\"h-5 w-5 text-blue-500\" /> Flashcards</>}\n  1624→              {activeStudyType === 'quiz' && <><ListChecks className=\"h-5 w-5 text-purple-500\" /> Quiz</>}\n  1625→              {activeStudyType === 'guide' && <><FileText className=\"h-5 w-5 text-orange-500\" /> Study Guide</>}\n  1626→              {activeStudyType === 'faq' && <><HelpCircle className=\"h-5 w-5 text-teal-500\" /> FAQ</>}\n  1627→            </SheetTitle>\n  1628→            <SheetDescription>\n  1629→              {activeStudyType === 'flashcards' && `${flashcards.length} cards generated from your sources`}\n  1630→              {activeStudyType === 'quiz' && `${quizQuestions.length} questions to test your knowledge`}\n  1631→              {activeStudyType === 'guide' && 'Comprehensive study guide from your sources'}\n  1632→              {activeStudyType === 'faq' && `${faqItems.length} frequently asked questions`}\n  1633→            </SheetDescription>\n  1634→          </SheetHeader>\n  1635→\n  1636→          <div className=\"mt-6\">\n  1637→            {/* Flashcards View */}\n  1638→            {activeStudyType === 'flashcards' && flashcards.length > 0 && (\n  1639→              <div className=\"space-y-4\">\n  1640→                <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n  1641→                  <span>Card {currentFlashcard + 1} of {flashcards.length}</span>\n  1642→                  <Button\n  1643→                    variant=\"ghost\"\n  1644→                    size=\"sm\"\n  1645→                    onClick={() => {\n  1646→                      setCurrentFlashcard(0)\n  1647→                      setShowFlashcardBack(false)\n  1648→                    }}\n  1649→                  >\n  1650→                    <RotateCcw className=\"h-4 w-4 mr-1\" />\n  1651→                    Reset\n  1652→                  </Button>\n  1653→                </div>\n  1654→\n  1655→                <div\n  1656→                  onClick={() => setShowFlashcardBack(!showFlashcardBack)}\n  1657→                  className=\"min-h-[200px] p-6 rounded-xl border-2 bg-gradient-to-br from-background to-muted/30 cursor-pointer hover:shadow-lg transition-all flex flex-col justify-center\"\n  1658→                >\n  1659→                  <p className=\"text-xs font-medium text-muted-foreground mb-3 uppercase tracking-wide\">\n  1660→                    {showFlashcardBack ? 'Answer' : 'Question'}\n  1661→                  </p>\n  1662→                  <p className=\"text-lg leading-relaxed\">\n  1663→                    {showFlashcardBack ? flashcards[currentFlashcard]?.back : flashcards[currentFlashcard]?.front}\n  1664→                  </p>\n  1665→                  <p className=\"text-xs text-muted-foreground mt-4\">Click to flip</p>\n  1666→                </div>\n  1667→\n  1668→                <div className=\"flex gap-2\">\n  1669→                  <Button\n  1670→                    variant=\"outline\"\n  1671→                    className=\"flex-1\"\n  1672→                    disabled={currentFlashcard === 0}\n  1673→                    onClick={() => { setCurrentFlashcard(c => c - 1); setShowFlashcardBack(false) }}\n  1674→                  >\n  1675→                    Previous\n  1676→                  </Button>\n  1677→                  <Button\n  1678→                    variant=\"outline\"\n  1679→                    className=\"flex-1\"\n  1680→                    disabled={currentFlashcard === flashcards.length - 1}\n  1681→                    onClick={() => { setCurrentFlashcard(c => c + 1); setShowFlashcardBack(false) }}\n  1682→                  >\n  1683→                    Next\n  1684→                  </Button>\n  1685→                </div>\n  1686→              </div>\n  1687→            )}\n  1688→\n  1689→            {/* Quiz View */}\n  1690→            {activeStudyType === 'quiz' && quizQuestions.length > 0 && (\n  1691→              <div className=\"space-y-4\">\n  1692→                <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n  1693→                  <span>Question {currentQuizQuestion + 1} of {quizQuestions.length}</span>\n  1694→                  <Button\n  1695→                    variant=\"ghost\"\n  1696→                    size=\"sm\"\n  1697→                    onClick={() => {\n  1698→                      setCurrentQuizQuestion(0)\n  1699→                      setSelectedAnswer(null)\n  1700→                      setShowQuizAnswer(false)\n  1701→                    }}\n  1702→                  >\n  1703→                    <RotateCcw className=\"h-4 w-4 mr-1\" />\n  1704→                    Reset\n  1705→                  </Button>\n  1706→                </div>\n  1707→\n  1708→                <div className=\"p-6 rounded-xl border bg-muted/30\">\n  1709→                  <p className=\"font-medium text-lg mb-4\">{quizQuestions[currentQuizQuestion]?.question}</p>\n  1710→\n  1711→                  <div className=\"space-y-2\">\n  1712→                    {quizQuestions[currentQuizQuestion]?.options.map((option, i) => (\n  1713→                      <button\n  1714→                        key={i}\n  1715→                        className={`\n  1716→                          w-full text-left p-4 rounded-lg border transition-all\n  1717→                          ${showQuizAnswer\n  1718→                            ? i === quizQuestions[currentQuizQuestion]?.correct_index\n  1719→                              ? 'bg-emerald-100 dark:bg-emerald-900/30 border-emerald-500'\n  1720→                              : selectedAnswer === i\n  1721→                              ? 'bg-red-100 dark:bg-red-900/30 border-red-500'\n  1722→                              : 'bg-muted/50'\n  1723→                            : selectedAnswer === i\n  1724→                            ? 'bg-primary/10 border-primary'\n  1725→                            : 'bg-background hover:bg-muted/50'\n  1726→                          }\n  1727→                        `}\n  1728→                        onClick={() => !showQuizAnswer && setSelectedAnswer(i)}\n  1729→                        disabled={showQuizAnswer}\n  1730→                      >\n  1731→                        {option}\n  1732→                      </button>\n  1733→                    ))}\n  1734→                  </div>\n  1735→\n  1736→                  {selectedAnswer !== null && !showQuizAnswer && (\n  1737→                    <Button\n  1738→                      className=\"w-full mt-4\"\n  1739→                      onClick={() => setShowQuizAnswer(true)}\n  1740→                    >\n  1741→                      Check Answer\n  1742→                    </Button>\n  1743→                  )}\n  1744→\n  1745→                  {showQuizAnswer && (\n  1746→                    <div className=\"mt-4 space-y-3\">\n  1747→                      <div className=\"p-4 rounded-lg bg-muted\">\n  1748→                        <p className=\"text-sm\">{quizQuestions[currentQuizQuestion]?.explanation}</p>\n  1749→                      </div>\n  1750→                      <Button\n  1751→                        className=\"w-full\"\n  1752→                        disabled={currentQuizQuestion === quizQuestions.length - 1}\n  1753→                        onClick={() => {\n  1754→                          setCurrentQuizQuestion(c => c + 1)\n  1755→                          setSelectedAnswer(null)\n  1756→                          setShowQuizAnswer(false)\n  1757→                        }}\n  1758→                      >\n  1759→                        Next Question\n  1760→                      </Button>\n  1761→                    </div>\n  1762→                  )}\n  1763→                </div>\n  1764→              </div>\n  1765→            )}\n  1766→\n  1767→            {/* Study Guide View */}\n  1768→            {activeStudyType === 'guide' && studyGuide && (\n  1769→              <div className=\"space-y-6\">\n  1770→                <h3 className=\"text-xl font-semibold\">{studyGuide.title}</h3>\n  1771→                {studyGuide.sections.map((section, i) => (\n  1772→                  <div key={i} className=\"space-y-2\">\n  1773→                    <h4 className=\"font-medium text-primary\">{section.heading}</h4>\n  1774→                    <p className=\"text-sm text-muted-foreground leading-relaxed whitespace-pre-wrap\">\n  1775→                      {section.content}\n  1776→                    </p>\n  1777→                  </div>\n  1778→                ))}\n  1779→              </div>\n  1780→            )}\n  1781→\n  1782→            {/* FAQ View */}\n  1783→            {activeStudyType === 'faq' && faqItems.length > 0 && (\n  1784→              <div className=\"space-y-4\">\n  1785→                {faqItems.map((item, i) => (\n  1786→                  <div key={i} className=\"p-4 rounded-xl border bg-muted/30\">\n  1787→                    <p className=\"font-medium mb-2\">Q: {item.question}</p>\n  1788→                    <p className=\"text-sm text-muted-foreground\">A: {item.answer}</p>\n  1789→                  </div>\n  1790→                ))}\n  1791→              </div>\n  1792→            )}\n  1793→          </div>\n  1794→        </SheetContent>\n  1795→      </Sheet>\n  1796→    </div>\n  1797→  )\n  1798→}\n  1799→"}]},"uuid":"4f9065d5-e1c2-4388-a5ef-e3dcdc203a92","timestamp":"2025-12-28T12:56:40.199Z","toolUseResult":{"type":"update","filePath":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/app/notebooks/[id]/page.tsx","content":"'use client'\n\nimport { useEffect, useState, useRef, useCallback } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { createClient, Notebook, Source, ChatMessage } from '@/lib/supabase'\nimport { chatApi, Note } from '@/lib/api'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Badge } from '@/components/ui/badge'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle, SheetTrigger } from '@/components/ui/sheet'\nimport { ScrollArea } from '@/components/ui/scroll-area'\nimport { Tooltip, TooltipContent, TooltipTrigger } from '@/components/ui/tooltip'\nimport {\n  ArrowLeft, Plus, Upload, FileText, Youtube, Link as LinkIcon,\n  Type, Send, Loader2, CheckCircle, XCircle, Clock, Trash2,\n  Mic, Video, Search, BookOpen, StickyNote, Sparkles, Pin,\n  Edit2, Save, X, AlertCircle, ChevronDown, ChevronRight,\n  MoreHorizontal, Copy, GraduationCap, HelpCircle, ListChecks,\n  Play, Pause, RotateCcw\n} from 'lucide-react'\nimport { toast } from 'sonner'\nimport { User } from '@supabase/supabase-js'\n\ninterface LocalNote {\n  id: string\n  notebook_id: string\n  type: 'written' | 'saved_response'\n  title: string | null\n  content: string | null\n  tags: string[]\n  is_pinned: boolean\n  created_at: string\n  updated_at: string\n}\n\nexport default function NotebookPage() {\n  const params = useParams()\n  const router = useRouter()\n  const notebookId = params.id as string\n  const supabase = createClient()\n\n  // Core state\n  const [user, setUser] = useState<User | null>(null)\n  const [notebook, setNotebook] = useState<Notebook | null>(null)\n  const [sources, setSources] = useState<Source[]>([])\n  const [messages, setMessages] = useState<ChatMessage[]>([])\n  const [notes, setNotes] = useState<LocalNote[]>([])\n  const [loading, setLoading] = useState(true)\n\n  // Chat state\n  const [sending, setSending] = useState(false)\n  const [message, setMessage] = useState('')\n  const [selectedSources, setSelectedSources] = useState<Set<string>>(new Set())\n  const [sessionId, setSessionId] = useState<string | null>(null)\n\n  // Source modal state\n  const [addSourceOpen, setAddSourceOpen] = useState(false)\n  const [sourceType, setSourceType] = useState<'file' | 'youtube' | 'url' | 'text'>('file')\n  const [sourceInput, setSourceInput] = useState('')\n  const [sourceName, setSourceName] = useState('')\n  const [uploading, setUploading] = useState(false)\n\n  // Notes state\n  const [addNoteOpen, setAddNoteOpen] = useState(false)\n  const [noteTitle, setNoteTitle] = useState('')\n  const [noteContent, setNoteContent] = useState('')\n  const [editingNote, setEditingNote] = useState<string | null>(null)\n  const [savingNote, setSavingNote] = useState(false)\n\n  // Audio state\n  const [audioFormat, setAudioFormat] = useState('deep_dive')\n  const [audioInstructions, setAudioInstructions] = useState('')\n  const [generatingAudio, setGeneratingAudio] = useState(false)\n\n  // Video state\n  const [videoStyle, setVideoStyle] = useState('explainer')\n  const [generatingVideo, setGeneratingVideo] = useState(false)\n\n  // Research state\n  const [researchQuery, setResearchQuery] = useState('')\n  const [researchMode, setResearchMode] = useState('fast')\n  const [researching, setResearching] = useState(false)\n\n  // Study loading states\n  const [generatingFlashcards, setGeneratingFlashcards] = useState(false)\n  const [generatingQuiz, setGeneratingQuiz] = useState(false)\n  const [generatingStudyGuide, setGeneratingStudyGuide] = useState(false)\n  const [generatingFaq, setGeneratingFaq] = useState(false)\n\n  // Study results\n  const [flashcards, setFlashcards] = useState<Array<{id: string, front: string, back: string}>>([])\n  const [quizQuestions, setQuizQuestions] = useState<Array<{id: string, question: string, options: string[], correct_index: number, explanation: string}>>([])\n  const [studyGuide, setStudyGuide] = useState<{title: string, sections: Array<{heading: string, content: string}>} | null>(null)\n  const [faqItems, setFaqItems] = useState<Array<{question: string, answer: string}>>([])\n  const [currentFlashcard, setCurrentFlashcard] = useState(0)\n  const [showFlashcardBack, setShowFlashcardBack] = useState(false)\n  const [currentQuizQuestion, setCurrentQuizQuestion] = useState(0)\n  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null)\n  const [showQuizAnswer, setShowQuizAnswer] = useState(false)\n\n  // Studio accordion state\n  const [expandedSection, setExpandedSection] = useState<string | null>('audio')\n\n  // Study materials sheet\n  const [studySheetOpen, setStudySheetOpen] = useState(false)\n  const [activeStudyType, setActiveStudyType] = useState<'flashcards' | 'quiz' | 'guide' | 'faq' | null>(null)\n\n  // Source preview state\n  const [viewingSource, setViewingSource] = useState<Source | null>(null)\n\n  // Refs\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n\n  // Initialize\n  useEffect(() => {\n    const init = async () => {\n      const { data: { user } } = await supabase.auth.getUser()\n      if (!user) {\n        router.push('/auth/login')\n        return\n      }\n      setUser(user)\n      await Promise.all([fetchNotebook(), fetchSources(), fetchNotes()])\n      setLoading(false)\n    }\n    init()\n  }, [notebookId])\n\n  // Auto-scroll messages\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }, [messages])\n\n  const fetchNotebook = async () => {\n    const { data, error } = await supabase\n      .from('notebooks')\n      .select('*')\n      .eq('id', notebookId)\n      .single()\n\n    if (error || !data) {\n      toast.error('Notebook not found')\n      router.push('/')\n      return\n    }\n    setNotebook(data)\n  }\n\n  const fetchSources = async () => {\n    const { data } = await supabase\n      .from('sources')\n      .select('*')\n      .eq('notebook_id', notebookId)\n      .order('created_at', { ascending: false })\n\n    setSources(data || [])\n  }\n\n  const fetchNotes = async () => {\n    const { data } = await supabase\n      .from('notes')\n      .select('*')\n      .eq('notebook_id', notebookId)\n      .order('is_pinned', { ascending: false })\n      .order('created_at', { ascending: false })\n\n    setNotes(data || [])\n  }\n\n  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n\n    setUploading(true)\n    const fileExt = file.name.split('.').pop()?.toLowerCase()\n    const filePath = `${user?.id}/${notebookId}/${Date.now()}.${fileExt}`\n\n    const { error: uploadError } = await supabase.storage\n      .from('sources')\n      .upload(filePath, file)\n\n    if (uploadError) {\n      toast.error('Failed to upload file')\n      setUploading(false)\n      return\n    }\n\n    const { data, error } = await supabase\n      .from('sources')\n      .insert({\n        notebook_id: notebookId,\n        type: fileExt === 'pdf' ? 'pdf' : fileExt === 'docx' ? 'docx' : 'txt',\n        name: file.name,\n        status: 'ready',\n        file_path: filePath,\n        original_filename: file.name,\n        mime_type: file.type,\n        file_size_bytes: file.size,\n      })\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to create source')\n    } else {\n      toast.success('File uploaded!')\n      setSources([data, ...sources])\n      setAddSourceOpen(false)\n    }\n    setUploading(false)\n  }\n\n  const addSource = async () => {\n    if (!sourceInput.trim()) return\n\n    setUploading(true)\n    let sourceData: Partial<Source> = {\n      notebook_id: notebookId,\n      status: 'ready',\n    }\n\n    if (sourceType === 'youtube') {\n      sourceData = {\n        ...sourceData,\n        type: 'youtube',\n        name: sourceName || `YouTube: ${sourceInput}`,\n        metadata: { url: sourceInput },\n      }\n    } else if (sourceType === 'url') {\n      sourceData = {\n        ...sourceData,\n        type: 'url',\n        name: sourceName || sourceInput,\n        metadata: { url: sourceInput },\n      }\n    } else if (sourceType === 'text') {\n      sourceData = {\n        ...sourceData,\n        type: 'text',\n        name: sourceName || 'Pasted Text',\n        metadata: { content: sourceInput },\n      }\n    }\n\n    const { data, error } = await supabase\n      .from('sources')\n      .insert(sourceData)\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to add source')\n    } else {\n      toast.success('Source added!')\n      setSources([data, ...sources])\n      setSourceInput('')\n      setSourceName('')\n      setAddSourceOpen(false)\n    }\n    setUploading(false)\n  }\n\n  const deleteSource = async (sourceId: string) => {\n    const { error } = await supabase\n      .from('sources')\n      .delete()\n      .eq('id', sourceId)\n\n    if (error) {\n      toast.error('Failed to delete source')\n    } else {\n      setSources(sources.filter(s => s.id !== sourceId))\n      selectedSources.delete(sourceId)\n      setSelectedSources(new Set(selectedSources))\n      toast.success('Source deleted')\n    }\n  }\n\n  const toggleSource = (sourceId: string) => {\n    const newSelected = new Set(selectedSources)\n    if (newSelected.has(sourceId)) {\n      newSelected.delete(sourceId)\n    } else {\n      newSelected.add(sourceId)\n    }\n    setSelectedSources(newSelected)\n  }\n\n  const selectAllSources = () => {\n    if (selectedSources.size === sources.length) {\n      setSelectedSources(new Set())\n    } else {\n      setSelectedSources(new Set(sources.map(s => s.id)))\n    }\n  }\n\n  const sendMessage = async () => {\n    if (!message.trim() || sending) return\n\n    setSending(true)\n    const userMessage: ChatMessage = {\n      id: crypto.randomUUID(),\n      session_id: sessionId || '',\n      role: 'user',\n      content: message,\n      citations: [],\n      source_ids_used: Array.from(selectedSources),\n      model_used: null,\n      input_tokens: null,\n      output_tokens: null,\n      cost_usd: null,\n      created_at: new Date().toISOString(),\n    }\n    setMessages(prev => [...prev, userMessage])\n    setMessage('')\n\n    try {\n      const response = await chatApi.sendMessage(notebookId, {\n        message: userMessage.content,\n        source_ids: Array.from(selectedSources),\n        session_id: sessionId || undefined,\n      })\n\n      if (response.data.session_id) {\n        setSessionId(response.data.session_id)\n      }\n\n      const aiMessage: ChatMessage = {\n        id: response.data.message_id,\n        session_id: response.data.session_id,\n        role: 'assistant',\n        content: response.data.content,\n        citations: response.data.citations,\n        source_ids_used: Array.from(selectedSources),\n        model_used: response.usage?.model_used || 'gemini-2.0-flash',\n        input_tokens: response.usage?.input_tokens || 0,\n        output_tokens: response.usage?.output_tokens || 0,\n        cost_usd: response.usage?.cost_usd || 0,\n        created_at: new Date().toISOString(),\n      }\n      setMessages(prev => [...prev, aiMessage])\n    } catch (error) {\n      toast.error('Failed to send message')\n      // Remove the user message on error\n      setMessages(prev => prev.filter(m => m.id !== userMessage.id))\n    }\n    setSending(false)\n  }\n\n  // Notes functions\n  const createNote = async () => {\n    if (!noteTitle.trim() && !noteContent.trim()) return\n\n    setSavingNote(true)\n    const { data, error } = await supabase\n      .from('notes')\n      .insert({\n        notebook_id: notebookId,\n        type: 'written',\n        title: noteTitle || 'Untitled Note',\n        content: noteContent,\n        tags: [],\n      })\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to create note')\n    } else {\n      toast.success('Note created!')\n      setNotes([data, ...notes])\n      setNoteTitle('')\n      setNoteContent('')\n      setAddNoteOpen(false)\n    }\n    setSavingNote(false)\n  }\n\n  const updateNote = async (noteId: string, updates: Partial<LocalNote>) => {\n    const { data, error } = await supabase\n      .from('notes')\n      .update({ ...updates, updated_at: new Date().toISOString() })\n      .eq('id', noteId)\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to update note')\n    } else {\n      setNotes(notes.map(n => n.id === noteId ? data : n))\n      setEditingNote(null)\n    }\n  }\n\n  const deleteNote = async (noteId: string) => {\n    const { error } = await supabase\n      .from('notes')\n      .delete()\n      .eq('id', noteId)\n\n    if (error) {\n      toast.error('Failed to delete note')\n    } else {\n      setNotes(notes.filter(n => n.id !== noteId))\n      toast.success('Note deleted')\n    }\n  }\n\n  const togglePinNote = async (note: LocalNote) => {\n    await updateNote(note.id, { is_pinned: !note.is_pinned })\n  }\n\n  const saveResponseAsNote = async (msg: ChatMessage) => {\n    const { data, error } = await supabase\n      .from('notes')\n      .insert({\n        notebook_id: notebookId,\n        type: 'saved_response',\n        title: `Saved Response - ${new Date().toLocaleDateString()}`,\n        content: msg.content,\n        tags: [],\n      })\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to save response')\n    } else {\n      toast.success('Response saved as note!')\n      setNotes([data, ...notes])\n    }\n  }\n\n  // Audio generation\n  const generateAudio = async () => {\n    if (selectedSources.size === 0) {\n      toast.error('Please select at least one source')\n      return\n    }\n\n    setGeneratingAudio(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/audio`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          format: audioFormat,\n          source_ids: Array.from(selectedSources),\n          custom_instructions: audioInstructions || undefined,\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else {\n        toast.success('Audio script generated! (Demo mode - no actual audio file)')\n      }\n    } catch {\n      toast.error('Failed to generate audio')\n    }\n    setGeneratingAudio(false)\n  }\n\n  // Video generation\n  const generateVideo = async () => {\n    if (selectedSources.size === 0) {\n      toast.error('Please select at least one source')\n      return\n    }\n\n    setGeneratingVideo(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/video`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          style: videoStyle,\n          source_ids: Array.from(selectedSources),\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else {\n        toast.success('Video script generated! (Demo mode - no actual video file)')\n      }\n    } catch {\n      toast.error('Failed to generate video')\n    }\n    setGeneratingVideo(false)\n  }\n\n  // Research generation\n  const runResearch = async () => {\n    if (!researchQuery.trim()) {\n      toast.error('Please enter a research query')\n      return\n    }\n\n    setResearching(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/research`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          query: researchQuery,\n          mode: researchMode,\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else {\n        toast.success('Research report generated!')\n        setResearchQuery('')\n      }\n    } catch {\n      toast.error('Failed to run research')\n    }\n    setResearching(false)\n  }\n\n  // Study material generation handlers\n  const handleGenerateFlashcards = async () => {\n    setGeneratingFlashcards(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          type: 'flashcards',\n          source_ids: Array.from(selectedSources),\n          count: 5,\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else if (result.data?.flashcards) {\n        setFlashcards(result.data.flashcards)\n        setCurrentFlashcard(0)\n        setShowFlashcardBack(false)\n        setActiveStudyType('flashcards')\n        setStudySheetOpen(true)\n        toast.success(`Generated ${result.data.flashcards.length} flashcards!`)\n      } else {\n        toast.error('Unexpected response')\n      }\n    } catch (err) {\n      console.error('Flashcards error:', err)\n      toast.error('Failed to generate flashcards')\n    } finally {\n      setGeneratingFlashcards(false)\n    }\n  }\n\n  const handleGenerateQuiz = async () => {\n    setGeneratingQuiz(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          type: 'quiz',\n          source_ids: Array.from(selectedSources),\n          count: 5,\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else if (result.data?.questions) {\n        setQuizQuestions(result.data.questions)\n        setCurrentQuizQuestion(0)\n        setSelectedAnswer(null)\n        setShowQuizAnswer(false)\n        setActiveStudyType('quiz')\n        setStudySheetOpen(true)\n        toast.success(`Generated ${result.data.questions.length} quiz questions!`)\n      } else {\n        toast.error('Unexpected response')\n      }\n    } catch (err) {\n      console.error('Quiz error:', err)\n      toast.error('Failed to generate quiz')\n    } finally {\n      setGeneratingQuiz(false)\n    }\n  }\n\n  const handleGenerateStudyGuide = async () => {\n    setGeneratingStudyGuide(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          type: 'study-guide',\n          source_ids: Array.from(selectedSources),\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else if (result.data?.sections) {\n        setStudyGuide(result.data)\n        setActiveStudyType('guide')\n        setStudySheetOpen(true)\n        toast.success('Study guide generated!')\n      } else {\n        toast.error('Unexpected response')\n      }\n    } catch (err) {\n      console.error('Study guide error:', err)\n      toast.error('Failed to generate study guide')\n    } finally {\n      setGeneratingStudyGuide(false)\n    }\n  }\n\n  const handleGenerateFaq = async () => {\n    setGeneratingFaq(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          type: 'faq',\n          source_ids: Array.from(selectedSources),\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else if (result.data?.faq) {\n        setFaqItems(result.data.faq)\n        setActiveStudyType('faq')\n        setStudySheetOpen(true)\n        toast.success(`Generated ${result.data.faq.length} FAQ items!`)\n      } else {\n        toast.error('Unexpected response')\n      }\n    } catch (err) {\n      console.error('FAQ error:', err)\n      toast.error('Failed to generate FAQ')\n    } finally {\n      setGeneratingFaq(false)\n    }\n  }\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'ready':\n        return <CheckCircle className=\"h-3.5 w-3.5 text-emerald-500\" />\n      case 'processing':\n        return <Clock className=\"h-3.5 w-3.5 text-amber-500 animate-spin\" />\n      case 'failed':\n        return <XCircle className=\"h-3.5 w-3.5 text-red-500\" />\n      default:\n        return <Clock className=\"h-3.5 w-3.5 text-muted-foreground\" />\n    }\n  }\n\n  const getSourceIcon = (type: string) => {\n    switch (type) {\n      case 'pdf':\n      case 'docx':\n      case 'txt':\n        return <FileText className=\"h-4 w-4 text-blue-500\" />\n      case 'youtube':\n        return <Youtube className=\"h-4 w-4 text-red-500\" />\n      case 'url':\n        return <LinkIcon className=\"h-4 w-4 text-violet-500\" />\n      case 'text':\n        return <Type className=\"h-4 w-4 text-slate-500\" />\n      default:\n        return <FileText className=\"h-4 w-4 text-slate-500\" />\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <div className=\"flex flex-col items-center gap-3\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          <p className=\"text-sm text-muted-foreground\">Loading notebook...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"h-screen flex flex-col bg-background\">\n      {/* Clean Header */}\n      <header className=\"h-14 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 px-4 flex items-center gap-4 shrink-0 sticky top-0 z-50\">\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => router.push('/')}\n          className=\"text-muted-foreground hover:text-foreground -ml-2\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n        </Button>\n\n        <div className=\"flex items-center gap-3\">\n          <span className=\"text-xl\">{notebook?.emoji}</span>\n          <h1 className=\"font-semibold text-lg tracking-tight\">{notebook?.name}</h1>\n        </div>\n\n        <div className=\"flex items-center gap-2 ml-auto\">\n          <Badge variant=\"secondary\" className=\"font-normal text-xs px-2.5 py-0.5\">\n            {sources.length} {sources.length === 1 ? 'source' : 'sources'}\n          </Badge>\n          {selectedSources.size > 0 && (\n            <Badge className=\"bg-primary/10 text-primary border-0 font-normal text-xs px-2.5 py-0.5\">\n              {selectedSources.size} selected\n            </Badge>\n          )}\n        </div>\n      </header>\n\n      {/* Three Panel Layout */}\n      <div className=\"flex-1 grid grid-cols-[280px_1fr_340px] overflow-hidden\">\n\n        {/* Left Panel - Sources */}\n        <div className=\"border-r bg-muted/30 flex flex-col h-full\">\n          <div className=\"p-4 border-b bg-background\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h2 className=\"font-semibold text-sm text-foreground\">Sources</h2>\n              <Dialog open={addSourceOpen} onOpenChange={setAddSourceOpen}>\n                <DialogTrigger asChild>\n                  <Button size=\"sm\" variant=\"outline\" className=\"h-7 w-7 p-0\">\n                    <Plus className=\"h-3.5 w-3.5\" />\n                  </Button>\n                </DialogTrigger>\n                <DialogContent className=\"sm:max-w-md\">\n                  <DialogHeader>\n                    <DialogTitle>Add Source</DialogTitle>\n                    <DialogDescription>\n                      Add documents, URLs, or text to your notebook for AI analysis.\n                    </DialogDescription>\n                  </DialogHeader>\n                  <Tabs value={sourceType} onValueChange={(v) => setSourceType(v as typeof sourceType)} className=\"mt-2\">\n                    <TabsList className=\"grid grid-cols-4 w-full\">\n                      <TabsTrigger value=\"file\" className=\"text-xs\">\n                        <Upload className=\"h-3.5 w-3.5 mr-1.5\" />\n                        File\n                      </TabsTrigger>\n                      <TabsTrigger value=\"youtube\" className=\"text-xs\">\n                        <Youtube className=\"h-3.5 w-3.5 mr-1.5\" />\n                        YouTube\n                      </TabsTrigger>\n                      <TabsTrigger value=\"url\" className=\"text-xs\">\n                        <LinkIcon className=\"h-3.5 w-3.5 mr-1.5\" />\n                        URL\n                      </TabsTrigger>\n                      <TabsTrigger value=\"text\" className=\"text-xs\">\n                        <Type className=\"h-3.5 w-3.5 mr-1.5\" />\n                        Text\n                      </TabsTrigger>\n                    </TabsList>\n                    <TabsContent value=\"file\" className=\"space-y-4 mt-4\">\n                      <input\n                        ref={fileInputRef}\n                        type=\"file\"\n                        accept=\".pdf,.docx,.txt,.md\"\n                        onChange={handleFileUpload}\n                        className=\"hidden\"\n                      />\n                      <button\n                        onClick={() => fileInputRef.current?.click()}\n                        disabled={uploading}\n                        className=\"w-full h-32 border-2 border-dashed rounded-lg flex flex-col items-center justify-center gap-2 hover:border-primary/50 hover:bg-muted/50 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {uploading ? (\n                          <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                        ) : (\n                          <>\n                            <Upload className=\"h-8 w-8 text-muted-foreground\" />\n                            <div className=\"text-center\">\n                              <p className=\"text-sm font-medium\">Click to upload</p>\n                              <p className=\"text-xs text-muted-foreground mt-0.5\">PDF, DOCX, TXT, or MD</p>\n                            </div>\n                          </>\n                        )}\n                      </button>\n                    </TabsContent>\n                    <TabsContent value=\"youtube\" className=\"space-y-3 mt-4\">\n                      <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium\">YouTube URL</label>\n                        <Input\n                          placeholder=\"https://youtube.com/watch?v=...\"\n                          value={sourceInput}\n                          onChange={(e) => setSourceInput(e.target.value)}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium\">Name (optional)</label>\n                        <Input\n                          placeholder=\"My video\"\n                          value={sourceName}\n                          onChange={(e) => setSourceName(e.target.value)}\n                        />\n                      </div>\n                    </TabsContent>\n                    <TabsContent value=\"url\" className=\"space-y-3 mt-4\">\n                      <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium\">Website URL</label>\n                        <Input\n                          placeholder=\"https://example.com/article\"\n                          value={sourceInput}\n                          onChange={(e) => setSourceInput(e.target.value)}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium\">Name (optional)</label>\n                        <Input\n                          placeholder=\"Article name\"\n                          value={sourceName}\n                          onChange={(e) => setSourceName(e.target.value)}\n                        />\n                      </div>\n                    </TabsContent>\n                    <TabsContent value=\"text\" className=\"space-y-3 mt-4\">\n                      <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium\">Name</label>\n                        <Input\n                          placeholder=\"My notes\"\n                          value={sourceName}\n                          onChange={(e) => setSourceName(e.target.value)}\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <label className=\"text-sm font-medium\">Content</label>\n                        <Textarea\n                          placeholder=\"Paste your text here...\"\n                          value={sourceInput}\n                          onChange={(e) => setSourceInput(e.target.value)}\n                          rows={6}\n                        />\n                      </div>\n                    </TabsContent>\n                  </Tabs>\n                  {sourceType !== 'file' && (\n                    <DialogFooter className=\"mt-4\">\n                      <Button\n                        onClick={addSource}\n                        disabled={uploading || !sourceInput.trim()}\n                        className=\"w-full sm:w-auto\"\n                      >\n                        {uploading && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                        Add Source\n                      </Button>\n                    </DialogFooter>\n                  )}\n                </DialogContent>\n              </Dialog>\n            </div>\n\n            {sources.length > 0 && (\n              <button\n                onClick={selectAllSources}\n                className=\"text-xs text-muted-foreground hover:text-foreground transition-colors\"\n              >\n                {selectedSources.size === sources.length ? 'Deselect all' : 'Select all'}\n              </button>\n            )}\n          </div>\n\n          <ScrollArea className=\"flex-1\">\n            <div className=\"p-2\">\n              {sources.length === 0 ? (\n                <div className=\"text-center py-12 px-4\">\n                  <div className=\"w-12 h-12 rounded-full bg-muted flex items-center justify-center mx-auto mb-3\">\n                    <FileText className=\"h-5 w-5 text-muted-foreground\" />\n                  </div>\n                  <p className=\"text-sm font-medium text-foreground mb-1\">No sources yet</p>\n                  <p className=\"text-xs text-muted-foreground\">Add documents to start analyzing</p>\n                </div>\n              ) : (\n                <div className=\"space-y-1\">\n                  {sources.map((source) => (\n                    <div\n                      key={source.id}\n                      className={`\n                        group relative flex items-center gap-2.5 px-3 py-2.5 rounded-lg cursor-pointer\n                        transition-all duration-150\n                        ${selectedSources.has(source.id)\n                          ? 'bg-primary/10 ring-1 ring-primary/20'\n                          : 'hover:bg-muted'\n                        }\n                        ${viewingSource?.id === source.id ? 'ring-2 ring-primary' : ''}\n                      `}\n                      onClick={() => toggleSource(source.id)}\n                    >\n                      <div className={`\n                        w-4 h-4 rounded border-2 flex items-center justify-center shrink-0\n                        transition-colors duration-150\n                        ${selectedSources.has(source.id)\n                          ? 'bg-primary border-primary'\n                          : 'border-muted-foreground/30 group-hover:border-muted-foreground/50'\n                        }\n                      `}>\n                        {selectedSources.has(source.id) && (\n                          <CheckCircle className=\"h-3 w-3 text-primary-foreground\" />\n                        )}\n                      </div>\n\n                      {getSourceIcon(source.type)}\n\n                      <span\n                        className=\"flex-1 text-sm truncate\"\n                        onClick={(e) => {\n                          e.stopPropagation()\n                          setViewingSource(source)\n                        }}\n                      >\n                        {source.name}\n                      </span>\n\n                      {getStatusIcon(source.status)}\n\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"opacity-0 group-hover:opacity-100 h-6 w-6 p-0 transition-opacity\"\n                        onClick={(e) => {\n                          e.stopPropagation()\n                          deleteSource(source.id)\n                        }}\n                      >\n                        <Trash2 className=\"h-3 w-3 text-muted-foreground hover:text-destructive\" />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n        </div>\n\n        {/* Center Panel - Chat */}\n        <div className=\"flex flex-col h-full bg-background\">\n          {/* Source Preview Banner */}\n          {viewingSource && (\n            <div className=\"border-b bg-muted/50 px-6 py-4\">\n              <div className=\"max-w-3xl mx-auto\">\n                <div className=\"flex items-start justify-between gap-4\">\n                  <div className=\"flex items-start gap-3 min-w-0\">\n                    <div className=\"p-2 rounded-lg bg-background border shrink-0\">\n                      {getSourceIcon(viewingSource.type)}\n                    </div>\n                    <div className=\"min-w-0\">\n                      <h3 className=\"font-medium text-sm truncate\">{viewingSource.name}</h3>\n                      <div className=\"flex items-center gap-2 mt-1\">\n                        <Badge variant=\"outline\" className=\"text-xs font-normal capitalize\">\n                          {viewingSource.type}\n                        </Badge>\n                        {viewingSource.file_size_bytes && (\n                          <span className=\"text-xs text-muted-foreground\">\n                            {(viewingSource.file_size_bytes / 1024).toFixed(1)} KB\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => setViewingSource(null)}\n                    className=\"shrink-0 h-8 w-8 p-0\"\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n\n                {(viewingSource.type === 'text' && viewingSource.metadata?.content) ||\n                 (viewingSource.type === 'youtube' && viewingSource.metadata?.url) ||\n                 (viewingSource.type === 'url' && viewingSource.metadata?.url) ? (\n                  <div className=\"mt-3 p-3 rounded-lg bg-background border text-sm max-h-32 overflow-y-auto\">\n                    {viewingSource.type === 'text' ? (\n                      <p className=\"whitespace-pre-wrap text-muted-foreground\">{viewingSource.metadata.content}</p>\n                    ) : (\n                      <a\n                        href={viewingSource.metadata.url}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"text-primary hover:underline break-all\"\n                      >\n                        {viewingSource.metadata.url}\n                      </a>\n                    )}\n                  </div>\n                ) : null}\n              </div>\n            </div>\n          )}\n\n          {/* Messages */}\n          <ScrollArea className=\"flex-1\">\n            <div className=\"max-w-3xl mx-auto px-6 py-6\">\n              {messages.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center min-h-[400px] text-center\">\n                  <div className=\"w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center mb-6\">\n                    <Sparkles className=\"h-7 w-7 text-primary\" />\n                  </div>\n                  <h3 className=\"text-xl font-semibold mb-2\">Start a conversation</h3>\n                  <p className=\"text-muted-foreground mb-8 max-w-sm\">\n                    Ask questions about your sources and get AI-powered insights with citations.\n                  </p>\n                  <div className=\"flex flex-wrap justify-center gap-2 max-w-lg\">\n                    {['Summarize the key points', 'What are the main takeaways?', 'Explain the methodology'].map((q) => (\n                      <button\n                        key={q}\n                        onClick={() => setMessage(q)}\n                        className=\"px-4 py-2 text-sm rounded-full border bg-background hover:bg-muted transition-colors\"\n                      >\n                        {q}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              ) : (\n                <div className=\"space-y-6\">\n                  {messages.map((msg) => (\n                    <div\n                      key={msg.id}\n                      className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}\n                    >\n                      <div\n                        className={`\n                          max-w-[85%] rounded-2xl px-4 py-3\n                          ${msg.role === 'user'\n                            ? 'bg-primary text-primary-foreground rounded-br-md'\n                            : 'bg-muted rounded-bl-md'\n                          }\n                        `}\n                      >\n                        <p className=\"whitespace-pre-wrap text-[15px] leading-relaxed\">{msg.content}</p>\n                        {msg.role === 'assistant' && (\n                          <div className=\"flex items-center gap-3 mt-3 pt-3 border-t border-border/50\">\n                            {msg.cost_usd !== null && msg.cost_usd > 0 && (\n                              <span className=\"text-xs text-muted-foreground\">\n                                ${msg.cost_usd.toFixed(4)}\n                              </span>\n                            )}\n                            <div className=\"flex items-center gap-1 ml-auto\">\n                              <Tooltip>\n                                <TooltipTrigger asChild>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"h-7 w-7 p-0\"\n                                    onClick={() => navigator.clipboard.writeText(msg.content)}\n                                  >\n                                    <Copy className=\"h-3.5 w-3.5\" />\n                                  </Button>\n                                </TooltipTrigger>\n                                <TooltipContent>Copy</TooltipContent>\n                              </Tooltip>\n                              <Tooltip>\n                                <TooltipTrigger asChild>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"h-7 w-7 p-0\"\n                                    onClick={() => saveResponseAsNote(msg)}\n                                  >\n                                    <StickyNote className=\"h-3.5 w-3.5\" />\n                                  </Button>\n                                </TooltipTrigger>\n                                <TooltipContent>Save as note</TooltipContent>\n                              </Tooltip>\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  ))}\n                  {sending && (\n                    <div className=\"flex justify-start\">\n                      <div className=\"bg-muted rounded-2xl rounded-bl-md px-4 py-3\">\n                        <div className=\"flex items-center gap-2\">\n                          <Loader2 className=\"h-4 w-4 animate-spin\" />\n                          <span className=\"text-sm text-muted-foreground\">Thinking...</span>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                  <div ref={messagesEndRef} />\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n\n          {/* Chat Input */}\n          <div className=\"border-t bg-background p-4\">\n            <div className=\"max-w-3xl mx-auto\">\n              {selectedSources.size === 0 && sources.length > 0 && (\n                <div className=\"flex items-center gap-2 mb-3 px-3 py-2 text-sm text-amber-700 dark:text-amber-400 bg-amber-50 dark:bg-amber-950/30 rounded-lg border border-amber-200 dark:border-amber-800/50\">\n                  <AlertCircle className=\"h-4 w-4 shrink-0\" />\n                  <span>Select sources from the left panel for contextual answers</span>\n                </div>\n              )}\n              <div className=\"flex items-center gap-3\">\n                <div className=\"flex-1 relative\">\n                  <Input\n                    placeholder=\"Ask a question about your sources...\"\n                    value={message}\n                    onChange={(e) => setMessage(e.target.value)}\n                    onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && sendMessage()}\n                    disabled={sending}\n                    className=\"pr-12 h-12 text-[15px] rounded-xl border-muted-foreground/20 focus:border-primary\"\n                  />\n                </div>\n                <Button\n                  onClick={sendMessage}\n                  disabled={sending || !message.trim()}\n                  size=\"lg\"\n                  className=\"h-12 w-12 rounded-xl shrink-0\"\n                >\n                  <Send className=\"h-5 w-5\" />\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Right Panel - Studio */}\n        <div className=\"border-l bg-muted/30 flex flex-col h-full\">\n          <div className=\"p-4 border-b bg-background\">\n            <h2 className=\"font-semibold text-sm\">Studio</h2>\n            <p className=\"text-xs text-muted-foreground mt-0.5\">Create content from your sources</p>\n          </div>\n\n          <ScrollArea className=\"flex-1\">\n            <div className=\"p-3 space-y-2\">\n\n              {/* Audio Overview Section */}\n              <div className=\"rounded-xl border bg-background overflow-hidden\">\n                <button\n                  onClick={() => setExpandedSection(expandedSection === 'audio' ? null : 'audio')}\n                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-orange-500/20 to-red-500/20 flex items-center justify-center\">\n                      <Mic className=\"h-4 w-4 text-orange-600\" />\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium text-sm\">Audio Overview</p>\n                      <p className=\"text-xs text-muted-foreground\">Podcast-style discussion</p>\n                    </div>\n                  </div>\n                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'audio' ? 'rotate-180' : ''}`} />\n                </button>\n\n                {expandedSection === 'audio' && (\n                  <div className=\"px-4 pb-4 space-y-4 border-t bg-muted/20\">\n                    <div className=\"pt-4 space-y-3\">\n                      <div className=\"space-y-1.5\">\n                        <label className=\"text-xs font-medium\">Format</label>\n                        <Select value={audioFormat} onValueChange={setAudioFormat}>\n                          <SelectTrigger className=\"h-9 text-sm\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"deep_dive\">Deep Dive (10-15 min)</SelectItem>\n                            <SelectItem value=\"brief\">Brief Summary (2-3 min)</SelectItem>\n                            <SelectItem value=\"critique\">Analytical (5-10 min)</SelectItem>\n                            <SelectItem value=\"debate\">Debate (8-15 min)</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"space-y-1.5\">\n                        <label className=\"text-xs font-medium\">Custom Instructions</label>\n                        <Textarea\n                          placeholder=\"Optional instructions for hosts...\"\n                          value={audioInstructions}\n                          onChange={(e) => setAudioInstructions(e.target.value)}\n                          rows={2}\n                          className=\"text-sm resize-none\"\n                        />\n                      </div>\n                      <Button\n                        className=\"w-full\"\n                        onClick={generateAudio}\n                        disabled={generatingAudio || selectedSources.size === 0}\n                      >\n                        {generatingAudio ? (\n                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        ) : (\n                          <Play className=\"h-4 w-4 mr-2\" />\n                        )}\n                        Generate Audio\n                      </Button>\n                      {selectedSources.size === 0 && (\n                        <p className=\"text-xs text-muted-foreground text-center\">\n                          Select sources to generate\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Video Overview Section */}\n              <div className=\"rounded-xl border bg-background overflow-hidden\">\n                <button\n                  onClick={() => setExpandedSection(expandedSection === 'video' ? null : 'video')}\n                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center\">\n                      <Video className=\"h-4 w-4 text-purple-600\" />\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium text-sm\">Video Overview</p>\n                      <p className=\"text-xs text-muted-foreground\">Visual explainer video</p>\n                    </div>\n                  </div>\n                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'video' ? 'rotate-180' : ''}`} />\n                </button>\n\n                {expandedSection === 'video' && (\n                  <div className=\"px-4 pb-4 space-y-4 border-t bg-muted/20\">\n                    <div className=\"pt-4 space-y-3\">\n                      <div className=\"space-y-1.5\">\n                        <label className=\"text-xs font-medium\">Style</label>\n                        <Select value={videoStyle} onValueChange={setVideoStyle}>\n                          <SelectTrigger className=\"h-9 text-sm\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"explainer\">Explainer</SelectItem>\n                            <SelectItem value=\"documentary\">Documentary</SelectItem>\n                            <SelectItem value=\"presentation\">Presentation</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <Button\n                        className=\"w-full\"\n                        onClick={generateVideo}\n                        disabled={generatingVideo || selectedSources.size === 0}\n                      >\n                        {generatingVideo ? (\n                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        ) : (\n                          <Video className=\"h-4 w-4 mr-2\" />\n                        )}\n                        Generate Video\n                      </Button>\n                      {selectedSources.size === 0 && (\n                        <p className=\"text-xs text-muted-foreground text-center\">\n                          Select sources to generate\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Deep Research Section */}\n              <div className=\"rounded-xl border bg-background overflow-hidden\">\n                <button\n                  onClick={() => setExpandedSection(expandedSection === 'research' ? null : 'research')}\n                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-blue-500/20 to-cyan-500/20 flex items-center justify-center\">\n                      <Search className=\"h-4 w-4 text-blue-600\" />\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium text-sm\">Deep Research</p>\n                      <p className=\"text-xs text-muted-foreground\">Autonomous web research</p>\n                    </div>\n                  </div>\n                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'research' ? 'rotate-180' : ''}`} />\n                </button>\n\n                {expandedSection === 'research' && (\n                  <div className=\"px-4 pb-4 space-y-4 border-t bg-muted/20\">\n                    <div className=\"pt-4 space-y-3\">\n                      <div className=\"space-y-1.5\">\n                        <label className=\"text-xs font-medium\">Research Query</label>\n                        <Input\n                          placeholder=\"What would you like to research?\"\n                          value={researchQuery}\n                          onChange={(e) => setResearchQuery(e.target.value)}\n                          className=\"h-9 text-sm\"\n                        />\n                      </div>\n                      <div className=\"space-y-1.5\">\n                        <label className=\"text-xs font-medium\">Mode</label>\n                        <Select value={researchMode} onValueChange={setResearchMode}>\n                          <SelectTrigger className=\"h-9 text-sm\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"fast\">Fast (3-5 min)</SelectItem>\n                            <SelectItem value=\"deep\">Deep (10-15 min)</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <Button\n                        className=\"w-full\"\n                        onClick={runResearch}\n                        disabled={researching || !researchQuery.trim()}\n                      >\n                        {researching ? (\n                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        ) : (\n                          <Search className=\"h-4 w-4 mr-2\" />\n                        )}\n                        Start Research\n                      </Button>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Study Materials Section */}\n              <div className=\"rounded-xl border bg-background overflow-hidden\">\n                <button\n                  onClick={() => setExpandedSection(expandedSection === 'study' ? null : 'study')}\n                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-emerald-500/20 to-teal-500/20 flex items-center justify-center\">\n                      <GraduationCap className=\"h-4 w-4 text-emerald-600\" />\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium text-sm\">Study Materials</p>\n                      <p className=\"text-xs text-muted-foreground\">Flashcards, quizzes, and more</p>\n                    </div>\n                  </div>\n                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'study' ? 'rotate-180' : ''}`} />\n                </button>\n\n                {expandedSection === 'study' && (\n                  <div className=\"px-4 pb-4 border-t bg-muted/20\">\n                    <div className=\"pt-4 grid grid-cols-2 gap-2\">\n                      <button\n                        onClick={handleGenerateFlashcards}\n                        disabled={selectedSources.size === 0 || generatingFlashcards}\n                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {generatingFlashcards ? (\n                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n                        ) : (\n                          <BookOpen className=\"h-5 w-5 text-blue-500\" />\n                        )}\n                        <span className=\"text-xs font-medium\">Flashcards</span>\n                      </button>\n\n                      <button\n                        onClick={handleGenerateQuiz}\n                        disabled={selectedSources.size === 0 || generatingQuiz}\n                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {generatingQuiz ? (\n                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n                        ) : (\n                          <ListChecks className=\"h-5 w-5 text-purple-500\" />\n                        )}\n                        <span className=\"text-xs font-medium\">Quiz</span>\n                      </button>\n\n                      <button\n                        onClick={handleGenerateStudyGuide}\n                        disabled={selectedSources.size === 0 || generatingStudyGuide}\n                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {generatingStudyGuide ? (\n                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n                        ) : (\n                          <FileText className=\"h-5 w-5 text-orange-500\" />\n                        )}\n                        <span className=\"text-xs font-medium\">Study Guide</span>\n                      </button>\n\n                      <button\n                        onClick={handleGenerateFaq}\n                        disabled={selectedSources.size === 0 || generatingFaq}\n                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {generatingFaq ? (\n                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n                        ) : (\n                          <HelpCircle className=\"h-5 w-5 text-teal-500\" />\n                        )}\n                        <span className=\"text-xs font-medium\">FAQ</span>\n                      </button>\n                    </div>\n\n                    {selectedSources.size === 0 && (\n                      <p className=\"text-xs text-muted-foreground text-center mt-3\">\n                        Select sources to generate study materials\n                      </p>\n                    )}\n\n                    {/* Quick access to generated materials */}\n                    {(flashcards.length > 0 || quizQuestions.length > 0 || studyGuide || faqItems.length > 0) && (\n                      <div className=\"mt-4 pt-3 border-t\">\n                        <p className=\"text-xs font-medium text-muted-foreground mb-2\">Generated Materials</p>\n                        <div className=\"space-y-1\">\n                          {flashcards.length > 0 && (\n                            <button\n                              onClick={() => { setActiveStudyType('flashcards'); setStudySheetOpen(true) }}\n                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"\n                            >\n                              <BookOpen className=\"h-4 w-4 text-blue-500\" />\n                              <span>{flashcards.length} Flashcards</span>\n                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />\n                            </button>\n                          )}\n                          {quizQuestions.length > 0 && (\n                            <button\n                              onClick={() => { setActiveStudyType('quiz'); setStudySheetOpen(true) }}\n                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"\n                            >\n                              <ListChecks className=\"h-4 w-4 text-purple-500\" />\n                              <span>{quizQuestions.length} Quiz Questions</span>\n                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />\n                            </button>\n                          )}\n                          {studyGuide && (\n                            <button\n                              onClick={() => { setActiveStudyType('guide'); setStudySheetOpen(true) }}\n                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"\n                            >\n                              <FileText className=\"h-4 w-4 text-orange-500\" />\n                              <span>Study Guide</span>\n                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />\n                            </button>\n                          )}\n                          {faqItems.length > 0 && (\n                            <button\n                              onClick={() => { setActiveStudyType('faq'); setStudySheetOpen(true) }}\n                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"\n                            >\n                              <HelpCircle className=\"h-4 w-4 text-teal-500\" />\n                              <span>{faqItems.length} FAQ Items</span>\n                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />\n                            </button>\n                          )}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n\n              {/* Notes Section */}\n              <div className=\"rounded-xl border bg-background overflow-hidden\">\n                <button\n                  onClick={() => setExpandedSection(expandedSection === 'notes' ? null : 'notes')}\n                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-amber-500/20 to-yellow-500/20 flex items-center justify-center\">\n                      <StickyNote className=\"h-4 w-4 text-amber-600\" />\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium text-sm\">Notes</p>\n                      <p className=\"text-xs text-muted-foreground\">{notes.length} saved</p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Dialog open={addNoteOpen} onOpenChange={setAddNoteOpen}>\n                      <DialogTrigger asChild>\n                        <Button\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          className=\"h-7 w-7 p-0\"\n                          onClick={(e) => e.stopPropagation()}\n                        >\n                          <Plus className=\"h-3.5 w-3.5\" />\n                        </Button>\n                      </DialogTrigger>\n                      <DialogContent>\n                        <DialogHeader>\n                          <DialogTitle>Create Note</DialogTitle>\n                          <DialogDescription>\n                            Write a new note to save your thoughts.\n                          </DialogDescription>\n                        </DialogHeader>\n                        <div className=\"space-y-4 mt-2\">\n                          <div className=\"space-y-2\">\n                            <label className=\"text-sm font-medium\">Title</label>\n                            <Input\n                              placeholder=\"Note title...\"\n                              value={noteTitle}\n                              onChange={(e) => setNoteTitle(e.target.value)}\n                            />\n                          </div>\n                          <div className=\"space-y-2\">\n                            <label className=\"text-sm font-medium\">Content</label>\n                            <Textarea\n                              placeholder=\"Write your note...\"\n                              value={noteContent}\n                              onChange={(e) => setNoteContent(e.target.value)}\n                              rows={6}\n                            />\n                          </div>\n                        </div>\n                        <DialogFooter className=\"mt-4\">\n                          <Button onClick={createNote} disabled={savingNote}>\n                            {savingNote && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                            Create Note\n                          </Button>\n                        </DialogFooter>\n                      </DialogContent>\n                    </Dialog>\n                    <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'notes' ? 'rotate-180' : ''}`} />\n                  </div>\n                </button>\n\n                {expandedSection === 'notes' && (\n                  <div className=\"px-4 pb-4 border-t bg-muted/20\">\n                    <div className=\"pt-4\">\n                      {notes.length === 0 ? (\n                        <div className=\"text-center py-6\">\n                          <StickyNote className=\"h-8 w-8 mx-auto mb-2 text-muted-foreground/50\" />\n                          <p className=\"text-sm text-muted-foreground\">No notes yet</p>\n                          <p className=\"text-xs text-muted-foreground mt-1\">Create notes or save chat responses</p>\n                        </div>\n                      ) : (\n                        <div className=\"space-y-2\">\n                          {notes.map((note) => (\n                            <div\n                              key={note.id}\n                              className=\"p-3 rounded-lg border bg-background group\"\n                            >\n                              <div className=\"flex items-start justify-between gap-2\">\n                                <div className=\"flex items-center gap-2 min-w-0\">\n                                  {note.is_pinned && <Pin className=\"h-3 w-3 text-amber-500 shrink-0\" />}\n                                  <span className=\"font-medium text-sm truncate\">\n                                    {note.title || 'Untitled'}\n                                  </span>\n                                </div>\n                                <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"h-6 w-6 p-0\"\n                                    onClick={() => togglePinNote(note)}\n                                  >\n                                    <Pin className={`h-3 w-3 ${note.is_pinned ? 'text-amber-500' : 'text-muted-foreground'}`} />\n                                  </Button>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"h-6 w-6 p-0\"\n                                    onClick={() => deleteNote(note.id)}\n                                  >\n                                    <Trash2 className=\"h-3 w-3 text-muted-foreground hover:text-destructive\" />\n                                  </Button>\n                                </div>\n                              </div>\n                              <p className=\"text-xs text-muted-foreground mt-1.5 line-clamp-2\">\n                                {note.content || 'No content'}\n                              </p>\n                              <div className=\"flex items-center gap-2 mt-2\">\n                                <Badge variant=\"outline\" className=\"text-[10px] font-normal px-1.5 py-0\">\n                                  {note.type === 'saved_response' ? 'Chat' : 'Note'}\n                                </Badge>\n                                <span className=\"text-[10px] text-muted-foreground\">\n                                  {new Date(note.created_at).toLocaleDateString()}\n                                </span>\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n\n            </div>\n          </ScrollArea>\n        </div>\n      </div>\n\n      {/* Study Materials Sheet */}\n      <Sheet open={studySheetOpen} onOpenChange={setStudySheetOpen}>\n        <SheetContent className=\"w-full sm:max-w-lg overflow-y-auto\">\n          <SheetHeader>\n            <SheetTitle className=\"flex items-center gap-2\">\n              {activeStudyType === 'flashcards' && <><BookOpen className=\"h-5 w-5 text-blue-500\" /> Flashcards</>}\n              {activeStudyType === 'quiz' && <><ListChecks className=\"h-5 w-5 text-purple-500\" /> Quiz</>}\n              {activeStudyType === 'guide' && <><FileText className=\"h-5 w-5 text-orange-500\" /> Study Guide</>}\n              {activeStudyType === 'faq' && <><HelpCircle className=\"h-5 w-5 text-teal-500\" /> FAQ</>}\n            </SheetTitle>\n            <SheetDescription>\n              {activeStudyType === 'flashcards' && `${flashcards.length} cards generated from your sources`}\n              {activeStudyType === 'quiz' && `${quizQuestions.length} questions to test your knowledge`}\n              {activeStudyType === 'guide' && 'Comprehensive study guide from your sources'}\n              {activeStudyType === 'faq' && `${faqItems.length} frequently asked questions`}\n            </SheetDescription>\n          </SheetHeader>\n\n          <div className=\"mt-6\">\n            {/* Flashcards View */}\n            {activeStudyType === 'flashcards' && flashcards.length > 0 && (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n                  <span>Card {currentFlashcard + 1} of {flashcards.length}</span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setCurrentFlashcard(0)\n                      setShowFlashcardBack(false)\n                    }}\n                  >\n                    <RotateCcw className=\"h-4 w-4 mr-1\" />\n                    Reset\n                  </Button>\n                </div>\n\n                <div\n                  onClick={() => setShowFlashcardBack(!showFlashcardBack)}\n                  className=\"min-h-[200px] p-6 rounded-xl border-2 bg-gradient-to-br from-background to-muted/30 cursor-pointer hover:shadow-lg transition-all flex flex-col justify-center\"\n                >\n                  <p className=\"text-xs font-medium text-muted-foreground mb-3 uppercase tracking-wide\">\n                    {showFlashcardBack ? 'Answer' : 'Question'}\n                  </p>\n                  <p className=\"text-lg leading-relaxed\">\n                    {showFlashcardBack ? flashcards[currentFlashcard]?.back : flashcards[currentFlashcard]?.front}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground mt-4\">Click to flip</p>\n                </div>\n\n                <div className=\"flex gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    className=\"flex-1\"\n                    disabled={currentFlashcard === 0}\n                    onClick={() => { setCurrentFlashcard(c => c - 1); setShowFlashcardBack(false) }}\n                  >\n                    Previous\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    className=\"flex-1\"\n                    disabled={currentFlashcard === flashcards.length - 1}\n                    onClick={() => { setCurrentFlashcard(c => c + 1); setShowFlashcardBack(false) }}\n                  >\n                    Next\n                  </Button>\n                </div>\n              </div>\n            )}\n\n            {/* Quiz View */}\n            {activeStudyType === 'quiz' && quizQuestions.length > 0 && (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n                  <span>Question {currentQuizQuestion + 1} of {quizQuestions.length}</span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setCurrentQuizQuestion(0)\n                      setSelectedAnswer(null)\n                      setShowQuizAnswer(false)\n                    }}\n                  >\n                    <RotateCcw className=\"h-4 w-4 mr-1\" />\n                    Reset\n                  </Button>\n                </div>\n\n                <div className=\"p-6 rounded-xl border bg-muted/30\">\n                  <p className=\"font-medium text-lg mb-4\">{quizQuestions[currentQuizQuestion]?.question}</p>\n\n                  <div className=\"space-y-2\">\n                    {quizQuestions[currentQuizQuestion]?.options.map((option, i) => (\n                      <button\n                        key={i}\n                        className={`\n                          w-full text-left p-4 rounded-lg border transition-all\n                          ${showQuizAnswer\n                            ? i === quizQuestions[currentQuizQuestion]?.correct_index\n                              ? 'bg-emerald-100 dark:bg-emerald-900/30 border-emerald-500'\n                              : selectedAnswer === i\n                              ? 'bg-red-100 dark:bg-red-900/30 border-red-500'\n                              : 'bg-muted/50'\n                            : selectedAnswer === i\n                            ? 'bg-primary/10 border-primary'\n                            : 'bg-background hover:bg-muted/50'\n                          }\n                        `}\n                        onClick={() => !showQuizAnswer && setSelectedAnswer(i)}\n                        disabled={showQuizAnswer}\n                      >\n                        {option}\n                      </button>\n                    ))}\n                  </div>\n\n                  {selectedAnswer !== null && !showQuizAnswer && (\n                    <Button\n                      className=\"w-full mt-4\"\n                      onClick={() => setShowQuizAnswer(true)}\n                    >\n                      Check Answer\n                    </Button>\n                  )}\n\n                  {showQuizAnswer && (\n                    <div className=\"mt-4 space-y-3\">\n                      <div className=\"p-4 rounded-lg bg-muted\">\n                        <p className=\"text-sm\">{quizQuestions[currentQuizQuestion]?.explanation}</p>\n                      </div>\n                      <Button\n                        className=\"w-full\"\n                        disabled={currentQuizQuestion === quizQuestions.length - 1}\n                        onClick={() => {\n                          setCurrentQuizQuestion(c => c + 1)\n                          setSelectedAnswer(null)\n                          setShowQuizAnswer(false)\n                        }}\n                      >\n                        Next Question\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Study Guide View */}\n            {activeStudyType === 'guide' && studyGuide && (\n              <div className=\"space-y-6\">\n                <h3 className=\"text-xl font-semibold\">{studyGuide.title}</h3>\n                {studyGuide.sections.map((section, i) => (\n                  <div key={i} className=\"space-y-2\">\n                    <h4 className=\"font-medium text-primary\">{section.heading}</h4>\n                    <p className=\"text-sm text-muted-foreground leading-relaxed whitespace-pre-wrap\">\n                      {section.content}\n                    </p>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {/* FAQ View */}\n            {activeStudyType === 'faq' && faqItems.length > 0 && (\n              <div className=\"space-y-4\">\n                {faqItems.map((item, i) => (\n                  <div key={i} className=\"p-4 rounded-xl border bg-muted/30\">\n                    <p className=\"font-medium mb-2\">Q: {item.question}</p>\n                    <p className=\"text-sm text-muted-foreground\">A: {item.answer}</p>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </SheetContent>\n      </Sheet>\n    </div>\n  )\n}\n","structuredPatch":[{"oldStart":7,"oldLines":18,"newStart":7,"newLines":20,"lines":[" import { Button } from '@/components/ui/button'"," import { Input } from '@/components/ui/input'"," import { Textarea } from '@/components/ui/textarea'","-import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'"," import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'"," import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'"," import { Badge } from '@/components/ui/badge'","-import { Separator } from '@/components/ui/separator'","-import { Progress } from '@/components/ui/progress'"," import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'","+import { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle, SheetTrigger } from '@/components/ui/sheet'","+import { ScrollArea } from '@/components/ui/scroll-area'","+import { Tooltip, TooltipContent, TooltipTrigger } from '@/components/ui/tooltip'"," import {","   ArrowLeft, Plus, Upload, FileText, Youtube, Link as LinkIcon,","   Type, Send, Loader2, CheckCircle, XCircle, Clock, Trash2,","   Mic, Video, Search, BookOpen, StickyNote, Sparkles, Pin,","-  Edit2, Save, X, AlertCircle, ChevronDown","+  Edit2, Save, X, AlertCircle, ChevronDown, ChevronRight,","+  MoreHorizontal, Copy, GraduationCap, HelpCircle, ListChecks,","+  Play, Pause, RotateCcw"," } from 'lucide-react'"," import { toast } from 'sonner'"," import { User } from '@supabase/supabase-js'"]},{"oldStart":100,"oldLines":9,"newStart":102,"newLines":13,"lines":["   const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null)","   const [showQuizAnswer, setShowQuizAnswer] = useState(false)"," ","-  // Studio tab state","-  const [studioTab, setStudioTab] = useState('audio')","+  // Studio accordion state","+  const [expandedSection, setExpandedSection] = useState<string | null>('audio')"," ","+  // Study materials sheet","+  const [studySheetOpen, setStudySheetOpen] = useState(false)","+  const [activeStudyType, setActiveStudyType] = useState<'flashcards' | 'quiz' | 'guide' | 'faq' | null>(null)","+","   // Source preview state","   const [viewingSource, setViewingSource] = useState<Source | null>(null)"," "]},{"oldStart":531,"oldLines":16,"newStart":537,"newLines":160,"lines":["     setResearching(false)","   }"," ","+  // Study material generation handlers","+  const handleGenerateFlashcards = async () => {","+    setGeneratingFlashcards(true)","+    try {","+      const { data: { session } } = await supabase.auth.getSession()","+      const response = await fetch(`/api/notebooks/${notebookId}/study`, {","+        method: 'POST',","+        headers: {","+          'Content-Type': 'application/json',","+          'Authorization': `Bearer ${session?.access_token}`,","+        },","+        body: JSON.stringify({","+          type: 'flashcards',","+          source_ids: Array.from(selectedSources),","+          count: 5,","+        }),","+      })","+      const result = await response.json()","+      if (result.error) {","+        toast.error(result.error)","+      } else if (result.data?.flashcards) {","+        setFlashcards(result.data.flashcards)","+        setCurrentFlashcard(0)","+        setShowFlashcardBack(false)","+        setActiveStudyType('flashcards')","+        setStudySheetOpen(true)","+        toast.success(`Generated ${result.data.flashcards.length} flashcards!`)","+      } else {","+        toast.error('Unexpected response')","+      }","+    } catch (err) {","+      console.error('Flashcards error:', err)","+      toast.error('Failed to generate flashcards')","+    } finally {","+      setGeneratingFlashcards(false)","+    }","+  }","+","+  const handleGenerateQuiz = async () => {","+    setGeneratingQuiz(true)","+    try {","+      const { data: { session } } = await supabase.auth.getSession()","+      const response = await fetch(`/api/notebooks/${notebookId}/study`, {","+        method: 'POST',","+        headers: {","+          'Content-Type': 'application/json',","+          'Authorization': `Bearer ${session?.access_token}`,","+        },","+        body: JSON.stringify({","+          type: 'quiz',","+          source_ids: Array.from(selectedSources),","+          count: 5,","+        }),","+      })","+      const result = await response.json()","+      if (result.error) {","+        toast.error(result.error)","+      } else if (result.data?.questions) {","+        setQuizQuestions(result.data.questions)","+        setCurrentQuizQuestion(0)","+        setSelectedAnswer(null)","+        setShowQuizAnswer(false)","+        setActiveStudyType('quiz')","+        setStudySheetOpen(true)","+        toast.success(`Generated ${result.data.questions.length} quiz questions!`)","+      } else {","+        toast.error('Unexpected response')","+      }","+    } catch (err) {","+      console.error('Quiz error:', err)","+      toast.error('Failed to generate quiz')","+    } finally {","+      setGeneratingQuiz(false)","+    }","+  }","+","+  const handleGenerateStudyGuide = async () => {","+    setGeneratingStudyGuide(true)","+    try {","+      const { data: { session } } = await supabase.auth.getSession()","+      const response = await fetch(`/api/notebooks/${notebookId}/study`, {","+        method: 'POST',","+        headers: {","+          'Content-Type': 'application/json',","+          'Authorization': `Bearer ${session?.access_token}`,","+        },","+        body: JSON.stringify({","+          type: 'study-guide',","+          source_ids: Array.from(selectedSources),","+        }),","+      })","+      const result = await response.json()","+      if (result.error) {","+        toast.error(result.error)","+      } else if (result.data?.sections) {","+        setStudyGuide(result.data)","+        setActiveStudyType('guide')","+        setStudySheetOpen(true)","+        toast.success('Study guide generated!')","+      } else {","+        toast.error('Unexpected response')","+      }","+    } catch (err) {","+      console.error('Study guide error:', err)","+      toast.error('Failed to generate study guide')","+    } finally {","+      setGeneratingStudyGuide(false)","+    }","+  }","+","+  const handleGenerateFaq = async () => {","+    setGeneratingFaq(true)","+    try {","+      const { data: { session } } = await supabase.auth.getSession()","+      const response = await fetch(`/api/notebooks/${notebookId}/study`, {","+        method: 'POST',","+        headers: {","+          'Content-Type': 'application/json',","+          'Authorization': `Bearer ${session?.access_token}`,","+        },","+        body: JSON.stringify({","+          type: 'faq',","+          source_ids: Array.from(selectedSources),","+        }),","+      })","+      const result = await response.json()","+      if (result.error) {","+        toast.error(result.error)","+      } else if (result.data?.faq) {","+        setFaqItems(result.data.faq)","+        setActiveStudyType('faq')","+        setStudySheetOpen(true)","+        toast.success(`Generated ${result.data.faq.length} FAQ items!`)","+      } else {","+        toast.error('Unexpected response')","+      }","+    } catch (err) {","+      console.error('FAQ error:', err)","+      toast.error('Failed to generate FAQ')","+    } finally {","+      setGeneratingFaq(false)","+    }","+  }","+","   const getStatusIcon = (status: string) => {","     switch (status) {","       case 'ready':","-        return <CheckCircle className=\"h-4 w-4 text-green-500\" />","+        return <CheckCircle className=\"h-3.5 w-3.5 text-emerald-500\" />","       case 'processing':","-        return <Clock className=\"h-4 w-4 text-yellow-500 animate-spin\" />","+        return <Clock className=\"h-3.5 w-3.5 text-amber-500 animate-spin\" />","       case 'failed':","-        return <XCircle className=\"h-4 w-4 text-red-500\" />","+        return <XCircle className=\"h-3.5 w-3.5 text-red-500\" />","       default:","-        return <Clock className=\"h-4 w-4 text-muted-foreground\" />","+        return <Clock className=\"h-3.5 w-3.5 text-muted-foreground\" />","     }","   }"," "]},{"oldStart":549,"oldLines":75,"newStart":699,"newLines":100,"lines":["       case 'pdf':","       case 'docx':","       case 'txt':","-        return <FileText className=\"h-4 w-4\" />","+        return <FileText className=\"h-4 w-4 text-blue-500\" />","       case 'youtube':","-        return <Youtube className=\"h-4 w-4\" />","+        return <Youtube className=\"h-4 w-4 text-red-500\" />","       case 'url':","-        return <LinkIcon className=\"h-4 w-4\" />","+        return <LinkIcon className=\"h-4 w-4 text-violet-500\" />","       case 'text':","-        return <Type className=\"h-4 w-4\" />","+        return <Type className=\"h-4 w-4 text-slate-500\" />","       default:","-        return <FileText className=\"h-4 w-4\" />","+        return <FileText className=\"h-4 w-4 text-slate-500\" />","     }","   }"," ","   if (loading) {","     return (","-      <div className=\"min-h-screen flex items-center justify-center\">","-        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />","+      <div className=\"min-h-screen flex items-center justify-center bg-background\">","+        <div className=\"flex flex-col items-center gap-3\">","+          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />","+          <p className=\"text-sm text-muted-foreground\">Loading notebook...</p>","+        </div>","       </div>","     )","   }"," ","   return (","-    <div className=\"h-screen flex flex-col overflow-hidden\">","-      {/* Header */}","-      <header className=\"border-b px-4 py-3 flex items-center gap-4 shrink-0\">","-        <Button variant=\"ghost\" size=\"sm\" onClick={() => router.push('/')}>","-          <ArrowLeft className=\"h-4 w-4 mr-2\" />","-          Back","+    <div className=\"h-screen flex flex-col bg-background\">","+      {/* Clean Header */}","+      <header className=\"h-14 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 px-4 flex items-center gap-4 shrink-0 sticky top-0 z-50\">","+        <Button","+          variant=\"ghost\"","+          size=\"sm\"","+          onClick={() => router.push('/')}","+          className=\"text-muted-foreground hover:text-foreground -ml-2\"","+        >","+          <ArrowLeft className=\"h-4 w-4\" />","         </Button>","-        <Separator orientation=\"vertical\" className=\"h-6\" />","-        <div className=\"flex items-center gap-2\">","+","+        <div className=\"flex items-center gap-3\">","           <span className=\"text-xl\">{notebook?.emoji}</span>","-          <h1 className=\"font-semibold\">{notebook?.name}</h1>","+          <h1 className=\"font-semibold text-lg tracking-tight\">{notebook?.name}</h1>","         </div>","-        <Badge variant=\"secondary\">{sources.length} sources</Badge>","-        <div className=\"ml-auto flex items-center gap-2\">","-          <Badge variant=\"outline\" className=\"text-xs\">","-            {selectedSources.size} selected","+","+        <div className=\"flex items-center gap-2 ml-auto\">","+          <Badge variant=\"secondary\" className=\"font-normal text-xs px-2.5 py-0.5\">","+            {sources.length} {sources.length === 1 ? 'source' : 'sources'}","           </Badge>","+          {selectedSources.size > 0 && (","+            <Badge className=\"bg-primary/10 text-primary border-0 font-normal text-xs px-2.5 py-0.5\">","+              {selectedSources.size} selected","+            </Badge>","+          )}","         </div>","       </header>"," ","       {/* Three Panel Layout */}","-      <div className=\"flex-1 grid grid-cols-[256px_1fr_320px] overflow-hidden\">","+      <div className=\"flex-1 grid grid-cols-[280px_1fr_340px] overflow-hidden\">","+","         {/* Left Panel - Sources */}","-        <div className=\"border-r flex flex-col bg-background h-full min-h-0\">","-          <div className=\"p-4 border-b shrink-0\">","-            <div className=\"flex items-center justify-between mb-2\">","-              <h2 className=\"font-semibold\">Sources</h2>","+        <div className=\"border-r bg-muted/30 flex flex-col h-full\">","+          <div className=\"p-4 border-b bg-background\">","+            <div className=\"flex items-center justify-between mb-3\">","+              <h2 className=\"font-semibold text-sm text-foreground\">Sources</h2>","               <Dialog open={addSourceOpen} onOpenChange={setAddSourceOpen}>","                 <DialogTrigger asChild>","-                  <Button size=\"sm\" variant=\"outline\">","-                    <Plus className=\"h-4 w-4\" />","+                  <Button size=\"sm\" variant=\"outline\" className=\"h-7 w-7 p-0\">","+                    <Plus className=\"h-3.5 w-3.5\" />","                   </Button>","                 </DialogTrigger>","-                <DialogContent>","+                <DialogContent className=\"sm:max-w-md\">","                   <DialogHeader>","                     <DialogTitle>Add Source</DialogTitle>","                     <DialogDescription>","-                      Add documents, URLs, or text to your notebook","+                      Add documents, URLs, or text to your notebook for AI analysis.","                     </DialogDescription>","                   </DialogHeader>","-                  <Tabs value={sourceType} onValueChange={(v) => setSourceType(v as typeof sourceType)}>","+                  <Tabs value={sourceType} onValueChange={(v) => setSourceType(v as typeof sourceType)} className=\"mt-2\">","                     <TabsList className=\"grid grid-cols-4 w-full\">","-                      <TabsTrigger value=\"file\"><Upload className=\"h-4 w-4\" /></TabsTrigger>","-                      <TabsTrigger value=\"youtube\"><Youtube className=\"h-4 w-4\" /></TabsTrigger>","-                      <TabsTrigger value=\"url\"><LinkIcon className=\"h-4 w-4\" /></TabsTrigger>","-                      <TabsTrigger value=\"text\"><Type className=\"h-4 w-4\" /></TabsTrigger>","+                      <TabsTrigger value=\"file\" className=\"text-xs\">","+                        <Upload className=\"h-3.5 w-3.5 mr-1.5\" />","+                        File","+                      </TabsTrigger>","+                      <TabsTrigger value=\"youtube\" className=\"text-xs\">","+                        <Youtube className=\"h-3.5 w-3.5 mr-1.5\" />","+                        YouTube","+                      </TabsTrigger>","+                      <TabsTrigger value=\"url\" className=\"text-xs\">","+                        <LinkIcon className=\"h-3.5 w-3.5 mr-1.5\" />","+                        URL","+                      </TabsTrigger>","+                      <TabsTrigger value=\"text\" className=\"text-xs\">","+                        <Type className=\"h-3.5 w-3.5 mr-1.5\" />","+                        Text","+                      </TabsTrigger>","                     </TabsList>","-                    <TabsContent value=\"file\" className=\"space-y-4\">","+                    <TabsContent value=\"file\" className=\"space-y-4 mt-4\">","                       <input","                         ref={fileInputRef}","                         type=\"file\""]},{"oldStart":625,"oldLines":64,"newStart":800,"newLines":87,"lines":["                         onChange={handleFileUpload}","                         className=\"hidden\"","                       />","-                      <Button","-                        variant=\"outline\"","-                        className=\"w-full h-24\"","+                      <button","                         onClick={() => fileInputRef.current?.click()}","                         disabled={uploading}","+                        className=\"w-full h-32 border-2 border-dashed rounded-lg flex flex-col items-center justify-center gap-2 hover:border-primary/50 hover:bg-muted/50 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"","                       >","                         {uploading ? (","-                          <Loader2 className=\"h-6 w-6 animate-spin\" />","+                          <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />","                         ) : (","-                          <div className=\"text-center\">","-                            <Upload className=\"h-6 w-6 mx-auto mb-2\" />","-                            <p className=\"text-sm\">Click to upload</p>","-                            <p className=\"text-xs text-muted-foreground\">PDF, DOCX, TXT</p>","-                          </div>","+                          <>","+                            <Upload className=\"h-8 w-8 text-muted-foreground\" />","+                            <div className=\"text-center\">","+                              <p className=\"text-sm font-medium\">Click to upload</p>","+                              <p className=\"text-xs text-muted-foreground mt-0.5\">PDF, DOCX, TXT, or MD</p>","+                            </div>","+                          </>","                         )}","-                      </Button>","+                      </button>","                     </TabsContent>","-                    <TabsContent value=\"youtube\" className=\"space-y-4\">","-                      <Input","-                        placeholder=\"YouTube URL\"","-                        value={sourceInput}","-                        onChange={(e) => setSourceInput(e.target.value)}","-                      />","-                      <Input","-                        placeholder=\"Name (optional)\"","-                        value={sourceName}","-                        onChange={(e) => setSourceName(e.target.value)}","-                      />","+                    <TabsContent value=\"youtube\" className=\"space-y-3 mt-4\">","+                      <div className=\"space-y-2\">","+                        <label className=\"text-sm font-medium\">YouTube URL</label>","+                        <Input","+                          placeholder=\"https://youtube.com/watch?v=...\"","+                          value={sourceInput}","+                          onChange={(e) => setSourceInput(e.target.value)}","+                        />","+                      </div>","+                      <div className=\"space-y-2\">","+                        <label className=\"text-sm font-medium\">Name (optional)</label>","+                        <Input","+                          placeholder=\"My video\"","+                          value={sourceName}","+                          onChange={(e) => setSourceName(e.target.value)}","+                        />","+                      </div>","                     </TabsContent>","-                    <TabsContent value=\"url\" className=\"space-y-4\">","-                      <Input","-                        placeholder=\"Website URL\"","-                        value={sourceInput}","-                        onChange={(e) => setSourceInput(e.target.value)}","-                      />","-                      <Input","-                        placeholder=\"Name (optional)\"","-                        value={sourceName}","-                        onChange={(e) => setSourceName(e.target.value)}","-                      />","+                    <TabsContent value=\"url\" className=\"space-y-3 mt-4\">","+                      <div className=\"space-y-2\">","+                        <label className=\"text-sm font-medium\">Website URL</label>","+                        <Input","+                          placeholder=\"https://example.com/article\"","+                          value={sourceInput}","+                          onChange={(e) => setSourceInput(e.target.value)}","+                        />","+                      </div>","+                      <div className=\"space-y-2\">","+                        <label className=\"text-sm font-medium\">Name (optional)</label>","+                        <Input","+                          placeholder=\"Article name\"","+                          value={sourceName}","+                          onChange={(e) => setSourceName(e.target.value)}","+                        />","+                      </div>","                     </TabsContent>","-                    <TabsContent value=\"text\" className=\"space-y-4\">","-                      <Input","-                        placeholder=\"Name\"","-                        value={sourceName}","-                        onChange={(e) => setSourceName(e.target.value)}","-                      />","-                      <Textarea","-                        placeholder=\"Paste your text here...\"","-                        value={sourceInput}","-                        onChange={(e) => setSourceInput(e.target.value)}","-                        rows={6}","-                      />","+                    <TabsContent value=\"text\" className=\"space-y-3 mt-4\">","+                      <div className=\"space-y-2\">","+                        <label className=\"text-sm font-medium\">Name</label>","+                        <Input","+                          placeholder=\"My notes\"","+                          value={sourceName}","+                          onChange={(e) => setSourceName(e.target.value)}","+                        />","+                      </div>","+                      <div className=\"space-y-2\">","+                        <label className=\"text-sm font-medium\">Content</label>","+                        <Textarea","+                          placeholder=\"Paste your text here...\"","+                          value={sourceInput}","+                          onChange={(e) => setSourceInput(e.target.value)}","+                          rows={6}","+                        />","+                      </div>","                     </TabsContent>","                   </Tabs>","                   {sourceType !== 'file' && (","-                    <DialogFooter>","-                      <Button onClick={addSource} disabled={uploading || !sourceInput.trim()}>","+                    <DialogFooter className=\"mt-4\">","+                      <Button","+                        onClick={addSource}","+                        disabled={uploading || !sourceInput.trim()}","+                        className=\"w-full sm:w-auto\"","+                      >","                         {uploading && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}","                         Add Source","                       </Button>"]},{"oldStart":691,"oldLines":194,"newStart":889,"newLines":270,"lines":["                 </DialogContent>","               </Dialog>","             </div>","+","             {sources.length > 0 && (","-              <Button","-                variant=\"ghost\"","-                size=\"sm\"","-                className=\"w-full justify-start text-xs\"","+              <button","                 onClick={selectAllSources}","+                className=\"text-xs text-muted-foreground hover:text-foreground transition-colors\"","               >","-                {selectedSources.size === sources.length ? 'Deselect All' : 'Select All'}","-              </Button>","+                {selectedSources.size === sources.length ? 'Deselect all' : 'Select all'}","+              </button>","             )}","           </div>","-          <div className=\"flex-1 min-h-0 overflow-y-auto\">","-            <div className=\"p-2 space-y-1\">","+","+          <ScrollArea className=\"flex-1\">","+            <div className=\"p-2\">","               {sources.length === 0 ? (","-                <div className=\"text-center py-8 text-muted-foreground\">","-                  <FileText className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />","-                  <p className=\"text-sm\">No sources yet</p>","-                  <p className=\"text-xs\">Add documents to get started</p>","+                <div className=\"text-center py-12 px-4\">","+                  <div className=\"w-12 h-12 rounded-full bg-muted flex items-center justify-center mx-auto mb-3\">","+                    <FileText className=\"h-5 w-5 text-muted-foreground\" />","+                  </div>","+                  <p className=\"text-sm font-medium text-foreground mb-1\">No sources yet</p>","+                  <p className=\"text-xs text-muted-foreground\">Add documents to start analyzing</p>","                 </div>","               ) : (","-                sources.map((source) => (","-                  <div","-                    key={source.id}","-                    className={`p-2 rounded-lg flex items-center gap-2 group ${","-                      selectedSources.has(source.id) ? 'bg-primary/10' : 'hover:bg-muted'","-                    } ${viewingSource?.id === source.id ? 'ring-2 ring-primary' : ''}`}","-                  >","-                    <input","-                      type=\"checkbox\"","-                      checked={selectedSources.has(source.id)}","-                      onChange={() => toggleSource(source.id)}","-                      className=\"rounded cursor-pointer\"","-                    />","-                    {getSourceIcon(source.type)}","-                    <span","-                      className=\"flex-1 text-sm truncate cursor-pointer hover:underline select-text\"","-                      onClick={() => setViewingSource(source)}","+                <div className=\"space-y-1\">","+                  {sources.map((source) => (","+                    <div","+                      key={source.id}","+                      className={`","+                        group relative flex items-center gap-2.5 px-3 py-2.5 rounded-lg cursor-pointer","+                        transition-all duration-150","+                        ${selectedSources.has(source.id)","+                          ? 'bg-primary/10 ring-1 ring-primary/20'","+                          : 'hover:bg-muted'","+                        }","+                        ${viewingSource?.id === source.id ? 'ring-2 ring-primary' : ''}","+                      `}","+                      onClick={() => toggleSource(source.id)}","                     >","-                      {source.name}","-                    </span>","-                    {getStatusIcon(source.status)}","-                    <Button","-                      variant=\"ghost\"","-                      size=\"sm\"","-                      className=\"opacity-0 group-hover:opacity-100 h-6 w-6 p-0\"","-                      onClick={() => deleteSource(source.id)}","-                    >","-                      <Trash2 className=\"h-3 w-3\" />","-                    </Button>","-                  </div>","-                ))","+                      <div className={`","+                        w-4 h-4 rounded border-2 flex items-center justify-center shrink-0","+                        transition-colors duration-150","+                        ${selectedSources.has(source.id)","+                          ? 'bg-primary border-primary'","+                          : 'border-muted-foreground/30 group-hover:border-muted-foreground/50'","+                        }","+                      `}>","+                        {selectedSources.has(source.id) && (","+                          <CheckCircle className=\"h-3 w-3 text-primary-foreground\" />","+                        )}","+                      </div>","+","+                      {getSourceIcon(source.type)}","+","+                      <span","+                        className=\"flex-1 text-sm truncate\"","+                        onClick={(e) => {","+                          e.stopPropagation()","+                          setViewingSource(source)","+                        }}","+                      >","+                        {source.name}","+                      </span>","+","+                      {getStatusIcon(source.status)}","+","+                      <Button","+                        variant=\"ghost\"","+                        size=\"sm\"","+                        className=\"opacity-0 group-hover:opacity-100 h-6 w-6 p-0 transition-opacity\"","+                        onClick={(e) => {","+                          e.stopPropagation()","+                          deleteSource(source.id)","+                        }}","+                      >","+                        <Trash2 className=\"h-3 w-3 text-muted-foreground hover:text-destructive\" />","+                      </Button>","+                    </div>","+                  ))}","+                </div>","               )}","             </div>","-          </div>","+          </ScrollArea>","         </div>"," ","-        {/* Center Panel - Chat or Source Preview */}","-        <div className=\"flex flex-col h-full min-h-0\">","-          {/* Source Preview */}","+        {/* Center Panel - Chat */}","+        <div className=\"flex flex-col h-full bg-background\">","+          {/* Source Preview Banner */}","           {viewingSource && (","-            <div className=\"border-b bg-muted/30 shrink-0\">","-              <div className=\"max-w-3xl mx-auto p-4\">","-                <div className=\"flex items-center justify-between mb-3\">","-                  <div className=\"flex items-center gap-2\">","-                    {getSourceIcon(viewingSource.type)}","-                    <h3 className=\"font-medium\">{viewingSource.name}</h3>","-                    <Badge variant=\"outline\" className=\"text-xs\">{viewingSource.type}</Badge>","+            <div className=\"border-b bg-muted/50 px-6 py-4\">","+              <div className=\"max-w-3xl mx-auto\">","+                <div className=\"flex items-start justify-between gap-4\">","+                  <div className=\"flex items-start gap-3 min-w-0\">","+                    <div className=\"p-2 rounded-lg bg-background border shrink-0\">","+                      {getSourceIcon(viewingSource.type)}","+                    </div>","+                    <div className=\"min-w-0\">","+                      <h3 className=\"font-medium text-sm truncate\">{viewingSource.name}</h3>","+                      <div className=\"flex items-center gap-2 mt-1\">","+                        <Badge variant=\"outline\" className=\"text-xs font-normal capitalize\">","+                          {viewingSource.type}","+                        </Badge>","+                        {viewingSource.file_size_bytes && (","+                          <span className=\"text-xs text-muted-foreground\">","+                            {(viewingSource.file_size_bytes / 1024).toFixed(1)} KB","+                          </span>","+                        )}","+                      </div>","+                    </div>","                   </div>","-                  <Button variant=\"ghost\" size=\"sm\" onClick={() => setViewingSource(null)}>","+                  <Button","+                    variant=\"ghost\"","+                    size=\"sm\"","+                    onClick={() => setViewingSource(null)}","+                    className=\"shrink-0 h-8 w-8 p-0\"","+                  >","                     <X className=\"h-4 w-4\" />","                   </Button>","                 </div>","-                <div className=\"bg-background rounded-lg border p-4 max-h-48 overflow-y-auto\">","-                  {viewingSource.type === 'text' && viewingSource.metadata?.content ? (","-                    <p className=\"text-sm whitespace-pre-wrap select-text\">{viewingSource.metadata.content}</p>","-                  ) : viewingSource.type === 'youtube' && viewingSource.metadata?.url ? (","-                    <div className=\"space-y-2\">","-                      <p className=\"text-sm text-muted-foreground\">YouTube URL:</p>","-                      <a href={viewingSource.metadata.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-sm text-primary hover:underline break-all select-text\">","+","+                {(viewingSource.type === 'text' && viewingSource.metadata?.content) ||","+                 (viewingSource.type === 'youtube' && viewingSource.metadata?.url) ||","+                 (viewingSource.type === 'url' && viewingSource.metadata?.url) ? (","+                  <div className=\"mt-3 p-3 rounded-lg bg-background border text-sm max-h-32 overflow-y-auto\">","+                    {viewingSource.type === 'text' ? (","+                      <p className=\"whitespace-pre-wrap text-muted-foreground\">{viewingSource.metadata.content}</p>","+                    ) : (","+                      <a","+                        href={viewingSource.metadata.url}","+                        target=\"_blank\"","+                        rel=\"noopener noreferrer\"","+                        className=\"text-primary hover:underline break-all\"","+                      >","                         {viewingSource.metadata.url}","                       </a>","-                    </div>","-                  ) : viewingSource.type === 'url' && viewingSource.metadata?.url ? (","-                    <div className=\"space-y-2\">","-                      <p className=\"text-sm text-muted-foreground\">Website URL:</p>","-                      <a href={viewingSource.metadata.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-sm text-primary hover:underline break-all select-text\">","-                        {viewingSource.metadata.url}","-                      </a>","-                    </div>","-                  ) : viewingSource.file_path ? (","-                    <div className=\"space-y-2\">","-                      <p className=\"text-sm text-muted-foreground\">File: {viewingSource.original_filename || viewingSource.name}</p>","-                      <p className=\"text-xs text-muted-foreground\">Size: {viewingSource.file_size_bytes ? `${(viewingSource.file_size_bytes / 1024).toFixed(1)} KB` : 'Unknown'}</p>","-                    </div>","-                  ) : (","-                    <p className=\"text-sm text-muted-foreground\">No preview available</p>","-                  )}","-                </div>","+                    )}","+                  </div>","+                ) : null}","               </div>","             </div>","           )}"," ","-          <div className=\"flex-1 min-h-0 overflow-y-auto p-4\">","-            <div className=\"max-w-3xl mx-auto space-y-4\">","+          {/* Messages */}","+          <ScrollArea className=\"flex-1\">","+            <div className=\"max-w-3xl mx-auto px-6 py-6\">","               {messages.length === 0 ? (","-                <div className=\"text-center py-16\">","-                  <Sparkles className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />","-                  <h3 className=\"text-lg font-medium mb-2\">Start a Conversation</h3>","-                  <p className=\"text-muted-foreground mb-4\">","-                    Ask questions about your sources","+                <div className=\"flex flex-col items-center justify-center min-h-[400px] text-center\">","+                  <div className=\"w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center mb-6\">","+                    <Sparkles className=\"h-7 w-7 text-primary\" />","+                  </div>","+                  <h3 className=\"text-xl font-semibold mb-2\">Start a conversation</h3>","+                  <p className=\"text-muted-foreground mb-8 max-w-sm\">","+                    Ask questions about your sources and get AI-powered insights with citations.","                   </p>","-                  <div className=\"flex flex-wrap justify-center gap-2\">","-                    {['Summarize the main points', 'What are the key takeaways?', 'Explain the methodology'].map((q) => (","-                      <Button","+                  <div className=\"flex flex-wrap justify-center gap-2 max-w-lg\">","+                    {['Summarize the key points', 'What are the main takeaways?', 'Explain the methodology'].map((q) => (","+                      <button","                         key={q}","-                        variant=\"outline\"","-                        size=\"sm\"","                         onClick={() => setMessage(q)}","+                        className=\"px-4 py-2 text-sm rounded-full border bg-background hover:bg-muted transition-colors\"","                       >","                         {q}","-                      </Button>","+                      </button>","                     ))}","                   </div>","                 </div>","               ) : (","-                messages.map((msg) => (","-                  <div","-                    key={msg.id}","-                    className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}","-                  >","+                <div className=\"space-y-6\">","+                  {messages.map((msg) => (","                     <div","-                      className={`max-w-[80%] rounded-2xl px-4 py-3 ${","-                        msg.role === 'user'","-                          ? 'bg-primary text-primary-foreground'","-                          : 'bg-muted'","-                      }`}","+                      key={msg.id}","+                      className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}","                     >","-                      <p className=\"whitespace-pre-wrap text-sm select-text\">{msg.content}</p>","-                      {msg.role === 'assistant' && (","-                        <div className=\"flex items-center gap-2 mt-2 pt-2 border-t border-border/50\">","-                          {msg.cost_usd !== null && msg.cost_usd > 0 && (","-                            <span className=\"text-xs opacity-70\">","-                              Cost: ${msg.cost_usd.toFixed(4)}","-                            </span>","-                          )}","-                          <Button","-                            variant=\"ghost\"","-                            size=\"sm\"","-                            className=\"h-6 text-xs ml-auto\"","-                            onClick={() => saveResponseAsNote(msg)}","-                          >","-                            <StickyNote className=\"h-3 w-3 mr-1\" />","-                            Save","-                          </Button>","+                      <div","+                        className={`","+                          max-w-[85%] rounded-2xl px-4 py-3","+                          ${msg.role === 'user'","+                            ? 'bg-primary text-primary-foreground rounded-br-md'","+                            : 'bg-muted rounded-bl-md'","+                          }","+                        `}","+                      >","+                        <p className=\"whitespace-pre-wrap text-[15px] leading-relaxed\">{msg.content}</p>","+                        {msg.role === 'assistant' && (","+                          <div className=\"flex items-center gap-3 mt-3 pt-3 border-t border-border/50\">","+                            {msg.cost_usd !== null && msg.cost_usd > 0 && (","+                              <span className=\"text-xs text-muted-foreground\">","+                                ${msg.cost_usd.toFixed(4)}","+                              </span>","+                            )}","+                            <div className=\"flex items-center gap-1 ml-auto\">","+                              <Tooltip>","+                                <TooltipTrigger asChild>","+                                  <Button","+                                    variant=\"ghost\"","+                                    size=\"sm\"","+                                    className=\"h-7 w-7 p-0\"","+                                    onClick={() => navigator.clipboard.writeText(msg.content)}","+                                  >","+                                    <Copy className=\"h-3.5 w-3.5\" />","+                                  </Button>","+                                </TooltipTrigger>","+                                <TooltipContent>Copy</TooltipContent>","+                              </Tooltip>","+                              <Tooltip>","+                                <TooltipTrigger asChild>","+                                  <Button","+                                    variant=\"ghost\"","+                                    size=\"sm\"","+                                    className=\"h-7 w-7 p-0\"","+                                    onClick={() => saveResponseAsNote(msg)}","+                                  >","+                                    <StickyNote className=\"h-3.5 w-3.5\" />","+                                  </Button>","+                                </TooltipTrigger>","+                                <TooltipContent>Save as note</TooltipContent>","+                              </Tooltip>","+                            </div>","+                          </div>","+                        )}","+                      </div>","+                    </div>","+                  ))}","+                  {sending && (","+                    <div className=\"flex justify-start\">","+                      <div className=\"bg-muted rounded-2xl rounded-bl-md px-4 py-3\">","+                        <div className=\"flex items-center gap-2\">","+                          <Loader2 className=\"h-4 w-4 animate-spin\" />","+                          <span className=\"text-sm text-muted-foreground\">Thinking...</span>","                         </div>","-                      )}","+                      </div>","                     </div>","-                  </div>","-                ))","-              )}","-              {sending && (","-                <div className=\"flex justify-start\">","-                  <div className=\"bg-muted rounded-2xl px-4 py-3\">","-                    <Loader2 className=\"h-5 w-5 animate-spin\" />","-                  </div>","+                  )}","+                  <div ref={messagesEndRef} />","                 </div>","               )}","-              <div ref={messagesEndRef} />","             </div>","-          </div>","-          <div className=\"p-4 border-t shrink-0\">","+          </ScrollArea>","+","+          {/* Chat Input */}","+          <div className=\"border-t bg-background p-4\">","             <div className=\"max-w-3xl mx-auto\">","               {selectedSources.size === 0 && sources.length > 0 && (","-                <div className=\"flex items-center gap-2 mb-2 text-xs text-amber-600 bg-amber-50 dark:bg-amber-900/20 p-2 rounded-lg\">","-                  <AlertCircle className=\"h-4 w-4\" />","-                  Select sources from the left panel for contextual answers","+                <div className=\"flex items-center gap-2 mb-3 px-3 py-2 text-sm text-amber-700 dark:text-amber-400 bg-amber-50 dark:bg-amber-950/30 rounded-lg border border-amber-200 dark:border-amber-800/50\">","+                  <AlertCircle className=\"h-4 w-4 shrink-0\" />","+                  <span>Select sources from the left panel for contextual answers</span>","                 </div>","               )}","-              <div className=\"flex gap-2\">","-                <Input","-                  placeholder=\"Ask a question about your sources...\"","-                  value={message}","-                  onChange={(e) => setMessage(e.target.value)}","-                  onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && sendMessage()}","-                  disabled={sending}","-                />","-                <Button onClick={sendMessage} disabled={sending || !message.trim()}>","-                  <Send className=\"h-4 w-4\" />","+              <div className=\"flex items-center gap-3\">","+                <div className=\"flex-1 relative\">","+                  <Input","+                    placeholder=\"Ask a question about your sources...\"","+                    value={message}","+                    onChange={(e) => setMessage(e.target.value)}","+                    onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && sendMessage()}","+                    disabled={sending}","+                    className=\"pr-12 h-12 text-[15px] rounded-xl border-muted-foreground/20 focus:border-primary\"","+                  />","+                </div>","+                <Button","+                  onClick={sendMessage}","+                  disabled={sending || !message.trim()}","+                  size=\"lg\"","+                  className=\"h-12 w-12 rounded-xl shrink-0\"","+                >","+                  <Send className=\"h-5 w-5\" />","                 </Button>","               </div>","             </div>"]},{"oldStart":886,"oldLines":645,"newStart":1160,"newLines":639,"lines":["         </div>"," ","         {/* Right Panel - Studio */}","-        <div className=\"border-l flex flex-col bg-background h-full min-h-0\">","-          <Tabs value={studioTab} onValueChange={setStudioTab} className=\"flex flex-col h-full min-h-0\">","-            <div className=\"p-4 border-b shrink-0\">","-              <h2 className=\"font-semibold mb-2\">Studio</h2>","-              <TabsList className=\"grid grid-cols-3 w-full\">","-                <TabsTrigger value=\"audio\" className=\"text-xs\">","-                  <Mic className=\"h-3 w-3 mr-1\" />","-                  Audio","-                </TabsTrigger>","-                <TabsTrigger value=\"study\" className=\"text-xs\">","-                  <BookOpen className=\"h-3 w-3 mr-1\" />","-                  Study","-                </TabsTrigger>","-                <TabsTrigger value=\"notes\" className=\"text-xs\">","-                  <StickyNote className=\"h-3 w-3 mr-1\" />","-                  Notes","-                </TabsTrigger>","-              </TabsList>","-            </div>","+        <div className=\"border-l bg-muted/30 flex flex-col h-full\">","+          <div className=\"p-4 border-b bg-background\">","+            <h2 className=\"font-semibold text-sm\">Studio</h2>","+            <p className=\"text-xs text-muted-foreground mt-0.5\">Create content from your sources</p>","+          </div>"," ","-            <div className=\"flex-1 min-h-0 overflow-y-auto p-4\">","-              <TabsContent value=\"audio\" className=\"mt-0 space-y-4\">","-                <Card>","-                  <CardHeader className=\"pb-2\">","-                    <CardTitle className=\"text-sm flex items-center gap-2\">","-                      <Mic className=\"h-4 w-4\" />","-                      Audio Overview","-                    </CardTitle>","-                    <CardDescription className=\"text-xs\">","-                      Generate a podcast-style discussion","-                    </CardDescription>","-                  </CardHeader>","-                  <CardContent className=\"space-y-3\">","-                    <div>","-                      <label className=\"text-xs font-medium mb-1 block\">Format</label>","-                      <Select value={audioFormat} onValueChange={setAudioFormat}>","-                        <SelectTrigger className=\"h-8 text-xs\">","-                          <SelectValue />","-                        </SelectTrigger>","-                        <SelectContent>","-                          <SelectItem value=\"deep_dive\">Deep Dive (10-15 min)</SelectItem>","-                          <SelectItem value=\"brief\">Brief Summary (2-3 min)</SelectItem>","-                          <SelectItem value=\"critique\">Analytical Discussion (5-10 min)</SelectItem>","-                          <SelectItem value=\"debate\">Debate Format (8-15 min)</SelectItem>","-                        </SelectContent>","-                      </Select>","+          <ScrollArea className=\"flex-1\">","+            <div className=\"p-3 space-y-2\">","+","+              {/* Audio Overview Section */}","+              <div className=\"rounded-xl border bg-background overflow-hidden\">","+                <button","+                  onClick={() => setExpandedSection(expandedSection === 'audio' ? null : 'audio')}","+                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"","+                >","+                  <div className=\"flex items-center gap-3\">","+                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-orange-500/20 to-red-500/20 flex items-center justify-center\">","+                      <Mic className=\"h-4 w-4 text-orange-600\" />","                     </div>","-                    <div>","-                      <label className=\"text-xs font-medium mb-1 block\">Custom Instructions</label>","-                      <Textarea","-                        placeholder=\"Optional instructions for the hosts...\"","-                        value={audioInstructions}","-                        onChange={(e) => setAudioInstructions(e.target.value)}","-                        rows={2}","-                        className=\"text-xs\"","-                      />","+                    <div className=\"text-left\">","+                      <p className=\"font-medium text-sm\">Audio Overview</p>","+                      <p className=\"text-xs text-muted-foreground\">Podcast-style discussion</p>","                     </div>","-                    <Button","-                      className=\"w-full\"","-                      size=\"sm\"","-                      onClick={generateAudio}","-                      disabled={generatingAudio || selectedSources.size === 0}","-                    >","-                      {generatingAudio ? (","-                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />","-                      ) : (","-                        <Mic className=\"h-4 w-4 mr-2\" />","-                      )}","-                      Generate Audio","-                    </Button>","-                    {selectedSources.size === 0 && (","-                      <p className=\"text-xs text-muted-foreground text-center\">","-                        Select sources to generate audio","-                      </p>","-                    )}","-                  </CardContent>","-                </Card>","+                  </div>","+                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'audio' ? 'rotate-180' : ''}`} />","+                </button>"," ","-                <Card>","-                  <CardHeader className=\"pb-2\">","-                    <CardTitle className=\"text-sm flex items-center gap-2\">","-                      <Video className=\"h-4 w-4\" />","-                      Video Overview","-                    </CardTitle>","-                    <CardDescription className=\"text-xs\">","-                      Create a visual explainer video","-                    </CardDescription>","-                  </CardHeader>","-                  <CardContent className=\"space-y-3\">","-                    <div>","-                      <label className=\"text-xs font-medium mb-1 block\">Style</label>","-                      <Select value={videoStyle} onValueChange={setVideoStyle}>","-                        <SelectTrigger className=\"h-8 text-xs\">","-                          <SelectValue />","-                        </SelectTrigger>","-                        <SelectContent>","-                          <SelectItem value=\"explainer\">Explainer</SelectItem>","-                          <SelectItem value=\"documentary\">Documentary</SelectItem>","-                          <SelectItem value=\"presentation\">Presentation</SelectItem>","-                        </SelectContent>","-                      </Select>","-                    </div>","-                    <Button","-                      className=\"w-full\"","-                      size=\"sm\"","-                      onClick={generateVideo}","-                      disabled={generatingVideo || selectedSources.size === 0}","-                    >","-                      {generatingVideo ? (","-                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />","-                      ) : (","-                        <Video className=\"h-4 w-4 mr-2\" />","+                {expandedSection === 'audio' && (","+                  <div className=\"px-4 pb-4 space-y-4 border-t bg-muted/20\">","+                    <div className=\"pt-4 space-y-3\">","+                      <div className=\"space-y-1.5\">","+                        <label className=\"text-xs font-medium\">Format</label>","+                        <Select value={audioFormat} onValueChange={setAudioFormat}>","+                          <SelectTrigger className=\"h-9 text-sm\">","+                            <SelectValue />","+                          </SelectTrigger>","+                          <SelectContent>","+                            <SelectItem value=\"deep_dive\">Deep Dive (10-15 min)</SelectItem>","+                            <SelectItem value=\"brief\">Brief Summary (2-3 min)</SelectItem>","+                            <SelectItem value=\"critique\">Analytical (5-10 min)</SelectItem>","+                            <SelectItem value=\"debate\">Debate (8-15 min)</SelectItem>","+                          </SelectContent>","+                        </Select>","+                      </div>","+                      <div className=\"space-y-1.5\">","+                        <label className=\"text-xs font-medium\">Custom Instructions</label>","+                        <Textarea","+                          placeholder=\"Optional instructions for hosts...\"","+                          value={audioInstructions}","+                          onChange={(e) => setAudioInstructions(e.target.value)}","+                          rows={2}","+                          className=\"text-sm resize-none\"","+                        />","+                      </div>","+                      <Button","+                        className=\"w-full\"","+                        onClick={generateAudio}","+                        disabled={generatingAudio || selectedSources.size === 0}","+                      >","+                        {generatingAudio ? (","+                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />","+                        ) : (","+                          <Play className=\"h-4 w-4 mr-2\" />","+                        )}","+                        Generate Audio","+                      </Button>","+                      {selectedSources.size === 0 && (","+                        <p className=\"text-xs text-muted-foreground text-center\">","+                          Select sources to generate","+                        </p>","                       )}","-                      Generate Video Script","-                    </Button>","-                    {selectedSources.size === 0 && (","-                      <p className=\"text-xs text-muted-foreground text-center\">","-                        Select sources to generate video","-                      </p>","-                    )}","-                  </CardContent>","-                </Card>","+                    </div>","+                  </div>","+                )}","+              </div>"," ","-                <Card>","-                  <CardHeader className=\"pb-2\">","-                    <CardTitle className=\"text-sm flex items-center gap-2\">","-                      <Search className=\"h-4 w-4\" />","-                      Deep Research","-                    </CardTitle>","-                    <CardDescription className=\"text-xs\">","-                      Autonomous web research agent","-                    </CardDescription>","-                  </CardHeader>","-                  <CardContent className=\"space-y-3\">","-                    <div>","-                      <label className=\"text-xs font-medium mb-1 block\">Research Query</label>","-                      <Input","-                        placeholder=\"What would you like to research?\"","-                        value={researchQuery}","-                        onChange={(e) => setResearchQuery(e.target.value)}","-                        className=\"h-8 text-xs\"","-                      />","+              {/* Video Overview Section */}","+              <div className=\"rounded-xl border bg-background overflow-hidden\">","+                <button","+                  onClick={() => setExpandedSection(expandedSection === 'video' ? null : 'video')}","+                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"","+                >","+                  <div className=\"flex items-center gap-3\">","+                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center\">","+                      <Video className=\"h-4 w-4 text-purple-600\" />","                     </div>","-                    <div>","-                      <label className=\"text-xs font-medium mb-1 block\">Mode</label>","-                      <Select value={researchMode} onValueChange={setResearchMode}>","-                        <SelectTrigger className=\"h-8 text-xs\">","-                          <SelectValue />","-                        </SelectTrigger>","-                        <SelectContent>","-                          <SelectItem value=\"fast\">Fast (3-5 min)</SelectItem>","-                          <SelectItem value=\"deep\">Deep (10-15 min)</SelectItem>","-                        </SelectContent>","-                      </Select>","+                    <div className=\"text-left\">","+                      <p className=\"font-medium text-sm\">Video Overview</p>","+                      <p className=\"text-xs text-muted-foreground\">Visual explainer video</p>","                     </div>","-                    <Button","-                      className=\"w-full\"","-                      size=\"sm\"","-                      onClick={runResearch}","-                      disabled={researching || !researchQuery.trim()}","-                    >","-                      {researching ? (","-                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />","-                      ) : (","-                        <Search className=\"h-4 w-4 mr-2\" />","-                      )}","-                      Start Research","-                    </Button>","-                  </CardContent>","-                </Card>","-              </TabsContent>","+                  </div>","+                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'video' ? 'rotate-180' : ''}`} />","+                </button>"," ","-              <TabsContent value=\"study\" className=\"mt-0 space-y-4\">","-                <Card>","-                  <CardHeader className=\"pb-2\">","-                    <CardTitle className=\"text-sm\">Study Materials</CardTitle>","-                    <CardDescription className=\"text-xs\">","-                      Generate study aids from your sources","-                    </CardDescription>","-                  </CardHeader>","-                  <CardContent className=\"space-y-2\">","-                    <Button","-                      variant=\"outline\"","-                      size=\"sm\"","-                      className=\"w-full justify-start\"","-                      disabled={selectedSources.size === 0 || generatingFlashcards}","-                      onClick={async () => {","-                        setGeneratingFlashcards(true)","-                        try {","-                          const { data: { session } } = await supabase.auth.getSession()","-                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {","-                            method: 'POST',","-                            headers: {","-                              'Content-Type': 'application/json',","-                              'Authorization': `Bearer ${session?.access_token}`,","-                            },","-                            body: JSON.stringify({","-                              type: 'flashcards',","-                              source_ids: Array.from(selectedSources),","-                              count: 5,","-                            }),","-                          })","-                          const result = await response.json()","-                          if (result.error) {","-                            toast.error(result.error)","-                          } else if (result.data?.flashcards) {","-                            setFlashcards(result.data.flashcards)","-                            setCurrentFlashcard(0)","-                            setShowFlashcardBack(false)","-                            toast.success(`Generated ${result.data.flashcards.length} flashcards!`)","-                          } else {","-                            toast.error('Unexpected response')","-                          }","-                        } catch (err) {","-                          console.error('Flashcards error:', err)","-                          toast.error('Failed to generate flashcards')","-                        } finally {","-                          setGeneratingFlashcards(false)","-                        }","-                      }}","-                    >","-                      {generatingFlashcards ? (","-                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />","-                      ) : (","-                        <BookOpen className=\"h-4 w-4 mr-2\" />","-                      )}","-                      {generatingFlashcards ? 'Generating...' : 'Generate Flashcards'}","-                    </Button>","-                    <Button","-                      variant=\"outline\"","-                      size=\"sm\"","-                      className=\"w-full justify-start\"","-                      disabled={selectedSources.size === 0 || generatingQuiz}","-                      onClick={async () => {","-                        setGeneratingQuiz(true)","-                        try {","-                          const { data: { session } } = await supabase.auth.getSession()","-                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {","-                            method: 'POST',","-                            headers: {","-                              'Content-Type': 'application/json',","-                              'Authorization': `Bearer ${session?.access_token}`,","-                            },","-                            body: JSON.stringify({","-                              type: 'quiz',","-                              source_ids: Array.from(selectedSources),","-                              count: 5,","-                            }),","-                          })","-                          const result = await response.json()","-                          if (result.error) {","-                            toast.error(result.error)","-                          } else if (result.data?.questions) {","-                            setQuizQuestions(result.data.questions)","-                            setCurrentQuizQuestion(0)","-                            setSelectedAnswer(null)","-                            setShowQuizAnswer(false)","-                            toast.success(`Generated ${result.data.questions.length} quiz questions!`)","-                          } else {","-                            toast.error('Unexpected response')","-                          }","-                        } catch (err) {","-                          console.error('Quiz error:', err)","-                          toast.error('Failed to generate quiz')","-                        } finally {","-                          setGeneratingQuiz(false)","-                        }","-                      }}","-                    >","-                      {generatingQuiz ? (","-                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />","-                      ) : (","-                        <CheckCircle className=\"h-4 w-4 mr-2\" />","-                      )}","-                      {generatingQuiz ? 'Generating...' : 'Generate Quiz'}","-                    </Button>","-                    <Button","-                      variant=\"outline\"","-                      size=\"sm\"","-                      className=\"w-full justify-start\"","-                      disabled={selectedSources.size === 0 || generatingStudyGuide}","-                      onClick={async () => {","-                        setGeneratingStudyGuide(true)","-                        try {","-                          const { data: { session } } = await supabase.auth.getSession()","-                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {","-                            method: 'POST',","-                            headers: {","-                              'Content-Type': 'application/json',","-                              'Authorization': `Bearer ${session?.access_token}`,","-                            },","-                            body: JSON.stringify({","-                              type: 'study-guide',","-                              source_ids: Array.from(selectedSources),","-                            }),","-                          })","-                          const result = await response.json()","-                          if (result.error) {","-                            toast.error(result.error)","-                          } else if (result.data?.sections) {","-                            setStudyGuide(result.data)","-                            toast.success('Study guide generated!')","-                          } else {","-                            toast.error('Unexpected response')","-                          }","-                        } catch (err) {","-                          console.error('Study guide error:', err)","-                          toast.error('Failed to generate study guide')","-                        } finally {","-                          setGeneratingStudyGuide(false)","-                        }","-                      }}","-                    >","-                      {generatingStudyGuide ? (","-                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />","-                      ) : (","-                        <FileText className=\"h-4 w-4 mr-2\" />","-                      )}","-                      {generatingStudyGuide ? 'Generating...' : 'Generate Study Guide'}","-                    </Button>","-                    <Button","-                      variant=\"outline\"","-                      size=\"sm\"","-                      className=\"w-full justify-start\"","-                      disabled={selectedSources.size === 0 || generatingFaq}","-                      onClick={async () => {","-                        setGeneratingFaq(true)","-                        try {","-                          const { data: { session } } = await supabase.auth.getSession()","-                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {","-                            method: 'POST',","-                            headers: {","-                              'Content-Type': 'application/json',","-                              'Authorization': `Bearer ${session?.access_token}`,","-                            },","-                            body: JSON.stringify({","-                              type: 'faq',","-                              source_ids: Array.from(selectedSources),","-                            }),","-                          })","-                          const result = await response.json()","-                          if (result.error) {","-                            toast.error(result.error)","-                          } else if (result.data?.faq) {","-                            setFaqItems(result.data.faq)","-                            toast.success(`Generated ${result.data.faq.length} FAQ items!`)","-                          } else {","-                            toast.error('Unexpected response')","-                          }","-                        } catch (err) {","-                          console.error('FAQ error:', err)","-                          toast.error('Failed to generate FAQ')","-                        } finally {","-                          setGeneratingFaq(false)","-                        }","-                      }}","-                    >","-                      {generatingFaq ? (","-                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />","-                      ) : (","-                        <AlertCircle className=\"h-4 w-4 mr-2\" />","-                      )}","-                      {generatingFaq ? 'Generating...' : 'Generate FAQ'}","-                    </Button>","-                  </CardContent>","-                </Card>","-","-                {/* Flashcards Display */}","-                {flashcards.length > 0 && (","-                  <Card>","-                    <CardHeader className=\"pb-2\">","-                      <div className=\"flex items-center justify-between\">","-                        <CardTitle className=\"text-sm\">Flashcards</CardTitle>","-                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setFlashcards([])}>","-                          <X className=\"h-3 w-3\" />","-                        </Button>","+                {expandedSection === 'video' && (","+                  <div className=\"px-4 pb-4 space-y-4 border-t bg-muted/20\">","+                    <div className=\"pt-4 space-y-3\">","+                      <div className=\"space-y-1.5\">","+                        <label className=\"text-xs font-medium\">Style</label>","+                        <Select value={videoStyle} onValueChange={setVideoStyle}>","+                          <SelectTrigger className=\"h-9 text-sm\">","+                            <SelectValue />","+                          </SelectTrigger>","+                          <SelectContent>","+                            <SelectItem value=\"explainer\">Explainer</SelectItem>","+                            <SelectItem value=\"documentary\">Documentary</SelectItem>","+                            <SelectItem value=\"presentation\">Presentation</SelectItem>","+                          </SelectContent>","+                        </Select>","                       </div>","-                      <CardDescription className=\"text-xs\">","-                        {currentFlashcard + 1} of {flashcards.length}","-                      </CardDescription>","-                    </CardHeader>","-                    <CardContent>","-                      <div","-                        className=\"bg-muted rounded-lg p-4 min-h-[120px] cursor-pointer select-text\"","-                        onClick={() => setShowFlashcardBack(!showFlashcardBack)}","+                      <Button","+                        className=\"w-full\"","+                        onClick={generateVideo}","+                        disabled={generatingVideo || selectedSources.size === 0}","                       >","-                        <p className=\"text-xs text-muted-foreground mb-1\">","-                          {showFlashcardBack ? 'Answer' : 'Question'} (click to flip)","+                        {generatingVideo ? (","+                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />","+                        ) : (","+                          <Video className=\"h-4 w-4 mr-2\" />","+                        )}","+                        Generate Video","+                      </Button>","+                      {selectedSources.size === 0 && (","+                        <p className=\"text-xs text-muted-foreground text-center\">","+                          Select sources to generate","                         </p>","-                        <p className=\"text-sm\">","-                          {showFlashcardBack ? flashcards[currentFlashcard]?.back : flashcards[currentFlashcard]?.front}","-                        </p>","+                      )}","+                    </div>","+                  </div>","+                )}","+              </div>","+","+              {/* Deep Research Section */}","+              <div className=\"rounded-xl border bg-background overflow-hidden\">","+                <button","+                  onClick={() => setExpandedSection(expandedSection === 'research' ? null : 'research')}","+                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"","+                >","+                  <div className=\"flex items-center gap-3\">","+                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-blue-500/20 to-cyan-500/20 flex items-center justify-center\">","+                      <Search className=\"h-4 w-4 text-blue-600\" />","+                    </div>","+                    <div className=\"text-left\">","+                      <p className=\"font-medium text-sm\">Deep Research</p>","+                      <p className=\"text-xs text-muted-foreground\">Autonomous web research</p>","+                    </div>","+                  </div>","+                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'research' ? 'rotate-180' : ''}`} />","+                </button>","+","+                {expandedSection === 'research' && (","+                  <div className=\"px-4 pb-4 space-y-4 border-t bg-muted/20\">","+                    <div className=\"pt-4 space-y-3\">","+                      <div className=\"space-y-1.5\">","+                        <label className=\"text-xs font-medium\">Research Query</label>","+                        <Input","+                          placeholder=\"What would you like to research?\"","+                          value={researchQuery}","+                          onChange={(e) => setResearchQuery(e.target.value)}","+                          className=\"h-9 text-sm\"","+                        />","                       </div>","-                      <div className=\"flex gap-2 mt-3\">","-                        <Button","-                          variant=\"outline\"","-                          size=\"sm\"","-                          className=\"flex-1\"","-                          disabled={currentFlashcard === 0}","-                          onClick={() => { setCurrentFlashcard(c => c - 1); setShowFlashcardBack(false) }}","-                        >","-                          Previous","-                        </Button>","-                        <Button","-                          variant=\"outline\"","-                          size=\"sm\"","-                          className=\"flex-1\"","-                          disabled={currentFlashcard === flashcards.length - 1}","-                          onClick={() => { setCurrentFlashcard(c => c + 1); setShowFlashcardBack(false) }}","-                        >","-                          Next","-                        </Button>","+                      <div className=\"space-y-1.5\">","+                        <label className=\"text-xs font-medium\">Mode</label>","+                        <Select value={researchMode} onValueChange={setResearchMode}>","+                          <SelectTrigger className=\"h-9 text-sm\">","+                            <SelectValue />","+                          </SelectTrigger>","+                          <SelectContent>","+                            <SelectItem value=\"fast\">Fast (3-5 min)</SelectItem>","+                            <SelectItem value=\"deep\">Deep (10-15 min)</SelectItem>","+                          </SelectContent>","+                        </Select>","                       </div>","-                    </CardContent>","-                  </Card>","+                      <Button","+                        className=\"w-full\"","+                        onClick={runResearch}","+                        disabled={researching || !researchQuery.trim()}","+                      >","+                        {researching ? (","+                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />","+                        ) : (","+                          <Search className=\"h-4 w-4 mr-2\" />","+                        )}","+                        Start Research","+                      </Button>","+                    </div>","+                  </div>","                 )}","+              </div>"," ","-                {/* Quiz Display */}","-                {quizQuestions.length > 0 && (","-                  <Card>","-                    <CardHeader className=\"pb-2\">","-                      <div className=\"flex items-center justify-between\">","-                        <CardTitle className=\"text-sm\">Quiz</CardTitle>","-                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setQuizQuestions([])}>","-                          <X className=\"h-3 w-3\" />","-                        </Button>","+              {/* Study Materials Section */}","+              <div className=\"rounded-xl border bg-background overflow-hidden\">","+                <button","+                  onClick={() => setExpandedSection(expandedSection === 'study' ? null : 'study')}","+                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"","+                >","+                  <div className=\"flex items-center gap-3\">","+                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-emerald-500/20 to-teal-500/20 flex items-center justify-center\">","+                      <GraduationCap className=\"h-4 w-4 text-emerald-600\" />","+                    </div>","+                    <div className=\"text-left\">","+                      <p className=\"font-medium text-sm\">Study Materials</p>","+                      <p className=\"text-xs text-muted-foreground\">Flashcards, quizzes, and more</p>","+                    </div>","+                  </div>","+                  <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'study' ? 'rotate-180' : ''}`} />","+                </button>","+","+                {expandedSection === 'study' && (","+                  <div className=\"px-4 pb-4 border-t bg-muted/20\">","+                    <div className=\"pt-4 grid grid-cols-2 gap-2\">","+                      <button","+                        onClick={handleGenerateFlashcards}","+                        disabled={selectedSources.size === 0 || generatingFlashcards}","+                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"","+                      >","+                        {generatingFlashcards ? (","+                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />","+                        ) : (","+                          <BookOpen className=\"h-5 w-5 text-blue-500\" />","+                        )}","+                        <span className=\"text-xs font-medium\">Flashcards</span>","+                      </button>","+","+                      <button","+                        onClick={handleGenerateQuiz}","+                        disabled={selectedSources.size === 0 || generatingQuiz}","+                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"","+                      >","+                        {generatingQuiz ? (","+                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />","+                        ) : (","+                          <ListChecks className=\"h-5 w-5 text-purple-500\" />","+                        )}","+                        <span className=\"text-xs font-medium\">Quiz</span>","+                      </button>","+","+                      <button","+                        onClick={handleGenerateStudyGuide}","+                        disabled={selectedSources.size === 0 || generatingStudyGuide}","+                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"","+                      >","+                        {generatingStudyGuide ? (","+                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />","+                        ) : (","+                          <FileText className=\"h-5 w-5 text-orange-500\" />","+                        )}","+                        <span className=\"text-xs font-medium\">Study Guide</span>","+                      </button>","+","+                      <button","+                        onClick={handleGenerateFaq}","+                        disabled={selectedSources.size === 0 || generatingFaq}","+                        className=\"flex flex-col items-center gap-2 p-4 rounded-lg border bg-background hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"","+                      >","+                        {generatingFaq ? (","+                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />","+                        ) : (","+                          <HelpCircle className=\"h-5 w-5 text-teal-500\" />","+                        )}","+                        <span className=\"text-xs font-medium\">FAQ</span>","+                      </button>","+                    </div>","+","+                    {selectedSources.size === 0 && (","+                      <p className=\"text-xs text-muted-foreground text-center mt-3\">","+                        Select sources to generate study materials","+                      </p>","+                    )}","+","+                    {/* Quick access to generated materials */}","+                    {(flashcards.length > 0 || quizQuestions.length > 0 || studyGuide || faqItems.length > 0) && (","+                      <div className=\"mt-4 pt-3 border-t\">","+                        <p className=\"text-xs font-medium text-muted-foreground mb-2\">Generated Materials</p>","+                        <div className=\"space-y-1\">","+                          {flashcards.length > 0 && (","+                            <button","+                              onClick={() => { setActiveStudyType('flashcards'); setStudySheetOpen(true) }}","+                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"","+                            >","+                              <BookOpen className=\"h-4 w-4 text-blue-500\" />","+                              <span>{flashcards.length} Flashcards</span>","+                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />","+                            </button>","+                          )}","+                          {quizQuestions.length > 0 && (","+                            <button","+                              onClick={() => { setActiveStudyType('quiz'); setStudySheetOpen(true) }}","+                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"","+                            >","+                              <ListChecks className=\"h-4 w-4 text-purple-500\" />","+                              <span>{quizQuestions.length} Quiz Questions</span>","+                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />","+                            </button>","+                          )}","+                          {studyGuide && (","+                            <button","+                              onClick={() => { setActiveStudyType('guide'); setStudySheetOpen(true) }}","+                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"","+                            >","+                              <FileText className=\"h-4 w-4 text-orange-500\" />","+                              <span>Study Guide</span>","+                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />","+                            </button>","+                          )}","+                          {faqItems.length > 0 && (","+                            <button","+                              onClick={() => { setActiveStudyType('faq'); setStudySheetOpen(true) }}","+                              className=\"w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg hover:bg-muted transition-colors\"","+                            >","+                              <HelpCircle className=\"h-4 w-4 text-teal-500\" />","+                              <span>{faqItems.length} FAQ Items</span>","+                              <ChevronRight className=\"h-4 w-4 ml-auto text-muted-foreground\" />","+                            </button>","+                          )}","+                        </div>","                       </div>","-                      <CardDescription className=\"text-xs\">","-                        Question {currentQuizQuestion + 1} of {quizQuestions.length}","-                      </CardDescription>","-                    </CardHeader>","-                    <CardContent>","-                      <p className=\"text-sm font-medium mb-3\">{quizQuestions[currentQuizQuestion]?.question}</p>","-                      <div className=\"space-y-2\">","-                        {quizQuestions[currentQuizQuestion]?.options.map((option, i) => (","-                          <button","-                            key={i}","-                            className={`w-full text-left p-2 rounded text-xs border transition-colors ${","-                              showQuizAnswer","-                                ? i === quizQuestions[currentQuizQuestion]?.correct_index","-                                  ? 'bg-green-100 border-green-500 dark:bg-green-900/30'","-                                  : selectedAnswer === i","-                                  ? 'bg-red-100 border-red-500 dark:bg-red-900/30'","-                                  : 'bg-muted'","-                                : selectedAnswer === i","-                                ? 'bg-primary/10 border-primary'","-                                : 'bg-muted hover:bg-muted/80'","-                            }`}","-                            onClick={() => !showQuizAnswer && setSelectedAnswer(i)}","-                            disabled={showQuizAnswer}","-                          >","-                            {option}","-                          </button>","-                        ))}","-                      </div>","-                      {selectedAnswer !== null && !showQuizAnswer && (","+                    )}","+                  </div>","+                )}","+              </div>","+","+              {/* Notes Section */}","+              <div className=\"rounded-xl border bg-background overflow-hidden\">","+                <button","+                  onClick={() => setExpandedSection(expandedSection === 'notes' ? null : 'notes')}","+                  className=\"w-full flex items-center justify-between p-4 hover:bg-muted/50 transition-colors\"","+                >","+                  <div className=\"flex items-center gap-3\">","+                    <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-amber-500/20 to-yellow-500/20 flex items-center justify-center\">","+                      <StickyNote className=\"h-4 w-4 text-amber-600\" />","+                    </div>","+                    <div className=\"text-left\">","+                      <p className=\"font-medium text-sm\">Notes</p>","+                      <p className=\"text-xs text-muted-foreground\">{notes.length} saved</p>","+                    </div>","+                  </div>","+                  <div className=\"flex items-center gap-2\">","+                    <Dialog open={addNoteOpen} onOpenChange={setAddNoteOpen}>","+                      <DialogTrigger asChild>","                         <Button","                           size=\"sm\"","-                          className=\"w-full mt-3\"","-                          onClick={() => setShowQuizAnswer(true)}","+                          variant=\"ghost\"","+                          className=\"h-7 w-7 p-0\"","+                          onClick={(e) => e.stopPropagation()}","                         >","-                          Check Answer","+                          <Plus className=\"h-3.5 w-3.5\" />","                         </Button>","-                      )}","-                      {showQuizAnswer && (","-                        <>","-                          <p className=\"text-xs text-muted-foreground mt-3 p-2 bg-muted rounded\">","-                            {quizQuestions[currentQuizQuestion]?.explanation}","-                          </p>","-                          <Button","-                            size=\"sm\"","-                            className=\"w-full mt-2\"","-                            disabled={currentQuizQuestion === quizQuestions.length - 1}","-                            onClick={() => {","-                              setCurrentQuizQuestion(c => c + 1)","-                              setSelectedAnswer(null)","-                              setShowQuizAnswer(false)","-                            }}","-                          >","-                            Next Question","+                      </DialogTrigger>","+                      <DialogContent>","+                        <DialogHeader>","+                          <DialogTitle>Create Note</DialogTitle>","+                          <DialogDescription>","+                            Write a new note to save your thoughts.","+                          </DialogDescription>","+                        </DialogHeader>","+                        <div className=\"space-y-4 mt-2\">","+                          <div className=\"space-y-2\">","+                            <label className=\"text-sm font-medium\">Title</label>","+                            <Input","+                              placeholder=\"Note title...\"","+                              value={noteTitle}","+                              onChange={(e) => setNoteTitle(e.target.value)}","+                            />","+                          </div>","+                          <div className=\"space-y-2\">","+                            <label className=\"text-sm font-medium\">Content</label>","+                            <Textarea","+                              placeholder=\"Write your note...\"","+                              value={noteContent}","+                              onChange={(e) => setNoteContent(e.target.value)}","+                              rows={6}","+                            />","+                          </div>","+                        </div>","+                        <DialogFooter className=\"mt-4\">","+                          <Button onClick={createNote} disabled={savingNote}>","+                            {savingNote && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}","+                            Create Note","                           </Button>","-                        </>","-                      )}","-                    </CardContent>","-                  </Card>","-                )}","+                        </DialogFooter>","+                      </DialogContent>","+                    </Dialog>","+                    <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${expandedSection === 'notes' ? 'rotate-180' : ''}`} />","+                  </div>","+                </button>"," ","-                {/* Study Guide Display */}","-                {studyGuide && (","-                  <Card>","-                    <CardHeader className=\"pb-2\">","-                      <div className=\"flex items-center justify-between\">","-                        <CardTitle className=\"text-sm\">{studyGuide.title}</CardTitle>","-                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setStudyGuide(null)}>","-                          <X className=\"h-3 w-3\" />","-                        </Button>","-                      </div>","-                    </CardHeader>","-                    <CardContent className=\"space-y-3\">","-                      {studyGuide.sections.map((section, i) => (","-                        <div key={i}>","-                          <h4 className=\"text-xs font-semibold mb-1\">{section.heading}</h4>","-                          <p className=\"text-xs text-muted-foreground whitespace-pre-wrap select-text\">","-                            {section.content}","-                          </p>","+                {expandedSection === 'notes' && (","+                  <div className=\"px-4 pb-4 border-t bg-muted/20\">","+                    <div className=\"pt-4\">","+                      {notes.length === 0 ? (","+                        <div className=\"text-center py-6\">","+                          <StickyNote className=\"h-8 w-8 mx-auto mb-2 text-muted-foreground/50\" />","+                          <p className=\"text-sm text-muted-foreground\">No notes yet</p>","+                          <p className=\"text-xs text-muted-foreground mt-1\">Create notes or save chat responses</p>","                         </div>","-                      ))}","-                    </CardContent>","-                  </Card>","-                )}","-","-                {/* FAQ Display */}","-                {faqItems.length > 0 && (","-                  <Card>","-                    <CardHeader className=\"pb-2\">","-                      <div className=\"flex items-center justify-between\">","-                        <CardTitle className=\"text-sm\">FAQ</CardTitle>","-                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setFaqItems([])}>","-                          <X className=\"h-3 w-3\" />","-                        </Button>","-                      </div>","-                    </CardHeader>","-                    <CardContent className=\"space-y-3\">","-                      {faqItems.map((item, i) => (","-                        <div key={i} className=\"border-b pb-2 last:border-0\">","-                          <p className=\"text-xs font-semibold mb-1\">Q: {item.question}</p>","-                          <p className=\"text-xs text-muted-foreground select-text\">A: {item.answer}</p>","+                      ) : (","+                        <div className=\"space-y-2\">","+                          {notes.map((note) => (","+                            <div","+                              key={note.id}","+                              className=\"p-3 rounded-lg border bg-background group\"","+                            >","+                              <div className=\"flex items-start justify-between gap-2\">","+                                <div className=\"flex items-center gap-2 min-w-0\">","+                                  {note.is_pinned && <Pin className=\"h-3 w-3 text-amber-500 shrink-0\" />}","+                                  <span className=\"font-medium text-sm truncate\">","+                                    {note.title || 'Untitled'}","+                                  </span>","+                                </div>","+                                <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">","+                                  <Button","+                                    variant=\"ghost\"","+                                    size=\"sm\"","+                                    className=\"h-6 w-6 p-0\"","+                                    onClick={() => togglePinNote(note)}","+                                  >","+                                    <Pin className={`h-3 w-3 ${note.is_pinned ? 'text-amber-500' : 'text-muted-foreground'}`} />","+                                  </Button>","+                                  <Button","+                                    variant=\"ghost\"","+                                    size=\"sm\"","+                                    className=\"h-6 w-6 p-0\"","+                                    onClick={() => deleteNote(note.id)}","+                                  >","+                                    <Trash2 className=\"h-3 w-3 text-muted-foreground hover:text-destructive\" />","+                                  </Button>","+                                </div>","+                              </div>","+                              <p className=\"text-xs text-muted-foreground mt-1.5 line-clamp-2\">","+                                {note.content || 'No content'}","+                              </p>","+                              <div className=\"flex items-center gap-2 mt-2\">","+                                <Badge variant=\"outline\" className=\"text-[10px] font-normal px-1.5 py-0\">","+                                  {note.type === 'saved_response' ? 'Chat' : 'Note'}","+                                </Badge>","+                                <span className=\"text-[10px] text-muted-foreground\">","+                                  {new Date(note.created_at).toLocaleDateString()}","+                                </span>","+                              </div>","+                            </div>","+                          ))}","                         </div>","-                      ))}","-                    </CardContent>","-                  </Card>","+                      )}","+                    </div>","+                  </div>","                 )}","+              </div>"," ","-                {selectedSources.size === 0 && (","-                  <p className=\"text-xs text-muted-foreground text-center\">","-                    Select sources to generate study materials","+            </div>","+          </ScrollArea>","+        </div>","+      </div>","+","+      {/* Study Materials Sheet */}","+      <Sheet open={studySheetOpen} onOpenChange={setStudySheetOpen}>","+        <SheetContent className=\"w-full sm:max-w-lg overflow-y-auto\">","+          <SheetHeader>","+            <SheetTitle className=\"flex items-center gap-2\">","+              {activeStudyType === 'flashcards' && <><BookOpen className=\"h-5 w-5 text-blue-500\" /> Flashcards</>}","+              {activeStudyType === 'quiz' && <><ListChecks className=\"h-5 w-5 text-purple-500\" /> Quiz</>}","+              {activeStudyType === 'guide' && <><FileText className=\"h-5 w-5 text-orange-500\" /> Study Guide</>}","+              {activeStudyType === 'faq' && <><HelpCircle className=\"h-5 w-5 text-teal-500\" /> FAQ</>}","+            </SheetTitle>","+            <SheetDescription>","+              {activeStudyType === 'flashcards' && `${flashcards.length} cards generated from your sources`}","+              {activeStudyType === 'quiz' && `${quizQuestions.length} questions to test your knowledge`}","+              {activeStudyType === 'guide' && 'Comprehensive study guide from your sources'}","+              {activeStudyType === 'faq' && `${faqItems.length} frequently asked questions`}","+            </SheetDescription>","+          </SheetHeader>","+","+          <div className=\"mt-6\">","+            {/* Flashcards View */}","+            {activeStudyType === 'flashcards' && flashcards.length > 0 && (","+              <div className=\"space-y-4\">","+                <div className=\"flex items-center justify-between text-sm text-muted-foreground\">","+                  <span>Card {currentFlashcard + 1} of {flashcards.length}</span>","+                  <Button","+                    variant=\"ghost\"","+                    size=\"sm\"","+                    onClick={() => {","+                      setCurrentFlashcard(0)","+                      setShowFlashcardBack(false)","+                    }}","+                  >","+                    <RotateCcw className=\"h-4 w-4 mr-1\" />","+                    Reset","+                  </Button>","+                </div>","+","+                <div","+                  onClick={() => setShowFlashcardBack(!showFlashcardBack)}","+                  className=\"min-h-[200px] p-6 rounded-xl border-2 bg-gradient-to-br from-background to-muted/30 cursor-pointer hover:shadow-lg transition-all flex flex-col justify-center\"","+                >","+                  <p className=\"text-xs font-medium text-muted-foreground mb-3 uppercase tracking-wide\">","+                    {showFlashcardBack ? 'Answer' : 'Question'}","                   </p>","-                )}","-              </TabsContent>","+                  <p className=\"text-lg leading-relaxed\">","+                    {showFlashcardBack ? flashcards[currentFlashcard]?.back : flashcards[currentFlashcard]?.front}","+                  </p>","+                  <p className=\"text-xs text-muted-foreground mt-4\">Click to flip</p>","+                </div>"," ","-              <TabsContent value=\"notes\" className=\"mt-0 space-y-4\">","-                <div className=\"flex items-center justify-between\">","-                  <h3 className=\"text-sm font-medium\">Your Notes</h3>","-                  <Dialog open={addNoteOpen} onOpenChange={setAddNoteOpen}>","-                    <DialogTrigger asChild>","-                      <Button size=\"sm\" variant=\"outline\">","-                        <Plus className=\"h-4 w-4\" />","-                      </Button>","-                    </DialogTrigger>","-                    <DialogContent>","-                      <DialogHeader>","-                        <DialogTitle>Create Note</DialogTitle>","-                      </DialogHeader>","-                      <div className=\"space-y-4\">","-                        <div>","-                          <label className=\"text-sm font-medium\">Title</label>","-                          <Input","-                            placeholder=\"Note title...\"","-                            value={noteTitle}","-                            onChange={(e) => setNoteTitle(e.target.value)}","-                          />","-                        </div>","-                        <div>","-                          <label className=\"text-sm font-medium\">Content</label>","-                          <Textarea","-                            placeholder=\"Write your note...\"","-                            value={noteContent}","-                            onChange={(e) => setNoteContent(e.target.value)}","-                            rows={6}","-                          />","-                        </div>","-                      </div>","-                      <DialogFooter>","-                        <Button onClick={createNote} disabled={savingNote}>","-                          {savingNote && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}","-                          Create Note","-                        </Button>","-                      </DialogFooter>","-                    </DialogContent>","-                  </Dialog>","+                <div className=\"flex gap-2\">","+                  <Button","+                    variant=\"outline\"","+                    className=\"flex-1\"","+                    disabled={currentFlashcard === 0}","+                    onClick={() => { setCurrentFlashcard(c => c - 1); setShowFlashcardBack(false) }}","+                  >","+                    Previous","+                  </Button>","+                  <Button","+                    variant=\"outline\"","+                    className=\"flex-1\"","+                    disabled={currentFlashcard === flashcards.length - 1}","+                    onClick={() => { setCurrentFlashcard(c => c + 1); setShowFlashcardBack(false) }}","+                  >","+                    Next","+                  </Button>","                 </div>","+              </div>","+            )}"," ","-                {notes.length === 0 ? (","-                  <div className=\"text-center py-8 text-muted-foreground\">","-                    <StickyNote className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />","-                    <p className=\"text-sm\">No notes yet</p>","-                    <p className=\"text-xs\">Create notes or save chat responses</p>","-                  </div>","-                ) : (","+            {/* Quiz View */}","+            {activeStudyType === 'quiz' && quizQuestions.length > 0 && (","+              <div className=\"space-y-4\">","+                <div className=\"flex items-center justify-between text-sm text-muted-foreground\">","+                  <span>Question {currentQuizQuestion + 1} of {quizQuestions.length}</span>","+                  <Button","+                    variant=\"ghost\"","+                    size=\"sm\"","+                    onClick={() => {","+                      setCurrentQuizQuestion(0)","+                      setSelectedAnswer(null)","+                      setShowQuizAnswer(false)","+                    }}","+                  >","+                    <RotateCcw className=\"h-4 w-4 mr-1\" />","+                    Reset","+                  </Button>","+                </div>","+","+                <div className=\"p-6 rounded-xl border bg-muted/30\">","+                  <p className=\"font-medium text-lg mb-4\">{quizQuestions[currentQuizQuestion]?.question}</p>","+","                   <div className=\"space-y-2\">","-                    {notes.map((note) => (","-                      <Card key={note.id} className=\"relative\">","-                        <CardHeader className=\"pb-2\">","-                          <div className=\"flex items-start justify-between\">","-                            <div className=\"flex items-center gap-2\">","-                              {note.is_pinned && <Pin className=\"h-3 w-3 text-primary\" />}","-                              <CardTitle className=\"text-sm\">","-                                {note.title || 'Untitled'}","-                              </CardTitle>","-                            </div>","-                            <div className=\"flex items-center gap-1\">","-                              <Button","-                                variant=\"ghost\"","-                                size=\"sm\"","-                                className=\"h-6 w-6 p-0\"","-                                onClick={() => togglePinNote(note)}","-                              >","-                                <Pin className={`h-3 w-3 ${note.is_pinned ? 'text-primary' : ''}`} />","-                              </Button>","-                              <Button","-                                variant=\"ghost\"","-                                size=\"sm\"","-                                className=\"h-6 w-6 p-0\"","-                                onClick={() => deleteNote(note.id)}","-                              >","-                                <Trash2 className=\"h-3 w-3\" />","-                              </Button>","-                            </div>","-                          </div>","-                          <CardDescription className=\"text-xs\">","-                            {note.type === 'saved_response' ? 'Saved from chat' : 'Note'}","-                            {' · '}","-                            {new Date(note.created_at).toLocaleDateString()}","-                          </CardDescription>","-                        </CardHeader>","-                        <CardContent>","-                          <p className=\"text-xs text-muted-foreground line-clamp-3\">","-                            {note.content || 'No content'}","-                          </p>","-                        </CardContent>","-                      </Card>","+                    {quizQuestions[currentQuizQuestion]?.options.map((option, i) => (","+                      <button","+                        key={i}","+                        className={`","+                          w-full text-left p-4 rounded-lg border transition-all","+                          ${showQuizAnswer","+                            ? i === quizQuestions[currentQuizQuestion]?.correct_index","+                              ? 'bg-emerald-100 dark:bg-emerald-900/30 border-emerald-500'","+                              : selectedAnswer === i","+                              ? 'bg-red-100 dark:bg-red-900/30 border-red-500'","+                              : 'bg-muted/50'","+                            : selectedAnswer === i","+                            ? 'bg-primary/10 border-primary'","+                            : 'bg-background hover:bg-muted/50'","+                          }","+                        `}","+                        onClick={() => !showQuizAnswer && setSelectedAnswer(i)}","+                        disabled={showQuizAnswer}","+                      >","+                        {option}","+                      </button>","                     ))}","                   </div>","-                )}","-              </TabsContent>","-            </div>","-          </Tabs>","-        </div>","-      </div>","+","+                  {selectedAnswer !== null && !showQuizAnswer && (","+                    <Button","+                      className=\"w-full mt-4\"","+                      onClick={() => setShowQuizAnswer(true)}","+                    >","+                      Check Answer","+                    </Button>","+                  )}","+","+                  {showQuizAnswer && (","+                    <div className=\"mt-4 space-y-3\">","+                      <div className=\"p-4 rounded-lg bg-muted\">","+                        <p className=\"text-sm\">{quizQuestions[currentQuizQuestion]?.explanation}</p>","+                      </div>","+                      <Button","+                        className=\"w-full\"","+                        disabled={currentQuizQuestion === quizQuestions.length - 1}","+                        onClick={() => {","+                          setCurrentQuizQuestion(c => c + 1)","+                          setSelectedAnswer(null)","+                          setShowQuizAnswer(false)","+                        }}","+                      >","+                        Next Question","+                      </Button>","+                    </div>","+                  )}","+                </div>","+              </div>","+            )}","+","+            {/* Study Guide View */}","+            {activeStudyType === 'guide' && studyGuide && (","+              <div className=\"space-y-6\">","+                <h3 className=\"text-xl font-semibold\">{studyGuide.title}</h3>","+                {studyGuide.sections.map((section, i) => (","+                  <div key={i} className=\"space-y-2\">","+                    <h4 className=\"font-medium text-primary\">{section.heading}</h4>","+                    <p className=\"text-sm text-muted-foreground leading-relaxed whitespace-pre-wrap\">","+                      {section.content}","+                    </p>","+                  </div>","+                ))}","+              </div>","+            )}","+","+            {/* FAQ View */}","+            {activeStudyType === 'faq' && faqItems.length > 0 && (","+              <div className=\"space-y-4\">","+                {faqItems.map((item, i) => (","+                  <div key={i} className=\"p-4 rounded-xl border bg-muted/30\">","+                    <p className=\"font-medium mb-2\">Q: {item.question}</p>","+                    <p className=\"text-sm text-muted-foreground\">A: {item.answer}</p>","+                  </div>","+                ))}","+              </div>","+            )}","+          </div>","+        </SheetContent>","+      </Sheet>","     </div>","   )"," }"]}],"originalFile":"'use client'\n\nimport { useEffect, useState, useRef, useCallback } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { createClient, Notebook, Source, ChatMessage } from '@/lib/supabase'\nimport { chatApi, Note } from '@/lib/api'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Badge } from '@/components/ui/badge'\nimport { Separator } from '@/components/ui/separator'\nimport { Progress } from '@/components/ui/progress'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport {\n  ArrowLeft, Plus, Upload, FileText, Youtube, Link as LinkIcon,\n  Type, Send, Loader2, CheckCircle, XCircle, Clock, Trash2,\n  Mic, Video, Search, BookOpen, StickyNote, Sparkles, Pin,\n  Edit2, Save, X, AlertCircle, ChevronDown\n} from 'lucide-react'\nimport { toast } from 'sonner'\nimport { User } from '@supabase/supabase-js'\n\ninterface LocalNote {\n  id: string\n  notebook_id: string\n  type: 'written' | 'saved_response'\n  title: string | null\n  content: string | null\n  tags: string[]\n  is_pinned: boolean\n  created_at: string\n  updated_at: string\n}\n\nexport default function NotebookPage() {\n  const params = useParams()\n  const router = useRouter()\n  const notebookId = params.id as string\n  const supabase = createClient()\n\n  // Core state\n  const [user, setUser] = useState<User | null>(null)\n  const [notebook, setNotebook] = useState<Notebook | null>(null)\n  const [sources, setSources] = useState<Source[]>([])\n  const [messages, setMessages] = useState<ChatMessage[]>([])\n  const [notes, setNotes] = useState<LocalNote[]>([])\n  const [loading, setLoading] = useState(true)\n\n  // Chat state\n  const [sending, setSending] = useState(false)\n  const [message, setMessage] = useState('')\n  const [selectedSources, setSelectedSources] = useState<Set<string>>(new Set())\n  const [sessionId, setSessionId] = useState<string | null>(null)\n\n  // Source modal state\n  const [addSourceOpen, setAddSourceOpen] = useState(false)\n  const [sourceType, setSourceType] = useState<'file' | 'youtube' | 'url' | 'text'>('file')\n  const [sourceInput, setSourceInput] = useState('')\n  const [sourceName, setSourceName] = useState('')\n  const [uploading, setUploading] = useState(false)\n\n  // Notes state\n  const [addNoteOpen, setAddNoteOpen] = useState(false)\n  const [noteTitle, setNoteTitle] = useState('')\n  const [noteContent, setNoteContent] = useState('')\n  const [editingNote, setEditingNote] = useState<string | null>(null)\n  const [savingNote, setSavingNote] = useState(false)\n\n  // Audio state\n  const [audioFormat, setAudioFormat] = useState('deep_dive')\n  const [audioInstructions, setAudioInstructions] = useState('')\n  const [generatingAudio, setGeneratingAudio] = useState(false)\n\n  // Video state\n  const [videoStyle, setVideoStyle] = useState('explainer')\n  const [generatingVideo, setGeneratingVideo] = useState(false)\n\n  // Research state\n  const [researchQuery, setResearchQuery] = useState('')\n  const [researchMode, setResearchMode] = useState('fast')\n  const [researching, setResearching] = useState(false)\n\n  // Study loading states\n  const [generatingFlashcards, setGeneratingFlashcards] = useState(false)\n  const [generatingQuiz, setGeneratingQuiz] = useState(false)\n  const [generatingStudyGuide, setGeneratingStudyGuide] = useState(false)\n  const [generatingFaq, setGeneratingFaq] = useState(false)\n\n  // Study results\n  const [flashcards, setFlashcards] = useState<Array<{id: string, front: string, back: string}>>([])\n  const [quizQuestions, setQuizQuestions] = useState<Array<{id: string, question: string, options: string[], correct_index: number, explanation: string}>>([])\n  const [studyGuide, setStudyGuide] = useState<{title: string, sections: Array<{heading: string, content: string}>} | null>(null)\n  const [faqItems, setFaqItems] = useState<Array<{question: string, answer: string}>>([])\n  const [currentFlashcard, setCurrentFlashcard] = useState(0)\n  const [showFlashcardBack, setShowFlashcardBack] = useState(false)\n  const [currentQuizQuestion, setCurrentQuizQuestion] = useState(0)\n  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null)\n  const [showQuizAnswer, setShowQuizAnswer] = useState(false)\n\n  // Studio tab state\n  const [studioTab, setStudioTab] = useState('audio')\n\n  // Source preview state\n  const [viewingSource, setViewingSource] = useState<Source | null>(null)\n\n  // Refs\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n\n  // Initialize\n  useEffect(() => {\n    const init = async () => {\n      const { data: { user } } = await supabase.auth.getUser()\n      if (!user) {\n        router.push('/auth/login')\n        return\n      }\n      setUser(user)\n      await Promise.all([fetchNotebook(), fetchSources(), fetchNotes()])\n      setLoading(false)\n    }\n    init()\n  }, [notebookId])\n\n  // Auto-scroll messages\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }, [messages])\n\n  const fetchNotebook = async () => {\n    const { data, error } = await supabase\n      .from('notebooks')\n      .select('*')\n      .eq('id', notebookId)\n      .single()\n\n    if (error || !data) {\n      toast.error('Notebook not found')\n      router.push('/')\n      return\n    }\n    setNotebook(data)\n  }\n\n  const fetchSources = async () => {\n    const { data } = await supabase\n      .from('sources')\n      .select('*')\n      .eq('notebook_id', notebookId)\n      .order('created_at', { ascending: false })\n\n    setSources(data || [])\n  }\n\n  const fetchNotes = async () => {\n    const { data } = await supabase\n      .from('notes')\n      .select('*')\n      .eq('notebook_id', notebookId)\n      .order('is_pinned', { ascending: false })\n      .order('created_at', { ascending: false })\n\n    setNotes(data || [])\n  }\n\n  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n\n    setUploading(true)\n    const fileExt = file.name.split('.').pop()?.toLowerCase()\n    const filePath = `${user?.id}/${notebookId}/${Date.now()}.${fileExt}`\n\n    const { error: uploadError } = await supabase.storage\n      .from('sources')\n      .upload(filePath, file)\n\n    if (uploadError) {\n      toast.error('Failed to upload file')\n      setUploading(false)\n      return\n    }\n\n    const { data, error } = await supabase\n      .from('sources')\n      .insert({\n        notebook_id: notebookId,\n        type: fileExt === 'pdf' ? 'pdf' : fileExt === 'docx' ? 'docx' : 'txt',\n        name: file.name,\n        status: 'ready',\n        file_path: filePath,\n        original_filename: file.name,\n        mime_type: file.type,\n        file_size_bytes: file.size,\n      })\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to create source')\n    } else {\n      toast.success('File uploaded!')\n      setSources([data, ...sources])\n      setAddSourceOpen(false)\n    }\n    setUploading(false)\n  }\n\n  const addSource = async () => {\n    if (!sourceInput.trim()) return\n\n    setUploading(true)\n    let sourceData: Partial<Source> = {\n      notebook_id: notebookId,\n      status: 'ready',\n    }\n\n    if (sourceType === 'youtube') {\n      sourceData = {\n        ...sourceData,\n        type: 'youtube',\n        name: sourceName || `YouTube: ${sourceInput}`,\n        metadata: { url: sourceInput },\n      }\n    } else if (sourceType === 'url') {\n      sourceData = {\n        ...sourceData,\n        type: 'url',\n        name: sourceName || sourceInput,\n        metadata: { url: sourceInput },\n      }\n    } else if (sourceType === 'text') {\n      sourceData = {\n        ...sourceData,\n        type: 'text',\n        name: sourceName || 'Pasted Text',\n        metadata: { content: sourceInput },\n      }\n    }\n\n    const { data, error } = await supabase\n      .from('sources')\n      .insert(sourceData)\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to add source')\n    } else {\n      toast.success('Source added!')\n      setSources([data, ...sources])\n      setSourceInput('')\n      setSourceName('')\n      setAddSourceOpen(false)\n    }\n    setUploading(false)\n  }\n\n  const deleteSource = async (sourceId: string) => {\n    const { error } = await supabase\n      .from('sources')\n      .delete()\n      .eq('id', sourceId)\n\n    if (error) {\n      toast.error('Failed to delete source')\n    } else {\n      setSources(sources.filter(s => s.id !== sourceId))\n      selectedSources.delete(sourceId)\n      setSelectedSources(new Set(selectedSources))\n      toast.success('Source deleted')\n    }\n  }\n\n  const toggleSource = (sourceId: string) => {\n    const newSelected = new Set(selectedSources)\n    if (newSelected.has(sourceId)) {\n      newSelected.delete(sourceId)\n    } else {\n      newSelected.add(sourceId)\n    }\n    setSelectedSources(newSelected)\n  }\n\n  const selectAllSources = () => {\n    if (selectedSources.size === sources.length) {\n      setSelectedSources(new Set())\n    } else {\n      setSelectedSources(new Set(sources.map(s => s.id)))\n    }\n  }\n\n  const sendMessage = async () => {\n    if (!message.trim() || sending) return\n\n    setSending(true)\n    const userMessage: ChatMessage = {\n      id: crypto.randomUUID(),\n      session_id: sessionId || '',\n      role: 'user',\n      content: message,\n      citations: [],\n      source_ids_used: Array.from(selectedSources),\n      model_used: null,\n      input_tokens: null,\n      output_tokens: null,\n      cost_usd: null,\n      created_at: new Date().toISOString(),\n    }\n    setMessages(prev => [...prev, userMessage])\n    setMessage('')\n\n    try {\n      const response = await chatApi.sendMessage(notebookId, {\n        message: userMessage.content,\n        source_ids: Array.from(selectedSources),\n        session_id: sessionId || undefined,\n      })\n\n      if (response.data.session_id) {\n        setSessionId(response.data.session_id)\n      }\n\n      const aiMessage: ChatMessage = {\n        id: response.data.message_id,\n        session_id: response.data.session_id,\n        role: 'assistant',\n        content: response.data.content,\n        citations: response.data.citations,\n        source_ids_used: Array.from(selectedSources),\n        model_used: response.usage?.model_used || 'gemini-2.0-flash',\n        input_tokens: response.usage?.input_tokens || 0,\n        output_tokens: response.usage?.output_tokens || 0,\n        cost_usd: response.usage?.cost_usd || 0,\n        created_at: new Date().toISOString(),\n      }\n      setMessages(prev => [...prev, aiMessage])\n    } catch (error) {\n      toast.error('Failed to send message')\n      // Remove the user message on error\n      setMessages(prev => prev.filter(m => m.id !== userMessage.id))\n    }\n    setSending(false)\n  }\n\n  // Notes functions\n  const createNote = async () => {\n    if (!noteTitle.trim() && !noteContent.trim()) return\n\n    setSavingNote(true)\n    const { data, error } = await supabase\n      .from('notes')\n      .insert({\n        notebook_id: notebookId,\n        type: 'written',\n        title: noteTitle || 'Untitled Note',\n        content: noteContent,\n        tags: [],\n      })\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to create note')\n    } else {\n      toast.success('Note created!')\n      setNotes([data, ...notes])\n      setNoteTitle('')\n      setNoteContent('')\n      setAddNoteOpen(false)\n    }\n    setSavingNote(false)\n  }\n\n  const updateNote = async (noteId: string, updates: Partial<LocalNote>) => {\n    const { data, error } = await supabase\n      .from('notes')\n      .update({ ...updates, updated_at: new Date().toISOString() })\n      .eq('id', noteId)\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to update note')\n    } else {\n      setNotes(notes.map(n => n.id === noteId ? data : n))\n      setEditingNote(null)\n    }\n  }\n\n  const deleteNote = async (noteId: string) => {\n    const { error } = await supabase\n      .from('notes')\n      .delete()\n      .eq('id', noteId)\n\n    if (error) {\n      toast.error('Failed to delete note')\n    } else {\n      setNotes(notes.filter(n => n.id !== noteId))\n      toast.success('Note deleted')\n    }\n  }\n\n  const togglePinNote = async (note: LocalNote) => {\n    await updateNote(note.id, { is_pinned: !note.is_pinned })\n  }\n\n  const saveResponseAsNote = async (msg: ChatMessage) => {\n    const { data, error } = await supabase\n      .from('notes')\n      .insert({\n        notebook_id: notebookId,\n        type: 'saved_response',\n        title: `Saved Response - ${new Date().toLocaleDateString()}`,\n        content: msg.content,\n        tags: [],\n      })\n      .select()\n      .single()\n\n    if (error) {\n      toast.error('Failed to save response')\n    } else {\n      toast.success('Response saved as note!')\n      setNotes([data, ...notes])\n    }\n  }\n\n  // Audio generation\n  const generateAudio = async () => {\n    if (selectedSources.size === 0) {\n      toast.error('Please select at least one source')\n      return\n    }\n\n    setGeneratingAudio(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/audio`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          format: audioFormat,\n          source_ids: Array.from(selectedSources),\n          custom_instructions: audioInstructions || undefined,\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else {\n        toast.success('Audio script generated! (Demo mode - no actual audio file)')\n      }\n    } catch {\n      toast.error('Failed to generate audio')\n    }\n    setGeneratingAudio(false)\n  }\n\n  // Video generation\n  const generateVideo = async () => {\n    if (selectedSources.size === 0) {\n      toast.error('Please select at least one source')\n      return\n    }\n\n    setGeneratingVideo(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/video`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          style: videoStyle,\n          source_ids: Array.from(selectedSources),\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else {\n        toast.success('Video script generated! (Demo mode - no actual video file)')\n      }\n    } catch {\n      toast.error('Failed to generate video')\n    }\n    setGeneratingVideo(false)\n  }\n\n  // Research generation\n  const runResearch = async () => {\n    if (!researchQuery.trim()) {\n      toast.error('Please enter a research query')\n      return\n    }\n\n    setResearching(true)\n    try {\n      const { data: { session } } = await supabase.auth.getSession()\n      const response = await fetch(`/api/notebooks/${notebookId}/research`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({\n          query: researchQuery,\n          mode: researchMode,\n        }),\n      })\n      const result = await response.json()\n      if (result.error) {\n        toast.error(result.error)\n      } else {\n        toast.success('Research report generated!')\n        setResearchQuery('')\n      }\n    } catch {\n      toast.error('Failed to run research')\n    }\n    setResearching(false)\n  }\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'ready':\n        return <CheckCircle className=\"h-4 w-4 text-green-500\" />\n      case 'processing':\n        return <Clock className=\"h-4 w-4 text-yellow-500 animate-spin\" />\n      case 'failed':\n        return <XCircle className=\"h-4 w-4 text-red-500\" />\n      default:\n        return <Clock className=\"h-4 w-4 text-muted-foreground\" />\n    }\n  }\n\n  const getSourceIcon = (type: string) => {\n    switch (type) {\n      case 'pdf':\n      case 'docx':\n      case 'txt':\n        return <FileText className=\"h-4 w-4\" />\n      case 'youtube':\n        return <Youtube className=\"h-4 w-4\" />\n      case 'url':\n        return <LinkIcon className=\"h-4 w-4\" />\n      case 'text':\n        return <Type className=\"h-4 w-4\" />\n      default:\n        return <FileText className=\"h-4 w-4\" />\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"h-screen flex flex-col overflow-hidden\">\n      {/* Header */}\n      <header className=\"border-b px-4 py-3 flex items-center gap-4 shrink-0\">\n        <Button variant=\"ghost\" size=\"sm\" onClick={() => router.push('/')}>\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back\n        </Button>\n        <Separator orientation=\"vertical\" className=\"h-6\" />\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-xl\">{notebook?.emoji}</span>\n          <h1 className=\"font-semibold\">{notebook?.name}</h1>\n        </div>\n        <Badge variant=\"secondary\">{sources.length} sources</Badge>\n        <div className=\"ml-auto flex items-center gap-2\">\n          <Badge variant=\"outline\" className=\"text-xs\">\n            {selectedSources.size} selected\n          </Badge>\n        </div>\n      </header>\n\n      {/* Three Panel Layout */}\n      <div className=\"flex-1 grid grid-cols-[256px_1fr_320px] overflow-hidden\">\n        {/* Left Panel - Sources */}\n        <div className=\"border-r flex flex-col bg-background h-full min-h-0\">\n          <div className=\"p-4 border-b shrink-0\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <h2 className=\"font-semibold\">Sources</h2>\n              <Dialog open={addSourceOpen} onOpenChange={setAddSourceOpen}>\n                <DialogTrigger asChild>\n                  <Button size=\"sm\" variant=\"outline\">\n                    <Plus className=\"h-4 w-4\" />\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>Add Source</DialogTitle>\n                    <DialogDescription>\n                      Add documents, URLs, or text to your notebook\n                    </DialogDescription>\n                  </DialogHeader>\n                  <Tabs value={sourceType} onValueChange={(v) => setSourceType(v as typeof sourceType)}>\n                    <TabsList className=\"grid grid-cols-4 w-full\">\n                      <TabsTrigger value=\"file\"><Upload className=\"h-4 w-4\" /></TabsTrigger>\n                      <TabsTrigger value=\"youtube\"><Youtube className=\"h-4 w-4\" /></TabsTrigger>\n                      <TabsTrigger value=\"url\"><LinkIcon className=\"h-4 w-4\" /></TabsTrigger>\n                      <TabsTrigger value=\"text\"><Type className=\"h-4 w-4\" /></TabsTrigger>\n                    </TabsList>\n                    <TabsContent value=\"file\" className=\"space-y-4\">\n                      <input\n                        ref={fileInputRef}\n                        type=\"file\"\n                        accept=\".pdf,.docx,.txt,.md\"\n                        onChange={handleFileUpload}\n                        className=\"hidden\"\n                      />\n                      <Button\n                        variant=\"outline\"\n                        className=\"w-full h-24\"\n                        onClick={() => fileInputRef.current?.click()}\n                        disabled={uploading}\n                      >\n                        {uploading ? (\n                          <Loader2 className=\"h-6 w-6 animate-spin\" />\n                        ) : (\n                          <div className=\"text-center\">\n                            <Upload className=\"h-6 w-6 mx-auto mb-2\" />\n                            <p className=\"text-sm\">Click to upload</p>\n                            <p className=\"text-xs text-muted-foreground\">PDF, DOCX, TXT</p>\n                          </div>\n                        )}\n                      </Button>\n                    </TabsContent>\n                    <TabsContent value=\"youtube\" className=\"space-y-4\">\n                      <Input\n                        placeholder=\"YouTube URL\"\n                        value={sourceInput}\n                        onChange={(e) => setSourceInput(e.target.value)}\n                      />\n                      <Input\n                        placeholder=\"Name (optional)\"\n                        value={sourceName}\n                        onChange={(e) => setSourceName(e.target.value)}\n                      />\n                    </TabsContent>\n                    <TabsContent value=\"url\" className=\"space-y-4\">\n                      <Input\n                        placeholder=\"Website URL\"\n                        value={sourceInput}\n                        onChange={(e) => setSourceInput(e.target.value)}\n                      />\n                      <Input\n                        placeholder=\"Name (optional)\"\n                        value={sourceName}\n                        onChange={(e) => setSourceName(e.target.value)}\n                      />\n                    </TabsContent>\n                    <TabsContent value=\"text\" className=\"space-y-4\">\n                      <Input\n                        placeholder=\"Name\"\n                        value={sourceName}\n                        onChange={(e) => setSourceName(e.target.value)}\n                      />\n                      <Textarea\n                        placeholder=\"Paste your text here...\"\n                        value={sourceInput}\n                        onChange={(e) => setSourceInput(e.target.value)}\n                        rows={6}\n                      />\n                    </TabsContent>\n                  </Tabs>\n                  {sourceType !== 'file' && (\n                    <DialogFooter>\n                      <Button onClick={addSource} disabled={uploading || !sourceInput.trim()}>\n                        {uploading && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                        Add Source\n                      </Button>\n                    </DialogFooter>\n                  )}\n                </DialogContent>\n              </Dialog>\n            </div>\n            {sources.length > 0 && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"w-full justify-start text-xs\"\n                onClick={selectAllSources}\n              >\n                {selectedSources.size === sources.length ? 'Deselect All' : 'Select All'}\n              </Button>\n            )}\n          </div>\n          <div className=\"flex-1 min-h-0 overflow-y-auto\">\n            <div className=\"p-2 space-y-1\">\n              {sources.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <FileText className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                  <p className=\"text-sm\">No sources yet</p>\n                  <p className=\"text-xs\">Add documents to get started</p>\n                </div>\n              ) : (\n                sources.map((source) => (\n                  <div\n                    key={source.id}\n                    className={`p-2 rounded-lg flex items-center gap-2 group ${\n                      selectedSources.has(source.id) ? 'bg-primary/10' : 'hover:bg-muted'\n                    } ${viewingSource?.id === source.id ? 'ring-2 ring-primary' : ''}`}\n                  >\n                    <input\n                      type=\"checkbox\"\n                      checked={selectedSources.has(source.id)}\n                      onChange={() => toggleSource(source.id)}\n                      className=\"rounded cursor-pointer\"\n                    />\n                    {getSourceIcon(source.type)}\n                    <span\n                      className=\"flex-1 text-sm truncate cursor-pointer hover:underline select-text\"\n                      onClick={() => setViewingSource(source)}\n                    >\n                      {source.name}\n                    </span>\n                    {getStatusIcon(source.status)}\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"opacity-0 group-hover:opacity-100 h-6 w-6 p-0\"\n                      onClick={() => deleteSource(source.id)}\n                    >\n                      <Trash2 className=\"h-3 w-3\" />\n                    </Button>\n                  </div>\n                ))\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Center Panel - Chat or Source Preview */}\n        <div className=\"flex flex-col h-full min-h-0\">\n          {/* Source Preview */}\n          {viewingSource && (\n            <div className=\"border-b bg-muted/30 shrink-0\">\n              <div className=\"max-w-3xl mx-auto p-4\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <div className=\"flex items-center gap-2\">\n                    {getSourceIcon(viewingSource.type)}\n                    <h3 className=\"font-medium\">{viewingSource.name}</h3>\n                    <Badge variant=\"outline\" className=\"text-xs\">{viewingSource.type}</Badge>\n                  </div>\n                  <Button variant=\"ghost\" size=\"sm\" onClick={() => setViewingSource(null)}>\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n                <div className=\"bg-background rounded-lg border p-4 max-h-48 overflow-y-auto\">\n                  {viewingSource.type === 'text' && viewingSource.metadata?.content ? (\n                    <p className=\"text-sm whitespace-pre-wrap select-text\">{viewingSource.metadata.content}</p>\n                  ) : viewingSource.type === 'youtube' && viewingSource.metadata?.url ? (\n                    <div className=\"space-y-2\">\n                      <p className=\"text-sm text-muted-foreground\">YouTube URL:</p>\n                      <a href={viewingSource.metadata.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-sm text-primary hover:underline break-all select-text\">\n                        {viewingSource.metadata.url}\n                      </a>\n                    </div>\n                  ) : viewingSource.type === 'url' && viewingSource.metadata?.url ? (\n                    <div className=\"space-y-2\">\n                      <p className=\"text-sm text-muted-foreground\">Website URL:</p>\n                      <a href={viewingSource.metadata.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-sm text-primary hover:underline break-all select-text\">\n                        {viewingSource.metadata.url}\n                      </a>\n                    </div>\n                  ) : viewingSource.file_path ? (\n                    <div className=\"space-y-2\">\n                      <p className=\"text-sm text-muted-foreground\">File: {viewingSource.original_filename || viewingSource.name}</p>\n                      <p className=\"text-xs text-muted-foreground\">Size: {viewingSource.file_size_bytes ? `${(viewingSource.file_size_bytes / 1024).toFixed(1)} KB` : 'Unknown'}</p>\n                    </div>\n                  ) : (\n                    <p className=\"text-sm text-muted-foreground\">No preview available</p>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex-1 min-h-0 overflow-y-auto p-4\">\n            <div className=\"max-w-3xl mx-auto space-y-4\">\n              {messages.length === 0 ? (\n                <div className=\"text-center py-16\">\n                  <Sparkles className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n                  <h3 className=\"text-lg font-medium mb-2\">Start a Conversation</h3>\n                  <p className=\"text-muted-foreground mb-4\">\n                    Ask questions about your sources\n                  </p>\n                  <div className=\"flex flex-wrap justify-center gap-2\">\n                    {['Summarize the main points', 'What are the key takeaways?', 'Explain the methodology'].map((q) => (\n                      <Button\n                        key={q}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => setMessage(q)}\n                      >\n                        {q}\n                      </Button>\n                    ))}\n                  </div>\n                </div>\n              ) : (\n                messages.map((msg) => (\n                  <div\n                    key={msg.id}\n                    className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}\n                  >\n                    <div\n                      className={`max-w-[80%] rounded-2xl px-4 py-3 ${\n                        msg.role === 'user'\n                          ? 'bg-primary text-primary-foreground'\n                          : 'bg-muted'\n                      }`}\n                    >\n                      <p className=\"whitespace-pre-wrap text-sm select-text\">{msg.content}</p>\n                      {msg.role === 'assistant' && (\n                        <div className=\"flex items-center gap-2 mt-2 pt-2 border-t border-border/50\">\n                          {msg.cost_usd !== null && msg.cost_usd > 0 && (\n                            <span className=\"text-xs opacity-70\">\n                              Cost: ${msg.cost_usd.toFixed(4)}\n                            </span>\n                          )}\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-6 text-xs ml-auto\"\n                            onClick={() => saveResponseAsNote(msg)}\n                          >\n                            <StickyNote className=\"h-3 w-3 mr-1\" />\n                            Save\n                          </Button>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                ))\n              )}\n              {sending && (\n                <div className=\"flex justify-start\">\n                  <div className=\"bg-muted rounded-2xl px-4 py-3\">\n                    <Loader2 className=\"h-5 w-5 animate-spin\" />\n                  </div>\n                </div>\n              )}\n              <div ref={messagesEndRef} />\n            </div>\n          </div>\n          <div className=\"p-4 border-t shrink-0\">\n            <div className=\"max-w-3xl mx-auto\">\n              {selectedSources.size === 0 && sources.length > 0 && (\n                <div className=\"flex items-center gap-2 mb-2 text-xs text-amber-600 bg-amber-50 dark:bg-amber-900/20 p-2 rounded-lg\">\n                  <AlertCircle className=\"h-4 w-4\" />\n                  Select sources from the left panel for contextual answers\n                </div>\n              )}\n              <div className=\"flex gap-2\">\n                <Input\n                  placeholder=\"Ask a question about your sources...\"\n                  value={message}\n                  onChange={(e) => setMessage(e.target.value)}\n                  onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && sendMessage()}\n                  disabled={sending}\n                />\n                <Button onClick={sendMessage} disabled={sending || !message.trim()}>\n                  <Send className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Right Panel - Studio */}\n        <div className=\"border-l flex flex-col bg-background h-full min-h-0\">\n          <Tabs value={studioTab} onValueChange={setStudioTab} className=\"flex flex-col h-full min-h-0\">\n            <div className=\"p-4 border-b shrink-0\">\n              <h2 className=\"font-semibold mb-2\">Studio</h2>\n              <TabsList className=\"grid grid-cols-3 w-full\">\n                <TabsTrigger value=\"audio\" className=\"text-xs\">\n                  <Mic className=\"h-3 w-3 mr-1\" />\n                  Audio\n                </TabsTrigger>\n                <TabsTrigger value=\"study\" className=\"text-xs\">\n                  <BookOpen className=\"h-3 w-3 mr-1\" />\n                  Study\n                </TabsTrigger>\n                <TabsTrigger value=\"notes\" className=\"text-xs\">\n                  <StickyNote className=\"h-3 w-3 mr-1\" />\n                  Notes\n                </TabsTrigger>\n              </TabsList>\n            </div>\n\n            <div className=\"flex-1 min-h-0 overflow-y-auto p-4\">\n              <TabsContent value=\"audio\" className=\"mt-0 space-y-4\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm flex items-center gap-2\">\n                      <Mic className=\"h-4 w-4\" />\n                      Audio Overview\n                    </CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      Generate a podcast-style discussion\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div>\n                      <label className=\"text-xs font-medium mb-1 block\">Format</label>\n                      <Select value={audioFormat} onValueChange={setAudioFormat}>\n                        <SelectTrigger className=\"h-8 text-xs\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"deep_dive\">Deep Dive (10-15 min)</SelectItem>\n                          <SelectItem value=\"brief\">Brief Summary (2-3 min)</SelectItem>\n                          <SelectItem value=\"critique\">Analytical Discussion (5-10 min)</SelectItem>\n                          <SelectItem value=\"debate\">Debate Format (8-15 min)</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <label className=\"text-xs font-medium mb-1 block\">Custom Instructions</label>\n                      <Textarea\n                        placeholder=\"Optional instructions for the hosts...\"\n                        value={audioInstructions}\n                        onChange={(e) => setAudioInstructions(e.target.value)}\n                        rows={2}\n                        className=\"text-xs\"\n                      />\n                    </div>\n                    <Button\n                      className=\"w-full\"\n                      size=\"sm\"\n                      onClick={generateAudio}\n                      disabled={generatingAudio || selectedSources.size === 0}\n                    >\n                      {generatingAudio ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <Mic className=\"h-4 w-4 mr-2\" />\n                      )}\n                      Generate Audio\n                    </Button>\n                    {selectedSources.size === 0 && (\n                      <p className=\"text-xs text-muted-foreground text-center\">\n                        Select sources to generate audio\n                      </p>\n                    )}\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm flex items-center gap-2\">\n                      <Video className=\"h-4 w-4\" />\n                      Video Overview\n                    </CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      Create a visual explainer video\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div>\n                      <label className=\"text-xs font-medium mb-1 block\">Style</label>\n                      <Select value={videoStyle} onValueChange={setVideoStyle}>\n                        <SelectTrigger className=\"h-8 text-xs\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"explainer\">Explainer</SelectItem>\n                          <SelectItem value=\"documentary\">Documentary</SelectItem>\n                          <SelectItem value=\"presentation\">Presentation</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <Button\n                      className=\"w-full\"\n                      size=\"sm\"\n                      onClick={generateVideo}\n                      disabled={generatingVideo || selectedSources.size === 0}\n                    >\n                      {generatingVideo ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <Video className=\"h-4 w-4 mr-2\" />\n                      )}\n                      Generate Video Script\n                    </Button>\n                    {selectedSources.size === 0 && (\n                      <p className=\"text-xs text-muted-foreground text-center\">\n                        Select sources to generate video\n                      </p>\n                    )}\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm flex items-center gap-2\">\n                      <Search className=\"h-4 w-4\" />\n                      Deep Research\n                    </CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      Autonomous web research agent\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div>\n                      <label className=\"text-xs font-medium mb-1 block\">Research Query</label>\n                      <Input\n                        placeholder=\"What would you like to research?\"\n                        value={researchQuery}\n                        onChange={(e) => setResearchQuery(e.target.value)}\n                        className=\"h-8 text-xs\"\n                      />\n                    </div>\n                    <div>\n                      <label className=\"text-xs font-medium mb-1 block\">Mode</label>\n                      <Select value={researchMode} onValueChange={setResearchMode}>\n                        <SelectTrigger className=\"h-8 text-xs\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"fast\">Fast (3-5 min)</SelectItem>\n                          <SelectItem value=\"deep\">Deep (10-15 min)</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <Button\n                      className=\"w-full\"\n                      size=\"sm\"\n                      onClick={runResearch}\n                      disabled={researching || !researchQuery.trim()}\n                    >\n                      {researching ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <Search className=\"h-4 w-4 mr-2\" />\n                      )}\n                      Start Research\n                    </Button>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"study\" className=\"mt-0 space-y-4\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm\">Study Materials</CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      Generate study aids from your sources\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"w-full justify-start\"\n                      disabled={selectedSources.size === 0 || generatingFlashcards}\n                      onClick={async () => {\n                        setGeneratingFlashcards(true)\n                        try {\n                          const { data: { session } } = await supabase.auth.getSession()\n                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n                            method: 'POST',\n                            headers: {\n                              'Content-Type': 'application/json',\n                              'Authorization': `Bearer ${session?.access_token}`,\n                            },\n                            body: JSON.stringify({\n                              type: 'flashcards',\n                              source_ids: Array.from(selectedSources),\n                              count: 5,\n                            }),\n                          })\n                          const result = await response.json()\n                          if (result.error) {\n                            toast.error(result.error)\n                          } else if (result.data?.flashcards) {\n                            setFlashcards(result.data.flashcards)\n                            setCurrentFlashcard(0)\n                            setShowFlashcardBack(false)\n                            toast.success(`Generated ${result.data.flashcards.length} flashcards!`)\n                          } else {\n                            toast.error('Unexpected response')\n                          }\n                        } catch (err) {\n                          console.error('Flashcards error:', err)\n                          toast.error('Failed to generate flashcards')\n                        } finally {\n                          setGeneratingFlashcards(false)\n                        }\n                      }}\n                    >\n                      {generatingFlashcards ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <BookOpen className=\"h-4 w-4 mr-2\" />\n                      )}\n                      {generatingFlashcards ? 'Generating...' : 'Generate Flashcards'}\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"w-full justify-start\"\n                      disabled={selectedSources.size === 0 || generatingQuiz}\n                      onClick={async () => {\n                        setGeneratingQuiz(true)\n                        try {\n                          const { data: { session } } = await supabase.auth.getSession()\n                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n                            method: 'POST',\n                            headers: {\n                              'Content-Type': 'application/json',\n                              'Authorization': `Bearer ${session?.access_token}`,\n                            },\n                            body: JSON.stringify({\n                              type: 'quiz',\n                              source_ids: Array.from(selectedSources),\n                              count: 5,\n                            }),\n                          })\n                          const result = await response.json()\n                          if (result.error) {\n                            toast.error(result.error)\n                          } else if (result.data?.questions) {\n                            setQuizQuestions(result.data.questions)\n                            setCurrentQuizQuestion(0)\n                            setSelectedAnswer(null)\n                            setShowQuizAnswer(false)\n                            toast.success(`Generated ${result.data.questions.length} quiz questions!`)\n                          } else {\n                            toast.error('Unexpected response')\n                          }\n                        } catch (err) {\n                          console.error('Quiz error:', err)\n                          toast.error('Failed to generate quiz')\n                        } finally {\n                          setGeneratingQuiz(false)\n                        }\n                      }}\n                    >\n                      {generatingQuiz ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <CheckCircle className=\"h-4 w-4 mr-2\" />\n                      )}\n                      {generatingQuiz ? 'Generating...' : 'Generate Quiz'}\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"w-full justify-start\"\n                      disabled={selectedSources.size === 0 || generatingStudyGuide}\n                      onClick={async () => {\n                        setGeneratingStudyGuide(true)\n                        try {\n                          const { data: { session } } = await supabase.auth.getSession()\n                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n                            method: 'POST',\n                            headers: {\n                              'Content-Type': 'application/json',\n                              'Authorization': `Bearer ${session?.access_token}`,\n                            },\n                            body: JSON.stringify({\n                              type: 'study-guide',\n                              source_ids: Array.from(selectedSources),\n                            }),\n                          })\n                          const result = await response.json()\n                          if (result.error) {\n                            toast.error(result.error)\n                          } else if (result.data?.sections) {\n                            setStudyGuide(result.data)\n                            toast.success('Study guide generated!')\n                          } else {\n                            toast.error('Unexpected response')\n                          }\n                        } catch (err) {\n                          console.error('Study guide error:', err)\n                          toast.error('Failed to generate study guide')\n                        } finally {\n                          setGeneratingStudyGuide(false)\n                        }\n                      }}\n                    >\n                      {generatingStudyGuide ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <FileText className=\"h-4 w-4 mr-2\" />\n                      )}\n                      {generatingStudyGuide ? 'Generating...' : 'Generate Study Guide'}\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"w-full justify-start\"\n                      disabled={selectedSources.size === 0 || generatingFaq}\n                      onClick={async () => {\n                        setGeneratingFaq(true)\n                        try {\n                          const { data: { session } } = await supabase.auth.getSession()\n                          const response = await fetch(`/api/notebooks/${notebookId}/study`, {\n                            method: 'POST',\n                            headers: {\n                              'Content-Type': 'application/json',\n                              'Authorization': `Bearer ${session?.access_token}`,\n                            },\n                            body: JSON.stringify({\n                              type: 'faq',\n                              source_ids: Array.from(selectedSources),\n                            }),\n                          })\n                          const result = await response.json()\n                          if (result.error) {\n                            toast.error(result.error)\n                          } else if (result.data?.faq) {\n                            setFaqItems(result.data.faq)\n                            toast.success(`Generated ${result.data.faq.length} FAQ items!`)\n                          } else {\n                            toast.error('Unexpected response')\n                          }\n                        } catch (err) {\n                          console.error('FAQ error:', err)\n                          toast.error('Failed to generate FAQ')\n                        } finally {\n                          setGeneratingFaq(false)\n                        }\n                      }}\n                    >\n                      {generatingFaq ? (\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      ) : (\n                        <AlertCircle className=\"h-4 w-4 mr-2\" />\n                      )}\n                      {generatingFaq ? 'Generating...' : 'Generate FAQ'}\n                    </Button>\n                  </CardContent>\n                </Card>\n\n                {/* Flashcards Display */}\n                {flashcards.length > 0 && (\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-sm\">Flashcards</CardTitle>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setFlashcards([])}>\n                          <X className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                      <CardDescription className=\"text-xs\">\n                        {currentFlashcard + 1} of {flashcards.length}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <div\n                        className=\"bg-muted rounded-lg p-4 min-h-[120px] cursor-pointer select-text\"\n                        onClick={() => setShowFlashcardBack(!showFlashcardBack)}\n                      >\n                        <p className=\"text-xs text-muted-foreground mb-1\">\n                          {showFlashcardBack ? 'Answer' : 'Question'} (click to flip)\n                        </p>\n                        <p className=\"text-sm\">\n                          {showFlashcardBack ? flashcards[currentFlashcard]?.back : flashcards[currentFlashcard]?.front}\n                        </p>\n                      </div>\n                      <div className=\"flex gap-2 mt-3\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"flex-1\"\n                          disabled={currentFlashcard === 0}\n                          onClick={() => { setCurrentFlashcard(c => c - 1); setShowFlashcardBack(false) }}\n                        >\n                          Previous\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"flex-1\"\n                          disabled={currentFlashcard === flashcards.length - 1}\n                          onClick={() => { setCurrentFlashcard(c => c + 1); setShowFlashcardBack(false) }}\n                        >\n                          Next\n                        </Button>\n                      </div>\n                    </CardContent>\n                  </Card>\n                )}\n\n                {/* Quiz Display */}\n                {quizQuestions.length > 0 && (\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-sm\">Quiz</CardTitle>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setQuizQuestions([])}>\n                          <X className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                      <CardDescription className=\"text-xs\">\n                        Question {currentQuizQuestion + 1} of {quizQuestions.length}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-sm font-medium mb-3\">{quizQuestions[currentQuizQuestion]?.question}</p>\n                      <div className=\"space-y-2\">\n                        {quizQuestions[currentQuizQuestion]?.options.map((option, i) => (\n                          <button\n                            key={i}\n                            className={`w-full text-left p-2 rounded text-xs border transition-colors ${\n                              showQuizAnswer\n                                ? i === quizQuestions[currentQuizQuestion]?.correct_index\n                                  ? 'bg-green-100 border-green-500 dark:bg-green-900/30'\n                                  : selectedAnswer === i\n                                  ? 'bg-red-100 border-red-500 dark:bg-red-900/30'\n                                  : 'bg-muted'\n                                : selectedAnswer === i\n                                ? 'bg-primary/10 border-primary'\n                                : 'bg-muted hover:bg-muted/80'\n                            }`}\n                            onClick={() => !showQuizAnswer && setSelectedAnswer(i)}\n                            disabled={showQuizAnswer}\n                          >\n                            {option}\n                          </button>\n                        ))}\n                      </div>\n                      {selectedAnswer !== null && !showQuizAnswer && (\n                        <Button\n                          size=\"sm\"\n                          className=\"w-full mt-3\"\n                          onClick={() => setShowQuizAnswer(true)}\n                        >\n                          Check Answer\n                        </Button>\n                      )}\n                      {showQuizAnswer && (\n                        <>\n                          <p className=\"text-xs text-muted-foreground mt-3 p-2 bg-muted rounded\">\n                            {quizQuestions[currentQuizQuestion]?.explanation}\n                          </p>\n                          <Button\n                            size=\"sm\"\n                            className=\"w-full mt-2\"\n                            disabled={currentQuizQuestion === quizQuestions.length - 1}\n                            onClick={() => {\n                              setCurrentQuizQuestion(c => c + 1)\n                              setSelectedAnswer(null)\n                              setShowQuizAnswer(false)\n                            }}\n                          >\n                            Next Question\n                          </Button>\n                        </>\n                      )}\n                    </CardContent>\n                  </Card>\n                )}\n\n                {/* Study Guide Display */}\n                {studyGuide && (\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-sm\">{studyGuide.title}</CardTitle>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setStudyGuide(null)}>\n                          <X className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      {studyGuide.sections.map((section, i) => (\n                        <div key={i}>\n                          <h4 className=\"text-xs font-semibold mb-1\">{section.heading}</h4>\n                          <p className=\"text-xs text-muted-foreground whitespace-pre-wrap select-text\">\n                            {section.content}\n                          </p>\n                        </div>\n                      ))}\n                    </CardContent>\n                  </Card>\n                )}\n\n                {/* FAQ Display */}\n                {faqItems.length > 0 && (\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-sm\">FAQ</CardTitle>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setFaqItems([])}>\n                          <X className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      {faqItems.map((item, i) => (\n                        <div key={i} className=\"border-b pb-2 last:border-0\">\n                          <p className=\"text-xs font-semibold mb-1\">Q: {item.question}</p>\n                          <p className=\"text-xs text-muted-foreground select-text\">A: {item.answer}</p>\n                        </div>\n                      ))}\n                    </CardContent>\n                  </Card>\n                )}\n\n                {selectedSources.size === 0 && (\n                  <p className=\"text-xs text-muted-foreground text-center\">\n                    Select sources to generate study materials\n                  </p>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"notes\" className=\"mt-0 space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <h3 className=\"text-sm font-medium\">Your Notes</h3>\n                  <Dialog open={addNoteOpen} onOpenChange={setAddNoteOpen}>\n                    <DialogTrigger asChild>\n                      <Button size=\"sm\" variant=\"outline\">\n                        <Plus className=\"h-4 w-4\" />\n                      </Button>\n                    </DialogTrigger>\n                    <DialogContent>\n                      <DialogHeader>\n                        <DialogTitle>Create Note</DialogTitle>\n                      </DialogHeader>\n                      <div className=\"space-y-4\">\n                        <div>\n                          <label className=\"text-sm font-medium\">Title</label>\n                          <Input\n                            placeholder=\"Note title...\"\n                            value={noteTitle}\n                            onChange={(e) => setNoteTitle(e.target.value)}\n                          />\n                        </div>\n                        <div>\n                          <label className=\"text-sm font-medium\">Content</label>\n                          <Textarea\n                            placeholder=\"Write your note...\"\n                            value={noteContent}\n                            onChange={(e) => setNoteContent(e.target.value)}\n                            rows={6}\n                          />\n                        </div>\n                      </div>\n                      <DialogFooter>\n                        <Button onClick={createNote} disabled={savingNote}>\n                          {savingNote && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                          Create Note\n                        </Button>\n                      </DialogFooter>\n                    </DialogContent>\n                  </Dialog>\n                </div>\n\n                {notes.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    <StickyNote className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                    <p className=\"text-sm\">No notes yet</p>\n                    <p className=\"text-xs\">Create notes or save chat responses</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-2\">\n                    {notes.map((note) => (\n                      <Card key={note.id} className=\"relative\">\n                        <CardHeader className=\"pb-2\">\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex items-center gap-2\">\n                              {note.is_pinned && <Pin className=\"h-3 w-3 text-primary\" />}\n                              <CardTitle className=\"text-sm\">\n                                {note.title || 'Untitled'}\n                              </CardTitle>\n                            </div>\n                            <div className=\"flex items-center gap-1\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                className=\"h-6 w-6 p-0\"\n                                onClick={() => togglePinNote(note)}\n                              >\n                                <Pin className={`h-3 w-3 ${note.is_pinned ? 'text-primary' : ''}`} />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                className=\"h-6 w-6 p-0\"\n                                onClick={() => deleteNote(note.id)}\n                              >\n                                <Trash2 className=\"h-3 w-3\" />\n                              </Button>\n                            </div>\n                          </div>\n                          <CardDescription className=\"text-xs\">\n                            {note.type === 'saved_response' ? 'Saved from chat' : 'Note'}\n                            {' · '}\n                            {new Date(note.created_at).toLocaleDateString()}\n                          </CardDescription>\n                        </CardHeader>\n                        <CardContent>\n                          <p className=\"text-xs text-muted-foreground line-clamp-3\">\n                            {note.content || 'No content'}\n                          </p>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n            </div>\n          </Tabs>\n        </div>\n      </div>\n    </div>\n  )\n}\n"}}
{"parentUuid":"e8719823-f664-43df-b7ff-a62ac495e35b","isSidechain":true,"userType":"external","cwd":"/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend","sessionId":"b89e905c-1d35-4357-859f-6479f9909283","version":"2.0.76","gitBranch":"","agentId":"a3d82b4","slug":"enumerated-swinging-ripple","message":{"model":"claude-opus-4-5-20251101","id":"msg_019CguNWLXExCaMrdKLjGmL3","type":"message","role":"assistant","content":[{"type":"text","text":"I have completely redesigned the notebook page to look like Google's NotebookLM with a clean, modern, and professional aesthetic. Here is a summary of the key design changes:\n\n## Design Improvements Made\n\n### `/Users/marwankashef/Desktop/YouTube/NotebookLM Re-Mastered/frontend/src/app/notebooks/[id]/page.tsx`\n\n**Header (Line 727-753)**\n- Clean, minimal header with backdrop blur effect\n- Subtle badge styling for source count and selection\n- Improved spacing and typography\n\n**Left Panel - Sources (Line 758-973)**\n- Soft muted background (`bg-muted/30`) instead of plain white\n- Custom checkbox design with smooth transitions\n- Color-coded source type icons (blue for files, red for YouTube, violet for URLs)\n- Hover states with subtle opacity reveals for delete buttons\n- Empty state with centered icon in a circular container\n- Clean dashed border upload zone in the dialog\n\n**Center Panel - Chat (Line 975-1160)**\n- Modern message bubbles with asymmetric corners (`rounded-br-md` for user, `rounded-bl-md` for AI)\n- Gradient background for the empty state sparkle icon\n- Pill-shaped suggestion buttons\n- Better input field with larger hit target (`h-12`) and rounded corners (`rounded-xl`)\n- Subtle loading state with \"Thinking...\" text\n- Tooltips on action buttons (Copy, Save as note)\n\n**Right Panel - Studio (Line 1162-1615)**\n- Collapsible accordion sections instead of cramped tabs\n- Each section has a gradient icon background (orange for audio, purple for video, blue for research, emerald for study, amber for notes)\n- Smooth chevron rotation animation on expand/collapse\n- 2x2 grid layout for study material buttons with icons\n- Generated materials list with chevron arrows for navigation\n\n**Study Materials Sheet (Line 1618-1795)**\n- Slide-over panel (`Sheet` component) instead of inline display\n- Beautiful flashcard design with gradient background and flip interaction\n- Quiz with color-coded correct/incorrect answers (emerald/red)\n- Reset button with rotate icon\n- Proper spacing and typography hierarchy\n\n**Visual Polish**\n- Consistent `rounded-xl` for cards and inputs\n- Subtle `ring` states for selection\n- Smooth `transition-all` and `transition-colors` throughout\n- Proper color palette using Tailwind's semantic colors (emerald, amber, purple, etc.)\n- Dark mode support via `dark:` variants\n- Better whitespace and breathing room between elements\n\nThe redesign maintains all existing functionality while providing a polished, Google NotebookLM-like experience that is modern, clean, and professional."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":82703,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":82703,"ephemeral_1h_input_tokens":0},"output_tokens":626,"service_tier":"standard"}},"requestId":"req_011CWZ83nPP9HnQNGzP8CSPi","type":"assistant","uuid":"bc628505-04b9-4b24-bbd9-763be3b8d06b","timestamp":"2025-12-28T12:57:05.410Z"}
